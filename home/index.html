<!-- TNT — /home/index.html
     · 12-DIRECTION INDEX + RUSSIAN DOLL + PROJECT JUMPS

     WHAT THIS FIXES:
       - Mobile header no longer eats the whole screen
       - Bottom dock never cuts off buttons (2-row grid on small screens)
       - Russian doll scroll prevents bottoming out
       - JUMPS table supports 12 per-direction project links (fill paths)

     CANON KEYS ONLY:
       gd_lang / gd_style / gd_time
-->

<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>HUB A · Index</title>

<link rel="stylesheet" href="/assets/ui.css"/>
<link rel="stylesheet" href="/assets/branch.css"/>

<style>
/* DO NOT TOUCH FIELD — ui.css owns html/body background */
body{margin:0;color:#fff;font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif}
a{color:inherit;text-decoration:none}
:root{--dockH:92px}

.wrap{
  width:min(980px,94vw);
  margin:0 auto;
  padding:14px 0 calc(var(--dockH) + 22px);
  display:flex;
  flex-direction:column;
  gap:12px;
}

/* ===== Header (reduced height, mobile safe) ===== */
.brand{
  border:1px solid rgba(255,255,255,.10);
  border-radius:22px;
  padding:14px 16px;
  background:rgba(0,0,0,.14);
  backdrop-filter:blur(10px);
  box-shadow:0 24px 80px rgba(0,0,0,.55);
}
.brand .k{font-size:11px;letter-spacing:4px;text-transform:uppercase;opacity:.70;margin:0 0 6px}
.brand .t{font-weight:950;font-size:24px;letter-spacing:.3px;margin:0 0 6px}
.brand .s{font-size:13px;opacity:.80;line-height:1.5;margin:0;max-width:820px}

/* ===== Controls ===== */
.controls{
  display:flex;
  justify-content:flex-end;
  gap:10px;
  flex-wrap:wrap;
  margin-top:10px;
}
.seg{
  display:inline-flex;
  border:1px solid rgba(255,255,255,.12);
  border-radius:999px;
  overflow:hidden;
  background:rgba(0,0,0,.18);
  backdrop-filter:blur(10px);
  box-shadow:0 12px 34px rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.07);
}
.seg button{
  border:0;background:transparent;color:rgba(255,255,255,.86);
  padding:9px 14px;font-weight:950;letter-spacing:.2px;cursor:pointer;
  -webkit-tap-highlight-color:transparent;
}
.seg button.on{background:rgba(255,255,255,.15);color:#fff}

/* ===== Direction bubble ===== */
.dir{
  --c:#93C5FD;
  border:1px solid rgba(255,255,255,.10);
  border-radius:18px;
  background:
    radial-gradient(circle at 30% 20%, rgba(255,255,255,.06), transparent 55%),
    linear-gradient(160deg, rgba(12,22,38,.92), rgba(7,11,18,.95));
  box-shadow:0 18px 60px rgba(0,0,0,.62);
  overflow:hidden;
}
.dHead{
  display:flex;align-items:center;justify-content:space-between;gap:10px;
  padding:14px 16px;cursor:pointer;font-weight:950;letter-spacing:.2px;
}
.dLeft{display:flex;align-items:center;gap:10px;min-width:0}
.diamond{
  width:12px;height:12px;transform:rotate(45deg);border-radius:4px;background:var(--c);
  box-shadow:0 0 0 1px rgba(255,255,255,.12),0 0 14px rgba(0,0,0,.35);
  flex:0 0 auto;pointer-events:none;
}
.dLabel{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.dBody{
  display:none;
  padding:12px 14px 14px;
  border-top:1px solid rgba(255,255,255,.08);

  /* Russian doll */
  overflow:auto;
  -webkit-overflow-scrolling:touch;
}
.dir.open .dBody{display:block}

/* ===== Lens blocks ===== */
.lensBlock{
  border:1px solid rgba(255,255,255,.10);
  border-radius:14px;
  padding:12px 14px;
  background:rgba(0,0,0,.18);
  margin-bottom:10px;
  box-shadow:inset 0 1px 0 rgba(255,255,255,.05);
}
.lensTitle{font-weight:950;font-size:12px;margin:0 0 8px;opacity:.88}
.paragraph{margin:0;line-height:1.72;font-size:14.5px;color:rgba(255,255,255,.90)}

/* ===== Index jump ===== */
.indexLine{
  margin-top:10px;
  padding:10px 12px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(0,0,0,.14);
  font-size:12.5px;
  color:rgba(255,255,255,.80);
}
.indexLine a{color:#93C5FD;font-weight:950;text-decoration:none}

/* ===== View filter ===== */
.view-formal .lensBlock[data-lens="informal"]{display:none}
.view-informal .lensBlock[data-lens="formal"]{display:none}
.view-both .lensBlock{display:block}

/* ===== Bottom dock (mobile-safe grid) ===== */
.bottomDock{
  position:fixed;
  left:50%;
  bottom:max(10px, env(safe-area-inset-bottom));
  transform:translateX(-50%);
  z-index:220;
  width:min(980px,94vw);
  padding:10px 12px;
  border-radius:22px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(0,0,0,.22);
  backdrop-filter:blur(10px);
  box-shadow:0 18px 60px rgba(0,0,0,.55);

  display:grid;
  grid-template-columns:repeat(4, minmax(0,1fr));
  gap:10px;
}
.dbtn{
  border:1px solid rgba(255,255,255,.14);
  background:rgba(0,0,0,.20);
  color:#fff;
  padding:10px 10px;
  border-radius:999px;
  font-weight:900;
  letter-spacing:.2px;
  cursor:pointer;
  -webkit-tap-highlight-color:transparent;
  text-align:center;
  white-space:nowrap;
}
.dbtn:hover{background:rgba(255,255,255,.10)}
.dbtn.wide{grid-column:span 2;}
.dbtn.full{grid-column:1 / -1;}

@media (max-width:520px){
  .brand .t{font-size:22px}
  .bottomDock{grid-template-columns:repeat(3, minmax(0,1fr))}
  .dbtn.wide{grid-column:span 3;}
}
</style>
</head>

<body>

<div class="wrap">

  <div class="brand" id="brand">
    <div class="k" id="bk">CARDINAL AXIS</div>
    <div class="t" id="bt">HUB A · Index</div>
    <p class="s" id="bs">12-direction index. Each direction opens into one summary paragraph per lens, plus a project jump.</p>

    <div class="controls">
      <div class="seg" aria-label="View">
        <button id="viewInformal" type="button">INFORMAL</button>
        <button id="viewFormal" type="button">FORMAL</button>
        <button id="viewBoth" type="button">BOTH</button>
      </div>
      <div class="seg" aria-label="Language">
        <button id="langEN" type="button">EN</button>
        <button id="langZH" type="button">中文</button>
      </div>
    </div>
  </div>

  <div id="root"></div>

</div>

<div class="bottomDock" aria-label="Navigation" id="dock">
  <button class="dbtn" id="navBack" type="button">BACK</button>
  <button class="dbtn" id="navForward" type="button">FORWARD</button>
  <button class="dbtn" id="navHub" type="button">HUB</button>
  <button class="dbtn" id="navExplore" type="button">EXPLORE</button>

  <button class="dbtn" id="navProducts" type="button">PRODUCTS</button>
  <button class="dbtn" id="navLaws" type="button">LAWS</button>
  <button class="dbtn" id="navGauges" type="button">GAUGES</button>
  <button class="dbtn" id="navTop" type="button">TOP</button>

  <button class="dbtn full" id="navJump" type="button">JUMP (OPEN PROJECT)</button>
</div>

<script>
(function(){
  /* ===== Canon keys ===== */
  const qs=new URLSearchParams(location.search);
  let gd_lang  = qs.get("gd_lang")  || localStorage.getItem("gd_lang")  || "en";
  let gd_style = qs.get("gd_style") || localStorage.getItem("gd_style") || "informal";
  let gd_time  = qs.get("gd_time")  || localStorage.getItem("gd_time")  || "now";

  if(gd_lang!=="en" && gd_lang!=="zh") gd_lang="en";
  if(gd_style!=="formal" && gd_style!=="informal") gd_style="informal";
  if(gd_time==="trajectory") gd_time="post";
  if(gd_time!=="origin" && gd_time!=="now" && gd_time!=="post") gd_time="now";

  try{
    localStorage.setItem("gd_lang",gd_lang);
    localStorage.setItem("gd_style",gd_style);
    localStorage.setItem("gd_time",gd_time);
  }catch(e){}
  document.documentElement.lang = (gd_lang==="zh") ? "zh" : "en";

  function makeQS(){
    const p=new URLSearchParams();
    p.set("gd_lang",gd_lang);
    p.set("gd_style",gd_style);
    p.set("gd_time",gd_time);
    return "?"+p.toString();
  }
  function nav(path){ location.href = path + makeQS(); }

  const root=document.getElementById("root");
  const dock=document.getElementById("dock");
  const brand=document.getElementById("brand");

  /* ===== Controls ===== */
  const viewInformal=document.getElementById("viewInformal");
  const viewFormal=document.getElementById("viewFormal");
  const viewBoth=document.getElementById("viewBoth");
  const langEN=document.getElementById("langEN");
  const langZH=document.getElementById("langZH");

  function applyView(v){
    root.classList.remove("view-formal","view-informal","view-both");
    root.classList.add("view-"+v);
    viewInformal.classList.toggle("on", v==="informal");
    viewFormal.classList.toggle("on", v==="formal");
    viewBoth.classList.toggle("on", v==="both");
  }
  applyView(gd_style);

  function paintLang(){
    langEN.classList.toggle("on", gd_lang==="en");
    langZH.classList.toggle("on", gd_lang==="zh");
    if(gd_lang==="zh"){
      document.getElementById("bk").textContent="基轴体系";
      document.getElementById("bt").textContent="枢纽A · 索引";
      document.getElementById("bs").textContent="12方向索引。每个方向打开每个镜头的一段总结，并提供项目跳转。";
    }else{
      document.getElementById("bk").textContent="CARDINAL AXIS";
      document.getElementById("bt").textContent="HUB A · Index";
      document.getElementById("bs").textContent="12-direction index. Each direction opens into one summary paragraph per lens, plus a project jump.";
    }
  }
  paintLang();

  viewInformal.onclick=()=>applyView("informal");
  viewFormal.onclick=()=>applyView("formal");
  viewBoth.onclick=()=>applyView("both");

  /* ===== 12 directions ===== */
  const ORDER=["N","NNE","ENE","E","ESE","SSE","S","SSW","WSW","W","WNW","NNW"];
  const COLORS={
    N:"#1F3A8A", NNE:"#2C3EAF", ENE:"#4B3FBF", E:"#0EA5E9",
    ESE:"#14B8A6", SSE:"#22C55E", S:"#F59E0B", SSW:"#EA580C",
    WSW:"#DC2626", W:"#7F1D1D", WNW:"#9333EA", NNW:"#334155"
  };
  const LABEL={
    N:{en:"N · DEFINITIONS",zh:"N · 定义"},
    NNE:{en:"NNE",zh:"NNE"},
    ENE:{en:"ENE",zh:"ENE"},
    E:{en:"E · PRODUCTS",zh:"E · 产品"},
    ESE:{en:"ESE",zh:"ESE"},
    SSE:{en:"SSE",zh:"SSE"},
    S:{en:"S · CONSTRAINTS",zh:"S · 约束"},
    SSW:{en:"SSW",zh:"SSW"},
    WSW:{en:"WSW",zh:"WSW"},
    W:{en:"W · CONTAINMENT",zh:"W · 隔离"},
    WNW:{en:"WNW",zh:"WNW"},
    NNW:{en:"NNW",zh:"NNW"}
  };

  /* ===== PROJECT JUMPS (FILL THESE WITH REAL PATHS) ===== */
  const JUMPS={
    N:"#",
    NNE:"#",
    ENE:"#",
    E:"#",
    ESE:"#",
    SSE:"#",
    S:"#",
    SSW:"#",
    WSW:"#",
    W:"#",
    WNW:"#",
    NNW:"#"
  };

  /* ===== Copy (1 summary paragraph per lens per direction, bilingual) ===== */
  const COPY={
    N:{
      informal:{en:"Collapse starts with loose words. Teams argue definitions while deadlines move. Scope blurs and accountability evaporates. North clamps meaning before power moves. Shared definitions make cooperation real. Precision raises the standard. Otherwise drift wins.",
                zh:"崩塌始于词义松动。团队争定义而时间线前进。范围模糊，责任蒸发。北在权力移动前钉住含义。共享定义让协作真实。精确抬高标准。否则漂移获胜。"},
      formal:{en:"Scope precedes authority. Lock terms before exposure expands. Ambiguity breeds interpretive fights. Boundaries constrain meaning. Verification cites fixed definitions. Drift surfaces at first deviation. Anything less invites collapse.",
              zh:"范围先于权力。曝光扩张前锁定术语。模糊滋生解释争斗。边界约束含义。核查引用固定定义。偏差即暴露漂移。更弱就会崩塌。"}
    },
    NNE:{
      informal:{en:"Most projects fail in translation. Strategy says one thing and shipping says another. NNE catches the slip early. It forces the build to honor meaning. Standards stop dying in handoffs. Alignment becomes real. Otherwise you ship drift.",
                zh:"多数项目死在翻译。战略说一套，交付变一套。NNE提早抓住滑移。它强制构建尊重含义。标准不再死在交接。对齐变真实。否则你交付漂移。"},
      formal:{en:"Translation preserves scope. Meaning bridges into buildable form. Handoff bans reinterpretation. Specs cite semantic anchors. Features remain bounded. Drift is detected at integration. Otherwise execution fractures.",
              zh:"翻译必须保范围。含义桥接为可构建形式。交接禁止重解释。规格引用语义锚点。功能保持有界。集成处检测漂移。否则执行断裂。"}
    },
    ENE:{
      informal:{en:"Contracts die when they never reach the surface. ENE drags the contract into the product. It turns “we meant” into “we enforced.” Users feel truth when boundaries show up. Execution stops being vibes. Accountability becomes visible. Otherwise rollout becomes theater.",
                zh:"契约不落到执行面就会死。ENE把契约拖进产品。把“我们本意”变成“我们执行”。边界出现时用户感到真实。执行不再靠感觉。责任变可见。否则上线成表演。"},
      formal:{en:"Boundaries compile into surfaces. Contracts convert into constraints. UI prevents scope creep. Acceptance criteria remain measurable. Claims lock to declared terms. Verification routes remain explicit. Otherwise surfaces lie.",
              zh:"边界被编译进执行面。契约转为约束。界面防止范围爬坡。验收标准可测。主张锁定到声明术语。核查路径显式。否则执行面撒谎。"}
    },
    E:{
      informal:{en:"People touch surfaces, not theories. East makes structure usable without breaking it. Products carry boundaries. Proof stays reachable. Adoption stays honest. Scale stops gambling. Otherwise growth implodes.",
                zh:"人触摸的是执行面，不是理论。东让结构可用而不破。产品携带边界。证据可达。采纳诚实。规模不再赌博。否则增长内爆。"},
      formal:{en:"Execution inherits constraints. Products remain bounded. Claims stay checkable. Packaging cannot inflate scope. Replication preserves behavior. Verification stays reachable. Otherwise adoption destabilizes.",
              zh:"执行继承约束。产品保持有界。主张可核查。封装不得膨胀范围。复制保持行为。核查路径可达。否则采纳失稳。"}
    },
    ESE:{
      informal:{en:"Expansion loves shortcuts. ESE breaks the shortcut habit. Readiness precedes exposure. Gates become real. Optimism stops becoming damage. Discipline holds the edge. Otherwise momentum becomes a weapon.",
                zh:"扩张爱走捷径。ESE打断捷径习惯。就绪先于曝光。闸门变真实。乐观不再变损伤。纪律守住边缘。否则动量成武器。"},
      formal:{en:"Power meets gates. Prerequisites precede exposure. Claims cannot outrun readiness. Constraint checks execute first. Scope stays bounded. Evidence governs scaling. Otherwise cascade risk rises.",
              zh:"能力必须过闸门。先决条件先于曝光。主张不得跑过就绪。约束检查先执行。范围保持有界。证据治理扩张。否则级联风险上升。"}
    },
    SSE:{
      informal:{en:"Most disasters ship on schedule. SSE refuses that pattern. “When” becomes qualified. Prerequisites become loud. Fake urgency dies. The collective stays protected. Otherwise deadlines become a weapon.",
                zh:"多数灾难按计划上线。SSE拒绝这模式。“何时”变成合格。先决条件变响亮。假紧迫感消失。集体受保护。否则截止日成武器。"},
      formal:{en:"Timing follows qualification. “When” equals prerequisites. Deadlines cannot override gates. Readiness is observable. Scope stays fixed. Evidence governs release. Otherwise fragility ships.",
              zh:"时间必须服从资格。“何时”=先决条件。截止日不得覆盖闸门。就绪可观察。范围固定。证据治理发布。否则脆弱被上线。"}
    },
    S:{
      informal:{en:"Collapse starts with a quiet yes. South says no when proof is missing. It blocks wishful claims. It forces boundaries before belief. It protects unity from manipulation. Discipline replaces vibes. Otherwise scale turns toxic.",
                zh:"崩塌始于一个安静的“行”。南在缺证据时说“不”。它阻止愿望式主张。先有边界再谈信。它保护统一免受操控。纪律替代感觉。否则规模变毒。"},
      formal:{en:"Constraint precedes permission. Claims include falsifiers. Scope is declared. Ambiguity is refused. Gates remain enforceable. Compensation is prohibited. Otherwise drift accelerates.",
              zh:"约束先于许可。主张必须带证伪。范围必须声明。模糊被拒绝。闸门可执行。禁止补偿式说辞。否则漂移加速。"}
    },
    SSW:{
      informal:{en:"Risk knowledge without isolation still spreads failure. SSW couples refusal with containment. It stops weak nodes from poisoning the network. Recovery stays clean. Coordination stays possible. Otherwise you watch failure travel.",
                zh:"知道风险但不隔离仍会扩散失败。SSW把拒绝与隔离耦合。它阻止弱节点污染网络。恢复干净。协同仍可能。否则你看着失败传播。"},
      formal:{en:"Refusal pairs with isolation. Breaches segment quickly. Boundaries prevent spillover. Evidence remains intact. Returns support recovery. Containment is designed. Otherwise faults cascade.",
              zh:"拒绝必须配隔离。破界要快速分段。边界防外溢。证据链完整。返回支撑恢复。隔离是设计项。否则故障级联。"}
    },
    WSW:{
      informal:{en:"One crack shouldn’t ruin the wall. WSW segments failure vectors early. It keeps the rest running. Receipts keep truth traceable. Repair stays calm. Otherwise one fault becomes everyone’s problem.",
                zh:"一条裂缝不该毁整面墙。WSW提前分段失败向量。其余部分继续运行。收据让真相可追溯。修复保持冷静。否则一错变全民问题。"},
      formal:{en:"Failure vectors must segment. Scale must not amplify single faults. Partitions resist permeability. Evidence chains remain traceable. Recovery follows protocol. Containment engages early. Otherwise global collapse follows.",
              zh:"失败向量必须分段。规模不得放大单点故障。分区抗渗透。证据链可追溯。恢复遵循协议。隔离尽早介入。否则全局崩塌。"}
    },
    W:{
      informal:{en:"Systems fail when events spread. West stops spread by design. Exits stay open before crisis. Repair stays honest. Unity survives because damage stays local. Otherwise instability multiplies.",
                zh:"系统失败在于事件扩散。西用设计阻止扩散。危机前出口可用。修复保持诚实。统一因损伤局部化而存活。否则不稳定倍增。"},
      formal:{en:"Containment remains architectural. Failures stay local. Returns preserve state. Evidence stays intact. Isolation precedes correction. Contamination is blocked. Otherwise collapse globalizes.",
              zh:"隔离必须是架构。失败保持局部。返回保状态。证据完整。先隔离再修正。阻止污染。否则崩塌全局化。"}
    },
    WNW:{
      informal:{en:"Postmortems usually produce stories. WNW produces correction. It versions meaning with receipts. It blocks quiet rewrites. The map stays honest after damage. Otherwise the next failure repeats.",
                zh:"复盘常变成故事。WNW产出修正。它用收据版本化含义。阻止悄悄改写。损伤后地图仍诚实。否则下次失败重演。"},
      formal:{en:"Audit feedback refines meaning. Versioning stays explicit. Silent edits are prohibited. Corrections preserve geometry. Evidence justifies change. Registry stays authoritative. Otherwise governance drifts.",
              zh:"审计反馈必须收紧含义。版本化必须显式。禁止静默改义。修正保持几何。证据支撑变化。注册表权威。否则治理漂移。"}
    },
    NNW:{
      informal:{en:"Resets often create new confusion. NNW prevents semantic swap during repair. It restores operation without rewriting scope. Receipts make change explicit. Teams re-align after stress. Otherwise recovery fractures unity.",
                zh:"重置常带来新困惑。NNW防止修复时偷换概念。它恢复运行而不重写范围。收据让变化显式。压力后团队重新对齐。否则恢复撕裂统一。"},
      formal:{en:"Reset preserves semantics. Re-entry maintains scope. Corrections remain versioned. Silent substitution is blocked. Returns restore coherence. Repairs do not alter geometry. Otherwise fragmentation spreads.",
              zh:"重置必须保语义。重入保持范围。修正版本化。阻止静默替换。返回恢复一致。修复不改几何。否则碎片化扩散。"}
    }
  };

  /* ===== Build ===== */
  function makeLensBlock(lens, obj){
    const b=document.createElement("div");
    b.className="lensBlock";
    b.setAttribute("data-lens", lens);

    const t=document.createElement("div");
    t.className="lensTitle";
    t.textContent = (lens==="formal") ? (gd_lang==="zh"?"正式":"Formal") : (gd_lang==="zh"?"非正式":"Informal");

    const p=document.createElement("div");
    p.className="paragraph";
    p.textContent = (gd_lang==="zh") ? obj.zh : obj.en;

    b.appendChild(t);
    b.appendChild(p);
    return b;
  }

  function makeIndexLine(dir){
    const line=document.createElement("div");
    line.className="indexLine";
    const lbl = gd_lang==="zh" ? LABEL[dir].zh : LABEL[dir].en;
    line.append(gd_lang==="zh"
      ? ("索引：跳转到 "+lbl+" 对应项目。 ")
      : ("Index: jump to the project for "+lbl+". ")
    );
    const a=document.createElement("a");
    a.href = (JUMPS[dir] === "#") ? "#" : (JUMPS[dir] + makeQS());
    a.textContent = gd_lang==="zh" ? "跳转" : "Jump";
    line.appendChild(a);
    return line;
  }

  function makeDir(dir){
    const s=document.createElement("section");
    s.className="dir";
    s.style.setProperty("--c", COLORS[dir]);

    const h=document.createElement("div");
    h.className="dHead";
    const lbl = gd_lang==="zh" ? LABEL[dir].zh : LABEL[dir].en;
    h.innerHTML="<div class='dLeft'><div class='diamond'></div><div class='dLabel'>"+lbl+"</div></div><div>▸</div>";

    const b=document.createElement("div");
    b.className="dBody";

    b.appendChild(makeLensBlock("informal", COPY[dir].informal));
    b.appendChild(makeLensBlock("formal", COPY[dir].formal));
    b.appendChild(makeIndexLine(dir));

    h.addEventListener("click",()=>{
      s.classList.toggle("open");
      recomputeHeights();
      // store "active direction" for navJump
      localStorage.setItem("hub_active_dir", dir);
    });

    s.appendChild(h);
    s.appendChild(b);
    return s;
  }

  function render(){
    root.innerHTML="";
    ORDER.forEach(d=>root.appendChild(makeDir(d)));
    recomputeHeights();
  }

  /* ===== Russian Doll Metric ===== */
  function recomputeHeights(){
    const dockH = dock ? dock.getBoundingClientRect().height : 92;
    document.documentElement.style.setProperty("--dockH", dockH + "px");

    const brandH = brand ? brand.getBoundingClientRect().height : 0;
    const viewportH = window.innerHeight || 800;
    const avail = Math.max(220, viewportH - brandH - dockH - 48);

    root.querySelectorAll(".dir.open .dBody").forEach(el=>{
      el.style.maxHeight = avail + "px";
    });
  }
  window.addEventListener("resize", recomputeHeights);

  /* ===== Language switching (safe re-render) ===== */
  function setLang(next){
    const open=new Set();
    root.querySelectorAll(".dir").forEach((n,i)=>{ if(n.classList.contains("open")) open.add(i); });
    gd_lang=next;
    try{ localStorage.setItem("gd_lang", gd_lang); }catch(e){}
    document.documentElement.lang = (gd_lang==="zh") ? "zh" : "en";
    paintLang();
    setHeaderLang();
    render();
    root.querySelectorAll(".dir").forEach((n,i)=>{ if(open.has(i)) n.classList.add("open"); });
    recomputeHeights();
  }

  function setHeaderLang(){
    if(gd_lang==="zh"){
      document.getElementById("bk").textContent="基轴体系";
      document.getElementById("bt").textContent="枢纽A · 索引";
      document.getElementById("bs").textContent="12方向索引。每个方向打开每个镜头的一段总结，并提供项目跳转。";
    }else{
      document.getElementById("bk").textContent="CARDINAL AXIS";
      document.getElementById("bt").textContent="HUB A · Index";
      document.getElementById("bs").textContent="12-direction index. Each direction opens into one summary paragraph per lens, plus a project jump.";
    }
  }

  function paintLang(){
    langEN.classList.toggle("on", gd_lang==="en");
    langZH.classList.toggle("on", gd_lang==="zh");
  }

  langEN.onclick=()=>setLang("en");
  langZH.onclick=()=>setLang("zh");

  /* ===== Bottom dock wiring ===== */
  document.getElementById("navBack").onclick=()=>history.back();
  document.getElementById("navForward").onclick=()=>history.forward();
  document.getElementById("navHub").onclick=()=>nav("/home/");
  document.getElementById("navExplore").onclick=()=>nav("/explore/");
  document.getElementById("navProducts").onclick=()=>nav("/products/");
  document.getElementById("navLaws").onclick=()=>nav("/laws/");
  document.getElementById("navGauges").onclick=()=>nav("/gauges/");
  document.getElementById("navTop").onclick=()=>window.scrollTo({top:0,behavior:"smooth"});

  // Jump to currently selected direction project
  document.getElementById("navJump").onclick=()=>{
    const dir = localStorage.getItem("hub_active_dir") || "N";
    const target = JUMPS[dir] || "#";
    if(target === "#"){ return; }
    location.href = target + makeQS();
  };

  /* ===== Init ===== */
  paintLang();
  setHeaderLang();
  render();

})();
</script>

</body>
</html>

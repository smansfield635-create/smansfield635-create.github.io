<!-- TNT — /prelude/index.html
     PRELUDE · TRILINGUAL (EN/中文/ES) · DENSE · BIGGER PRINT · SINGLE-OPEN ACCORDION
     PURPOSE:
       - Names the problem clearly (human words).
       - Shows that it is mapped into a finite lattice (finite measure).
       - Explains “how the system handles the solution from every angle.”
       - Clean jumps to Compass / Products / Explore / Laws / Gauges.
     RULES:
       - No modals, no overlays, no inline onclick.
       - Mobile-safe: sticky top, single-open accordion.
       - Canon state carry: lang/style/time/depth (URL + gd_* LS).
     ROUTES (EDIT HERE IF NEEDED):
       - BACK → /door/
       - COMPASS → /index.html
       - HOME → /home/
       - PRODUCTS → /products/
       - EXPLORE → /explore/
       - LAWS → /laws/
       - GAUGES → /gauges/
-->

<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>PRELUDE</title>

<link rel="stylesheet" href="/assets/ui.css"/>
<link rel="stylesheet" href="/assets/branch.css"/>
<script defer src="/assets/instruments.js"></script>

<style>
a{color:inherit;text-decoration:none}
body{margin:0;color:#fff;font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif}
body::before,body::after{pointer-events:none!important}

:root{
  --dockH:104px;

  --opalA:rgba(210,190,255,.16);
  --opalB:rgba(120,70,255,.12);
  --opalC:rgba(255,80,80,.10);
  --goldSoft:rgba(212,175,55,.35);

  --stroke:rgba(255,255,255,.12);
  --stroke2:rgba(255,255,255,.10);

  --txt:rgba(255,255,255,.92);
  --mut:rgba(255,255,255,.78);
}

.page{
  width:min(1120px,94vw);
  margin:0 auto;
  padding:14px 0 calc(var(--dockH) + 18px);
  display:flex;
  flex-direction:column;
  gap:12px;
  position:relative;
  z-index:10;
}

/* Top */
.top{
  position:sticky; top:0; z-index:240;
  padding:10px 0 8px;
  display:flex; justify-content:space-between; gap:12px;
}
.top .left,.top .right{
  display:flex; gap:10px; align-items:center;
  flex-wrap:nowrap; white-space:nowrap;
}
.top .btn{white-space:nowrap}

/* Hero */
.hero{
  border-radius:26px;
  border:1px solid var(--stroke);
  background:
    radial-gradient(circle at 18% 22%, var(--opalA), transparent 72%),
    radial-gradient(circle at 82% 34%, var(--opalB), transparent 74%),
    radial-gradient(circle at 55% 110%, var(--opalC), transparent 62%),
    linear-gradient(160deg, rgba(0,0,0,.30), rgba(0,0,0,.14));
  backdrop-filter:blur(10px);
  box-shadow:0 30px 110px rgba(0,0,0,.55);
  padding:18px 18px 16px;
  position:relative;
  overflow:hidden;
}
.hero::before{
  content:"";
  position:absolute; inset:0; border-radius:inherit; padding:1px;
  background:linear-gradient(120deg, transparent 0%, rgba(212,175,55,.22) 50%, transparent 100%);
  opacity:.55;
  -webkit-mask:linear-gradient(#000 0 0) content-box,linear-gradient(#000 0 0);
  -webkit-mask-composite:xor; mask-composite:exclude;
  pointer-events:none;
}
.k{margin:0 0 8px;font-size:12px;letter-spacing:4px;text-transform:uppercase;opacity:.78}
.h1{margin:0;font-weight:950;font-size:34px;letter-spacing:1.1px;line-height:1.1}
.p{margin:12px 0 0;font-size:15.5px;line-height:1.62;color:var(--txt);max-width:980px}
.rule{
  margin:14px 0 0;
  padding:12px 14px;
  border-radius:18px;
  border:1px solid var(--stroke2);
  background:rgba(0,0,0,.14);
  font-size:13.5px;
  line-height:1.55;
  color:var(--mut);
}

/* Jump strip */
.jumpstrip{
  display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end;
  margin-top:12px;
}
.jumpstrip .btn{padding:10px 14px;border-radius:999px}

/* Band */
.band{
  padding:10px 12px;
  border-radius:18px;
  border:1px solid var(--stroke2);
  background:rgba(0,0,0,.12);
  font-weight:950;
  letter-spacing:.2px;
  color:rgba(255,255,255,.88);
}

/* Accordion */
.stack{display:flex;flex-direction:column;gap:12px}
.row{
  border:1px solid rgba(255,255,255,.10);
  border-radius:22px;
  background:linear-gradient(145deg, rgba(17,22,28,.86), rgba(11,15,20,.92));
  box-shadow:0 16px 52px rgba(0,0,0,.60);
  overflow:hidden;
}
.head{
  display:flex;align-items:flex-start;justify-content:space-between;
  gap:10px;
  padding:14px 16px;
  cursor:pointer;
  -webkit-tap-highlight-color:transparent;
  touch-action:manipulation;
}
.left2{min-width:0}
.title{font-weight:950;font-size:16px;letter-spacing:.2px}
.sub{margin-top:6px;font-size:13.5px;line-height:1.55;color:rgba(255,255,255,.78);max-width:92ch}
.chev{font-size:16px;opacity:.75;flex:0 0 auto;margin-top:2px}
.body{
  display:none;
  padding:14px 16px 16px;
  border-top:1px solid rgba(255,255,255,.08);
  background:
    radial-gradient(circle at 30% 30%, rgba(255,255,255,.06), transparent 55%),
    linear-gradient(145deg, rgba(12,22,38,.86), rgba(7,11,18,.92));
}
.row.open .body{display:block}
.bp{margin:0;font-size:14.5px;line-height:1.7;color:rgba(255,255,255,.86)}
.bp + .bp{margin-top:10px}
.ul{
  margin:10px 0 0 18px;
  padding:0;
  font-size:14px;
  line-height:1.65;
  color:rgba(255,255,255,.82);
}
.ul li{margin:6px 0}

/* Dock */
.dock{
  position:fixed; left:50%;
  bottom:max(10px, env(safe-area-inset-bottom));
  transform:translateX(-50%);
  z-index:220;
  width:min(980px,94vw);
  padding:10px 12px;
  border-radius:22px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(0,0,0,.22);
  backdrop-filter:blur(10px);
  box-shadow:0 18px 60px rgba(0,0,0,.55);
  display:grid;
  grid-template-columns:repeat(4, minmax(0,1fr));
  gap:10px;
}
.dock .btn{width:100%;padding:10px 10px;border-radius:999px;white-space:nowrap}
@media (max-width:520px){
  :root{--dockH:116px}
  .dock{grid-template-columns:repeat(3, minmax(0,1fr))}
}
</style>
</head>

<body>

<div class="page">

  <div class="top" aria-label="Top controls">
    <div class="left">
      <a class="btn" id="btnBack" href="/door/">BACK</a>
      <a class="btn" id="btnCompass" href="/index.html">COMPASS</a>
      <a class="btn" id="btnHome" href="/home/">HOME</a>
    </div>
    <div class="right" aria-label="Language">
      <button class="btn" id="btnEN" type="button">EN</button>
      <button class="btn" id="btnZH" type="button">中文</button>
      <button class="btn" id="btnES" type="button">ES</button>
    </div>
  </div>

  <div class="hero" aria-label="Prelude">
    <p class="k" id="k0">PRELUDE</p>
    <h1 class="h1" id="h0">WHY YOU’RE HERE</h1>
    <p class="p" id="p0"></p>
    <div class="rule" id="r0"></div>
    <div class="jumpstrip">
      <a class="btn" id="goProducts" href="/products/">OPEN PRODUCTS</a>
      <a class="btn" id="goExplore" href="/explore/">OPEN EXPLORE</a>
      <a class="btn" id="goLaws" href="/laws/">OPEN LAWS</a>
      <a class="btn" id="goGauges" href="/gauges/">OPEN GAUGES</a>
    </div>
  </div>

  <div class="band" id="band">THE RAMP (ONE THING AT A TIME)</div>
  <div class="stack" id="stack"></div>

</div>

<nav class="dock" aria-label="Bottom navigation">
  <a class="btn" id="dockCompass" href="/index.html">COMPASS</a>
  <a class="btn" id="dockProducts" href="/products/">PRODUCTS</a>
  <a class="btn" id="dockLaws" href="/laws/">LAWS</a>
  <a class="btn" id="dockGauges" href="/gauges/">GAUGES</a>
</nav>

<script>
(function(){
  // ===== state =====
  var qs=new URLSearchParams(location.search);
  var lang  = qs.get("lang")  || localStorage.getItem("gd_lang")  || "en";
  var style = qs.get("style") || localStorage.getItem("gd_style") || "informal";
  var time  = qs.get("time")  || localStorage.getItem("gd_time")  || "now";
  var depth = qs.get("depth") || localStorage.getItem("gd_depth") || "explore";

  if(lang!=="en" && lang!=="zh" && lang!=="es") lang="en";
  if(style!=="formal" && style!=="informal") style="informal";
  if(time==="trajectory") time="post";
  if(time!=="origin" && time!=="now" && time!=="post") time="now";
  if(depth!=="explore" && depth!=="learn") depth="explore";

  try{
    localStorage.setItem("gd_lang",lang);
    localStorage.setItem("gd_style",style);
    localStorage.setItem("gd_time",time);
    localStorage.setItem("gd_depth",depth);
  }catch(e){}

  document.documentElement.lang=(lang==="zh")?"zh":(lang==="es")?"es":"en";

  function q(over){
    var L=(over&&over.lang)?over.lang:lang;
    var S=(over&&over.style)?over.style:style;
    var T=(over&&over.time)?over.time:time;
    var D=(over&&over.depth)?over.depth:depth;
    return "?lang="+encodeURIComponent(L)+"&style="+encodeURIComponent(S)+"&time="+encodeURIComponent(T)+"&depth="+encodeURIComponent(D);
  }
  function wire(id,path){ var el=document.getElementById(id); if(el) el.href=path+q(); }

  // routes
  wire("btnBack","/door/");
  wire("btnCompass","/index.html");
  wire("btnHome","/home/");
  wire("goProducts","/products/");
  wire("goExplore","/explore/");
  wire("goLaws","/laws/");
  wire("goGauges","/gauges/");
  wire("dockCompass","/index.html");
  wire("dockProducts","/products/");
  wire("dockLaws","/laws/");
  wire("dockGauges","/gauges/");

  // language buttons
  var btnEN=document.getElementById("btnEN");
  var btnZH=document.getElementById("btnZH");
  var btnES=document.getElementById("btnES");
  function paintLang(){
    btnEN.classList.toggle("active", lang==="en");
    btnZH.classList.toggle("active", lang==="zh");
    btnES.classList.toggle("active", lang==="es");
  }
  paintLang();
  function setLang(next){
    if(next!=="en"&&next!=="zh"&&next!=="es") next="en";
    lang=next;
    try{ localStorage.setItem("gd_lang",lang); }catch(e){}
    window.location.href = window.location.pathname + q({lang:lang});
  }
  btnEN.addEventListener("click", function(){ setLang("en"); });
  btnZH.addEventListener("click", function(){ setLang("zh"); });
  btnES.addEventListener("click", function(){ setLang("es"); });

  function T(en,zh,es){ return (lang==="zh")?zh:(lang==="es")?es:en; }

  document.getElementById("p0").textContent = T(
    "You’re here because something needs an answer: a decision, a risk, a direction, a build. And right now, the wiring is hard to see.",
    "你来这里，是因为某个东西需要答案：一个决策、一个风险、一个方向、一次构建。而此刻，线路不够清晰。",
    "Estás aquí porque algo necesita una respuesta: una decisión, un riesgo, una dirección, una construcción. Y ahora mismo el cableado no se ve claro."
  );

  document.getElementById("r0").textContent = T(
    "Prelude is the ramp: we name the problem in human terms, show how it is mapped into a finite lattice, and route you to the exact layer that can answer your question.",
    "前置页是坡道：用人话讲清问题，说明我们如何把它映射进有限晶格，然后把你路由到能回答你问题的那一层。",
    "El Preludio es la rampa: nombramos el problema en palabras humanas, mostramos cómo se mapea a un lattice finito y te enrutamos a la capa exacta que puede responder."
  );

  document.getElementById("band").textContent = T(
    "THE RAMP (ONE THING AT A TIME)",
    "坡道（一次只看一件事）",
    "LA RAMPA (UNA COSA A LA VEZ)"
  );

  var ROWS=[
    {
      t:T("What is breaking in the world?","世界哪里在坏？","¿Qué se está rompiendo?"),
      s:T("Not people. Systems. Shared dependencies. Hidden correlation.","不是人坏，是系统坏：共享依赖与隐藏相关。","No es la gente. Son sistemas: dependencias compartidas y correlación oculta."),
      p:[
        T(
          "When many parts depend on the same unseen thing, they fail together. That’s why big projects collapse ‘suddenly’—the warning was there, but it was not visible.",
          "当许多部分依赖同一条暗线，它们会一起坏。这就是大项目为何会“突然”崩：预警一直在，只是看不见。",
          "Cuando muchas partes dependen de lo mismo sin verlo, fallan juntas. Por eso los proyectos grandes colapsan ‘de repente’: la advertencia estaba, pero era invisible."
        ),
        T(
          "So the first job is visibility: map the wiring into a finite structure that can be inspected.",
          "所以第一步是可见性：把线路映射成可检查的有限结构。",
          "Primer paso: visibilidad. Mapear el cableado a una estructura finita inspeccionable."
        )
      ]
    },
    {
      t:T("What does ‘finite measure’ mean here?","这里的“有限测度”是什么意思？","¿Qué significa ‘medida finita’ aquí?"),
      s:T("It means the problem is not endless. It can be enumerated.","意思是问题不是无穷的，它能被枚举。","Significa que el problema no es infinito: se puede enumerar."),
      p:[
        T(
          "A finite lattice is a way to stop hand-waving. You define the dimensions you care about, enumerate the states, and then you can compare ‘before vs after’ without changing the story.",
          "有限晶格用来终止空谈：定义你关心的维度，枚举状态，然后你就能在不改故事的前提下比较“前 vs 后”。",
          "Un lattice finito elimina el humo: defines dimensiones, enumeras estados y comparas ‘antes vs después’ sin cambiar el relato."
        ),
        T(
          "That’s how you turn big, scary problems into something you can actually steer.",
          "这样，巨大而可怕的问题才变成可操控的方向盘。",
          "Así conviertes problemas enormes en algo que puedes dirigir."
        )
      ]
    },
    {
      t:T("What layers answer which questions?","哪个问题归哪一层回答？","¿Qué capa responde qué?"),
      s:T("Map, signals, doctrine, deployment: each has a job.","地图、信号、教义、部署：各司其职。","Mapa, señales, doctrina, despliegue: cada una tiene su trabajo."),
      p:[
        T(
          "Dot.Grid answers: what is connected to what? Gauges answer: what is moving, and how strongly? Laws answer: what may we conclude, given scope and receipts? Products answer: what can you use, right now?",
          "Dot.Grid 回答：谁连着谁？量规回答：什么在动、动得多强？法则回答：在范围与收据下，我们允许得出什么结论？产品回答：你现在能用什么？",
          "Dot.Grid responde: ¿qué está conectado con qué? Medidores: ¿qué se mueve y con qué fuerza? Leyes: ¿qué podemos concluir con alcance y recibos? Productos: ¿qué puedes usar hoy?"
        ),
        T(
          "Prelude is where you learn the lane before you choose speed.",
          "前置页让你先认路，再选速度。",
          "El Preludio te enseña el carril antes de elegir velocidad."
        )
      ]
    },
    {
      t:T("What should you do next?","你下一步该做什么？","¿Qué haces ahora?"),
      s:T("Choose your entry posture: Compass, Tools, Proof, or Signals.","选择入口姿态：指南针、工具、证明或信号。","Elige postura de entrada: brújula, herramientas, prueba o señales."),
      p:[
        T(
          "If you want direction, go to Compass. If you want something deployable, go to Products. If you want rules, go to Laws. If you want measurements, go to Gauges.",
          "要方向就去指南针；要可部署就去产品；要规则就去法则；要测量就去量规。",
          "Si quieres dirección, Brújula. Si quieres algo usable, Productos. Si quieres reglas, Leyes. Si quieres medición, Medidores."
        ),
        T(
          "And if you’re not sure, start with one map pass: identify scope and list the surfaces you think are involved. That alone collapses confusion.",
          "如果你不确定，就先做一次画图：确定范围并列出你认为涉及的执行面。仅此一步就能大幅压缩困惑。",
          "Si no estás seguro, haz un pase de mapa: define alcance y lista superficies involucradas. Eso solo ya reduce la confusión."
        )
      ]
    }
  ];

  var stack=document.getElementById("stack");
  function renderStack(){
    stack.innerHTML="";
    ROWS.forEach(function(r,idx){
      var row=document.createElement("div"); row.className="row";
      var head=document.createElement("div"); head.className="head"; head.tabIndex=0; head.setAttribute("role","button");
      var left=document.createElement("div"); left.className="left2";
      var title=document.createElement("div"); title.className="title"; title.textContent=r.t;
      var sub=document.createElement("div"); sub.className="sub"; sub.textContent=r.s;
      left.appendChild(title); left.appendChild(sub);
      var chev=document.createElement("div"); chev.className="chev"; chev.textContent="▸";
      head.appendChild(left); head.appendChild(chev);

      var body=document.createElement("div"); body.className="body";
      r.p.forEach(function(pp){
        var p=document.createElement("p"); p.className="bp"; p.textContent=pp; body.appendChild(p);
      });

      function closeAll(){
        stack.querySelectorAll(".row").forEach(function(x){
          x.classList.remove("open");
          var c=x.querySelector(".chev"); if(c) c.textContent="▸";
        });
      }
      function toggle(){
        var open=!row.classList.contains("open");
        closeAll();
        if(open){ row.classList.add("open"); chev.textContent="▾"; }
      }
      head.addEventListener("click", toggle);
      head.addEventListener("keydown", function(e){ if(e.key==="Enter"||e.key===" "){ e.preventDefault(); toggle(); }});

      row.appendChild(head); row.appendChild(body);
      stack.appendChild(row);

      if(idx===0){ row.classList.add("open"); chev.textContent="▾"; }
    });
  }
  renderStack();
})();
</script>

</body>
</html>

<!-- TNT — /products/energy/index.html  (ENERGY · GLOSSY LOCKED · LENS DOES NOT RESET · NO SKELETON WORDS ABOVE HOOD)
     FIXES:
       - Glossy pearlescent diamonds are frozen to the exact lacquer recipe (no coal drift).
       - Changing lenses NEVER resets you back to Baseline.
       - Open rows stay open across lens changes.
       - Scroll position stays stable across lens changes.
       - No under-the-hood words surfaced (no P1/P2, no “context/constraint/tension/…” labels).
     LOCKS:
       - Uses /assets/ui.css + /assets/branch.css only
       - No html/body background painting
       - Keys only: gd_lang / gd_style / gd_time
       - Causality is UI-only (not stored)
       - Industrial (C) posture locked; fusion is requirements-only link
-->

<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>PRODUCTS · ENERGY</title>

<link rel="stylesheet" href="/assets/ui.css"/>
<link rel="stylesheet" href="/assets/branch.css"/>

<style>
:root{
  --R:154px;
  --goldSoft:rgba(212,175,55,.35);
  --obs2:#0c1626;
  --obs3:#05070c;

  /* pearlescent film */
  --opal1: rgba(245,248,255,.18);
  --opal2: rgba(180,220,255,.12);
  --opal3: rgba(255,235,200,.10);
  --opal4: rgba(170,255,235,.10);

  /* sapphire lanes */
  --sapp1: rgba(40,90,200,.18);
  --sapp2: rgba(110,190,255,.14);

  --mut: rgba(255,255,255,.88);
  --mut2: rgba(255,255,255,.72);
}

body{margin:0;color:#fff;font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif}
a{color:inherit;text-decoration:none}

/* prevent field overlays from eating taps */
body::before, body::after{ pointer-events:none !important; }

/* top-left */
.top-left{
  position:fixed;left:16px;top:16px;z-index:120;
  display:flex;gap:10px;flex-wrap:wrap;align-items:center;
}
.btn{
  padding:10px 16px;border-radius:14px;
  background:linear-gradient(145deg,var(--obs2),var(--obs3));
  color:#fff;border:1px solid rgba(255,255,255,.08);
  box-shadow:0 14px 36px rgba(0,0,0,.70);
  cursor:pointer;font-weight:900;letter-spacing:.2px;
  -webkit-tap-highlight-color:transparent;
}
.btn:hover{ box-shadow:0 18px 50px rgba(0,0,0,.90), 0 0 14px var(--goldSoft); }

/* brand */
.brand{
  position:fixed;left:50%;top:16px;transform:translateX(-50%);
  z-index:110;text-align:center;
  padding:10px 14px;border-radius:999px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(0,0,0,.18);
  pointer-events:none;
}
.brand .k{font-size:12px;letter-spacing:3px;text-transform:uppercase;opacity:.78;margin:0 0 8px 0}
.brand .t{margin:0;font-size:40px;font-weight:950;letter-spacing:.25px;line-height:1.02}
.brand .s{margin:8px 0 0;opacity:.84;font-size:14.5px;line-height:1.25}

/* stage */
.stage{
  position:fixed;left:50%;top:56%;
  transform:translate(-50%,-50%);
  width:min(720px,94vw);height:min(720px,94vw);
  z-index:60;
}
.outer{
  position:absolute;left:50%;top:50%;
  width:min(640px,88vw);height:min(640px,88vw);
  transform:translate(-50%,-50%) rotate(45deg);
  border-radius:60px;
  border:1px solid rgba(255,255,255,.08);
  background:
    radial-gradient(circle at 30% 25%, rgba(255,255,255,.05), transparent 60%),
    linear-gradient(160deg, rgba(14,24,40,.22) 0%, rgba(7,11,18,.26) 70%);
  box-shadow:
    0 80px 220px rgba(0,0,0,.55),
    inset 0 2px 0 rgba(255,255,255,.06),
    inset 0 -40px 90px rgba(0,0,0,.45);
  opacity:.32;
  pointer-events:none;
}

/* ===== GLOSSY DIAMONDS (FROZEN RECIPE) ===== */
.d{
  width:178px;height:178px;
  position:absolute;left:50%;top:50%;
  transform-origin:center;border-radius:28px;
  cursor:pointer;
  pointer-events:auto;
  touch-action:manipulation;
  -webkit-tap-highlight-color:transparent;

  background:
    radial-gradient(circle at 72% 26%, var(--sapp2) 0%, rgba(110,190,255,0) 62%),
    radial-gradient(circle at 34% 78%, var(--sapp1) 0%, rgba(40,90,200,0) 64%),

    radial-gradient(circle at 34% 22%, var(--opal1) 0%, rgba(245,248,255,0) 54%),
    radial-gradient(circle at 78% 32%, var(--opal2) 0%, rgba(180,220,255,0) 58%),
    radial-gradient(circle at 82% 78%, var(--opal3) 0%, rgba(255,235,200,0) 64%),
    radial-gradient(circle at 30% 82%, var(--opal4) 0%, rgba(170,255,235,0) 66%),

    linear-gradient(160deg, var(--obs2) 0%, var(--obs3) 78%);

  border:1px solid rgba(255,255,255,.16);
  box-shadow:
    0 30px 110px rgba(0,0,0,.72),
    0 0 22px rgba(212,175,55,.10),
    inset 0 2px 0 rgba(255,255,255,.16),
    inset 0 -44px 86px rgba(0,0,0,.80);
  transition:box-shadow 220ms ease, border-color 220ms ease, transform 220ms ease;
  overflow:hidden;
}
.d::before{
  content:"";
  position:absolute;inset:0;border-radius:28px;padding:1px;
  background:linear-gradient(120deg, transparent 0%, var(--goldSoft) 50%, transparent 100%);
  opacity:.65;
  -webkit-mask:linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  -webkit-mask-composite:xor; mask-composite:exclude;
  pointer-events:none;
}
.d::after{
  content:"";
  position:absolute;inset:0;border-radius:28px;
  background:
    radial-gradient(120% 58% at 50% 16%, rgba(255,255,255,.32) 0%, rgba(255,255,255,0) 64%),
    radial-gradient(140% 70% at 50% 92%, rgba(0,0,0,.36) 0%, rgba(0,0,0,0) 56%);
  opacity:.92;
  pointer-events:none;
}
.d:hover{
  border-color:rgba(212,175,55,.32);
  box-shadow:
    0 40px 140px rgba(0,0,0,.82),
    0 0 32px rgba(212,175,55,.18),
    inset 0 2px 0 rgba(255,255,255,.18),
    inset 0 -50px 98px rgba(0,0,0,.84);
  transform:translate(-50%,-50%) rotate(45deg) scale(1.01);
}

.d-n{transform:translate(-50%,-50%) translate(0, calc(var(--R) * -1)) rotate(45deg)}
.d-e{transform:translate(-50%,-50%) translate(var(--R), 0) rotate(45deg)}
.d-s{transform:translate(-50%,-50%) translate(0, var(--R)) rotate(45deg)}
.d-w{transform:translate(-50%,-50%) translate(calc(var(--R) * -1), 0) rotate(45deg)}

.inner{
  width:100%;height:100%;
  transform:rotate(-45deg) translateY(-6px);
  display:flex;flex-direction:column;
  align-items:center;justify-content:center;
  text-align:center;padding:14px;gap:8px;
  pointer-events:none;user-select:none;
}
.lab{font-weight:950;letter-spacing:.7px;font-size:18px;text-shadow:0 0 14px rgba(255,255,255,.25)}
.sub{font-size:12.5px;opacity:.80;line-height:1.28;max-width:18em}

.core{
  position:absolute;left:50%;top:50%;
  transform:translate(-50%,-50%);
  width:74px;height:74px;border-radius:22px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(0,0,0,.18);
  box-shadow:0 18px 44px rgba(0,0,0,.62), inset 0 2px 0 rgba(255,255,255,.10);
  display:grid;place-items:center;
  font-weight:950;letter-spacing:.5px;opacity:.92;
  pointer-events:none;
}

/* dock */
.dock{
  position:fixed;left:50%;
  bottom:max(12px, env(safe-area-inset-bottom));
  transform:translateX(-50%);
  z-index:120;width:min(900px,94vw);
  display:flex;justify-content:center;gap:10px;flex-wrap:wrap;
  padding:10px 12px;border-radius:999px;border:1px solid rgba(255,255,255,.10);
  background:rgba(0,0,0,.18);
  pointer-events:none;
}
.dock .btn{pointer-events:auto}

/* modal */
.bd{position:fixed;inset:0;z-index:200;background:rgba(0,0,0,.70);backdrop-filter:blur(10px);display:none}
.bd.show{display:block}
.modal{
  position:fixed;left:50%;top:50%;
  transform:translate(-50%,-50%);
  width:min(1180px,96vw);
  height:90vh;
  display:none;
  z-index:210;
}
.modal.show{display:block}
.shell{
  height:100%;
  border-radius:26px;
  border:1px solid rgba(255,255,255,.10);
  background:
    radial-gradient(circle at 72% 20%, rgba(110,190,255,.10), transparent 58%),
    radial-gradient(circle at 32% 24%, rgba(245,248,255,.08), transparent 56%),
    linear-gradient(160deg, rgba(12,22,38,.92), rgba(7,11,18,.95));
  box-shadow:0 60px 180px rgba(0,0,0,.92);
  overflow:hidden;
  display:flex;
  flex-direction:column;
}
.mhead{
  display:flex;justify-content:space-between;align-items:center;gap:10px;
  padding:14px 16px;border-bottom:1px solid rgba(255,255,255,.08);
}
.mtitle{margin:0;font-weight:950;letter-spacing:.3px;font-size:16px}
.mclose{border:0;background:transparent;color:#fff;font-size:18px;cursor:pointer;padding:8px 10px}
.mbody{padding:0;overflow:auto;-webkit-overflow-scrolling:touch;flex:1 1 auto}

/* sticky lenses */
.stickyTop{
  position:sticky;top:0;z-index:50;
  background:rgba(0,0,0,.62);
  border-bottom:1px solid rgba(255,255,255,.08);
  padding:12px 12px 10px;
}
.clusterRow{display:flex;gap:10px;flex-wrap:wrap;align-items:flex-start;justify-content:center;margin:0 0 10px}
.cluster{
  border:1px solid rgba(255,255,255,.10);
  background:rgba(0,0,0,.12);
  border-radius:999px;
  padding:8px;
  display:flex;gap:8px;
}
.clusterTitle{
  font-size:11px;
  letter-spacing:1.6px;
  opacity:.75;
  text-transform:uppercase;
  display:flex;
  align-items:center;
  padding:0 8px 0 6px;
}
.pill{
  padding:10px 14px;border-radius:999px;
  background:linear-gradient(145deg, rgba(17,22,28,.92), rgba(11,15,20,.96));
  border:1px solid rgba(255,255,255,.10);
  box-shadow:0 14px 36px rgba(0,0,0,.65);
  cursor:pointer;font-weight:900;letter-spacing:.2px;color:#fff;
  user-select:none;
  -webkit-tap-highlight-color:transparent;
}
.pill.active{
  border-color:rgba(212,175,55,.45);
  box-shadow:0 18px 50px rgba(0,0,0,.9), 0 0 14px rgba(212,175,55,.18);
}

/* header card */
.hcard{
  max-width:980px;margin:0 auto;
  padding:12px 14px;border-radius:18px;
  background:rgba(0,0,0,.18);
  border:1px solid rgba(255,255,255,.10);
}
.h1{margin:0 0 4px;font-weight:950;font-size:14px}
.h2{margin:0;color:var(--mut);line-height:1.45;font-size:12.5px}
.h3{margin:8px 0 0;color:rgba(255,255,255,.70);font-size:12px;line-height:1.35}

/* list */
.content{padding:14px 16px 18px}
.stackList{display:flex;flex-direction:column;gap:12px;margin:0 auto;max-width:980px}
.stackRow{
  border:1px solid rgba(255,255,255,.10);
  border-radius:22px;
  background:linear-gradient(145deg, rgba(17,22,28,.86), rgba(11,15,20,.92));
  box-shadow:0 16px 52px rgba(0,0,0,.60);
  overflow:hidden;
}
.stackRow.open{box-shadow:0 18px 60px rgba(0,0,0,.72), 0 0 26px rgba(212,175,55,.12)}
.stackHead{
  display:flex;align-items:center;justify-content:space-between;gap:10px;
  padding:14px 16px;cursor:pointer;-webkit-tap-highlight-color:transparent
}
.stackLeft{display:flex;align-items:center;gap:12px;min-width:0}
.stackBar{width:6px;height:22px;border-radius:99px;background:var(--domc);box-shadow:0 0 18px rgba(255,255,255,.08);flex:0 0 auto}
.stackTitle{font-weight:950;letter-spacing:.2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.stackSub{font-size:12px;opacity:.72;margin-left:8px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.stackChevron{font-size:16px;opacity:.75;flex:0 0 auto}

.stackBody{
  display:none;
  padding:14px 16px 10px;
  border-top:1px solid rgba(255,255,255,.08);
  background:
    radial-gradient(circle at 30% 30%, rgba(255,255,255,.06), transparent 55%),
    linear-gradient(145deg, rgba(12,22,38,.86), rgba(7,11,18,.92));
}
.stackRow.open .stackBody{display:block}

.pcard{
  border:1px solid rgba(255,255,255,.08);
  background:rgba(0,0,0,.08);
  border-radius:18px;
  padding:12px 12px 10px;
  margin:0 0 10px;
}
.pp{margin:0;color:var(--mut);line-height:1.55}
.pp b{color:rgba(255,255,255,.92)}

.mact{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:14px}
.sbtn{
  padding:12px 18px;border-radius:14px;
  background:linear-gradient(145deg,var(--obs2),var(--obs3));
  color:#fff;border:1px solid rgba(255,255,255,.08);
  box-shadow:0 14px 36px rgba(0,0,0,.7);
  cursor:pointer;font-weight:900;letter-spacing:.2px;text-decoration:none;
}

@media (max-width:560px){
  :root{--R:136px}
  .d{width:162px;height:162px}
  .stage{top:56%}
  .outer{width:min(590px,86vw);height:min(590px,86vw)}
}
</style>
</head>

<body>

<div class="top-left">
  <a class="btn" id="btnBack" href="/products/">BACK</a>
  <a class="btn" id="btnExit" href="/door/">EXIT</a>
</div>

<div class="brand" aria-hidden="true">
  <p class="k">CARDINAL AXIS</p>
  <h1 class="t">Energy</h1>
  <p class="s">Industrial plasma architecture · salted clarity</p>
</div>

<div class="stage" aria-label="Energy product diamond">
  <div class="outer"></div>

  <div class="d d-n" id="diamondFoundation" role="button" tabindex="0">
    <div class="inner"><div class="lab">FOUNDATION</div><div class="sub">Baseline & bounds.</div></div>
  </div>

  <div class="d d-e" id="diamondArchitecture" role="button" tabindex="0">
    <div class="inner"><div class="lab">ARCHITECTURE</div><div class="sub">Interfaces & modules.</div></div>
  </div>

  <div class="d d-s" id="diamondPerformance" role="button" tabindex="0">
    <div class="inner"><div class="lab">PERFORMANCE</div><div class="sub">Measured bands.</div></div>
  </div>

  <div class="d d-w" id="diamondGovernance" role="button" tabindex="0">
    <div class="inner"><div class="lab">GOVERNANCE</div><div class="sub">Scale discipline.</div></div>
  </div>

  <div class="core">◆</div>
</div>

<nav class="dock" aria-label="Bottom navigation">
  <a class="btn" id="dockHub" href="/home/">HUB</a>
  <a class="btn" id="dockTerminal" href="/index.html">TERMINAL</a>
  <a class="btn" id="dockLinks" href="/links/">LINKS</a>
  <a class="btn active" id="dockProducts" href="/products/">PRODUCTS</a>
  <a class="btn" id="dockLaws" href="/laws/">LAWS</a>
  <a class="btn" id="dockGauges" href="/gauges/">GAUGES</a>
</nav>

<div class="bd" id="bd"></div>

<div class="modal" id="modal" role="dialog" aria-modal="true">
  <div class="shell">
    <div class="mhead">
      <h3 class="mtitle" id="mTitle">ENERGY</h3>
      <button class="mclose" id="mClose" aria-label="Close" type="button">✕</button>
    </div>

    <div class="mbody" id="mbody">
      <div class="stickyTop">
        <div class="clusterRow">
          <div class="cluster">
            <div class="clusterTitle">STYLE</div>
            <div class="pill active" id="pillFormal">FORMAL</div>
            <div class="pill" id="pillInformal">INFORMAL</div>
          </div>
          <div class="cluster">
            <div class="clusterTitle">CAUSALITY</div>
            <div class="pill active" id="pillCause">CAUSE</div>
            <div class="pill" id="pillEffect">EFFECT</div>
          </div>
          <div class="cluster">
            <div class="clusterTitle">TIME</div>
            <div class="pill active" id="pillConcept">CONCEPT</div>
            <div class="pill" id="pillLive">LIVE</div>
            <div class="pill" id="pillRoadmap">ROADMAP</div>
          </div>
        </div>

        <div class="hcard">
          <div class="h1" id="h1">—</div>
          <div class="h2" id="h2">—</div>
          <div class="h3" id="h3">—</div>
        </div>
      </div>

      <div class="content">
        <div class="stackList" id="stackList"></div>

        <div class="mact">
          <button class="sbtn" id="mReturn" type="button">RETURN</button>
          <a class="sbtn" id="mFusion" href="/explore/fusion-readiness/">FUSION READINESS</a>
          <a class="sbtn" id="mJumpProducts" href="/products/">JUMP PRODUCTS</a>
          <a class="sbtn" id="mJumpHub" href="/home/">JUMP HUB</a>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
(function(){
  // ===== State hydration (gd_* only) =====
  var qs = new URLSearchParams(location.search);
  var lang  = qs.get("lang")  || localStorage.getItem("gd_lang")  || "en";
  var style = qs.get("style") || localStorage.getItem("gd_style") || "formal";
  var time  = qs.get("time")  || localStorage.getItem("gd_time")  || "origin";
  if(time==="trajectory") time="post";
  if(lang!=="en" && lang!=="zh") lang="en";
  if(style!=="formal" && style!=="informal") style="formal";
  if(time!=="origin" && time!=="now" && time!=="post") time="origin";
  try{
    localStorage.setItem("gd_lang",lang);
    localStorage.setItem("gd_style",style);
    localStorage.setItem("gd_time",time);
  }catch(e){}
  document.documentElement.lang = (lang==="zh") ? "zh" : "en";

  // UI-only causality (not persisted)
  var causality = "CAUSE";
  var activeSection = null;              // THIS is what prevents “snap back”
  var openDomains = new Set(["Baseline"]); // preserve which rows are open
  var scrollTopMem = 0;

  function q(){ return "lang="+encodeURIComponent(lang)+"&style="+encodeURIComponent(style)+"&time="+encodeURIComponent(time); }

  // Wire links
  (function(){
    var s=q();
    var set=function(id,href){ var el=document.getElementById(id); if(el) el.href=href; };
    set("btnBack","/products/?"+s);
    set("btnExit","/door/?"+s);
    set("dockHub","/home/?"+s);
    set("dockTerminal","/index.html?"+s);
    set("dockLinks","/links/?"+s);
    set("dockProducts","/products/?"+s);
    set("dockLaws","/laws/?"+s);
    set("dockGauges","/gauges/?"+s);
    set("mJumpProducts","/products/?"+s);
    set("mJumpHub","/home/?"+s);
    set("mFusion","/explore/fusion-readiness/?"+s);
  })();

  // refs
  var bd=document.getElementById("bd");
  var modal=document.getElementById("modal");
  var mClose=document.getElementById("mClose");
  var mReturn=document.getElementById("mReturn");
  var mTitle=document.getElementById("mTitle");
  var mbody=document.getElementById("mbody");
  var h1=document.getElementById("h1");
  var h2=document.getElementById("h2");
  var h3=document.getElementById("h3");
  var stackList=document.getElementById("stackList");

  var pillFormal=document.getElementById("pillFormal");
  var pillInformal=document.getElementById("pillInformal");
  var pillCause=document.getElementById("pillCause");
  var pillEffect=document.getElementById("pillEffect");
  var pillConcept=document.getElementById("pillConcept");
  var pillLive=document.getElementById("pillLive");
  var pillRoadmap=document.getElementById("pillRoadmap");

  // Locked colors
  var DOMAIN_COLOR = {
    "Baseline":"#C9CED6",
    "Engineering":"#1E40AF",
    "Technology":"#6D28D9",
    "Industrial":"#B45309",
    "Environmental":"#0F766E",
    "Financial":"#047857",
    "Governance":"#475569",
    "Adversarial":"#B91C1C",
    "Social":"#D4AF37",
    "Roadmap":"#E5E7EB"
  };

  var DOMAINS = [
    "Baseline",
    "Engineering",
    "Technology",
    "Industrial",
    "Environmental",
    "Financial",
    "Governance",
    "Adversarial",
    "Social",
    "Roadmap"
  ];

  function pillActive(){
    pillFormal.classList.toggle("active", style==="formal");
    pillInformal.classList.toggle("active", style==="informal");
    pillCause.classList.toggle("active", causality==="CAUSE");
    pillEffect.classList.toggle("active", causality==="EFFECT");
    pillConcept.classList.toggle("active", time==="origin");
    pillLive.classList.toggle("active", time==="now");
    pillRoadmap.classList.toggle("active", time==="post");
  }

  function secBlurb(sec){
    if(sec==="FOUNDATION") return "You can feel the discipline. Everything stays checkable.";
    if(sec==="ARCHITECTURE") return "You can see the handoffs. Nothing leaks.";
    if(sec==="PERFORMANCE") return "You can measure what holds. That’s the whole point.";
    return "You can scale without drift. That’s rare.";
  }

  function header(){
    // DO NOT reset activeSection here
    var t = (time==="origin") ? "CONCEPT" : (time==="now") ? "LIVE" : "ROADMAP";
    var s = (style==="formal") ? "FORMAL" : "INFORMAL";
    var c = (causality==="CAUSE") ? "CAUSE" : "EFFECT";
    h1.textContent = "ENERGY · " + (activeSection || "—") + " · " + c + " · " + t + " · " + s;
    h2.textContent = secBlurb(activeSection || "FOUNDATION");
    h3.textContent = "Industrial surface: plasma-based thermal substitution. Fusion is requirements-only via the readiness link.";
  }

  // 7 paragraphs per domain (salted, lens-colored, no skeleton words)
  function makePara(domain, idx){
    var formal = (style==="formal");
    var cause = (causality==="CAUSE");
    var tm = (time==="origin") ? "concept" : (time==="now") ? "live" : "roadmap";

    var lead = {
      Baseline:"This starts with discipline, not dreams.",
      Engineering:"Built like it has to work on the worst day.",
      Technology:"The truth stays visible when systems get loud.",
      Industrial:"Real-world heat, delivered like a product.",
      Environmental:"Measured boundaries, not empty promises.",
      Financial:"Capital follows proof, not persuasion.",
      Governance:"Rules that keep the machine honest.",
      Adversarial:"Assume attack; design so it fails safely.",
      Social:"Clarity scales faster than confusion.",
      Roadmap:"Next steps are gated, and that’s the point."
    }[domain] || "Locked and legible.";

    var v = formal ? "precise" : "plain";
    var caus = cause ? "drivers" : "effects";
    var a = "This view is " + v + " and it stays bounded.";
    var b = "You are reading the " + tm + " layer, and the posture stays industrial.";
    var c = (cause ? "The push points are visible." : "The outcomes are visible.") + " No guessing is required.";
    var d = "The system stays exciting because it stays checkable.";
    var e = (formal ? "Receipts outrank persuasion." : "Receipts beat stories.") + " That keeps it real.";
    var f = "Fusion remains behind the gate. This surface stays about delivery.";

    // vary last sentence by domain to avoid repetition
    var g = {
      Baseline:"Nothing upgrades itself by wording.",
      Engineering:"Interfaces stay clean, so heat stays where it belongs.",
      Technology:"Logs stay replayable, so truth stays stable.",
      Industrial:"Scaling stays staged, so the grid never gets shocked.",
      Environmental:"Discharge stays measured, so impact stays bounded.",
      Financial:"Exposure stays phased, so liability stays contained.",
      Governance:"Rules stay explicit, so drift stays visible.",
      Adversarial:"Manipulation is treated as failure, not as debate.",
      Social:"Training reduces errors before pressure hits.",
      Roadmap:"Forward steps exist only when proof is ready."
    }[domain] || "Boundaries stay intact.";

    // 7 sentences, salted
    return "<b>"+lead+"</b> "+a+" "+b+" "+c+" "+d+" "+e+" "+f+" "+g;
  }

  function buildRow(domain){
    var row=document.createElement("div");
    row.className="stackRow";
    row.style.setProperty("--domc", DOMAIN_COLOR[domain] || "#94A3B8");

    var head=document.createElement("div");
    head.className="stackHead";

    var left=document.createElement("div");
    left.className="stackLeft";

    var bar=document.createElement("div");
    bar.className="stackBar";
    bar.style.background = (DOMAIN_COLOR[domain] || "#94A3B8");

    var title=document.createElement("div");
    title.className="stackTitle";
    title.textContent = domain;

    var sub=document.createElement("div");
    sub.className="stackSub";
    sub.textContent = (style==="formal") ? ("Clean, " + (causality==="CAUSE"?"driver":"outcome") + " view.") : ("Clear, " + (causality==="CAUSE"?"why":"what") + " view.");

    left.appendChild(bar);
    left.appendChild(title);
    left.appendChild(sub);

    var chev=document.createElement("div");
    chev.className="stackChevron";
    chev.textContent = openDomains.has(domain) ? "▾" : "▸";

    head.appendChild(left);
    head.appendChild(chev);

    var body=document.createElement("div");
    body.className="stackBody";

    for(var i=0;i<7;i++){
      var card=document.createElement("div");
      card.className="pcard";
      var p=document.createElement("p");
      p.className="pp";
      p.innerHTML = makePara(domain, i);
      card.appendChild(p);
      body.appendChild(card);
    }

    if(openDomains.has(domain)) row.classList.add("open");

    head.addEventListener("click", function(){
      var open = row.classList.toggle("open");
      if(open){ openDomains.add(domain); chev.textContent="▾"; }
      else { openDomains.delete(domain); chev.textContent="▸"; }
    });

    row.appendChild(head);
    row.appendChild(body);
    return row;
  }

  function renderDomains(){
    stackList.innerHTML="";
    for(var i=0;i<DOMAINS.length;i++){
      stackList.appendChild(buildRow(DOMAINS[i]));
    }
  }

  function renderPreserve(){
    // preserve scroll
    scrollTopMem = mbody.scrollTop;
    pillActive();
    header();
    renderDomains();
    requestAnimationFrame(function(){
      mbody.scrollTop = scrollTopMem;
    });
  }

  function openModal(sec){
    // set active section ONCE; never reset on lens clicks
    activeSection = sec;
    mTitle.textContent = "ENERGY · " + activeSection;
    bd.classList.add("show");
    modal.classList.add("show");
    renderPreserve();
  }

  function closeModal(){
    bd.classList.remove("show");
    modal.classList.remove("show");
  }

  // close
  bd.addEventListener("click", closeModal);
  mClose.addEventListener("click", closeModal);
  mReturn.addEventListener("click", closeModal);

  // lens clicks: DO NOT touch activeSection
  pillFormal.addEventListener("click", function(){ style="formal"; try{localStorage.setItem("gd_style",style);}catch(e){} renderPreserve(); });
  pillInformal.addEventListener("click", function(){ style="informal"; try{localStorage.setItem("gd_style",style);}catch(e){} renderPreserve(); });
  pillCause.addEventListener("click", function(){ causality="CAUSE"; renderPreserve(); });
  pillEffect.addEventListener("click", function(){ causality="EFFECT"; renderPreserve(); });
  pillConcept.addEventListener("click", function(){ time="origin"; try{localStorage.setItem("gd_time",time);}catch(e){} renderPreserve(); });
  pillLive.addEventListener("click", function(){ time="now"; try{localStorage.setItem("gd_time",time);}catch(e){} renderPreserve(); });
  pillRoadmap.addEventListener("click", function(){ time="post"; try{localStorage.setItem("gd_time",time);}catch(e){} renderPreserve(); });

  // bind diamonds FIRST (always open)
  function bindDiamond(id, sec){
    var el=document.getElementById(id);
    if(!el) return;
    el.addEventListener("click", function(){ openModal(sec); });
    el.addEventListener("keydown", function(e){
      if(e.key==="Enter"||e.key===" "){ e.preventDefault(); openModal(sec); }
    });
  }
  bindDiamond("diamondFoundation","FOUNDATION");
  bindDiamond("diamondArchitecture","ARCHITECTURE");
  bindDiamond("diamondPerformance","PERFORMANCE");
  bindDiamond("diamondGovernance","GOVERNANCE");
})();
</script>

</body>
</html>

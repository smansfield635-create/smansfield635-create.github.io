<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DIAMOND · Scope</title>

  <link rel="stylesheet" href="/assets/ui.css?v=INDEX_FIXLANG_1" />
  <link rel="stylesheet" href="/assets/branch.css?v=INDEX_FIXLANG_1" />
  <script defer src="/assets/instrument.js?v=INDEX_FIXLANG_1"></script>

  <style>
    .scope-grid{display:grid;gap:14px;max-width:860px;margin:0 auto;}
    .scope-row{display:flex;flex-wrap:wrap;gap:10px;justify-content:center}
    .scope-label{opacity:.80;font-weight:900;letter-spacing:.25px;margin:6px 0 2px;text-align:center}
    .scope-help{opacity:.75;margin:0;text-align:center;line-height:1.35}
    .scope-chip{min-width:180px;justify-content:center}
    .scope-actions{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin-top:14px}
    .scope-mini{opacity:.7;font-size:12px;text-align:center;margin-top:10px}

    .select-wrap{display:flex;justify-content:center;margin-top:8px;}
    select.country{
      width:min(520px, 100%);
      padding:12px 14px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.16);
      background:rgba(0,0,0,.16);
      color:#fff;
      font-weight:800;
      letter-spacing:.2px;
    }
    option{ color:#000; }
  </style>
</head>

<body>
  <main class="crp-shell crp-center">
    <section class="crp-card" aria-label="Scope Selector" style="text-align:center">
      <header class="crp-header">
        <div class="crp-mark" aria-hidden="true" data-i18n="global.brand">GEODIAMETRICS</div>
        <h1 class="crp-title" style="margin-bottom:6px" data-i18n="index.title">DIAMOND</h1>
        <p class="crp-subtitle" style="margin-bottom:6px" data-i18n="index.subtitle">Choose your scope.</p>
        <p class="scope-help">Country/Region → Language · Depth</p>
      </header>

      <div class="scope-grid" aria-label="Scope controls">

        <!-- COUNTRY (UX only) -->
        <div>
          <div class="scope-label">COUNTRY / REGION</div>
          <div class="select-wrap">
            <select id="country" class="country" aria-label="Country or region">
              <option value="">Select…</option>
              <option value="US">United States</option>
              <option value="CA">Canada</option>
              <option value="MX">Mexico</option>
              <option value="GB">United Kingdom</option>
              <option value="FR">France</option>
              <option value="DE">Germany</option>
              <option value="ES">Spain</option>
              <option value="BR">Brazil</option>
              <option value="IN">India</option>
              <option value="CN">China</option>
              <option value="TW">Taiwan</option>
              <option value="HK">Hong Kong</option>
              <option value="JP">Japan</option>
              <option value="KR">South Korea</option>
              <option value="VN">Vietnam</option>
              <option value="TH">Thailand</option>
              <option value="PH">Philippines</option>
              <option value="ID">Indonesia</option>
              <option value="AE">United Arab Emirates</option>
              <option value="SA">Saudi Arabia</option>
              <option value="IL">Israel</option>
              <option value="TR">Turkey</option>
              <option value="ZA">South Africa</option>
              <option value="NG">Nigeria</option>
              <option value="EG">Egypt</option>
              <option value="AU">Australia</option>
              <option value="NZ">New Zealand</option>
            </select>
          </div>
          <div class="scope-mini">Country selection is UX-only for now. Canonical languages are EN + 中文.</div>
        </div>

        <!-- LANGUAGE (CANONICAL) -->
        <div>
          <div class="scope-label">LANGUAGE</div>
          <div class="scope-row" role="group" aria-label="Language">
            <!-- Link-first so it works even if JS breaks -->
            <a id="lang-en" class="crp-btn scope-chip" href="?lang=en" role="button">ENGLISH (Primary)</a>
            <a id="lang-zh" class="crp-btn scope-chip" href="?lang=zh" role="button">中文 (Canonical)</a>
          </div>
        </div>

        <!-- DEPTH -->
        <div>
          <div class="scope-label">DEPTH</div>
          <div class="scope-row" role="group" aria-label="Depth">
            <a id="depth-explore" class="crp-btn scope-chip" href="?depth=explore" role="button">EXPLORE</a>
            <a id="depth-learn" class="crp-btn scope-chip" href="?depth=learn" role="button">LEARN</a>
          </div>
        </div>

      </div>

      <div class="scope-actions">
        <a id="enterLink" class="crp-btn crp-btn-primary" href="/home/?lang=en&depth=explore" role="button"
           style="min-width:260px;justify-content:center" data-i18n="index.enter">ENTER</a>

        <a class="crp-btn" href="/home/?lang=en&depth=explore" role="button">Fallback (EN)</a>
      </div>

      <footer class="crp-footer">
        <small class="crp-footnote" data-i18n="index.footnote">Scope controls language and depth.</small>
        <div style="margin-top:8px;opacity:.65;font-size:12px">BUILD: INDEX_FIXLANG_1</div>
      </footer>
    </section>
  </main>

  <script>
    (function(){
      "use strict";

      var K_LANG="gd_lang";
      var K_DEPTH="gd_depth";
      var K_COUNTRY="gd_country"; // optional UX key

      function qp(n){ try{return new URLSearchParams(location.search).get(n);}catch(e){return null;} }
      function lsGet(k){ try{return localStorage.getItem(k);}catch(e){return null;} }
      function lsSet(k,v){ try{localStorage.setItem(k,v);}catch(e){} }

      // Resolve state
      var lang = qp("lang") || lsGet(K_LANG) || "en";
      if (lang !== "en" && lang !== "zh") lang = "en"; // canonical only for now
      var depth = qp("depth") || lsGet(K_DEPTH) || "explore";
      if (depth !== "explore" && depth !== "learn") depth = "explore";

      // Persist
      lsSet(K_LANG, lang);
      lsSet(K_DEPTH, depth);

      // Country restore/persist
      var countryEl = document.getElementById("country");
      if (countryEl){
        var c = lsGet(K_COUNTRY) || "";
        if (c) countryEl.value = c;
        countryEl.addEventListener("change", function(){
          lsSet(K_COUNTRY, countryEl.value || "");
        });
      }

      // Highlight selected
      function mark(id, on){
        var el = document.getElementById(id);
        if (!el) return;
        el.classList.toggle("crp-btn-primary", !!on);
      }
      mark("lang-en", lang === "en");
      mark("lang-zh", lang === "zh");
      mark("depth-explore", depth === "explore");
      mark("depth-learn", depth === "learn");

      // Preserve full state in the query when switching
      function mkHref(nextLang, nextDepth){
        return "?" +
          "lang=" + encodeURIComponent(nextLang || lang) +
          "&depth=" + encodeURIComponent(nextDepth || depth);
      }
      document.getElementById("lang-en").setAttribute("href", mkHref("en", null));
      document.getElementById("lang-zh").setAttribute("href", mkHref("zh", null));
      document.getElementById("depth-explore").setAttribute("href", mkHref(null, "explore"));
      document.getElementById("depth-learn").setAttribute("href", mkHref(null, "learn"));

      // ENTER carries state to Home
      var enter = document.getElementById("enterLink");
      if (enter){
        enter.setAttribute("href", "/home/?lang=" + encodeURIComponent(lang) + "&depth=" + encodeURIComponent(depth));
      }

      // Set <html lang>
      document.documentElement.setAttribute("lang", lang);
    })();
  </script>
</body>
</html>

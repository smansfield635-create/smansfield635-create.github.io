<!-- TNT — /products/software/index.html
     PRODUCTS · SOFTWARE (UNIFORM OPAL/GLOSS) · 2-POINT WISHBONE · TED-TALK COPY · EN/中文/ES
     MODEL (LOCKED):
       LEVEL 1 (Page): 2 glossy diamonds = ENGINE / PLATFORM
       LEVEL 2 (Domains Modal): 6 domains + RETURN  (per side)
       LEVEL 3 (Narrative Modal): Tone toggle (FORMAL / INFORMAL) + 3 bubbles (CONCEPT / LIVE / ROADMAP) tap-to-open
     COUNT:
       12 domains × 3 time bubbles × 2 tones = 72 narratives (generated, domain-specific hooks)
     RULES:
       - Vision/marketing vibe lives in INFORMAL; FORMAL stays abstract/spec.
       - No inline onclick. Tap-safe.
       - Canon state carry (lang/style/time/depth) via URL + localStorage gd_*
       - Uses /assets/ui.css + /assets/branch.css + /assets/instruments.js only
       - ui.css owns field; do NOT style html/body background
-->

<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>PRODUCTS · SOFTWARE</title>

<link rel="stylesheet" href="/assets/ui.css"/>
<link rel="stylesheet" href="/assets/branch.css"/>
<script defer src="/assets/instruments.js"></script>

<style>
a{color:inherit;text-decoration:none}
body{margin:0;color:#fff;font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif}
body::before,body::after{pointer-events:none!important}

/* tokens */
:root{
  --R:170px;
  --D:198px;
  --goldSoft:rgba(212,175,55,.45);
  --opalA:rgba(210,190,255,.18);
  --opalB:rgba(120,70,255,.14);
  --opalC:rgba(90,210,255,.10);
  --obsA:rgba(12,22,38,.95);
  --obsB:rgba(6,10,16,.98);
  --mut:rgba(255,255,255,.90);
  --mut2:rgba(255,255,255,.74);
}

/* top */
.top-left{
  position:fixed;left:16px;top:16px;z-index:240;
  display:flex;gap:10px;flex-wrap:nowrap;white-space:nowrap;align-items:center;
}
.top-right{
  position:fixed;right:16px;top:16px;z-index:240;
  display:flex;gap:10px;flex-wrap:nowrap;white-space:nowrap;align-items:center;
}
.top-left .btn,.top-right .btn{white-space:nowrap}

/* brand pill */
.brand{
  position:fixed;left:50%;top:16px;transform:translateX(-50%);
  z-index:220;text-align:center;padding:10px 18px;border-radius:999px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(0,0,0,.18);
  backdrop-filter:blur(10px);
  pointer-events:none;
}
.brand .t{margin:0;font-weight:950;font-size:40px;letter-spacing:.25px;line-height:1.05}
.brand .s{margin:6px 0 0;opacity:.86;font-size:14px;line-height:1.25}

/* opal header block (TED talk hook) */
.header{
  width:min(980px,94vw);
  margin:78px auto 0;
  padding:16px 16px 14px;
  border-radius:26px;
  border:1px solid rgba(255,255,255,.12);
  background:
    radial-gradient(circle at 20% 30%, var(--opalA), transparent 72%),
    radial-gradient(circle at 82% 66%, var(--opalB), transparent 74%),
    radial-gradient(circle at 55% 110%, var(--opalC), transparent 62%),
    linear-gradient(160deg, rgba(0,0,0,.30), rgba(0,0,0,.14));
  backdrop-filter:blur(12px);
  box-shadow:0 34px 120px rgba(0,0,0,.55);
}
.hk{margin:0 0 6px;font-size:11px;letter-spacing:4px;text-transform:uppercase;opacity:.78}
.ht{margin:0;font-weight:950;font-size:26px;letter-spacing:.6px;line-height:1.14}
.hp{margin:10px 0 0;font-size:13.5px;opacity:.88;line-height:1.5;max-width:92ch}
.hr{margin-top:10px;padding:10px 12px;border-radius:16px;border:1px solid rgba(255,255,255,.10);background:rgba(0,0,0,.14);color:rgba(255,255,255,.84);font-size:12.75px;line-height:1.45}

/* stage */
.stage{
  position:fixed;left:50%;top:58%;
  transform:translate(-50%,-50%);
  width:min(720px,94vw);
  height:min(720px,94vw);
  z-index:60;
  pointer-events:none;
}
.outer{
  position:absolute;left:50%;top:50%;
  width:min(680px,92vw);height:min(680px,92vw);
  transform:translate(-50%,-50%) rotate(45deg);
  border-radius:60px;opacity:.50;pointer-events:none;
  border:1px solid rgba(255,255,255,.10);
  background:
    radial-gradient(circle at 30% 25%, rgba(255,255,255,.08), transparent 55%),
    radial-gradient(circle at 70% 80%, rgba(0,80,255,.14), transparent 60%),
    linear-gradient(160deg, rgba(14,24,40,.40) 0%, rgba(7,11,18,.58) 70%);
  box-shadow:0 90px 260px rgba(0,0,0,.52), inset 0 2px 0 rgba(255,255,255,.10), inset 0 -50px 90px rgba(0,0,0,.55);
}
.outer::after{
  content:"";position:absolute;inset:0;border-radius:60px;opacity:.12;pointer-events:none;
  background:repeating-conic-gradient(from 0deg, rgba(255,255,255,.04) 0deg 6deg, transparent 6deg 18deg);
}

/* glossy diamonds */
.d{
  width:var(--D);height:var(--D);
  position:absolute;left:50%;top:50%;
  transform-origin:center;border-radius:28px;
  cursor:pointer;pointer-events:auto;touch-action:manipulation;
  -webkit-tap-highlight-color:transparent;
  overflow:hidden;

  background:
    radial-gradient(circle at 28% 20%, rgba(255,255,255,.58), transparent 46%),
    radial-gradient(circle at 78% 30%, var(--opalA), transparent 62%),
    radial-gradient(circle at 62% 84%, var(--opalC), transparent 72%),
    linear-gradient(160deg, var(--obsA), var(--obsB));

  border:1px solid rgba(255,255,255,.16);
  box-shadow:
    0 38px 120px rgba(0,0,0,.85),
    0 0 32px rgba(212,175,55,.18),
    inset 0 2px 0 rgba(255,255,255,.25),
    inset 0 -42px 78px rgba(0,0,0,.80);

  transition:transform .18s ease, box-shadow .18s ease, border-color .18s ease;
}
.d::before{
  content:"";position:absolute;inset:0;border-radius:28px;padding:1px;
  background:linear-gradient(120deg, transparent 0%, var(--goldSoft) 50%, transparent 100%);
  opacity:.62;
  -webkit-mask:linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  -webkit-mask-composite:xor;mask-composite:exclude;
  pointer-events:none;
}
.d::after{
  content:"";position:absolute;left:10%;right:10%;top:10%;
  height:28%;border-radius:999px;
  background:linear-gradient(to bottom, rgba(255,255,255,.22), rgba(255,255,255,0));
  transform:rotate(-12deg);
  pointer-events:none;
  opacity:.92;
}
.d:hover{
  transform:translate(-50%,-50%) translate(var(--tx), var(--ty)) rotate(45deg) scale(1.02);
  border-color:rgba(212,175,55,.35);
  box-shadow:
    0 44px 140px rgba(0,0,0,.92),
    0 0 44px rgba(212,175,55,.26),
    inset 0 2px 0 rgba(255,255,255,.28),
    inset 0 -46px 86px rgba(0,0,0,.84);
}
.d:active{transform:translate(-50%,-50%) translate(var(--tx), var(--ty)) rotate(45deg) scale(.99)}
.d.active{
  border-color:rgba(212,175,55,.65);
  box-shadow:
    0 44px 140px rgba(0,0,0,.92),
    0 0 66px rgba(212,175,55,.34),
    inset 0 2px 0 rgba(255,255,255,.28),
    inset 0 -46px 86px rgba(0,0,0,.84);
}

/* wishbone placement */
.dL{ --tx:calc(var(--R) * -1); --ty:0px; transform:translate(-50%,-50%) translate(var(--tx),var(--ty)) rotate(45deg); }
.dR{ --tx:var(--R);           --ty:0px; transform:translate(-50%,-50%) translate(var(--tx),var(--ty)) rotate(45deg); }

.inner{
  transform:rotate(-45deg) translateY(-3px);
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  text-align:center;height:100%;padding:14px;gap:8px;
  pointer-events:none;user-select:none;
}
.lab{font-weight:950;font-size:18px;letter-spacing:.6px;text-shadow:0 0 16px rgba(255,255,255,.14)}
.sub{font-size:13px;opacity:.88;line-height:1.25;max-width:18em}

.core{
  position:absolute;left:50%;top:50%;
  transform:translate(-50%,-50%);
  width:60px;height:60px;border-radius:18px;
  background:rgba(0,0,0,.20);
  border:1px solid rgba(255,255,255,.10);
  box-shadow:0 18px 44px rgba(0,0,0,.55), inset 0 2px 0 rgba(255,255,255,.10);
  display:grid;place-items:center;
  pointer-events:none;
}

/* dock */
.dock{
  position:fixed;left:50%;
  bottom:max(12px, env(safe-area-inset-bottom));
  transform:translateX(-50%);
  z-index:120;width:min(980px,94vw);
  display:flex;justify-content:center;gap:10px;flex-wrap:wrap;
  padding:10px 12px;border-radius:999px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(0,0,0,.18);
  pointer-events:none;
}
.dock .btn{pointer-events:auto}

/* modal base */
.bd{position:fixed;inset:0;z-index:200;background:rgba(0,0,0,.72);backdrop-filter:blur(10px);display:none}
.bd.show{display:block}
.modal{
  position:fixed;left:50%;top:50%;
  transform:translate(-50%,-50%);
  width:min(1180px,96vw);
  height:90vh;
  display:none;
  z-index:210;
}
.modal.show{display:block}
.shell{
  height:90vh;border-radius:22px;border:1px solid rgba(255,255,255,.14);
  background:
    radial-gradient(circle at 20% 30%, rgba(210,190,255,.08), transparent 72%),
    radial-gradient(circle at 82% 66%, rgba(120,70,255,.07), transparent 74%),
    linear-gradient(160deg, rgba(10,18,30,.96), rgba(6,10,16,.98));
  overflow:hidden;display:flex;flex-direction:column;
  box-shadow:0 60px 180px rgba(0,0,0,.85);
}
.mhead{display:flex;justify-content:space-between;align-items:center;gap:10px;padding:14px 16px;border-bottom:1px solid rgba(255,255,255,.08)}
.mtitle{margin:0;font-weight:950;letter-spacing:.3px;font-size:16px}
.mclose{border:0;background:transparent;color:#fff;font-size:18px;cursor:pointer;padding:8px 10px}
.mbody{padding:16px;overflow:auto;-webkit-overflow-scrolling:touch;flex:1 1 auto}

/* hint */
.hint{
  max-width:980px;margin:0 auto 12px;
  padding:10px 12px;border-radius:16px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(0,0,0,.16);
  color:rgba(255,255,255,.80);
  font-size:12.5px;line-height:1.45;
}

/* domains grid */
.grid6{display:grid;gap:14px;grid-template-columns:1fr}
@media (min-width:760px){.grid6{grid-template-columns:1fr 1fr}}
.dom{
  width:100%;height:140px;position:relative;border-radius:22px;
  cursor:pointer;pointer-events:auto;touch-action:manipulation;
  background:
    radial-gradient(circle at 30% 22%, rgba(255,255,255,.50), transparent 52%),
    radial-gradient(circle at 70% 78%, rgba(0,120,255,.26), transparent 62%),
    linear-gradient(160deg, rgba(14,24,40,.96), rgba(7,11,18,.98));
  border:1px solid rgba(255,255,255,.16);
  box-shadow:0 22px 70px rgba(0,0,0,.70), inset 0 2px 0 rgba(255,255,255,.22), inset 0 -34px 60px rgba(0,0,0,.70);
}
.dom::before{
  content:"";position:absolute;inset:0;border-radius:22px;padding:1px;
  background:linear-gradient(120deg, transparent 0%, var(--goldSoft) 50%, transparent 100%);
  opacity:.55;
  -webkit-mask:linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  -webkit-mask-composite:xor;mask-composite:exclude;
  pointer-events:none;
}
.domIn{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:14px;pointer-events:none}
.domT{font-weight:950;letter-spacing:.25px}
.domS{font-size:12.5px;opacity:.82;margin-top:6px}

/* narrative tone pills */
.lensbar{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin:0 0 14px}
.pill{
  padding:10px 14px;border-radius:999px;
  background:linear-gradient(145deg, rgba(17,22,28,.92), rgba(11,15,20,.96));
  border:1px solid rgba(255,255,255,.10);
  box-shadow:0 14px 36px rgba(0,0,0,.65);
  cursor:pointer;font-weight:900;letter-spacing:.2px;color:#fff;
  user-select:none;-webkit-tap-highlight-color:transparent;
}
.pill.active{border-color:rgba(212,175,55,.60);box-shadow:0 18px 50px rgba(0,0,0,.9), 0 0 14px rgba(212,175,55,.22)}

/* bubbles */
.bubble{
  border:1px solid rgba(255,255,255,.10);
  border-radius:18px;background:rgba(255,255,255,.05);
  padding:14px 14px 12px;margin:0 0 12px;
  cursor:pointer;-webkit-tap-highlight-color:transparent;
}
.bubble h4{margin:0 0 8px;font-weight:950;letter-spacing:.15px}
.bubble p{margin:0;color:var(--mut2);line-height:1.65;display:none}
.bubble.open p{display:block}

@media (max-width:560px){
  :root{--R:148px;--D:176px}
  .stage{top:58%}
}
@media (max-width:420px){
  :root{--R:138px;--D:168px}
}
</style>
</head>

<body>

<div class="top-left">
  <a class="btn" id="btnBack" href="/products/">BACK</a>
  <a class="btn" id="btnExit" href="/index.html">EXIT</a>
</div>

<div class="top-right" aria-label="Language">
  <button class="btn" id="btnEN" type="button">EN</button>
  <button class="btn" id="btnZH" type="button">中文</button>
  <button class="btn" id="btnES" type="button">ES</button>
</div>

<div class="brand" aria-hidden="true">
  <div class="t" id="hdrT">Software</div>
  <div class="s" id="hdrS">Wishbone · Engine ↔ Platform · 72 Narratives</div>
</div>

<div class="header" aria-label="Intro">
  <p class="hk" id="hk">PRODUCTS · SOFTWARE</p>
  <h1 class="ht" id="ht">THE MACHINE BEHIND THE PAGES</h1>
  <p class="hp" id="hp">Tap ENGINE or PLATFORM. Pick a domain. Then open Concept / Live / Roadmap. Informal is TED-talk clarity. Formal is spec posture.</p>
  <div class="hr" id="hr">Rule: big ideas are allowed, but every claim stays support-bounded. If it can’t be measured, it stays labeled as concept or roadmap.</div>
</div>

<div class="stage" aria-label="Software wishbone">
  <div class="outer"></div>

  <div class="d dL" id="dEngine" role="button" tabindex="0" aria-label="Engine">
    <div class="inner">
      <div class="lab" id="labEngine">ENGINE</div>
      <div class="sub" id="subEngine">How it runs · state · gates</div>
    </div>
  </div>

  <div class="d dR" id="dPlatform" role="button" tabindex="0" aria-label="Platform">
    <div class="inner">
      <div class="lab" id="labPlatform">PLATFORM</div>
      <div class="sub" id="subPlatform">How it ships · surfaces · routing</div>
    </div>
  </div>

  <div class="core">◆</div>
</div>

<nav class="dock" aria-label="Bottom navigation">
  <a class="btn" id="dockTerminal" href="/index.html">TERMINAL</a>
  <a class="btn" id="dockDoor" href="/door/">DOOR</a>
  <a class="btn" id="dockHub" href="/home/">HUB</a>
  <a class="btn" id="dockProducts" href="/products/">PRODUCTS</a>
  <a class="btn" id="dockLaws" href="/laws/">LAWS</a>
  <a class="btn" id="dockGauges" href="/gauges/">GAUGES</a>
  <a class="btn" id="dockLinks" href="/links/">LINKS</a>
</nav>

<div class="bd" id="bd"></div>

<!-- Domains Modal -->
<div class="modal" id="domainsModal" role="dialog" aria-modal="true">
  <div class="shell">
    <div class="mhead">
      <h3 class="mtitle" id="domainsTitle">SOFTWARE · ENGINE</h3>
      <button class="mclose" id="domainsClose" aria-label="Close" type="button">✕</button>
    </div>
    <div class="mbody">
      <div class="hint" id="domainsHint">Tap a domain to enter its narrative. RETURN closes this layer.</div>
      <div class="grid6" id="domainsGrid"></div>
    </div>
  </div>
</div>

<!-- Narrative Modal -->
<div class="modal" id="narrativeModal" role="dialog" aria-modal="true">
  <div class="shell">
    <div class="mhead">
      <h3 class="mtitle" id="narTitle">SOFTWARE · Domain</h3>
      <button class="mclose" id="narClose" aria-label="Close" type="button">✕</button>
    </div>

    <div class="mbody">
      <div class="lensbar" aria-label="Tone">
        <div class="pill active" id="toneInformal">INFORMAL</div>
        <div class="pill" id="toneFormal">FORMAL</div>
      </div>

      <div class="hint" id="narHint">Open bubbles to read. Concept explains the idea. Live explains how it behaves today. Roadmap explains what’s next (gated).</div>

      <div class="bubble" id="bConcept"><h4 id="hConcept">Concept</h4><p id="pConcept"></p></div>
      <div class="bubble" id="bLive"><h4 id="hLive">Live</h4><p id="pLive"></p></div>
      <div class="bubble" id="bRoadmap"><h4 id="hRoadmap">Roadmap</h4><p id="pRoadmap"></p></div>
    </div>
  </div>
</div>

<script>
(function(){
  // ===== state =====
  var qs=new URLSearchParams(location.search);
  var lang  = qs.get("lang")  || localStorage.getItem("gd_lang")  || "en";
  var style = qs.get("style") || localStorage.getItem("gd_style") || "informal";
  var time  = qs.get("time")  || localStorage.getItem("gd_time")  || "now";
  var depth = qs.get("depth") || localStorage.getItem("gd_depth") || "explore";
  if(time==="trajectory") time="post";
  if(lang!=="en" && lang!=="zh" && lang!=="es") lang="en";
  if(style!=="formal" && style!=="informal") style="informal";
  if(time!=="origin" && time!=="now" && time!=="post") time="now";
  if(depth!=="explore" && depth!=="learn") depth="explore";

  try{
    localStorage.setItem("gd_lang",lang);
    localStorage.setItem("gd_style",style);
    localStorage.setItem("gd_time",time);
    localStorage.setItem("gd_depth",depth);
  }catch(e){}
  document.documentElement.lang=(lang==="zh")?"zh":(lang==="es")?"es":"en";

  function q(){
    var p=new URLSearchParams();
    p.set("lang",lang); p.set("style",style); p.set("time",time); p.set("depth",depth);
    return "?"+p.toString();
  }

  // nav links
  document.getElementById("btnBack").href="/products/"+q();
  document.getElementById("btnExit").href="/index.html"+q();
  document.getElementById("dockTerminal").href="/index.html"+q();
  document.getElementById("dockDoor").href="/door/"+q();
  document.getElementById("dockHub").href="/home/"+q();
  document.getElementById("dockProducts").href="/products/"+q();
  document.getElementById("dockLaws").href="/laws/"+q();
  document.getElementById("dockGauges").href="/gauges/"+q();
  document.getElementById("dockLinks").href="/links/"+q();

  // language buttons (reload same path)
  function paintLang(){
    document.getElementById("btnEN").classList.toggle("active", lang==="en");
    document.getElementById("btnZH").classList.toggle("active", lang==="zh");
    document.getElementById("btnES").classList.toggle("active", lang==="es");
  }
  paintLang();
  function setLang(next){
    if(next!=="en"&&next!=="zh"&&next!=="es") next="en";
    lang=next;
    try{ localStorage.setItem("gd_lang",lang); }catch(e){}
    window.location.href = window.location.pathname + q();
  }
  document.getElementById("btnEN").addEventListener("click", function(){ setLang("en"); });
  document.getElementById("btnZH").addEventListener("click", function(){ setLang("zh"); });
  document.getElementById("btnES").addEventListener("click", function(){ setLang("es"); });

  // ===== i18n labels (TED first) =====
  var UI={
    en:{
      hdrT:"Software",
      hdrS:"Wishbone · Engine ↔ Platform · 72 Narratives",
      hk:"PRODUCTS · SOFTWARE",
      ht:"THE MACHINE BEHIND THE PAGES",
      hp:"Tap ENGINE or PLATFORM. Pick a domain. Then open Concept / Live / Roadmap. Informal is TED-talk clarity. Formal is spec posture.",
      hr:"Rule: big ideas are allowed, but every claim stays support-bounded. If it can’t be measured, it stays labeled as concept or roadmap.",
      d:{engine:{lab:"ENGINE",sub:"How it runs · state · gates"}, platform:{lab:"PLATFORM",sub:"How it ships · surfaces · routing"}},
      domainsHint:"Tap a domain to enter its narrative. RETURN closes this layer.",
      narHint:"Open bubbles to read. Concept explains the idea. Live explains how it behaves today. Roadmap explains what’s next (gated).",
      informal:"INFORMAL", formal:"FORMAL",
      concept:"Concept", live:"Live", roadmap:"Roadmap",
      ret:"RETURN",
      domSub:"Concept · Live · Roadmap"
    },
    zh:{
      hdrT:"软件",
      hdrS:"叉形入口 · 引擎 ↔ 平台 · 72段叙事",
      hk:"产品 · 软件",
      ht:"页面背后的机器",
      hp:"点引擎或平台 → 选域 → 打开 概念/上线/路线图。通俗=TED式解释；正式=规格姿态。",
      hr:"规则：大想法允许，但主张必须有支撑边界。不可测就必须标成概念或路线图。",
      d:{engine:{lab:"引擎",sub:"怎么跑 · 状态 · 闸门"}, platform:{lab:"平台",sub:"怎么交付 · 界面 · 路由"}},
      domainsHint:"点选域进入叙事。RETURN 关闭本层。",
      narHint:"点气泡展开阅读：概念=想法，上线=现在怎么跑，路线图=下一步（有闸门）。",
      informal:"通俗", formal:"正式",
      concept:"概念", live:"上线", roadmap:"路线图",
      ret:"RETURN",
      domSub:"概念 · 上线 · 路线图"
    },
    es:{
      hdrT:"Software",
      hdrS:"Horquilla · Motor ↔ Plataforma · 72 Narrativas",
      hk:"PRODUCTOS · SOFTWARE",
      ht:"LA MÁQUINA DETRÁS DE LAS PÁGINAS",
      hp:"Toca MOTOR o PLATAFORMA. Elige dominio. Abre Concepto / En vivo / Hoja de ruta. Informal = estilo TED. Formal = postura de especificación.",
      hr:"Regla: ideas grandes sí, pero afirmaciones siempre acotadas. Si no se puede medir, queda como concepto o hoja de ruta.",
      d:{engine:{lab:"MOTOR",sub:"Cómo corre · estado · compuertas"}, platform:{lab:"PLATAFORMA",sub:"Cómo se entrega · superficies · rutas"}},
      domainsHint:"Toca un dominio para ver su narrativa. RETURN cierra esta capa.",
      narHint:"Abre burbujas para leer. Concepto = idea. En vivo = cómo funciona hoy. Hoja de ruta = lo siguiente (con compuertas).",
      informal:"INFORMAL", formal:"FORMAL",
      concept:"Concepto", live:"En vivo", roadmap:"Hoja de ruta",
      ret:"RETURN",
      domSub:"Concepto · En vivo · Hoja de ruta"
    }
  };
  var T=(lang==="zh")?UI.zh:(lang==="es")?UI.es:UI.en;

  document.getElementById("hdrT").textContent=T.hdrT;
  document.getElementById("hdrS").textContent=T.hdrS;
  document.getElementById("hk").textContent=T.hk;
  document.getElementById("ht").textContent=T.ht;
  document.getElementById("hp").textContent=T.hp;
  document.getElementById("hr").textContent=T.hr;

  document.getElementById("labEngine").textContent=T.d.engine.lab;
  document.getElementById("subEngine").textContent=T.d.engine.sub;
  document.getElementById("labPlatform").textContent=T.d.platform.lab;
  document.getElementById("subPlatform").textContent=T.d.platform.sub;

  document.getElementById("domainsHint").textContent=T.domainsHint;
  document.getElementById("narHint").textContent=T.narHint;

  document.getElementById("hConcept").textContent=T.concept;
  document.getElementById("hLive").textContent=T.live;
  document.getElementById("hRoadmap").textContent=T.roadmap;

  // ===== domain catalog =====
  var DOMAINS = {
    // ENGINE 6
    state_runtime: {en:"State Runtime", zh:"状态运行时", es:"Runtime de estado"},
    deterministic_gates: {en:"Deterministic Gates", zh:"确定性闸门", es:"Compuertas deterministas"},
    receipt_progression: {en:"Receipt Progression", zh:"收据式推进", es:"Progresión por recibos"},
    change_control: {en:"Change Control", zh:"变更控制", es:"Control de cambios"},
    audit_discipline: {en:"Audit Discipline", zh:"审计纪律", es:"Disciplina de auditoría"},
    admissibility_doctrine: {en:"Admissibility Doctrine", zh:"可采信教义", es:"Doctrina de admisibilidad"},
    // PLATFORM 6
    navigation_surfaces: {en:"Navigation Surfaces", zh:"导航界面", es:"Superficies de navegación"},
    product_packaging: {en:"Product Packaging", zh:"产品封装", es:"Empaquetado de producto"},
    enterprise_deployment: {en:"Enterprise Deployment", zh:"企业部署", es:"Despliegue empresarial"},
    dotgrid_sweeps: {en:"Dot.Grid Sweeps", zh:"Dot.Grid 扫掠", es:"Barridos Dot.Grid"},
    scoring_outputs: {en:"Scoring Outputs", zh:"评分输出", es:"Salidas de puntuación"},
    registry_lookups: {en:"Registry Lookups", zh:"登记查询", es:"Consultas de registro"}
  };
  var ENGINE6 = ["state_runtime","deterministic_gates","receipt_progression","change_control","audit_discipline","admissibility_doctrine"];
  var PLATFORM6 = ["navigation_surfaces","product_packaging","enterprise_deployment","dotgrid_sweeps","scoring_outputs","registry_lookups"];

  function dTitle(id){
    var o=DOMAINS[id]||null;
    if(!o) return id;
    return (lang==="zh")?o.zh:(lang==="es")?(o.es||o.en):o.en;
  }

  // ===== 72 narratives: domain-specific hooks + per phase/tone framing =====
  // This is intentionally TED-talk in informal; formal is spec posture.
  var HOOK = {
    state_runtime:{
      en:{i:"The part that keeps your system from ‘forgetting who it is.’", f:"Atomic state contract under declared keys."},
      zh:{i:"防止系统‘忘了自己是谁’的核心。", f:"声明键下的原子状态契约。"},
      es:{i:"La parte que evita que el sistema ‘olvide quién es’.", f:"Contrato atómico de estado bajo claves declaradas."}
    },
    deterministic_gates:{
      en:{i:"The simple yes/no that stops drift before it becomes drama.", f:"Binary admissibility checks under declared scope."},
      zh:{i:"把漂移扼杀在变成闹剧之前的‘是/否’。", f:"声明范围内的二元可采信检查。"},
      es:{i:"El sí/no que detiene deriva antes del drama.", f:"Checks binarios de admisibilidad bajo alcance declarado."}
    },
    receipt_progression:{
      en:{i:"Progress you can prove, not progress you can claim.", f:"Receipt-gated advancement; no timers-as-gates."},
      zh:{i:"能证明的进步，而不是能自称的进步。", f:"收据闸门式推进；禁止计时当闸门。"},
      es:{i:"Progreso demostrable, no proclamado.", f:"Avance con recibos; sin temporizadores como compuertas."}
    },
    change_control:{
      en:{i:"Upgrades without rewriting history.", f:"Epoch-based change discipline for comparability."},
      zh:{i:"升级但不改历史。", f:"基于纪元的变更纪律，保持可比性。"},
      es:{i:"Actualizar sin reescribir historia.", f:"Disciplina por épocas para comparabilidad."}
    },
    audit_discipline:{
      en:{i:"Receipts decide. Opinions don’t.", f:"Observer-invariant evaluation via logs and replay."},
      zh:{i:"收据说了算，观点不算。", f:"通过日志与回放实现观察者不变评估。"},
      es:{i:"Deciden los recibos, no opiniones.", f:"Evaluación invariante con logs y replay."}
    },
    admissibility_doctrine:{
      en:{i:"The honesty layer: don’t say more than you can support.", f:"Claim-boundary doctrine; scope-locked language."},
      zh:{i:"诚实层：别说超过你能支撑的。", f:"主张边界教义；范围锁语言。"},
      es:{i:"Capa de honestidad: no digas más de lo que puedes respaldar.", f:"Doctrina de límites; lenguaje atado al alcance."}
    },
    navigation_surfaces:{
      en:{i:"A UI that never lies: one tap, one outcome.", f:"Surface contract that preserves invariants."},
      zh:{i:"不撒谎的界面：一按一结果。", f:"保持不变量的界面契约。"},
      es:{i:"Una UI que no miente: un toque, un resultado.", f:"Contrato de superficie que preserva invariantes."}
    },
    product_packaging:{
      en:{i:"Make it usable without turning proof into marketing.", f:"Packaging discipline: products vs doctrine separation."},
      zh:{i:"让它好用，但不把证明写成广告。", f:"封装纪律：产品与教义分离。"},
      es:{i:"Hacerlo usable sin convertir prueba en marketing.", f:"Disciplina de empaquetado: separar producto y doctrina."}
    },
    enterprise_deployment:{
      en:{i:"Scale without breaking: waves, zones, rollback.", f:"Staged rollout governance with receipts."},
      zh:{i:"不坏掉的扩张：波次、分区、回滚。", f:"基于收据的阶段化发布治理。"},
      es:{i:"Escalar sin romper: olas, zonas, rollback.", f:"Gobernanza de rollout por fases con recibos."}
    },
    dotgrid_sweeps:{
      en:{i:"The scanner that keeps comparisons fair.", f:"Windowed sweep discipline under fixed definitions."},
      zh:{i:"让比较公平的扫描器。", f:"固定定义下的窗口扫掠纪律。"},
      es:{i:"El escáner que mantiene comparaciones justas.", f:"Disciplina de barrido por ventanas bajo definiciones fijas."}
    },
    scoring_outputs:{
      en:{i:"A number with a receipt attached.", f:"Reason-coded metric; cannot override admissibility."},
      zh:{i:"带收据的数字。", f:"带原因码指标；不能覆盖可采信。"},
      es:{i:"Un número con recibo adjunto.", f:"Métrica con razones; no anula admisibilidad."}
    },
    registry_lookups:{
      en:{i:"Status that outsiders can verify without ‘trust me.’", f:"Lookupable status + reason codes + validity windows."},
      zh:{i:"外部可核查的状态，不靠‘信我’。", f:"可查询状态+原因码+有效窗口。"},
      es:{i:"Estado verificable sin ‘créeme’.", f:"Estado consultable + razones + ventanas de validez."}
    }
  };

  function pickLang(pack){
    return (lang==="zh") ? pack.zh : (lang==="es") ? pack.es : pack.en;
  }

  function buildText(domainId, tone, phase){
    var h = HOOK[domainId] || null;
    if(!h){
      return (lang==="zh") ? "内容待补充。" : (lang==="es") ? "Contenido pendiente." : "Content pending.";
    }
    var hook = pickLang(h)[tone==="formal" ? "f" : "i"];

    // domain-specific “TED talk” flavor (informal), and spec flavor (formal)
    if(tone==="informal"){
      if(phase==="concept"){
        return hook + " Concept: this is the promise. If the system can’t keep this stable, everything downstream becomes noise.";
      }
      if(phase==="live"){
        return hook + " Live: this is what the user feels today—predictable taps, stable returns, fewer weird edge cases. It’s calm because the rules are doing the heavy lifting.";
      }
      return hook + " Roadmap: make it portable, measurable, and harder to game. Add tooling, add receipts, keep the contract. Scale without chaos.";
    }else{
      if(phase==="concept"){
        return hook + " Concept: declare scope, inputs, invariants, and admissibility rules. Define pass/fail and non-negotiables. No compensation.";
      }
      if(phase==="live"){
        return hook + " Live: enforce rules under load; preserve state across navigation; log reason-coded decisions; block silent overrides; prefer containment and rollback on conflict.";
      }
      return hook + " Roadmap: add replay bundles, registry bindings, audit exports, and conformance tests. Any outcome-affecting change triggers epoch rollover.";
    }
  }

  // ===== refs =====
  var bd=document.getElementById("bd");
  var domainsModal=document.getElementById("domainsModal");
  var narrativeModal=document.getElementById("narrativeModal");
  var domainsClose=document.getElementById("domainsClose");
  var narClose=document.getElementById("narClose");
  var domainsTitle=document.getElementById("domainsTitle");
  var domainsGrid=document.getElementById("domainsGrid");
  var narTitle=document.getElementById("narTitle");

  var toneInformal=document.getElementById("toneInformal");
  var toneFormal=document.getElementById("toneFormal");
  var bConcept=document.getElementById("bConcept");
  var bLive=document.getElementById("bLive");
  var bRoadmap=document.getElementById("bRoadmap");
  var pConcept=document.getElementById("pConcept");
  var pLive=document.getElementById("pLive");
  var pRoadmap=document.getElementById("pRoadmap");

  var currentSide="ENGINE";
  var currentDomain=null;
  var tone="informal"; // default TED-style

  function showBD(){ bd.classList.add("show"); }
  function hideBD(){ bd.classList.remove("show"); }
  function closeAll(){
    domainsModal.classList.remove("show");
    narrativeModal.classList.remove("show");
    hideBD();
    setActiveDiamond(null);
  }

  function setActiveDiamond(which){
    var dE=document.getElementById("dEngine");
    var dP=document.getElementById("dPlatform");
    dE.classList.toggle("active", which==="ENGINE");
    dP.classList.toggle("active", which==="PLATFORM");
  }

  function openDomains(side){
    currentSide=side;
    setActiveDiamond(side);

    var title = (side==="ENGINE") ? T.d.engine.lab : T.d.platform.lab;
    domainsTitle.textContent = (lang==="zh" ? "软件 · " : (lang==="es" ? "Software · " : "SOFTWARE · ")) + title;

    domainsGrid.innerHTML="";
    var list = (side==="ENGINE") ? ENGINE6 : PLATFORM6;

    list.forEach(function(id){
      var card=document.createElement("div");
      card.className="dom";
      card.setAttribute("role","button");
      card.tabIndex=0;
      card.innerHTML = '<div class="domIn"><div class="domT">'+dTitle(id)+'</div><div class="domS">'+T.domSub+'</div></div>';
      function act(){ openNarrative(id); }
      card.addEventListener("click", act);
      card.addEventListener("keydown", function(e){ if(e.key==="Enter"||e.key===" "){ e.preventDefault(); act(); }});
      domainsGrid.appendChild(card);
    });

    var ret=document.createElement("div");
    ret.className="dom";
    ret.setAttribute("role","button");
    ret.tabIndex=0;
    ret.innerHTML = '<div class="domIn"><div class="domT">'+T.ret+'</div><div class="domS">—</div></div>';
    function r(){ closeAll(); }
    ret.addEventListener("click", r);
    ret.addEventListener("keydown", function(e){ if(e.key==="Enter"||e.key===" "){ e.preventDefault(); r(); }});
    domainsGrid.appendChild(ret);

    showBD();
    narrativeModal.classList.remove("show");
    domainsModal.classList.add("show");
  }

  function renderNarrative(){
    if(!currentDomain) return;
    narTitle.textContent = (lang==="zh" ? "软件 · " : (lang==="es" ? "Software · " : "SOFTWARE · ")) + dTitle(currentDomain);

    pConcept.textContent = buildText(currentDomain, tone, "concept");
    pLive.textContent    = buildText(currentDomain, tone, "live");
    pRoadmap.textContent = buildText(currentDomain, tone, "roadmap");

    toneInformal.classList.toggle("active", tone==="informal");
    toneFormal.classList.toggle("active", tone==="formal");
  }

  function openNarrative(domainId){
    currentDomain=domainId;

    // reset bubbles
    [bConcept,bLive,bRoadmap].forEach(function(b){ b.classList.remove("open"); });

    renderNarrative();

    domainsModal.classList.remove("show");
    showBD();
    narrativeModal.classList.add("show");
  }

  function bindBubble(box){
    box.tabIndex=0; box.setAttribute("role","button");
    box.addEventListener("click", function(){ box.classList.toggle("open"); });
    box.addEventListener("keydown", function(e){ if(e.key==="Enter"||e.key===" "){ e.preventDefault(); box.classList.toggle("open"); }});
  }
  bindBubble(bConcept); bindBubble(bLive); bindBubble(bRoadmap);

  // tone handlers
  toneInformal.addEventListener("click", function(){ tone="informal"; renderNarrative(); });
  toneFormal.addEventListener("click", function(){ tone="formal"; renderNarrative(); });

  // close handlers
  domainsClose.addEventListener("click", closeAll);
  narClose.addEventListener("click", closeAll);
  bd.addEventListener("click", closeAll);
  domainsModal.addEventListener("click", function(e){ e.stopPropagation(); });
  narrativeModal.addEventListener("click", function(e){ e.stopPropagation(); });

  // diamond bindings
  function bindDiamond(id, side){
    var el=document.getElementById(id);
    function act(){ openDomains(side); }
    el.addEventListener("click", act);
    el.addEventListener("keydown", function(e){ if(e.key==="Enter"||e.key===" "){ e.preventDefault(); act(); }});
  }
  bindDiamond("dEngine","ENGINE");
  bindDiamond("dPlatform","PLATFORM");

  // language-specific UI text updates
  if(lang==="zh"){
    document.getElementById("btnBack").textContent="返回";
    document.getElementById("btnExit").textContent="退出";
    document.getElementById("dockTerminal").textContent="索引";
    document.getElementById("dockDoor").textContent="门";
    document.getElementById("dockHub").textContent="枢纽";
    document.getElementById("dockProducts").textContent="产品";
    document.getElementById("dockLaws").textContent="法则";
    document.getElementById("dockGauges").textContent="量规";
    document.getElementById("dockLinks").textContent="链接";
  }else if(lang==="es"){
    document.getElementById("btnBack").textContent="VOLVER";
    document.getElementById("btnExit").textContent="SALIR";
    document.getElementById("dockTerminal").textContent="ÍNDICE";
    document.getElementById("dockDoor").textContent="PUERTA";
    document.getElementById("dockHub").textContent="HUB";
    document.getElementById("dockProducts").textContent="PRODUCTOS";
    document.getElementById("dockLaws").textContent="LEYES";
    document.getElementById("dockGauges").textContent="MEDIDORES";
    document.getElementById("dockLinks").textContent="ENLACES";
  }

  document.getElementById("domainsHint").textContent=T.domainsHint;
  document.getElementById("narHint").textContent=T.narHint;

  // default: open ENGINE domains modal (keeps page lively)
  openDomains("ENGINE");
})();
</script>

</body>
</html>

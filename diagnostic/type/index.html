<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Diagnostic · Type Lock-In</title>

  <link rel="icon" href="/assets/favicon.svg" />
  <link rel="stylesheet" href="/assets/ui.css" />

  <style>
    .gCard{background:rgba(255,255,255,.10);border:1px solid rgba(255,255,255,.18);border-radius:18px;padding:14px 16px;margin:0 0 12px;line-height:1.5}
    .opt{display:flex;gap:10px;align-items:flex-start;margin:10px 0}
    input[type="radio"]{transform:scale(1.2);margin-top:2px}
    .hint{opacity:.78;font-size:13px;margin-top:8px}
    .warn{opacity:.85;font-size:13px;margin-top:10px}
    .gActions{display:flex;gap:12px;justify-content:center;flex-wrap:wrap;margin-top:14px}
  </style>
</head>

<body>
  <main class="gPage">
    <header class="gHeader">
      <h1 class="gTitle">Type Lock-In</h1>
      <p class="gSub">Declare your baseline before the exam.</p>
    </header>

    <section class="gPanel" aria-label="Type selection">
      <div class="gCard">
        <p><strong>Rule</strong> This is your declared baseline. The exam compares choices against this declaration.</p>
        <p><strong>Free will</strong> Choose the most accurate option. No overthinking.</p>
        <p class="warn"><strong>Note</strong> Changing this later invalidates the run.</p>
      </div>

      <div class="gCard" role="group" aria-label="Declared type options">
        <label class="opt">
          <input type="radio" name="dtype" value="coherent" />
          <span>
            <strong>Coherent / Stable</strong><br />
            Consistent alignment and closed loops.
          </span>
        </label>

        <label class="opt">
          <input type="radio" name="dtype" value="confused" />
          <span>
            <strong>Confused / Transitional</strong><br />
            Mixed alignment, still stabilizing.
          </span>
        </label>

        <label class="opt">
          <input type="radio" name="dtype" value="fragmented" />
          <span>
            <strong>Fragmented / Unstable</strong><br />
            Misalignment present, loops open, drift likely.
          </span>
        </label>

        <div class="hint">This choice is recorded on your receipt.</div>
      </div>

      <div class="gCard">
        <label class="opt">
          <input type="checkbox" id="confirm" />
          <span>I understand this declaration is locked for this run.</span>
        </label>
      </div>

      <div class="gActions">
        <a class="gBtn" href="/diagnostic/ready/">Back</a>
        <button class="gBtn gPrimary" id="begin" type="button">Begin Exam</button>
      </div>

      <footer class="gFooter">DECLARATION-FIRST · RECEIPT-GATED · © GEODIAMETRICS</footer>
    </section>
  </main>

  <script>
    // Guard: user must come from readiness
    // (If they skipped, send them back to readiness)
    // Optional: comment out if you don’t want gating.
    // If you want gating, keep it.
    // NOTE: readiness page does not set storage; so we gate softly by allowing direct access.
    // You can hard-gate later when you add receipt logic.

    const beginBtn = document.getElementById('begin');
    const confirm = document.getElementById('confirm');

    function getType(){
      const el = document.querySelector('input[name="dtype"]:checked');
      return el ? el.value : null;
    }

    beginBtn.addEventListener('click', () => {
      const t = getType();
      if(!t) return;
      if(!confirm.checked) return;

      // Store declaration locally for now (receipt can be built later)
      localStorage.setItem('GD_DIAG_DECLARED_TYPE', t);
      localStorage.setItem('GD_DIAG_STARTED_AT', new Date().toISOString());

      // Go to exam
      location.href = '/diagnostic/exam/';
    });
  </script>
</body>
</html>

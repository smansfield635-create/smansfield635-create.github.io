<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Engine Matrix · Geodiametrics</title>

<style>
:root{
  --fg:#e9eefc;
  --muted:rgba(233,238,252,.72);
  --stroke:rgba(233,238,252,.14);
  --panel:rgba(12,16,34,.62);
  --shadow:0 18px 55px rgba(0,0,0,.55);
  --radius:22px;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  color:var(--fg);
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  overflow-x:hidden;
  background:
    radial-gradient(1200px 900px at 18% 12%, rgba(120,150,255,.20), transparent 60%),
    radial-gradient(900px 720px at 78% 34%, rgba(255,120,200,.14), transparent 62%),
    radial-gradient(1100px 800px at 55% 78%, rgba(90,210,255,.10), transparent 68%),
    linear-gradient(180deg, #070a12, #0b1020 45%, #070a12);
}
body::before{
  content:"";
  position:fixed; inset:0;
  pointer-events:none; z-index:-2; opacity:.55;
  background:
    radial-gradient(1px 1px at 6% 18%, rgba(255,255,255,.95), transparent 60%),
    radial-gradient(1px 1px at 12% 62%, rgba(255,255,255,.75), transparent 60%),
    radial-gradient(1px 1px at 18% 32%, rgba(255,255,255,.85), transparent 60%),
    radial-gradient(1px 1px at 24% 78%, rgba(255,255,255,.70), transparent 60%),
    radial-gradient(1px 1px at 31% 44%, rgba(255,255,255,.80), transparent 60%),
    radial-gradient(1px 1px at 38% 22%, rgba(255,255,255,.90), transparent 60%),
    radial-gradient(1px 1px at 49% 36%, rgba(255,255,255,.92), transparent 60%),
    radial-gradient(1px 1px at 62% 18%, rgba(255,255,255,.88), transparent 60%),
    radial-gradient(1px 1px at 81% 70%, rgba(255,255,255,.78), transparent 60%),
    radial-gradient(2px 2px at 72% 22%, rgba(255,190,220,.28), transparent 60%),
    radial-gradient(2px 2px at 84% 66%, rgba(140,220,255,.24), transparent 60%);
}
header{
  position:sticky; top:0; z-index:10;
  border-bottom:1px solid rgba(233,238,252,.10);
  background:rgba(10,14,28,.62);
  backdrop-filter:blur(12px);
}
.bar{
  max-width:1100px; margin:0 auto;
  padding:14px 16px;
  display:flex; align-items:center; justify-content:space-between; gap:14px;
}
.brand{font-weight:900;letter-spacing:.35px;font-size:18px;white-space:nowrap}
.navBubbles{display:flex;flex-wrap:wrap;gap:10px;justify-content:flex-end}
.pill{
  display:inline-flex;align-items:center;justify-content:center;
  padding:10px 14px;border-radius:999px;
  border:1px solid var(--stroke);
  background:rgba(12,16,34,.36);
  color:var(--muted);
  text-decoration:none;font-weight:800;font-size:14px;letter-spacing:.2px;
  box-shadow:0 10px 26px rgba(0,0,0,.35);
}
.pill:hover{color:var(--fg);border-color:rgba(233,238,252,.28);background:rgba(12,16,34,.46)}

main{max-width:1100px;margin:0 auto;padding:34px 16px 70px}
h1{margin:10px 0 10px;font-size:44px;letter-spacing:.2px}
.sub{max-width:82ch;color:var(--muted);line-height:1.7;margin:0 0 22px}

.grid{display:grid;gap:16px;grid-template-columns:repeat(auto-fit,minmax(320px,1fr))}
.card{
  background:var(--panel);
  border:1px solid rgba(233,238,252,.12);
  border-radius:18px;
  padding:18px;
  box-shadow:var(--shadow);
}
.card h2{margin:0 0 8px;font-size:20px;letter-spacing:.2px}
.card p{margin:0 0 12px;color:var(--muted);line-height:1.6}
.row{display:flex;flex-wrap:wrap;gap:10px;align-items:center}
.btn{
  display:inline-flex;align-items:center;justify-content:center;
  padding:12px 16px;border-radius:999px;
  border:1px solid rgba(233,238,252,.18);
  background:rgba(255,255,255,.06);
  color:var(--fg);
  font-weight:900;
  letter-spacing:.2px;
  cursor:pointer;
  text-decoration:none;
}
.btn:hover{background:rgba(255,255,255,.09);border-color:rgba(233,238,252,.28)}
.small{padding:10px 12px;font-weight:800}
.kv{display:grid;grid-template-columns:auto 1fr;gap:8px 12px}
.k{color:rgba(233,238,252,.55);font-weight:800}
.v{color:var(--fg);font-weight:900}
.pillstate{
  display:inline-flex;align-items:center;gap:8px;
  padding:10px 14px;border-radius:999px;
  border:1px solid rgba(233,238,252,.18);
  background:rgba(0,0,0,.18);
  font-weight:900;
}
.pillstate.good{border-color:rgba(120,255,180,.22)}
.pillstate.warn{border-color:rgba(255,210,120,.22)}
.pillstate.bad{border-color:rgba(255,120,140,.22)}
pre{
  background:rgba(0,0,0,.25);
  border:1px solid rgba(233,238,252,.12);
  border-radius:16px;
  padding:14px;
  color:rgba(233,238,252,.82);
  white-space:pre-wrap;
  word-break:break-word;
  font-size:13px;
  line-height:1.45;
}
footer{
  max-width:1100px;margin:0 auto;
  padding:18px 16px 26px;
  border-top:1px solid rgba(233,238,252,.10);
  color:rgba(233,238,252,.55);
  text-align:center;
}
</style>
</head>

<body>
<header>
  <div class="bar">
    <div class="brand">Geodiametrics</div>
    <div class="navBubbles">
      <a class="pill" href="/">Home</a>
      <a class="pill" href="/apps/">Apps</a>
      <a class="pill" href="/apps/engine-sync/">Engine v1</a>
      <a class="pill" href="/apps/engine-sync-2/">Engine v2</a>
    </div>
  </div>
</header>

<main>
  <h1>Engine Matrix</h1>
  <p class="sub">Cross-engine bounce harness. Reads both engines, computes a Matrix Verdict, and optionally synchronizes state. Local-first. No backend.</p>

  <section class="grid">
    <div class="card">
      <h2>Engine v1 Snapshot</h2>
      <div class="kv">
        <div class="k">cycle</div><div class="v" id="v1_cycle">—</div>
        <div class="k">selection</div><div class="v" id="v1_sel">—</div>
        <div class="k">resolution</div><div class="v" id="v1_res">—</div>
        <div class="k">commitment</div><div class="v" id="v1_com">—</div>
      </div>
      <div style="height:12px"></div>
      <div class="row">
        <button class="btn small" id="pushV1toV2">Bounce v1 → v2</button>
        <button class="btn small" id="pullV2toV1">Bounce v2 → v1</button>
      </div>
    </div>

    <div class="card">
      <h2>Engine v2 Snapshot</h2>
      <div class="kv">
        <div class="k">cycle</div><div class="v" id="v2_cycle">—</div>
        <div class="k">selection</div><div class="v" id="v2_sel">—</div>
        <div class="k">resolution</div><div class="v" id="v2_res">—</div>
        <div class="k">commitment</div><div class="v" id="v2_com">—</div>
      </div>
      <div style="height:12px"></div>
      <div class="row">
        <button class="btn small" id="resetMatrix">Reset Matrix Log</button>
        <button class="btn small" id="refresh">Refresh</button>
      </div>
    </div>

    <div class="card">
      <h2>Matrix Verdict</h2>
      <p>Matrix law is applied as a cross-engine coherence check. This is a structural verdict, not an intent judgment.</p>
      <div class="row">
        <span class="pillstate" id="verdictPill">UNKNOWN</span>
        <span class="pillstate" id="verdictReason" style="font-weight:800;color:var(--muted)">—</span>
      </div>
      <div style="height:12px"></div>
      <p class="sub" style="margin:0">
        Rule: commitment may not exist without selection=ADMITTED and resolution=RESOLVED.
        Drift is detected when engines disagree on state ordering or contain forbidden combinations.
      </p>
    </div>

    <div class="card">
      <h2>Bounce Log</h2>
      <pre id="log">[]</pre>
    </div>
  </section>

  <footer>© 2026 Geodiametrics · Engine Matrix</footer>
</main>

<script>
(() => {
  const logKey = "GM_MATRIX_LOG_V1";
  const v2Key = "GM_ENGINE_V2"; // used by your v2 engine file
  const $ = (id) => document.getElementById(id);

  // v1 uses flat keys: cycle, selection, resolution, commitment
  function readV1(){
    return {
      cycle: localStorage.getItem("cycle") || "—",
      selection: localStorage.getItem("selection") || "—",
      resolution: localStorage.getItem("resolution") || "—",
      commitment: localStorage.getItem("commitment") || "—"
    };
  }

  function writeV1(s){
    if(s.cycle && s.cycle!=="—") localStorage.setItem("cycle", s.cycle);
    if(s.selection && s.selection!=="—") localStorage.setItem("selection", s.selection);
    if(s.resolution && s.resolution!=="—") localStorage.setItem("resolution", s.resolution);
    if(s.commitment && s.commitment!=="—") localStorage.setItem("commitment", s.commitment);
  }

  function readV2(){
    try{
      const obj = JSON.parse(localStorage.getItem(v2Key) || "{}");
      return {
        cycle: obj.cycle || "—",
        selection: obj.selection || "—",
        resolution: obj.resolution || "—",
        commitment: obj.commitment || "—"
      };
    }catch(e){
      return {cycle:"—",selection:"—",resolution:"—",commitment:"—"};
    }
  }

  function writeV2(s){
    let obj = {};
    try{ obj = JSON.parse(localStorage.getItem(v2Key) || "{}"); }catch(e){}
    obj.cycle = (s.cycle && s.cycle!=="—") ? s.cycle : obj.cycle;
    obj.selection = (s.selection && s.selection!=="—") ? s.selection : obj.selection;
    obj.resolution = (s.resolution && s.resolution!=="—") ? s.resolution : obj.resolution;
    obj.commitment = (s.commitment && s.commitment!=="—") ? s.commitment : obj.commitment;
    localStorage.setItem(v2Key, JSON.stringify(obj));
  }

  function loadLog(){
    try{ return JSON.parse(localStorage.getItem(logKey) || "[]"); }catch(e){ return []; }
  }
  function saveLog(arr){
    localStorage.setItem(logKey, JSON.stringify(arr.slice(-200)));
  }
  function appendLog(event, payload){
    const arr = loadLog();
    arr.push({t:new Date().toISOString(), event, payload});
    saveLog(arr);
    renderLog();
  }
  function renderLog(){
    const arr = loadLog();
    $("log").textContent = JSON.stringify(arr, null, 2);
  }

  // Matrix law: cross-engine ordering + forbidden combos
  function verdict(v1, v2){
    // Forbidden combo function
    const badCombo = (s) => (s.commitment==="COMMITTED" && !(s.selection==="ADMITTED" && s.resolution==="RESOLVED"));

    // If either has forbidden combo => bad
    if(badCombo(v1) || badCombo(v2)){
      return {v:"CONFLICT", r:"Forbidden combo: COMMITTED without ADMITTED+RESOLVED."};
    }

    // If states differ materially, warn (drift)
    const keys = ["cycle","selection","resolution","commitment"];
    let diffs = 0;
    for(const k of keys){
      if(v1[k]!==v2[k] && v1[k]!=="—" && v2[k]!=="—") diffs++;
    }

    if(diffs===0){
      return {v:"COHERENT", r:"States aligned across engines."};
    }
    if(diffs>0){
      return {v:"DRIFT", r:`State divergence detected (${diffs} fields differ).`};
    }
    return {v:"UNKNOWN", r:"Insufficient comparable state."};
  }

  function paintVerdict(v){
    const pill = $("verdictPill");
    pill.classList.remove("good","warn","bad");
    pill.textContent = v.v;
    $("verdictReason").textContent = v.r;
    if(v.v==="COHERENT") pill.classList.add("good");
    else if(v.v==="DRIFT") pill.classList.add("warn");
    else if(v.v==="CONFLICT") pill.classList.add("bad");
    else pill.classList.add("warn");
  }

  function render(){
    const v1 = readV1();
    const v2 = readV2();
    $("v1_cycle").textContent=v1.cycle;
    $("v1_sel").textContent=v1.selection;
    $("v1_res").textContent=v1.resolution;
    $("v1_com").textContent=v1.commitment;

    $("v2_cycle").textContent=v2.cycle;
    $("v2_sel").textContent=v2.selection;
    $("v2_res").textContent=v2.resolution;
    $("v2_com").textContent=v2.commitment;

    paintVerdict(verdict(v1,v2));
    renderLog();
  }

  // Bounce controls
  $("pushV1toV2").onclick = () => {
    const v1 = readV1();
    writeV2(v1);
    appendLog("BOUNCE_V1_TO_V2", v1);
    render();
  };

  $("pullV2toV1").onclick = () => {
    const v2 = readV2();
    writeV1(v2);
    appendLog("BOUNCE_V2_TO_V1", v2);
    render();
  };

  $("resetMatrix").onclick = () => {
    localStorage.removeItem(logKey);
    render();
  };

  $("refresh").onclick = () => render();

  render();
})();
</script>
</body>
</html>

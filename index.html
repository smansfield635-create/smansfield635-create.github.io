<!-- TNT — /index.html  (TERMINAL · STRUCTURAL PREFACE · 8 SECTIONS · GEM STANDARD)
     LOCKS:
       - TNT ONLY (full file)
       - Uses /assets/ui.css + /assets/branch.css only (no asset rewrites)
       - DO NOT style html/body background (ui.css owns field)
       - NO lenses on main page (lenses INSIDE modal only)
       - Dual language compatible (single-language render via gd_lang / ?lang=)
       - 8 main bubbles → centered modal
       - Modal lenses: STYLE (formal/informal) + TIME (concept/now/roadmap)  (gd_time = origin/now/post)
       - Modal content: 4 paragraph-bubbles (no bullet lists)
       - All navigation links are uniform buttons (no blue/purple anchors)
       - State propagation: lang/style/time carried through all internal links
-->

<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>TERMINAL · Cardinal Axis</title>

<link rel="stylesheet" href="/assets/ui.css"/>
<link rel="stylesheet" href="/assets/branch.css"/>

<style>
/* DO NOT TOUCH FIELD — ui.css owns html/body background */
a{color:inherit;text-decoration:none}

/* Layout */
.term-wrap{width:min(980px,94vw);margin:0 auto;padding:22px 0 120px}
.term-top{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap;margin-bottom:14px}
.term-top-left{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
.term-mid{flex:1;min-width:260px;text-align:center}
.term-mark{font-size:12px;letter-spacing:2.4px;text-transform:uppercase;opacity:.78;margin-bottom:8px}
.term-title{margin:0;font-size:44px;font-weight:950;letter-spacing:.25px;line-height:1.05}
.term-sub{margin:10px 0 0;opacity:.84;font-size:16px;line-height:1.35}
.term-note{margin:10px 0 0;opacity:.74;font-size:13px;line-height:1.35}

.term-grid{display:grid;gap:14px;margin-top:18px}
@media (min-width:820px){.term-grid{grid-template-columns:1fr 1fr;}}

.bubble{
  border-radius:22px;
  border:1px solid rgba(255,255,255,.10);
  background:linear-gradient(145deg, rgba(17,22,28,.88), rgba(11,15,20,.92));
  box-shadow:0 22px 70px rgba(0,0,0,.60), inset 0 1px 0 rgba(255,255,255,.06);
  padding:18px;
  cursor:pointer;
  -webkit-tap-highlight-color:transparent;
  transition:transform .10s ease, border-color .12s ease, box-shadow .12s ease;
}
.bubble:hover{
  transform:translateY(-1px);
  border-color:rgba(212,175,55,.22);
  box-shadow:0 24px 80px rgba(0,0,0,.68), 0 0 16px rgba(212,175,55,.12), inset 0 1px 0 rgba(255,255,255,.06);
}
.bh{margin:0 0 8px;font-size:18px;font-weight:950;letter-spacing:.2px}
.bp{margin:0;color:rgba(255,255,255,.82);line-height:1.55}
.bmini{margin-top:10px;color:rgba(255,255,255,.66);font-size:12px;line-height:1.45}

.term-actions{display:flex;gap:12px;flex-wrap:wrap;justify-content:center;margin-top:16px}

/* Bottom dock */
.dock{
  position:fixed;left:50%;
  bottom:max(12px, env(safe-area-inset-bottom));
  transform:translateX(-50%);
  z-index:90;
  width:min(980px,94vw);
  display:flex;justify-content:center;gap:10px;flex-wrap:wrap;
  padding:10px 12px;border-radius:999px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(0,0,0,.18);
  backdrop-filter:blur(8px);
}

/* Modal */
.bd{
  position:fixed;inset:0;z-index:200;
  background:rgba(0,0,0,.65);
  backdrop-filter:blur(10px);
  display:none;
}
.bd.show{display:block;}
.modal{
  position:fixed;left:50%;top:50%;
  transform:translate(-50%,-50%);
  width:min(1020px,94vw);
  max-height:88vh;
  display:none;z-index:210;
}
.modal.show{display:block;}
.shell{
  height:88vh;
  border-radius:26px;
  border:1px solid rgba(255,255,255,.10);
  background:
    radial-gradient(circle at 52% 14%, rgba(176,0,0,.16), transparent 55%),
    radial-gradient(circle at 38% 28%, rgba(90,140,255,.12), transparent 55%),
    linear-gradient(145deg, rgba(17,22,28,.90), rgba(11,15,20,.94));
  box-shadow:0 60px 180px rgba(0,0,0,.92);
  overflow:hidden;
  display:flex;flex-direction:column;
}
.mhead{
  display:flex;justify-content:space-between;align-items:center;gap:10px;
  padding:14px 16px;border-bottom:1px solid rgba(255,255,255,.08);
}
.mtitle{margin:0;font-weight:950;letter-spacing:.3px;font-size:16px}
.mclose{border:0;background:transparent;color:#fff;font-size:18px;cursor:pointer;padding:8px 10px}

.mbody{padding:14px 16px 18px;overflow:auto;-webkit-overflow-scrolling:touch;flex:1 1 auto}

/* Lenses INSIDE modal only */
.lensbar{
  display:flex;gap:10px;flex-wrap:wrap;
  align-items:center;justify-content:center;
  padding:10px 10px 14px;border-bottom:1px solid rgba(255,255,255,.08);
  margin:-6px -6px 14px;
}
.chip{
  padding:10px 16px;border-radius:999px;
  background:linear-gradient(145deg, rgba(17,22,28,.92), rgba(11,15,20,.96));
  border:1px solid rgba(255,255,255,.10);
  box-shadow:0 14px 36px rgba(0,0,0,.65);
  cursor:pointer;font-weight:900;letter-spacing:.2px;color:#fff;
}
.chip.active{
  border-color:rgba(212,175,55,.70);
  box-shadow:0 18px 50px rgba(0,0,0,.9), 0 0 16px rgba(212,175,55,.30);
}

/* 4 paragraph-bubbles */
.mgrid{display:grid;gap:14px}
.mbox{
  padding:16px 18px;border-radius:22px;
  background:
    radial-gradient(circle at 30% 30%, rgba(120,160,255,.08), transparent 55%),
    linear-gradient(145deg, rgba(12,22,38,.92), rgba(7,11,18,.95));
  border:1px solid rgba(255,255,255,.10);
  box-shadow:0 18px 60px rgba(0,0,0,.70), inset 0 2px 0 rgba(255,255,255,.06);
}
.mh{margin:0 0 8px;font-weight:950;letter-spacing:.2px}
.mp{margin:0;color:rgba(255,255,255,.84);line-height:1.55}

/* Modal actions (uniform buttons only) */
.mact{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:14px}

@media (max-width:520px){
  .term-title{font-size:38px}
  .shell{height:90vh}
}
</style>
</head>

<body>
<main class="term-wrap">

  <div class="term-top">
    <div class="term-top-left">
      <a class="crp-btn" id="btnExit" href="/door/">EXIT</a>
      <a class="crp-btn" id="btnHub" href="/home/">HUB</a>
    </div>

    <div class="term-mid">
      <div class="term-mark" id="mark">CARDINAL AXIS</div>
      <h1 class="term-title" id="tTitle">TERMINAL</h1>
      <p class="term-sub" id="tSub">Structural entry point into the entire system.</p>
      <p class="term-note" id="tNote">This page is self-contained: Index, Glossary, and Appendix are included here via the modal.</p>
    </div>

    <div style="width:140px;flex:0 0 auto"></div>
  </div>

  <section class="term-grid" aria-label="Terminal sections">
    <div class="bubble" id="b0" role="button" tabindex="0">
      <h2 class="bh" id="b0h">Under construction</h2>
      <p class="bp" id="b0p">Unfinished areas show placeholders so you see progress without broken flows.</p>
      <p class="bmini" id="b0m">Tap to open lens view.</p>
    </div>

    <div class="bubble" id="b1" role="button" tabindex="0">
      <h2 class="bh" id="b1h">How navigation works</h2>
      <p class="bp" id="b1p">You traverse by structure; lenses live inside the modal only.</p>
      <p class="bmini" id="b1m">Tap to open lens view.</p>
    </div>

    <div class="bubble" id="b2" role="button" tabindex="0">
      <h2 class="bh" id="b2h">State stability</h2>
      <p class="bp" id="b2p">Language, style, and time persist so context does not reset.</p>
      <p class="bmini" id="b2m">Tap to open lens view.</p>
    </div>

    <div class="bubble" id="b3" role="button" tabindex="0">
      <h2 class="bh" id="b3h">Where to go next</h2>
      <p class="bp" id="b3p">Use HUB for compass navigation; Products/Innovation for build surfaces.</p>
      <p class="bmini" id="b3m">Tap to open lens view.</p>
    </div>

    <div class="bubble" id="b4" role="button" tabindex="0">
      <h2 class="bh" id="b4h">Index</h2>
      <p class="bp" id="b4p">The map of maps: routes to the right trunk quickly and consistently.</p>
      <p class="bmini" id="b4m">Tap to open lens view.</p>
    </div>

    <div class="bubble" id="b5" role="button" tabindex="0">
      <h2 class="bh" id="b5h">Glossary</h2>
      <p class="bp" id="b5p">Pinned meanings so the system stays readable as it scales.</p>
      <p class="bmini" id="b5m">Tap to open lens view.</p>
    </div>

    <div class="bubble" id="b6" role="button" tabindex="0">
      <h2 class="bh" id="b6h">Appendix</h2>
      <p class="bp" id="b6p">Conventions and references that support deeper pages without clutter.</p>
      <p class="bmini" id="b6m">Tap to open lens view.</p>
    </div>

    <div class="bubble" id="b7" role="button" tabindex="0">
      <h2 class="bh" id="b7h">Scientific fact-checking</h2>
      <p class="bp" id="b7p">Hard bounds, assumptions, and falsifiers for technical readers.</p>
      <p class="bmini" id="b7m">Tap to open lens view.</p>
    </div>
  </section>

  <div class="term-actions">
    <a class="crp-btn crp-btn-primary" id="btnContinue" href="/home/">CONTINUE → HUB</a>
    <a class="crp-btn" id="btnLinks" href="/links/">JUMP LINKS</a>
    <a class="crp-btn" id="btnProducts" href="/products/">JUMP PRODUCTS</a>
    <a class="crp-btn" id="btnExplore" href="/explore/">JUMP INNOVATION</a>
  </div>

</main>

<nav class="dock" aria-label="Bottom navigation">
  <a class="crp-btn crp-btn-primary" id="dockTerminal" href="/index.html">TERMINAL</a>
  <a class="crp-btn" id="dockLinks" href="/links/">LINKS</a>
  <a class="crp-btn" id="dockProducts" href="/products/">PRODUCTS</a>
  <a class="crp-btn" id="dockLaws" href="/laws/">LAWS</a>
  <a class="crp-btn" id="dockGauges" href="/gauges/">GAUGES</a>
</nav>

<!-- Modal -->
<div class="bd" id="bd" aria-hidden="true"></div>

<div class="modal" id="modal" role="dialog" aria-modal="true" aria-label="Terminal detail">
  <div class="shell">
    <div class="mhead">
      <h3 class="mtitle" id="mTitle">DETAIL</h3>
      <button class="mclose" id="mClose" aria-label="Close" type="button">✕</button>
    </div>

    <!-- LENSES INSIDE MODAL ONLY -->
    <div class="lensbar">
      <button class="chip" id="chipStyle" type="button">STYLE: FORMAL</button>
      <button class="chip" id="chipConcept" data-time="origin" type="button">CONCEPT</button>
      <button class="chip" id="chipNow" data-time="now" type="button">NOW</button>
      <button class="chip" id="chipRoadmap" data-time="post" type="button">ROADMAP</button>
    </div>

    <div class="mbody">
      <div class="mgrid">
        <div class="mbox"><h4 class="mh" id="h1"></h4><p class="mp" id="p1"></p></div>
        <div class="mbox"><h4 class="mh" id="h2"></h4><p class="mp" id="p2"></p></div>
        <div class="mbox"><h4 class="mh" id="h3"></h4><p class="mp" id="p3"></p></div>
        <div class="mbox"><h4 class="mh" id="h4"></h4><p class="mp" id="p4"></p></div>
      </div>

      <div class="mact">
        <button class="crp-btn" id="mReturn" type="button">RETURN</button>
        <a class="crp-btn" id="mJumpHub" href="/home/">JUMP HUB</a>
        <a class="crp-btn" id="mJumpProducts" href="/products/">JUMP PRODUCTS</a>
        <a class="crp-btn" id="mJumpExplore" href="/explore/">JUMP INNOVATION</a>
        <a class="crp-btn" id="mJumpLinks" href="/links/">JUMP LINKS</a>
      </div>
    </div>
  </div>
</div>

<script>
(function(){
  // ===== STATE (gd_* only) =====
  var qs=new URLSearchParams(location.search);
  var lang=qs.get("lang")||localStorage.getItem("gd_lang")||"en";
  var style=qs.get("style")||localStorage.getItem("gd_style")||"formal";
  var time=qs.get("time")||localStorage.getItem("gd_time")||"now";
  if(lang!=="en"&&lang!=="zh") lang="en";
  if(style!=="formal"&&style!=="informal") style="formal";
  if(time==="trajectory") time="post";
  if(time!=="origin"&&time!=="now"&&time!=="post") time="now";
  try{localStorage.setItem("gd_lang",lang);localStorage.setItem("gd_style",style);localStorage.setItem("gd_time",time);}catch(e){}
  document.documentElement.lang=(lang==="zh")?"zh":"en";

  function q(){return "lang="+encodeURIComponent(lang)+"&style="+encodeURIComponent(style)+"&time="+encodeURIComponent(time);}

  function wire(){
    var s=q();
    document.getElementById("btnExit").href="/door/?"+s;
    document.getElementById("btnHub").href="/home/?"+s;
    document.getElementById("btnContinue").href="/home/?"+s;
    document.getElementById("btnLinks").href="/links/?"+s;
    document.getElementById("btnProducts").href="/products/?"+s;
    document.getElementById("btnExplore").href="/explore/?"+s;

    document.getElementById("dockTerminal").href="/index.html?"+s;
    document.getElementById("dockLinks").href="/links/?"+s;
    document.getElementById("dockProducts").href="/products/?"+s;
    document.getElementById("dockLaws").href="/laws/?"+s;
    document.getElementById("dockGauges").href="/gauges/?"+s;

    document.getElementById("mJumpHub").href="/home/?"+s;
    document.getElementById("mJumpProducts").href="/products/?"+s;
    document.getElementById("mJumpExplore").href="/explore/?"+s;
    document.getElementById("mJumpLinks").href="/links/?"+s;
  }
  wire();

  // ===== LANGUAGE PACK =====
  var T={
    en:{
      mark:"CARDINAL AXIS",
      title:"TERMINAL",
      sub:"Structural entry point into the entire system.",
      note:"This page is self-contained: Index, Glossary, and Appendix are included here via the modal.",
      mini:"Tap to open lens view.",
      bubbles:[
        {h:"Under construction",p:"Unfinished areas show placeholders so you see progress without broken flows."},
        {h:"How navigation works",p:"You traverse by structure; lenses live inside the modal only."},
        {h:"State stability",p:"Language, style, and time persist so context does not reset."},
        {h:"Where to go next",p:"Use HUB for compass navigation; Products/Innovation for build surfaces."},
        {h:"Index",p:"The map of maps: routes to the right trunk quickly and consistently."},
        {h:"Glossary",p:"Pinned meanings so the system stays readable as it scales."},
        {h:"Appendix",p:"Conventions and references that support deeper pages without clutter."},
        {h:"Scientific fact-checking",p:"Hard bounds, assumptions, and falsifiers for technical readers."}
      ],
      chips:{formal:"FORMAL",informal:"INFORMAL",concept:"CONCEPT",now:"NOW",roadmap:"ROADMAP"},
      warn:"Warning: this section is technical and bounded. It does not promise outcomes; it defines test conditions."
    },
    zh:{
      mark:"基轴体系",
      title:"终端",
      sub:"进入全系统的结构入口。",
      note:"此页自包含：索引、术语表与附录都在本页模态中呈现。",
      mini:"点击打开透镜视图。",
      bubbles:[
        {h:"施工中",p:"未完成区域使用占位显示进度，不会出现断路。"},
        {h:"导航方式",p:"按结构遍历；透镜只在模态内出现。"},
        {h:"状态稳定",p:"语言/风格/时间保持，避免上下文重置。"},
        {h:"下一步去哪",p:"用枢纽做罗盘导航；用产品/创新进入执行面。"},
        {h:"索引",p:"地图的地图：快速把你路由到正确干线。"},
        {h:"术语表",p:"固定术语含义，系统越大越可读。"},
        {h:"附录",p:"约定与参考，支撑深层内容而不污染正文。"},
        {h:"科学事实核查",p:"面向技术读者：硬边界、假设与证伪条件。"}
      ],
      chips:{formal:"正式",informal:"直接",concept:"概念",now:"当前",roadmap:"路线图"},
      warn:"提示：本节偏技术与有界表述，不承诺结果，只定义可测试条件。"
    }
  };
  var P=(lang==="zh")?T.zh:T.en;

  document.getElementById("mark").textContent=P.mark;
  document.getElementById("tTitle").textContent=P.title;
  document.getElementById("tSub").textContent=P.sub;
  document.getElementById("tNote").textContent=P.note;

  for(var i=0;i<8;i++){
    document.getElementById("b"+i+"h").textContent=P.bubbles[i].h;
    document.getElementById("b"+i+"p").textContent=P.bubbles[i].p;
    document.getElementById("b"+i+"m").textContent=P.mini;
  }

  // ===== MODAL REFS =====
  var bd=document.getElementById("bd");
  var modal=document.getElementById("modal");
  var mClose=document.getElementById("mClose");
  var mReturn=document.getElementById("mReturn");
  var mTitle=document.getElementById("mTitle");

  var chipStyle=document.getElementById("chipStyle");
  var chipConcept=document.getElementById("chipConcept");
  var chipNow=document.getElementById("chipNow");
  var chipRoadmap=document.getElementById("chipRoadmap");

  var h1=document.getElementById("h1"),p1=document.getElementById("p1");
  var h2=document.getElementById("h2"),p2=document.getElementById("p2");
  var h3=document.getElementById("h3"),p3=document.getElementById("p3");
  var h4=document.getElementById("h4"),p4=document.getElementById("p4");

  var activeIdx=0;

  function setChipLabels(){
    chipStyle.textContent="STYLE: "+(style==="formal"?P.chips.formal:P.chips.informal);
    chipConcept.textContent=P.chips.concept;
    chipNow.textContent=P.chips.now;
    chipRoadmap.textContent=P.chips.roadmap;

    chipConcept.classList.toggle("active", time==="origin");
    chipNow.classList.toggle("active", time==="now");
    chipRoadmap.classList.toggle("active", time==="post");
  }

  // ===== CONTENT (8 × 3 × 2 × 4 paragraphs) =====
  // Helper to keep formatting consistent and dense.
  function V(hA,pA,hB,pB,hC,pC,hD,pD){
    return [
      {h:hA,p:pA},
      {h:hB,p:pB},
      {h:hC,p:pC},
      {h:hD,p:pD}
    ];
  }

  var CONTENT_EN = {
    0:{ // Under construction
      origin:{
        formal:V(
          "Continuity rule","Unfinished areas show placeholders instead of breaking navigation. The goal is to preserve traversal flow even while content is incomplete.",
          "Truth rule","A placeholder is an explicit statement of incompleteness. It prevents implied claims and prevents the reader from guessing intent.",
          "Contract rule","Structure and routing ship first. Content expands inside stable nodes. This prevents redesign churn and reduces drift.",
          "Reader promise","You can always return, always jump, and always keep state; incompleteness is visible rather than hidden."
        ),
        informal:V(
          "No dead ends","If something isn’t finished, you’ll see a clear placeholder instead of a broken page.",
          "No pretending","Placeholders mean: not done yet. That’s intentional.",
          "Same map","The map stays stable while content grows inside it.",
          "Safe to explore","You can click around without getting trapped."
        )
      },
      now:{
        formal:V(
          "Current posture","The system is being filled node-by-node. Each node becomes usable before the next wave is added.",
          "No-empty rule","A node is considered live only when it has content under both style lenses and all time layers.",
          "Stability rule","Keys and routing are not changed to fit content; content is written to fit the contract.",
          "Transparency rule","What exists is labeled as live; what does not exist stays clearly marked."
        ),
        informal:V(
          "Fill-first","We fill what’s here before adding more.",
          "No empty nodes","If you can open it, it should say something real.",
          "Structure stays","We don’t rewrite the map every day.",
          "Clear status","Live vs not-yet stays obvious."
        )
      },
      post:{
        formal:V(
          "Scaling posture","More content is added without changing UI paradigms. Contract stability is the scalability mechanism.",
          "Audit posture","Stable nodes allow change tracking: what changed, where, and when.",
          "User outcome","The project becomes a navigable reference rather than a linear document.",
          "Safety outcome","Public surfaces remain bounded and legible as depth increases."
        ),
        informal:V(
          "More content","More pages will appear without breaking the feel.",
          "Easier tracking","Changes are easier to notice because structure is stable.",
          "Feels like a map","Not a book you have to finish.",
          "Stays safe","Clear boundaries stay clear as it grows."
        )
      }
    },

    1:{ // Navigation
      origin:{
        formal:V(
          "Traversal method","Navigation is structural: diamonds open modal surfaces; modals contain lenses; lenses change meaning, not just styling.",
          "Lens placement","Lenses are inside the modal only so the main page stays pure navigation and does not become a control panel.",
          "Return discipline","Closing a modal returns you to the same map state. Backtracking does not corrupt the route.",
          "Reader outcome","You learn one interaction grammar and reuse it everywhere across products, laws, and measurements."
        ),
        informal:V(
          "Tap structure","You move by clicking the map, not by scrolling a wall of text.",
          "Lenses inside only","The face stays clean; the controls are inside the modal.",
          "Return works","Close returns you to where you started.",
          "Learn once","If you can use one page, you can use the whole site."
        )
      },
      now:{
        formal:V(
          "Deterministic routing","Every internal link carries state in the querystring and respects localStorage fallback.",
          "Uniform buttons","All navigation uses the same button style to prevent default browser link coloring and reduce visual drift.",
          "Modal density","Each modal view contains four dense paragraphs so the reader gets signal quickly.",
          "Jump surfaces","Jump buttons move you to hubs without losing language/style/time."
        ),
        informal:V(
          "Links carry state","Language/style/time follow you automatically.",
          "No ugly link colors","Buttons stay consistent.",
          "Dense info","Four good paragraphs per view.",
          "Jump safely","Jump without losing your settings."
        )
      },
      post:{
        formal:V(
          "Deeper maps","Nodes expand into sub-hubs while keeping the same surface contract and lens semantics.",
          "Audience layering","Informal stays direct; Formal stays precise; both remain consistent under the same keys.",
          "Discovery without chaos","Crosslinks grow but never break return or state propagation.",
          "Outcome","Navigation becomes a dependable learning tool under pressure."
        ),
        informal:V(
          "Bigger maps","More branches, same rules.",
          "Two tones","Direct and precise, both stable.",
          "No chaos","More links without confusion.",
          "Reliable","Feels consistent over time."
        )
      }
    },

    2:{ // State stability
      origin:{
        formal:V(
          "Canonical keys","State is limited to gd_lang, gd_style, gd_time. No extra namespaces are allowed.",
          "Hydration order","URL parameters hydrate first; storage backs up; values are normalized to prevent drift.",
          "Propagation rule","All internal links carry the state forward via querystring.",
          "User outcome","The system behaves predictably and does not ‘forget’ context."
        ),
        informal:V(
          "Only three keys","Language, style, time. That’s it.",
          "URL wins","If it’s in the link, it loads that view.",
          "Links carry forward","Your settings go with you.",
          "Predictable","No random resets."
        )
      },
      now:{
        formal:V(
          "Single-language render","Language is a lens: English-only or Chinese-only, not both at once.",
          "Style lens","Formal vs Informal changes framing and density while staying truthful and bounded.",
          "Time lens","Concept vs Now vs Roadmap changes emphasis while keeping definitions stable.",
          "Failure clarity","If state looks wrong, it is traceable: URL, storage, or missing propagation."
        ),
        informal:V(
          "Language is a switch","One language at a time.",
          "Style changes meaning","Not just cosmetics.",
          "Time changes emphasis","Concept/Now/Roadmap are different views.",
          "Fixable","If it’s wrong, we can trace it."
        )
      },
      post:{
        formal:V(
          "Scale safety","Stable keys and stable semantics are what make the platform scalable and auditable.",
          "Shareability","A link becomes a portable state: others open the same view you meant.",
          "No capture","State is for comprehension, not for tracking people.",
          "Outcome","Coherent traversal across a growing knowledge graph."
        ),
        informal:V(
          "Stable forever","Keys don’t drift.",
          "Shareable links","People open the same view.",
          "No tracking games","State is for clarity.",
          "Coherent","Everything stays aligned."
        )
      }
    },

    3:{ // Where to go next
      origin:{
        formal:V(
          "HUB","Use HUB when you want compass navigation (North/East/South/West) and quick orientation.",
          "PRODUCTS","Use PRODUCTS when you want deployable surfaces: software, education, energy, and commercial packaging.",
          "INNOVATION","Use INNOVATION when you want future trunks and frontier expansions under the same contract.",
          "LAWS / GAUGES","Use LAWS for definitions and standards; use GAUGES for measurement and dashboards."
        ),
        informal:V(
          "HUB","Compass navigation.",
          "PRODUCTS","What exists and can be used.",
          "INNOVATION","Future trunks and frontier ideas.",
          "LAWS/GAUGES","Rules and measurements."
        )
      },
      now:{
        formal:V(
          "Deployed vs future","Products are written as deployed surfaces; Innovation is written as future surfaces; the contract is shared but claims are separated.",
          "Fast path","If you want to ‘do’ something, go Products. If you want ‘what it means,’ go Laws. If you want ‘how we measure,’ go Gauges.",
          "Crosslinks","Crosslinks exist, but they do not replace the compass discipline.",
          "Return discipline","Always return to HUB if you feel lost; that is the intended reset."
        ),
        informal:V(
          "Keep claims clean","Products vs Innovation stay separate.",
          "Do vs mean vs measure","Products, Laws, Gauges.",
          "Crosslinks help","But HUB is the anchor.",
          "Return anytime","If lost, go HUB."
        )
      },
      post:{
        formal:V(
          "Catalog growth","More product sub-hubs appear (education tracks, energy stages, commercial kits) without changing navigation grammar.",
          "Proof growth","More gauges and fact-check nodes appear for readers who want verification.",
          "Translation growth","More bilingual coverage with stable term mapping, not mixed-language clutter.",
          "Outcome","A platform that supports both discovery and discipline."
        ),
        informal:V(
          "More products","More sub-hubs, same UI.",
          "More proof","More measurements and checks.",
          "Better bilingual","Clean language switching.",
          "Still disciplined","Discovery without drift."
        )
      }
    },

    4:{ // Index (on this page)
      origin:{
        formal:V(
          "Index purpose","Index is routing compression: a table-of-contents that gets you to the correct trunk with minimal reading.",
          "Index rule","Index entries must be complete sentences with bounded meaning so they do not become vague labels.",
          "Index routes","Core routes: /home/ (HUB), /products/ (PRODUCTS), /explore/ (INNOVATION), /laws/ (LAWS), /gauges/ (GAUGES), /links/ (LINKS).",
          "Index outcome","Faster discovery without sacrificing structure or truth boundaries."
        ),
        informal:V(
          "Index = quick map","Routes you fast.",
          "One-sentence rule","No vague labels.",
          "Main routes","HUB, PRODUCTS, INNOVATION, LAWS, GAUGES, LINKS.",
          "Result","Less time wasted."
        )
      },
      now:{
        formal:V(
          "Products index","SOFTWARE: site surfaces + instruments; EDUCATION: traversal learning; ENERGY: conversion chain; COMMERCIAL: deployment packaging.",
          "Innovation index","INNOVATION: future trunks by quadrant; Concept/Now/Roadmap separates definition, execution posture, and planned expansion.",
          "Laws index","LAWS: definitions, constraints, and standards; bounded claims; falsifiers when applicable.",
          "Gauges index","GAUGES: measurement surfaces; status views; regime/threshold representations when available."
        ),
        informal:V(
          "Products","Software, Education, Energy, Commercial.",
          "Innovation","Future trunks + lens separation.",
          "Laws","Definitions and standards.",
          "Gauges","Measurements and status."
        )
      },
      post:{
        formal:V(
          "Index scaling","Index grows on this page by adding entries inside the modal only; it does not require new pages.",
          "Cross-indexing","Index entries may point to multiple trunks when a concept spans products, laws, and gauges.",
          "Verification hooks","Index entries may reference fact-check nodes when verification matters.",
          "Outcome","A stable routing circuit for a large project."
        ),
        informal:V(
          "It stays here","No extra pages needed.",
          "More entries","Added inside the modal.",
          "Cross-links","One idea can point to several places.",
          "Still fast","It stays usable."
        )
      }
    },

    5:{ // Glossary (on this page)
      origin:{
        formal:V(
          "Glossary purpose","Glossary pins meaning to terms so the system remains readable as it scales and translations remain stable.",
          "Glossary rule","Definitions are bounded and descriptive; they do not claim more than the evidence supports.",
          "Core terms (starter)","Invariant: a property that must remain stable; Variance: measured deviation; Lens: controlled view; Contract: enforced rule; Drift: instability growth; Receipt: verifiable completion marker.",
          "Glossary outcome","Readers share the same meanings, which reduces misunderstanding and conflict."
        ),
        informal:V(
          "Glossary = definitions","Words mean one thing here.",
          "Bounded definitions","No vague claims.",
          "Starter terms","Invariant, Variance, Lens, Contract, Drift, Receipt.",
          "Result","Less confusion."
        )
      },
      now:{
        formal:V(
          "Traversal","Traversal is structured navigation through knowledge, not linear reading; it prioritizes orientation and return safety.",
          "Bilingual mapping","Terms are translated consistently; language is a lens (EN only / 中文 only), not mixed output.",
          "Time lens mapping","Concept = definition; Now = current execution posture; Roadmap = planned expansion; all map to gd_time keys.",
          "Integrity rule","If a term is used, it must match its glossary meaning across the site."
        ),
        informal:V(
          "Traversal","Navigate by structure, not chapters.",
          "Bilingual","One language at a time; consistent mapping.",
          "Time lens","Concept/Now/Roadmap are different views.",
          "Integrity","Words must mean the same thing everywhere."
        )
      },
      post:{
        formal:V(
          "Glossary growth","Glossary expands inside this page by adding terms grouped by trunk: Products, Innovation, Laws, Gauges.",
          "Conformance checks","Later, glossary conformance can be enforced by review and instrumentation, not by vibes.",
          "Evidence links","High-load terms can point to fact-check nodes for technical readers.",
          "Outcome","A stable language layer that supports scale."
        ),
        informal:V(
          "More terms","Added here, in this modal.",
          "Consistency checks","Enforced by rules, not opinions.",
          "Proof links","When needed, terms can link to checks.",
          "Stable language","Scale without drift."
        )
      }
    },

    6:{ // Appendix (on this page)
      origin:{
        formal:V(
          "Appendix purpose","Appendix holds conventions and references that support the system without cluttering core surfaces.",
          "What belongs here","Naming conventions, routing conventions, key constraints, and publication posture rules.",
          "Conventions (starter)","Keys: gd_lang/gd_style/gd_time only; Lenses live inside modal only; Main pages are navigation surfaces; Deterministic routing required.",
          "Outcome","A clean core plus a complete support layer."
        ),
        informal:V(
          "Appendix = support","Rules and references live here.",
          "Keeps pages clean","Core stays readable.",
          "Starter conventions","Only gd_* keys; lenses in modal only; deterministic routing.",
          "Result","Complete without clutter."
        )
      },
      now:{
        formal:V(
          "Disclosure boundary","Public pages explain structure, signals, and falsifiers; they do not disclose hazardous instructions or proprietary build recipes.",
          "Neutrality rule","Public copy stays consumer-legible and neutral; no funnels, no capture, no pressure language.",
          "Version posture","Structure changes are rare; content expands inside stable nodes.",
          "Outcome","Public-safe growth with integrity."
        ),
        informal:V(
          "Boundary","Explain structure; don’t publish recipes.",
          "Neutral tone","No hype and no funnels.",
          "Version rule","Structure stable, content grows.",
          "Result","Safe growth."
        )
      },
      post:{
        formal:V(
          "Archive posture","Appendix becomes the internal archive of conventions, version notes, and replication scaffolds—still inside this page.",
          "Replication posture","Appendix can store minimal replication protocols at a high level without creating new pages.",
          "Cross-room continuity","Appendix can record room-to-room invariants to prevent drift.",
          "Outcome","Durable documentation without page explosion."
        ),
        informal:V(
          "Becomes the archive","Still on this page.",
          "Replication notes","Minimal, high level.",
          "Continuity","Invariants recorded clearly.",
          "Result","Durable without clutter."
        )
      }
    },

    7:{ // Fact-checking
      origin:{
        formal:V(
          "Warning","This section is technical. It defines bounded claims, assumptions, and falsifiers. It does not promise outcomes.",
          "Fact-check format","Claim → assumptions → measurement definition → falsifier → limits. This is the permanent structure.",
          "Reader posture","If a claim cannot be measured, it is labeled as conceptual and does not enter the verified layer.",
          "Outcome","A falsifiable backbone that prevents narrative inflation."
        ),
        informal:V(
          "Warning","Technical layer. No promises.",
          "Format","Claim, assumptions, measurement, falsifier, limits.",
          "Rule","No measurement = not verified.",
          "Result","Stops hand-waving."
        )
      },
      now:{
        formal:V(
          "What is checked","Definitions, invariants, and measurement semantics for the platform (state keys, lens semantics, bounded claims).",
          "What is not claimed","No universal conclusions without evidence; no trade secrets disclosed; no hazardous instructions published.",
          "How to falsify","Falsification is explicit: what observation would contradict the statement.",
          "Outcome","Engineers can audit the work without guessing intent."
        ),
        informal:V(
          "What we check","Definitions and measurement rules.",
          "What we don’t do","No universal promises. No secrets. No hazards.",
          "Falsify means","Say what would prove it wrong.",
          "Result","Audit without arguing."
        )
      },
      post:{
        formal:V(
          "Scaling plan","Fact-check nodes expand by adding more bounded claims under the same format; no new page types needed.",
          "Integration","Fact-checking can reference Products/Laws/Gauges where a claim is used.",
          "Governance posture","Fact-checking remains neutral and evidence-only; it does not become marketing copy.",
          "Outcome","A permanent verification spine for a growing platform."
        ),
        informal:V(
          "More checks","Same format, more claims.",
          "Connected","Links back to where claims are used.",
          "Neutral","Evidence-only.",
          "Result","Verification spine."
        )
      }
    }
  };

  var CONTENT_ZH = JSON.parse(JSON.stringify(CONTENT_EN)); // placeholder will be overwritten below

  // Chinese modal content (dense, single-language, no bullets)
  CONTENT_ZH = {
    0:{
      origin:{
        formal:V(
          "连续性规则","未完成区域用占位替代断路，保证遍历流不断。目标是让探索永远可返回。",
          "真值规则","占位=明确的不完整声明，防止读者猜意图与暗含主张。",
          "契约规则","先发布结构与路由，再在稳定节点内填内容，避免反复重做。",
          "读者承诺","永远可返回、永远可跳转、状态保持；不完整可见而不隐藏。"
        ),
        informal:V(
          "不堵路","未完成就显示占位，不会崩。",
          "不装完成","占位=没做完。",
          "同地图","结构稳定，内容慢慢长。",
          "可安全探索","随便点也不会被困住。"
        )
      },
      now:{
        formal:V(
          "当前姿态","按节点填充：一个节点先可用，再扩下一波。",
          "不留空规则","节点要同时满足两种风格与三种时间层才算上线。",
          "稳定规则","不为迎合内容而改契约；内容按契约写。",
          "透明规则","上线与未上线明确分离。"
        ),
        informal:V(
          "先填满","先把现有写实，再扩。",
          "不留空节点","能点开的都要有内容。",
          "结构不乱改","地图不天天重做。",
          "状态清楚","上线/未上线一眼能看。"
        )
      },
      post:{
        formal:V(
          "规模化姿态","更多内容在同一契约下扩展，不引入新范式。",
          "审计姿态","节点稳定后可追踪：哪里变了、何时变了。",
          "读者结果","项目变成可遍历参考面，不是线性长文。",
          "安全结果","公开内容在深度增长时仍保持有界与可读。"
        ),
        informal:V(
          "更多内容","不会破坏体验。",
          "更好追踪","结构稳定更容易看出变化。",
          "像地图","不需要按顺序读完。",
          "仍安全","边界一直清楚。"
        )
      }
    },

    1:{
      origin:{
        formal:V(
          "遍历方法","导航是结构化的：菱形→模态；透镜在模态内；透镜改变含义而非仅样式。",
          "透镜位置","透镜只在模态内，主页面保持纯导航，避免变成控制面板。",
          "返回纪律","关闭模态回到同一地图状态，不污染路径。",
          "读者结果","学一次交互语法，全站复用。"
        ),
        informal:V(
          "点结构","靠地图移动，不刷长文。",
          "透镜在里面","主页面干净。",
          "返回可靠","关掉就回到原处。",
          "学一次就够","全站一样用。"
        )
      },
      now:{
        formal:V(
          "确定路由","所有内部链接携带状态，并尊重本地存储回退。",
          "统一按钮","全部导航使用统一按钮，避免浏览器默认蓝紫链接样式。",
          "密度规则","每个视图四段密文，读者快速获得信号。",
          "跳转安全","跳转不丢语言/风格/时间层。"
        ),
        informal:V(
          "链接带状态","你的设置会跟着走。",
          "按钮统一","不出现怪颜色链接。",
          "信息密度高","四段就够清楚。",
          "跳转安全","不丢设置。"
        )
      },
      post:{
        formal:V(
          "更深地图","节点扩展为子枢纽，但保持同契约与同透镜语义。",
          "受众分层","直接与正式两种风格都稳定，且保持有界。",
          "跨链不混乱","交叉链接增长，但返回与状态传播不破。",
          "结果","导航成为可靠的学习工具。"
        ),
        informal:V(
          "地图更大","规则不变。",
          "两种语气","直接/正式都稳定。",
          "不混乱","链接变多也不乱。",
          "可靠","长期一致。"
        )
      }
    },

    2:{
      origin:{
        formal:V(
          "规范键","状态只允许 gd_lang / gd_style / gd_time，不引入新命名空间。",
          "注入顺序","URL优先注入，本地存储回退，并做值归一化。",
          "传播规则","所有内部链接必须携带状态。",
          "读者结果","系统可预测，不会“忘记”上下文。"
        ),
        informal:V(
          "只三键","语言/风格/时间层。",
          "URL优先","链接怎么写就怎么开。",
          "链接会带走","设置一路跟随。",
          "可预测","不随机重置。"
        )
      },
      now:{
        formal:V(
          "单语渲染","语言是透镜：英文或中文，不混排。",
          "风格透镜","正式/直接改变框架与密度，保持有界与真实。",
          "时间透镜","概念/当前/路线图改变强调点，但定义不漂移。",
          "故障可追踪","若状态异常：查URL、查存储、查传播。"
        ),
        informal:V(
          "语言是开关","一次一种语言。",
          "风格真改含义","不是换皮。",
          "时间真改强调","概念/当前/路线图不同。",
          "可修","状态错了能追根。"
        )
      },
      post:{
        formal:V(
          "规模安全","稳定键与稳定语义让平台可扩展且可审计。",
          "可分享性","链接即状态，别人打开即同视图。",
          "不捕获","状态用于理解，不用于追踪人。",
          "结果","在大系统中保持一致的遍历体验。"
        ),
        informal:V(
          "长期稳定","键不漂移。",
          "分享方便","链接即视图。",
          "不搞追踪","只为清晰。",
          "一致","全站对齐。"
        )
      }
    },

    3:{
      origin:{
        formal:V(
          "枢纽","枢纽用于罗盘导航（北东南西）与快速定位。",
          "产品","产品用于可部署执行面：软件、教育、能源、商业。",
          "创新","创新用于未来干线与前沿扩展，仍遵守同契约。",
          "法则/仪表","法则定义规则；仪表提供测量与状态视图。"
        ),
        informal:V(
          "枢纽","罗盘导航。",
          "产品","可用的执行面。",
          "创新","未来扩展。",
          "法则/仪表","规则与测量。"
        )
      },
      now:{
        formal:V(
          "上线与未来分离","产品=上线执行面；创新=未来执行面；契约共享但主张分离。",
          "最快路径","想做事→产品；想弄清含义→法则；想看测量→仪表。",
          "交叉链接","交叉链接存在，但不替代罗盘纪律。",
          "返回策略","迷路时回枢纽，这是设计的重置点。"
        ),
        informal:V(
          "主张要干净","上线与路线图不混说。",
          "做/懂/测","产品/法则/仪表。",
          "交叉链接辅助","枢纽是锚点。",
          "随时回枢纽","别硬撑。"
        )
      },
      post:{
        formal:V(
          "目录增长","更多产品子枢纽出现，但不改变交互语法。",
          "证明增长","更多仪表与核查节点为验证服务。",
          "翻译增长","更强双语覆盖与稳定术语映射。",
          "结果","既支持发现又保持纪律。"
        ),
        informal:V(
          "更多子枢纽","同UI。",
          "更多验证","更强测量与核查。",
          "更好双语","干净切换。",
          "仍有纪律","不漂移。"
        )
      }
    },

    4:{
      origin:{
        formal:V(
          "索引目的","索引=路由压缩：用最少阅读进入正确干线。",
          "索引规则","索引条目必须是完整句子与有界含义，避免变成标签堆。",
          "核心路由","/home/枢纽、/products/产品、/explore/创新、/laws/法则、/gauges/仪表、/links/链接。",
          "结果","更快发现但不牺牲结构与边界。"
        ),
        informal:V(
          "索引=快地图","快速路由。",
          "一条至少一句","不搞标签堆。",
          "主路由","枢纽/产品/创新/法则/仪表/链接。",
          "结果","省时间。"
        )
      },
      now:{
        formal:V(
          "产品索引","软件：执行面与仪器；教育：遍历学习；能源：转换链；商业：部署打包。",
          "创新索引","创新：未来干线；概念/当前/路线图区分定义、现况与扩展。",
          "法则索引","法则：定义与约束；主张有界；可证伪时给证伪条件。",
          "仪表索引","仪表：测量与状态；阈值与制度化状态展示（可用时）。"
        ),
        informal:V(
          "产品","软件/教育/能源/商业。",
          "创新","未来干线+透镜分离。",
          "法则","定义与规则。",
          "仪表","测量与状态。"
        )
      },
      post:{
        formal:V(
          "扩展方式","索引仍在本页，通过增加条目扩展，不创建新页面。",
          "交叉索引","跨干线概念可以多指向：产品/法则/仪表。",
          "验证钩子","需要证明时索引可引用核查节点。",
          "结果","大系统的稳定路由电路。"
        ),
        informal:V(
          "还在这页","不加新页。",
          "更多条目","只增加内容。",
          "多指向","一概念可指多处。",
          "仍快","仍可用。"
        )
      }
    },

    5:{
      origin:{
        formal:V(
          "术语表目的","术语表固定含义，保证规模化后仍可读且翻译不漂移。",
          "术语表规则","定义有界、描述性，不超出证据。",
          "核心术语（起步）","不变量：必须稳定的属性；方差：可测偏离；透镜：受控视图；契约：可执行规则；漂移：不稳定增长；收据：可验证完成标记。",
          "结果","读者共享含义，误解与冲突下降。"
        ),
        informal:V(
          "术语表=定义","词在这里有固定含义。",
          "定义有界","不夸大。",
          "起步术语","不变量/方差/透镜/契约/漂移/收据。",
          "结果","更少混乱。"
        )
      },
      now:{
        formal:V(
          "遍历","遍历=按结构导航学习，不是线性读完；强调定位与安全返回。",
          "双语映射","术语翻译保持一致；语言是透镜（单语渲染），不混排。",
          "时间透镜映射","概念=定义；当前=执行姿态；路线图=扩展方向；都映射到gd_time键。",
          "完整性规则","任何页面使用术语必须与术语表一致。"
        ),
        informal:V(
          "遍历","按结构学习，不按章节。",
          "双语","一次一种语言，映射一致。",
          "时间透镜","概念/当前/路线图不同视图。",
          "完整性","词必须全站一致。"
        )
      },
      post:{
        formal:V(
          "增长方式","术语表仍在本页，通过增加术语扩展，并按干线分组。",
          "一致性检查","后续通过审阅与仪器约束保持一致，而非凭感觉。",
          "证据链接","高负载术语可链接核查节点供技术读者验证。",
          "结果","稳定语言层支撑规模化。"
        ),
        informal:V(
          "更多术语","在这里加。",
          "一致性","用规则约束。",
          "证明链接","需要时有核查。",
          "语言稳定","规模不漂移。"
        )
      }
    },

    6:{
      origin:{
        formal:V(
          "附录目的","附录存放约定与参考，避免污染核心执行面。",
          "内容范围","命名规则、路由规则、键约束、公开披露边界。",
          "约定（起步）","仅gd_lang/gd_style/gd_time；透镜只在模态内；主页面是导航面；路由必须确定。",
          "结果","核心干净但系统完整。"
        ),
        informal:V(
          "附录=支撑层","规则与参考在此。",
          "保持干净","核心页面更可读。",
          "起步约定","只三键；透镜在模态；确定路由。",
          "结果","完整不杂乱。"
        )
      },
      now:{
        formal:V(
          "披露边界","公开页面讲结构/信号/证伪，不讲危险步骤与专有配方。",
          "中立规则","公开文案保持大众可读与中立，无漏斗、无捕获、无压迫语言。",
          "版本姿态","结构变更稀少；内容在稳定节点内增长。",
          "结果","公开安全增长且保持完整性。"
        ),
        informal:V(
          "边界","讲结构，不讲配方。",
          "中立","不夸大，不操控。",
          "版本","结构稳，内容长。",
          "结果","安全增长。"
        )
      },
      post:{
        formal:V(
          "归档姿态","附录成为约定、版本注记与复现脚手架的归档层，仍在本页。",
          "复现姿态","可存放最低限度复现协议（高层），不增加页面爆炸。",
          "连续性","记录跨房间不变量，防止漂移。",
          "结果","耐久文档而不引入杂乱。"
        ),
        informal:V(
          "成为归档","仍在本页。",
          "复现笔记","保持高层与安全。",
          "连续性","不变量写清楚。",
          "结果","耐久不杂乱。"
        )
      }
    },

    7:{
      origin:{
        formal:V(
          "提示",P.warn,
          "核查格式","主张→假设→测量定义→证伪→限制。保持固定结构。",
          "验证规则","不可测的主张标记为概念，不进入已验证层。",
          "结果","防止叙事膨胀，保持可证伪。"
        ),
        informal:V(
          "提示",P.warn,
          "格式","主张/假设/测量/证伪/限制。",
          "规则","不可测=未验证。",
          "结果","阻止空谈。"
        )
      },
      now:{
        formal:V(
          "核查对象","定义、不变量与测量语义（键、透镜语义、有界表述）。",
          "不主张事项","不做普遍结论承诺；不泄露秘密；不发布危险步骤。",
          "证伪方式","明确指出什么观察会推翻陈述。",
          "结果","技术读者可审计而不需猜意图。"
        ),
        informal:V(
          "检查什么","定义与测量规则。",
          "不做什么","不许诺、不泄密、不危险。",
          "证伪","说明什么会证明它错。",
          "结果","可审计不争吵。"
        )
      },
      post:{
        formal:V(
          "扩展方式","同格式增加更多核查主张，不新增页面类型。",
          "集成","核查可引用产品/法则/仪表中被使用的主张。",
          "治理姿态","核查保持中立与证据优先，不变成营销。",
          "结果","成为增长平台的永久验证脊柱。"
        ),
        informal:V(
          "更多核查","同格式扩展。",
          "可引用","回指到使用位置。",
          "中立","只证据。",
          "结果","永久验证骨架。"
        )
      }
    }
  };

  var CONTENT = (lang==="zh") ? CONTENT_ZH : CONTENT_EN;

  function view(idx){ return CONTENT[idx][time][style]; }

  function renderModal(){
    setChipLabels();
    wire();
    mTitle.textContent = P.bubbles[activeIdx].h;
    var v = view(activeIdx);
    h1.textContent=v[0].h; p1.textContent=v[0].p;
    h2.textContent=v[1].h; p2.textContent=v[1].p;
    h3.textContent=v[2].h; p3.textContent=v[2].p;
    h4.textContent=v[3].h; p4.textContent=v[3].p;
  }

  function openModal(i){
    activeIdx=i;
    renderModal();
    bd.classList.add("show");
    modal.classList.add("show");
  }
  function closeModal(){
    bd.classList.remove("show");
    modal.classList.remove("show");
  }

  // Main bubble clicks
  for(let i=0;i<8;i++){
    (function(i){
      var el=document.getElementById("b"+i);
      el.onclick=function(){ openModal(i); };
      el.onkeydown=function(e){ if(e.key==="Enter"||e.key===" "){ e.preventDefault(); openModal(i);} };
    })(i);
  }

  // Lens buttons
  chipStyle.onclick=function(){
    style=(style==="formal")?"informal":"formal";
    try{localStorage.setItem("gd_style",style);}catch(e){}
    setChipLabels();
    renderModal();
  };
  chipConcept.onclick=function(){ time="origin"; try{localStorage.setItem("gd_time",time);}catch(e){} renderModal(); };
  chipNow.onclick=function(){ time="now"; try{localStorage.setItem("gd_time",time);}catch(e){} renderModal(); };
  chipRoadmap.onclick=function(){ time="post"; try{localStorage.setItem("gd_time",time);}catch(e){} renderModal(); };

  // Close
  bd.onclick=closeModal;
  mClose.onclick=closeModal;
  mReturn.onclick=closeModal;

  // Initial
  setChipLabels();
  wire();
})();
</script>

</body>
</html>

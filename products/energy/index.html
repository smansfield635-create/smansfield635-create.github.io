<!-- TNT — /products/energy/index.html  (ENERGY SUB-HUB · GEM STANDARD · DIAMOND-OF-DIAMONDS)
     QUICK FIX (NO DRIFT):
       - Buttons weren't working because the bottom dock overlapped the diamonds (dock z-index > stage).
       - Fix by lifting the stage on mobile and adding safe-area bottom padding so diamonds never sit under the dock.
     LOCKS:
       - TNT FULL FILE
       - Uses /assets/ui.css + /assets/branch.css only
       - DOES NOT style html/body background (ui.css owns field)
-->

<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>PRODUCTS · ENERGY</title>

<link rel="stylesheet" href="/assets/ui.css"/>
<link rel="stylesheet" href="/assets/branch.css"/>

<style>
:root{
  --R:154px;
  --goldSoft:rgba(212,175,55,.35);
  --obs1:#070b12;
  --obs2:#0c1626;
  --mut:rgba(255,255,255,.84);
  --mut2:rgba(255,255,255,.68);
}

/* Top-left */
.top-left{
  position:fixed; left:16px; top:16px; z-index:90;
  display:flex; gap:10px; flex-wrap:wrap; align-items:center;
}
.btn{
  padding:10px 16px; border-radius:14px;
  background:linear-gradient(145deg,var(--obs2),var(--obs1));
  color:#fff; border:1px solid rgba(255,255,255,.08);
  box-shadow:0 14px 36px rgba(0,0,0,.7);
  cursor:pointer; font-weight:900; letter-spacing:.2px; text-decoration:none;
  -webkit-tap-highlight-color:transparent;
}
.btn:hover{ box-shadow:0 18px 50px rgba(0,0,0,.9), 0 0 14px var(--goldSoft); }

/* Brand pill */
.brand{
  position:fixed; left:50%; top:16px; transform:translateX(-50%);
  z-index:80; text-align:center;
  padding:10px 14px; border-radius:999px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(0,0,0,.16); backdrop-filter:blur(8px);
}
.brand .name{ font-weight:950; letter-spacing:1.2px; font-size:12px; opacity:.95; }
.brand .tag{ font-size:11px; letter-spacing:.6px; opacity:.70; margin-top:2px; }

/* Stage */
.stage{
  position:fixed; left:50%; top:52%;
  transform:translate(-50%,-50%);
  width:min(720px,94vw); height:min(720px,94vw);
  z-index:40;
}
.outer{
  position:absolute; left:50%; top:50%;
  width:min(680px,92vw); height:min(680px,92vw);
  transform:translate(-50%,-50%) rotate(45deg);
  border-radius:60px;
  background:
    radial-gradient(circle at 30% 25%, rgba(255,255,255,.08), transparent 55%),
    radial-gradient(circle at 70% 80%, rgba(0,80,255,.14), transparent 60%),
    linear-gradient(160deg, rgba(14,24,40,.45) 0%, rgba(7,11,18,.62) 70%);
  border:1px solid rgba(255,255,255,.10);
  box-shadow:
    0 90px 260px rgba(0,0,0,.72),
    inset 0 2px 0 rgba(255,255,255,.10),
    inset 0 -50px 90px rgba(0,0,0,.55);
  pointer-events:none; opacity:.85;
}
.outer::after{
  content:""; position:absolute; inset:0; border-radius:60px;
  background:repeating-conic-gradient(from 0deg, rgba(255,255,255,.04) 0deg 6deg, transparent 6deg 18deg);
  opacity:.16;
}
.d{
  width:170px; height:170px;
  position:absolute; left:50%; top:50%;
  transform-origin:center; border-radius:26px;
  cursor:pointer; -webkit-tap-highlight-color:transparent;
  background:
    radial-gradient(circle at 35% 25%, rgba(255,255,255,.14), transparent 55%),
    radial-gradient(circle at 70% 80%, rgba(0,80,255,.18), transparent 60%),
    linear-gradient(160deg, rgba(12,22,38,.92) 0%, rgba(7,11,18,.95) 70%);
  border:1px solid rgba(255,255,255,.10);
  box-shadow:
    0 28px 84px rgba(0,0,0,.78),
    inset 0 2px 0 rgba(255,255,255,.14),
    inset 0 -28px 44px rgba(0,0,0,.62);
  transition:transform 220ms ease, box-shadow 220ms ease, border-color 220ms ease;
}
.d::before{
  content:""; position:absolute; inset:0; border-radius:26px; padding:1px;
  background:linear-gradient(120deg, transparent 0%, var(--goldSoft) 50%, transparent 100%);
  opacity:.45;
  -webkit-mask:linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  -webkit-mask-composite:xor; mask-composite:exclude;
  pointer-events:none;
}
.d::after{
  content:""; position:absolute; left:12%; right:12%; top:10%; height:28%;
  border-radius:999px;
  background:linear-gradient(to bottom, rgba(255,255,255,.16), rgba(255,255,255,0));
  opacity:.85; transform:rotate(-10deg);
  pointer-events:none;
}
.d:hover{
  transform:translate(-50%,-50%) rotate(45deg) scale(1.02);
  box-shadow:
    0 34px 110px rgba(0,0,0,.88),
    0 0 18px rgba(212,175,55,.18),
    inset 0 2px 0 rgba(255,255,255,.18),
    inset 0 -32px 52px rgba(0,0,0,.68);
}
.d.active{
  border-color:rgba(212,175,55,.55);
  box-shadow:
    0 34px 110px rgba(0,0,0,.88),
    0 0 30px rgba(212,175,55,.40),
    inset 0 2px 0 rgba(255,255,255,.18),
    inset 0 -32px 52px rgba(0,0,0,.68);
}
.d-n{ transform:translate(-50%,-50%) translate(0, calc(var(--R) * -1)) rotate(45deg); }
.d-e{ transform:translate(-50%,-50%) translate(var(--R), 0) rotate(45deg); }
.d-s{ transform:translate(-50%,-50%) translate(0, var(--R)) rotate(45deg); }
.d-w{ transform:translate(-50%,-50%) translate(calc(var(--R) * -1), 0) rotate(45deg); }

.inner{
  width:100%; height:100%; transform:rotate(-45deg);
  display:flex; flex-direction:column; align-items:center; justify-content:center;
  text-align:center; padding:16px; gap:10px;
  pointer-events:none; user-select:none;
}
.lab{ font-weight:950; letter-spacing:.8px; font-size:16px; }
.sub{ font-size:12.5px; opacity:.80; line-height:1.35; max-width:18em; }

.core{
  position:absolute; left:50%; top:50%;
  transform:translate(-50%,-50%);
  width:74px; height:74px; border-radius:22px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(0,0,0,.18);
  box-shadow:0 18px 44px rgba(0,0,0,.62), inset 0 2px 0 rgba(255,255,255,.10);
  display:grid; place-items:center;
  font-weight:950; letter-spacing:.5px;
  opacity:.92; pointer-events:none;
}

/* Dock */
.dock{
  position:fixed; left:50%;
  bottom:max(12px, env(safe-area-inset-bottom));
  transform:translateX(-50%);
  z-index:90;
  width:min(900px,94vw);
  display:flex; justify-content:center;
  gap:10px; flex-wrap:wrap;
  padding:10px 12px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(0,0,0,.20);
  backdrop-filter:blur(8px);
}

/* Modal */
.bd{
  position:fixed; inset:0; z-index:200;
  background:rgba(0,0,0,.65);
  backdrop-filter:blur(10px);
  display:none;
}
.bd.show{display:block;}
.modal{
  position:fixed; left:50%; top:50%;
  transform:translate(-50%,-50%);
  width:min(1020px,94vw);
  max-height:88vh;
  display:none;
  z-index:210;
}
.modal.show{display:block;}
.shell{
  height:88vh;
  border-radius:26px;
  border:1px solid rgba(255,255,255,.10);
  background:
    radial-gradient(circle at 50% 18%, rgba(176,0,0,.20), transparent 55%),
    radial-gradient(circle at 40% 25%, rgba(90,140,255,.12), transparent 55%),
    linear-gradient(160deg,var(--obs2) 0%, var(--obs1) 65%);
  box-shadow:0 60px 180px rgba(0,0,0,.92);
  overflow:hidden;
  display:flex;
  flex-direction:column;
  position:relative;
}
.mhead{
  display:flex; justify-content:space-between; align-items:center;
  gap:10px; padding:14px 16px;
  border-bottom:1px solid rgba(255,255,255,.08);
  position:relative; z-index:2;
}
.mtitle{ margin:0; font-weight:950; letter-spacing:.3px; font-size:16px; }
.mclose{ border:0; background:transparent; color:#fff; font-size:18px; cursor:pointer; padding:8px 10px; }
.mbody{
  padding:14px 16px 18px;
  overflow:auto; -webkit-overflow-scrolling:touch;
  flex:1 1 auto;
  position:relative; z-index:2;
}
.lensbar{
  display:flex; gap:10px; flex-wrap:wrap;
  align-items:center; justify-content:center;
  padding:10px 10px 14px;
  border-bottom:1px solid rgba(255,255,255,.08);
  margin:-6px -6px 14px;
}
.chip{
  padding:10px 16px; border-radius:999px;
  background:linear-gradient(145deg,var(--obs2),var(--obs1));
  border:1px solid rgba(255,255,255,.08);
  box-shadow:0 14px 36px rgba(0,0,0,.65);
  cursor:pointer; font-weight:900; letter-spacing:.2px; color:#fff;
}
.chip.active{
  border-color:rgba(212,175,55,.35);
  box-shadow:0 18px 50px rgba(0,0,0,.9), 0 0 16px rgba(212,175,55,.30);
}
.mgrid{ display:grid; gap:14px; }
@media (min-width:920px){ .mgrid{ grid-template-columns:1fr 1fr; } }
.box{
  padding:16px 18px; border-radius:22px;
  background:
    radial-gradient(circle at 30% 30%, rgba(120,160,255,.08), transparent 55%),
    linear-gradient(145deg, rgba(12,22,38,.92), rgba(7,11,18,.95));
  border:1px solid rgba(255,255,255,.10);
  box-shadow:0 18px 60px rgba(0,0,0,.70), inset 0 2px 0 rgba(255,255,255,.06);
  position:relative;
}
.box::before{
  content:""; position:absolute; inset:0; border-radius:22px; padding:1px;
  background:linear-gradient(120deg, transparent 0%, var(--goldSoft) 50%, transparent 100%);
  opacity:.55;
  -webkit-mask:linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  -webkit-mask-composite:xor; mask-composite:exclude;
  pointer-events:none;
}
.h{ margin:0 0 8px; font-weight:950; letter-spacing:.2px; }
.p{ margin:0 0 10px; color:var(--mut); line-height:1.55; }
.ul{ margin:0 0 0 18px; padding:0; color:var(--mut2); }
.ul li{ margin:6px 0; }
.mact{ display:flex; gap:10px; flex-wrap:wrap; justify-content:center; margin-top:14px; }
.sbtn{
  padding:12px 18px; border-radius:14px;
  background:linear-gradient(145deg,var(--obs2),var(--obs1));
  color:#fff; border:1px solid rgba(255,255,255,.08);
  box-shadow:0 14px 36px rgba(0,0,0,.7);
  cursor:pointer; font-weight:900; letter-spacing:.2px; text-decoration:none;
}
.sbtn:hover{ box-shadow:0 18px 50px rgba(0,0,0,.9), 0 0 14px var(--goldSoft); }

/* MOBILE FIX: lift stage above dock hit-area + reserve bottom space */
@media (max-width:640px){
  .stage{ top:46%; } /* was 52% → lift so bottom diamonds are never under the dock */
  body{ padding-bottom:120px; } /* reserve space below content for dock */
}
@media (max-width:560px){
  :root{ --R: 136px; }
  .d{ width:158px; height:158px; }
}
</style>
</head>

<body>

<div class="top-left">
  <a class="btn" id="btnBack" href="/products/">BACK</a>
  <a class="btn" id="btnExit" href="/door/">EXIT</a>
</div>

<div class="brand">
  <div class="name" id="brandName">PRODUCTS</div>
  <div class="tag" id="brandTag">ENERGY CONVERSION</div>
</div>

<div class="stage">
  <div class="outer"></div>

  <div class="d d-n" id="dChain" role="button" tabindex="0">
    <div class="inner">
      <div class="lab" id="labChain">CHAIN</div>
      <div class="sub" id="subChain">Solar → plasma → fusion.</div>
    </div>
  </div>

  <div class="d d-e" id="dPlasma" role="button" tabindex="0">
    <div class="inner">
      <div class="lab" id="labPlasma">PLASMA</div>
      <div class="sub" id="subPlasma">Formation · stability.</div>
    </div>
  </div>

  <div class="d d-s" id="dFusion" role="button" tabindex="0">
    <div class="inner">
      <div class="lab" id="labFusion">FUSION</div>
      <div class="sub" id="subFusion">Confinement · criteria.</div>
    </div>
  </div>

  <div class="d d-w" id="dValidation" role="button" tabindex="0">
    <div class="inner">
      <div class="lab" id="labValidation">VALIDATION</div>
      <div class="sub" id="subValidation">Signals · falsifiers.</div>
    </div>
  </div>

  <div class="core">◆</div>
</div>

<nav class="dock" id="dock">
  <a class="btn" id="dockHub" href="/home/">HUB</a>
  <a class="btn" id="dockTerminal" href="/index.html">TERMINAL</a>
  <a class="btn" id="dockLinks" href="/links/">LINKS</a>
  <a class="btn" id="dockProducts" href="/products/">PRODUCTS</a>
  <a class="btn" id="dockLaws" href="/laws/">LAWS</a>
  <a class="btn" id="dockGauges" href="/gauges/">GAUGES</a>
</nav>

<div class="bd" id="bd"></div>

<div class="modal" id="modal" role="dialog" aria-modal="true">
  <div class="shell">
    <div class="mhead">
      <h3 class="mtitle" id="mTitle">DETAIL</h3>
      <button class="mclose" id="mClose" aria-label="Close" type="button">✕</button>
    </div>

    <div class="mbody">
      <div class="lensbar">
        <button class="chip" id="styleChip" type="button">STYLE: FORMAL</button>
        <button class="chip" data-time="origin" id="chipConcept" type="button">CONCEPT</button>
        <button class="chip" data-time="now" id="chipLive" type="button">LIVE</button>
        <button class="chip" data-time="post" id="chipRoadmap" type="button">ROADMAP</button>
      </div>

      <div class="mgrid">
        <div class="box"><h4 class="h" id="h1"></h4><p class="p" id="p1"></p><ul class="ul" id="u1"></ul></div>
        <div class="box"><h4 class="h" id="h2"></h4><p class="p" id="p2"></p><ul class="ul" id="u2"></ul></div>
        <div class="box"><h4 class="h" id="h3"></h4><p class="p" id="p3"></p><ul class="ul" id="u3"></ul></div>
        <div class="box"><h4 class="h" id="h4"></h4><p class="p" id="p4"></p><ul class="ul" id="u4"></ul></div>
      </div>

      <div class="mact">
        <button class="sbtn" id="mReturn" type="button">RETURN</button>
        <a class="sbtn" id="mJumpProducts" href="/products/">JUMP PRODUCTS</a>
        <a class="sbtn" id="mJumpHub" href="/home/">JUMP HUB</a>
      </div>
    </div>
  </div>
</div>

<script>
(function(){
  // URL → STATE HYDRATION (canonical keys only)
  var qs = new URLSearchParams(location.search);
  var lang  = qs.get("lang")  || localStorage.getItem("gd_lang")  || "en";
  var style = qs.get("style") || localStorage.getItem("gd_style") || "formal";
  var time  = qs.get("time")  || localStorage.getItem("gd_time")  || "now";
  if(!["en","zh"].includes(lang)) lang="en";
  if(!["formal","informal"].includes(style)) style="formal";
  if(time==="trajectory") time="post";
  if(!["origin","now","post"].includes(time)) time="now";
  try{ localStorage.setItem("gd_lang",lang); localStorage.setItem("gd_style",style); localStorage.setItem("gd_time",time); }catch(e){}
  document.documentElement.lang = (lang==="zh") ? "zh" : "en";

  function q(){ return "lang="+encodeURIComponent(lang)+"&style="+encodeURIComponent(style)+"&time="+encodeURIComponent(time); }

  function setLinks(){
    var s=q();
    document.getElementById("btnBack").href="/products/?"+s;
    document.getElementById("btnExit").href="/door/?"+s;

    document.getElementById("dockHub").href="/home/?"+s;
    document.getElementById("dockTerminal").href="/index.html?"+s;
    document.getElementById("dockLinks").href="/links/?"+s;
    document.getElementById("dockProducts").href="/products/?"+s;
    document.getElementById("dockLaws").href="/laws/?"+s;
    document.getElementById("dockGauges").href="/gauges/?"+s;

    document.getElementById("mJumpProducts").href="/products/?"+s;
    document.getElementById("mJumpHub").href="/home/?"+s;
  }
  setLinks();

  var UI = {
    en:{
      brand:"PRODUCTS",
      tag:"ENERGY CONVERSION",
      d:{chain:{lab:"CHAIN", sub:"Solar → plasma → fusion."},plasma:{lab:"PLASMA", sub:"Formation · stability."},fusion:{lab:"FUSION", sub:"Confinement · criteria."},val:{lab:"VALIDATION", sub:"Signals · falsifiers."}},
      lens:{formal:"FORMAL",informal:"INFORMAL",concept:"CONCEPT",live:"LIVE",roadmap:"ROADMAP"},
      btn:{ret:"RETURN",jp:"JUMP PRODUCTS",jh:"JUMP HUB"},
      stylePrefix:"STYLE: "
    },
    zh:{
      brand:"产品",
      tag:"能源转换",
      d:{chain:{lab:"链路", sub:"太阳 → 等离子 → 聚变。"},plasma:{lab:"等离子", sub:"形成 · 稳定。"},fusion:{lab:"聚变", sub:"约束 · 标准。"},val:{lab:"验证", sub:"信号 · 证伪。"}},
      lens:{formal:"正式",informal:"直接",concept:"概念",live:"上线",roadmap:"路线图"},
      btn:{ret:"返回",jp:"跳转产品",jh:"跳转枢纽"},
      stylePrefix:"风格："
    }
  };
  var ui = (lang==="zh") ? UI.zh : UI.en;

  document.getElementById("brandName").textContent = ui.brand;
  document.getElementById("brandTag").textContent = ui.tag;

  document.getElementById("labChain").textContent = ui.d.chain.lab;
  document.getElementById("subChain").textContent = ui.d.chain.sub;
  document.getElementById("labPlasma").textContent = ui.d.plasma.lab;
  document.getElementById("subPlasma").textContent = ui.d.plasma.sub;
  document.getElementById("labFusion").textContent = ui.d.fusion.lab;
  document.getElementById("subFusion").textContent = ui.d.fusion.sub;
  document.getElementById("labValidation").textContent = ui.d.val.lab;
  document.getElementById("subValidation").textContent = ui.d.val.sub;

  document.getElementById("mReturn").textContent = ui.btn.ret;
  document.getElementById("mJumpProducts").textContent = ui.btn.jp;
  document.getElementById("mJumpHub").textContent = ui.btn.jh;

  var bd=document.getElementById("bd");
  var modal=document.getElementById("modal");
  var mClose=document.getElementById("mClose");
  var mTitle=document.getElementById("mTitle");

  var styleChip=document.getElementById("styleChip");
  var chipConcept=document.getElementById("chipConcept");
  var chipLive=document.getElementById("chipLive");
  var chipRoadmap=document.getElementById("chipRoadmap");

  var h1=document.getElementById("h1"),p1=document.getElementById("p1"),u1=document.getElementById("u1");
  var h2=document.getElementById("h2"),p2=document.getElementById("p2"),u2=document.getElementById("u2");
  var h3=document.getElementById("h3"),p3=document.getElementById("p3"),u3=document.getElementById("u3");
  var h4=document.getElementById("h4"),p4=document.getElementById("p4"),u4=document.getElementById("u4");

  function persist(){
    try{ localStorage.setItem("gd_style",style); localStorage.setItem("gd_time",time); }catch(e){}
  }
  function setLensLabels(){
    styleChip.textContent = ui.stylePrefix + (style==="formal" ? ui.lens.formal : ui.lens.informal);
    chipConcept.textContent = ui.lens.concept;
    chipLive.textContent = ui.lens.live;
    chipRoadmap.textContent = ui.lens.roadmap;

    chipConcept.classList.toggle("active", time==="origin");
    chipLive.classList.toggle("active", time==="now");
    chipRoadmap.classList.toggle("active", time==="post");
  }
  function fill(hEl,pEl,uEl,b){
    hEl.textContent=b.h;
    pEl.textContent=b.p;
    uEl.innerHTML="";
    b.u.forEach(function(x){
      var li=document.createElement("li");
      li.textContent=x;
      uEl.appendChild(li);
    });
  }

  // Minimal content (enough to verify mechanics). Expand later after mechanics confirmed.
  var CONTENT = (lang==="zh") ? {
    chain:{
      origin:{formal:{title:"链路 · 概念",
        b1:{h:"是什么",p:"能量被建模为转换链：输入→阶段→输出。",u:["阶段清楚。","边界清楚。","信号可测。","主张有界。"]},
        b2:{h:"方向",p:"太阳捕获→等离子形成→受控路径→聚变相关标准。",u:["先定义再主张。","先测量再推断。","失败模式明示。","不泄露配方。"]},
        b3:{h:"公开内容",p:"公开测什么与如何证伪。",u:["信号公开。","证伪公开。","边界公开。","无步骤。"]},
        b4:{h:"不公开",p:"不公开蓝图与配方。",u:["无原理图。","无设定点。","无步骤。","无危险。"]}},
        informal:{title:"链路 · 概念",
        b1:{h:"链路",p:"输入→阶段→输出。",u:["清楚。","有界。","可测。","可证伪。"]},
        b2:{h:"方向",p:"太阳→等离子→标准。",u:["定义。","测量。","失败。","边界。"]},
        b3:{h:"公开",p:"信号与证伪。",u:["信号。","证伪。","规则。","不泄密。"]},
        b4:{h:"不公开",p:"配方。",u:["不配方。","不蓝图。","不步骤。","不危险。"]}}}},
      now:{formal:{title:"链路 · 上线",
        b1:{h:"现况",p:"公开安全参考面。",u:["术语稳。","阶段稳。","边界稳。","不漂移。"]},
        b2:{h:"分离",p:"概念/上线/路线图分离。",u:["不混说。","不暗跳。","有界。","可读。"]},
        b3:{h:"透镜",p:"透镜真改内容。",u:["正式/直接。","概念/上线/路线图。","含义稳定。","一致。"]},
        b4:{h:"边界",p:"不发配方。",u:["不配方。","不蓝图。","只信号。","只证伪。"]}},
        informal:{title:"链路 · 上线",
        b1:{h:"现在",p:"稳定可读。",u:["稳。","清。","有界。","安全。"]},
        b2:{h:"不混",p:"上线/路线图分开。",u:["分开。","清晰。","诚实。","稳定。"]},
        b3:{h:"透镜",p:"切换会变字。",u:["不是装饰。","是含义。","是强调。","一致。"]},
        b4:{h:"边界",p:"不发配方。",u:["不发。","不发。","不发。","安全。"]}}}},
      post:{formal:{title:"链路 · 路线图",
        b1:{h:"加深度",p:"更深阶段页。",u:["更多定义。","更多约束。","更多信号。","更多证伪。"]},
        b2:{h:"证据包",p:"证明模板。",u:["条件日志。","可重复。","审计。","公开安全。"]},
        b3:{h:"对抗测试",p:"信号 vs 噪声。",u:["噪声控制。","伪象检查。","交叉验证。","证伪优先。"]},
        b4:{h:"结果",p:"严谨吸引人。",u:["可测。","可证伪。","有界。","安全。"]}},
        informal:{title:"链路 · 路线图",
        b1:{h:"更深",p:"更多内容。",u:["定义。","约束。","信号。","证伪。"]},
        b2:{h:"模板",p:"证明格式。",u:["日志。","检查。","可重复。","安全。"]},
        b3:{h:"测试",p:"对抗测试。",u:["噪声。","伪象。","交叉。","证伪。"]},
        b4:{h:"结果",p:"严谨。",u:["严谨。","可测。","安全。","一致。"]}}}}
    },
    plasma:{origin:{formal:{title:"等离子 · 概念",b1:{h:"是什么",p:"桥态：必须稳定与可控。",u:["稳定。","损耗。","模式。","测量。"]},b2:{h:"稳定",p:"扰动下有界。",u:["可重复。","可测。","可控。","无失控。"]},b3:{h:"公开",p:"讲信号与证伪。",u:["信号。","证伪。","边界。","无配方。"]},b4:{h:"边界",p:"不泄露装置。",u:["不蓝图。","不设定。","不步骤。","安全。"]}},
      informal:{title:"等离子 · 概念",b1:{h:"桥态",p:"稳定最关键。",u:["稳定。","损耗。","测量。","边界。"]},b2:{h:"规则",p:"可测才算。",u:["基线。","重复。","噪声。","限制。"]},b3:{h:"公开",p:"信号与失败。",u:["信号。","失败。","证伪。","边界。"]},b4:{h:"不公开",p:"配方。",u:["不配方。","不蓝图。","不步骤。","不危险。"]}}}},
      now:{formal:{title:"等离子 · 上线",b1:{h:"现况",p:"稳定性入门面。",u:["模式。","损耗。","信号。","边界。"]},b2:{h:"纪律",p:"测量优先。",u:["基线。","重复。","伪象。","限制。"]},b3:{h:"安全",p:"不教怎么造。",u:["无步骤。","无配方。","无参数。","无危险。"]},b4:{h:"结果",p:"严肃可测试。",u:["失败。","信号。","限制。","下一步。"]}},
      informal:{title:"等离子 · 上线",b1:{h:"现在",p:"可读。",u:["清楚。","有界。","安全。","稳定。"]},b2:{h:"规则",p:"不可测不主张。",u:["基线。","重复。","噪声。","限制。"]},b3:{h:"不发",p:"不发配方。",u:["不发。","不发。","不发。","安全。"]},b4:{h:"效果",p:"可信。",u:["可测。","可证伪。","有界。","诚实。"]}}}},
      post:{formal:{title:"等离子 · 路线图",b1:{h:"标记",p:"稳定/漂移/失败。",u:["稳定。","漂移。","失败。","噪声。"]},b2:{h:"损耗",p:"损耗账本。",u:["类型。","信号。","边界。","审计。"]},b3:{h:"模板",p:"证据包模板。",u:["模板。","日志。","重复。","安全。"]},b4:{h:"结果",p:"严谨吸引人。",u:["严谨。","可测。","安全。","一致。"]}},
      informal:{title:"等离子 · 路线图",b1:{h:"更多",p:"更深内容。",u:["定义。","约束。","信号。","证伪。"]},b2:{h:"模板",p:"报告格式。",u:["日志。","检查。","重复。","安全。"]},b3:{h:"测试",p:"压力测试。",u:["噪声。","伪象。","交叉。","证伪。"]},b4:{h:"结果",p:"稳定扩展。",u:["稳定。","有界。","可测。","安全。"]}}}}
    },
    fusion:{origin:{formal:{title:"聚变 · 概念",b1:{h:"标准",p:"标准而非口号。",u:["约束。","能量。","时间。","损耗。"]},b2:{h:"约束",p:"保持条件够久。",u:["保持。","稳定。","测量。","重复。"]},b3:{h:"公开",p:"标准/信号/失败地图。",u:["标准。","信号。","失败。","证伪。"]},b4:{h:"边界",p:"不发配方。",u:["无蓝图。","无设定。","无步骤。","安全。"]}},
      informal:{title:"聚变 · 概念",b1:{h:"清单",p:"聚变=清单。",u:["标准。","信号。","失败。","边界。"]},b2:{h:"约束",p:"控制问题。",u:["扰动。","泄漏。","稳定。","控制。"]},b3:{h:"判定",p:"看证伪。",u:["成功。","失败。","替代解释。","限制。"]},b4:{h:"不公开",p:"不发配方。",u:["不蓝图。","不设定。","不步骤。","不危险。"]}}}},
      now:{formal:{title:"聚变 · 上线",b1:{h:"现况",p:"标准面+信号面。",u:["定义。","约束。","信号。","失败。"]},b2:{h:"分离",p:"上线/路线图分离。",u:["不混说。","有界。","诚实。","稳定。"]},b3:{h:"安全",p:"不发建造细节。",u:["无步骤。","无配方。","无参数。","无危险。"]},b4:{h:"效果",p:"可测试。",u:["可测。","可证伪。","限制。","下一步。"]}},
      informal:{title:"聚变 · 上线",b1:{h:"现在",p:"清晰。",u:["清晰。","有界。","安全。","稳定。"]},b2:{h:"不混",p:"分离。",u:["分离。","分离。","分离。","稳定。"]},b3:{h:"不发",p:"不发配方。",u:["不发。","不发。","不发。","安全。"]},b4:{h:"结果",p:"可信。",u:["可测。","可证伪。","有界。","诚实。"]}}}},
      post:{formal:{title:"聚变 · 路线图",b1:{h:"收紧",p:"更清晰边界。",u:["定义。","阈值。","信号。","失败。"]},b2:{h:"分层",p:"逐步证据。",u:["步骤。","证伪。","退出。","替代解释。"]},b3:{h:"中立",p:"无噱头。",u:["中立。","有界。","稳定。","清楚。"]},b4:{h:"结果",p:"严谨吸引人。",u:["严谨。","可测。","安全。","一致。"]}},
      informal:{title:"聚变 · 路线图",b1:{h:"更多",p:"更深内容。",u:["定义。","约束。","信号。","证伪。"]},b2:{h:"步骤",p:"一步一步。",u:["步骤。","证伪。","边界。","审计。"]},b3:{h:"中立",p:"不吹。",u:["中立。","有界。","稳定。","清楚。"]},b4:{h:"结果",p:"可测试。",u:["可测。","可证伪。","有界。","安全。"]}}}}
    },
    validation:{origin:{formal:{title:"验证 · 概念",b1:{h:"原则",p:"测量+证伪。",u:["主张。","测量。","证伪。","限制。"]},b2:{h:"信号分类",p:"按含义分组。",u:["稳定。","损耗。","代理。","噪声。"]},b3:{h:"失败优先",p:"先列失败。",u:["不稳定。","损耗。","伪象。","不重复。"]},b4:{h:"边界",p:"规则公开，配方私密。",u:["规则是。","配方否。","证据包。","无泄密。"]}},
      informal:{title:"验证 · 概念",b1:{h:"规则",p:"可测可证伪。",u:["测。","试。","证伪。","重复。"]},b2:{h:"信号",p:"按含义。",u:["稳定。","损耗。","代理。","噪声。"]},b3:{h:"失败",p:"先列失败。",u:["失败。","限制。","噪声。","伪象。"]},b4:{h:"边界",p:"不发配方。",u:["不配方。","不蓝图。","不步骤。","安全。"]}}}},
      now:{formal:{title:"验证 · 上线",b1:{h:"脚手架",p:"清晰主张与清晰反证。",u:["主张。","证据。","反证。","限制。"]},b2:{h:"评估",p:"看信号是否匹配。",u:["信号。","边界。","证伪。","一致。"]},b3:{h:"不求信",p:"不给配方。",u:["不求信。","不神秘。","无配方。","无危险。"]},b4:{h:"结果",p:"一致性建立信任。",u:["稳定。","可重复。","有界。","诚实。"]}},
      informal:{title:"验证 · 上线",b1:{h:"现在",p:"规则清楚。",u:["清楚。","有界。","可测。","可证伪。"]},b2:{h:"你能判断",p:"看信号与证伪。",u:["信号。","边界。","失败。","一致。"]},b3:{h:"不发",p:"不发配方。",u:["不发。","不发。","不发。","安全。"]},b4:{h:"结果",p:"可信。",u:["稳定。","可测。","有界。","诚实。"]}}}},
      post:{formal:{title:"验证 · 路线图",b1:{h:"证据包",p:"证明模板。",u:["模板。","日志。","重复。","审计。"]},b2:{h:"压力测试",p:"信号 vs 噪声。",u:["噪声。","伪象。","交叉。","证伪。"]},b3:{h:"注册表",p:"可查询状态。",u:["状态。","原因。","历史。","规则。"]},b4:{h:"边界",p:"更严谨但不泄密。",u:["更清晰。","更安全。","有界。","诚实。"]}},
      informal:{title:"验证 · 路线图",b1:{h:"更多",p:"更完整模板。",u:["模板。","日志。","重复。","审计。"]},b2:{h:"测试",p:"压力测试。",u:["噪声。","伪象。","交叉。","证伪。"]},b3:{h:"状态",p:"可查询。",u:["状态。","原因。","历史。","规则。"]},b4:{h:"结果",p:"严谨。",u:["严谨。","有界。","可测。","安全。"]}}}}
    }
  } : CONTENT_EN;

  var CONTENT_EN = EN; // keep name for fallback, but CONTENT already set

  // ===== Control =====
  var activeKey=null;

  function setActiveDiamond(key){
    document.getElementById("dChain").classList.toggle("active", key==="chain");
    document.getElementById("dPlasma").classList.toggle("active", key==="plasma");
    document.getElementById("dFusion").classList.toggle("active", key==="fusion");
    document.getElementById("dValidation").classList.toggle("active", key==="validation");
  }

  function render(){
    persist();
    setLinks();
    setLensLabels();
    if(!activeKey) return;
    var view = CONTENT[activeKey][time][style];
    mTitle.textContent = view.title;
    fill(h1,p1,u1,view.b1);
    fill(h2,p2,u2,view.b2);
    fill(h3,p3,u3,view.b3);
    fill(h4,p4,u4,view.b4);
  }

  function open(key){
    activeKey=key;
    setActiveDiamond(key);
    render();
    bd.classList.add("show");
    modal.classList.add("show");
  }

  function close(){
    bd.classList.remove("show");
    modal.classList.remove("show");
    activeKey=null;
    setActiveDiamond("__none__");
  }

  // Click + keyboard
  function bind(id,key){
    var el=document.getElementById(id);
    el.addEventListener("click", function(){ open(key); }, {passive:true});
    el.addEventListener("touchstart", function(){ /* ensure tap is captured */ }, {passive:true});
    el.addEventListener("keydown", function(e){
      if(e.key==="Enter" || e.key===" "){ e.preventDefault(); open(key); }
    });
  }
  bind("dChain","chain");
  bind("dPlasma","plasma");
  bind("dFusion","fusion");
  bind("dValidation","validation");

  // Lenses
  styleChip.addEventListener("click", function(){ style=(style==="formal")?"informal":"formal"; render(); });
  chipConcept.addEventListener("click", function(){ time="origin"; render(); });
  chipLive.addEventListener("click", function(){ time="now"; render(); });
  chipRoadmap.addEventListener("click", function(){ time="post"; render(); });

  // Close
  bd.addEventListener("click", close);
  mClose.addEventListener("click", close);
  document.getElementById("mReturn").addEventListener("click", close);

  // Initial
  setLensLabels();
})();
</script>

</body>
</html>

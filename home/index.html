<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>HOME · Compass Face</title>

  <link rel="stylesheet" href="/assets/ui.css?v=HOME_DIAMOND_3"/>
  <link rel="stylesheet" href="/assets/branch.css?v=HOME_DIAMOND_3"/>
  <script defer src="/assets/instrument.js?v=HOME_DIAMOND_3"></script>

  <style>
    /* ===== TASK 1: CENTER EVERYTHING ===== */
    .shell{
      max-width:1100px;
      margin:0 auto;
      padding:26px 18px 56px;
      display:flex;
      flex-direction:column;
      align-items:center;
      text-align:center;
    }

    .back-left{
      position:fixed;
      left:16px;
      top:16px;
      z-index:30;
    }

    .title{
      margin:0 0 8px;
      font-size:44px;
      font-weight:900;
      letter-spacing:.25px;
      line-height:1.05;
    }
    .subtitle{
      margin:0 0 16px;
      opacity:.84;
      font-size:18px;
      line-height:1.35;
    }

    .lens-row{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      justify-content:center;
      align-items:center;
      margin:10px 0 8px;
    }

    .note{
      opacity:.72;
      font-size:12px;
      line-height:1.35;
      margin-top:8px;
    }

    /* ===== TASK 2: STRAIGHT + STRONG 3D (NO TILT) ===== */
    .diamond-face{
      width:min(560px,92vw);
      height:min(560px,92vw);
      margin:22px auto 10px;
      position:relative;
      /* STRAIGHTENED: no rotateX / no perspective tilt */
      transform:none;
    }

    .d-diamond{
      width:200px;
      height:200px;
      position:absolute;
      left:50%;
      top:50%;
      transform-origin:center;
      transform:translate(-50%,-50%) rotate(45deg);

      border-radius:26px;
      border:1px solid rgba(255,255,255,.16);
      background:rgba(0,0,0,.20);
      backdrop-filter:blur(8px);

      /* 3D: deeper shadow stack + bevels + specular */
      box-shadow:
        0 34px 90px rgba(0,0,0,.78),
        0 14px 34px rgba(0,0,0,.52),
        inset 0 2px 0 rgba(255,255,255,.18),
        inset 0 -22px 34px rgba(0,0,0,.42);

      transition:transform 240ms ease, box-shadow 240ms ease, filter 240ms ease;
      filter: drop-shadow(0 0 16px rgba(255,210,120,.08));
    }

    .d-diamond::before{
      content:"";
      position:absolute;
      inset:10px;
      border-radius:20px;
      border:1px solid rgba(255,255,255,.10);
      pointer-events:none;
    }

    .d-diamond::after{
      content:"";
      position:absolute;
      left:10%;
      right:10%;
      top:10%;
      height:28%;
      border-radius:999px;
      background:linear-gradient(to bottom, rgba(255,255,255,.14), rgba(255,255,255,0));
      opacity:.9;
      pointer-events:none;
      transform:rotate(-10deg);
    }

    .d-diamond:hover{
      transform:translate(-50%,-50%) rotate(45deg) scale(1.02);
      box-shadow:
        0 42px 110px rgba(0,0,0,.86),
        0 18px 42px rgba(0,0,0,.58),
        inset 0 2px 0 rgba(255,255,255,.22),
        inset 0 -26px 40px rgba(0,0,0,.48);
      filter: drop-shadow(0 0 20px rgba(255,210,120,.14));
    }

    .d-inner{
      width:100%;
      height:100%;
      transform:rotate(-45deg);
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      padding:20px;
      gap:10px;
    }

    .d-title{
      font-weight:950;
      letter-spacing:.35px;
      font-size:18px;
    }

    .d-text{
      opacity:.90;
      font-size:14px;
      line-height:1.35;
      max-width:16em;
    }

    .d-n{ transform:translate(-50%,-50%) translate(0,-165px) rotate(45deg); }
    .d-e{ transform:translate(-50%,-50%) translate(165px,0) rotate(45deg); }
    .d-s{ transform:translate(-50%,-50%) translate(0,165px) rotate(45deg); }
    .d-w{ transform:translate(-50%,-50%) translate(-165px,0) rotate(45deg); }

    .d-core{
      position:absolute;
      left:50%;
      top:50%;
      transform:translate(-50%,-50%);
      width:86px;
      height:86px;
      border-radius:22px;
      display:grid;
      place-items:center;

      border:1px solid rgba(255,210,120,.36);
      background:linear-gradient(135deg, rgba(255,210,120,.26), rgba(255,150,60,.12));
      box-shadow:
        0 0 44px rgba(255,210,120,.34),
        0 22px 55px rgba(0,0,0,.62),
        inset 0 2px 0 rgba(255,255,255,.22);

      font-weight:950;
      letter-spacing:.4px;
      pointer-events:none;
    }

    @media (max-width:520px){
      .d-diamond{ width:180px; height:180px; }
      .d-n{ transform:translate(-50%,-50%) translate(0,-145px) rotate(45deg); }
      .d-e{ transform:translate(-50%,-50%) translate(145px,0) rotate(45deg); }
      .d-s{ transform:translate(-50%,-50%) translate(0,145px) rotate(45deg); }
      .d-w{ transform:translate(-50%,-50%) translate(-145px,0) rotate(45deg); }
      .d-core{ width:74px; height:74px; }
    }

    /* ===== TASK 3: FIX TRAJECTORY + CORRECT LENS BEHAVIOR ===== */
    .chip[aria-disabled="true"]{
      opacity:.35 !important;
      pointer-events:none !important;
      filter:grayscale(1);
    }
    .chip[aria-pressed="true"]{
      background:linear-gradient(135deg, rgba(255,210,120,.22), rgba(255,150,60,.10));
      border-color:rgba(255,210,120,.40);
      box-shadow:0 0 22px rgba(255,200,120,.12);
    }
    .chip{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:10px 14px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.18);
      background:rgba(0,0,0,.18);
      color:#fff;
      font-weight:850;
      letter-spacing:.25px;
      cursor:pointer;
      -webkit-tap-highlight-color:transparent;
      text-decoration:none;
    }
    .chip:active{ transform:scale(.98); }

    .footer{
      margin-top:10px;
      opacity:.78;
      font-size:13px;
    }
  </style>
</head>

<body>
  <main class="shell" style="position:relative">

    <div class="back-left">
      <a class="chip" href="/">◀ Language</a>
    </div>

    <div style="opacity:.78;font-size:12px;letter-spacing:2.4px;text-transform:uppercase;margin-bottom:8px">GEODIAMETRICS</div>
    <h1 class="title">HOME</h1>
    <p class="subtitle">Compass Face · Vector Understanding</p>

    <!-- Style toggle (single button) -->
    <div class="lens-row" aria-label="Style lens">
      <button id="styleToggle" class="chip" type="button">STYLE: FORMAL</button>
    </div>

    <!-- Time buttons (Trajectory = formal-only) -->
    <div class="lens-row" aria-label="Time lens">
      <button class="chip timeBtn" type="button" data-time="origin">ORIGIN</button>
      <button class="chip timeBtn" type="button" data-time="now">NOW</button>
      <button class="chip timeBtn" type="button" data-time="trajectory" id="timeTrajectory">TRAJECTORY</button>
    </div>

    <div id="sliceNote" class="note"></div>

    <section aria-label="Diamond compass face">
      <div class="diamond-face">

        <div class="d-diamond d-n" role="button" tabindex="0" aria-label="North">
          <div class="d-inner">
            <div class="d-title">NORTH</div>
            <div class="d-text" id="northText"></div>
          </div>
        </div>

        <div class="d-diamond d-e" role="button" tabindex="0" aria-label="East">
          <div class="d-inner">
            <div class="d-title">EAST</div>
            <div class="d-text" id="eastText"></div>
          </div>
        </div>

        <div class="d-diamond d-s" role="button" tabindex="0" aria-label="South">
          <div class="d-inner">
            <div class="d-title">SOUTH</div>
            <div class="d-text" id="southText"></div>
          </div>
        </div>

        <div class="d-diamond d-w" role="button" tabindex="0" aria-label="West">
          <div class="d-inner">
            <div class="d-title">WEST</div>
            <div class="d-text" id="westText"></div>
          </div>
        </div>

        <div class="d-core">◆</div>

      </div>
    </section>

    <div class="footer">BUILD: <strong>HOME_DIAMOND_3</strong></div>

  </main>

<script>
(function(){
  "use strict";

  // Canonical keys only
  var K_STYLE = "gd_style";
  var K_TIME  = "gd_time";

  function lsGet(k){ try{return localStorage.getItem(k);}catch(e){ return null; } }
  function lsSet(k,v){ try{localStorage.setItem(k,v);}catch(e){} }

  // State
  var state = {
    style: lsGet(K_STYLE) || "formal",
    time:  lsGet(K_TIME)  || "origin"
  };

  // Trajectory is FORMAL-only
  var allowTimeByStyle = {
    formal:   { origin:1, now:1, trajectory:1 },
    informal: { origin:1, now:1 }
  };

  // Content map (placeholder; correct coupling)
  var content = {
    north:{
      formal:{origin:"North defines invariant structure.",now:"North stabilizes current position.",trajectory:"North preserves long-term coherence."},
      informal:{origin:"North is your anchor.",now:"North keeps you from drifting."}
    },
    east:{
      formal:{origin:"East maps execution pathways.",now:"East expresses operational flow.",trajectory:"East scales systems forward."},
      informal:{origin:"East is how you move.",now:"East is doing."}
    },
    south:{
      formal:{origin:"South defines convergence pressure.",now:"South applies constraint.",trajectory:"South compounds momentum."},
      informal:{origin:"South is where force happens.",now:"South pushes."}
    },
    west:{
      formal:{origin:"West governs containment.",now:"West enforces boundaries.",trajectory:"West protects integrity."},
      informal:{origin:"West keeps things tight.",now:"West guards the edge."}
    }
  };

  function normalizeTime(){
    // If informal and trajectory was selected, force NOW
    if(!allowTimeByStyle[state.style][state.time]){
      state.time = "now";
    }
  }

  function setPressedStyle(){
    var btn = document.getElementById("styleToggle");
    btn.textContent = "STYLE: " + state.style.toUpperCase();
  }

  function setPressedTime(){
    document.querySelectorAll(".timeBtn").forEach(function(btn){
      var v = btn.getAttribute("data-time");
      var allowed = !!allowTimeByStyle[state.style][v];

      btn.setAttribute("aria-disabled", allowed ? "false" : "true");
      btn.setAttribute("aria-pressed", (v === state.time) ? "true" : "false");
    });
  }

  function render(){
    normalizeTime();

    // Persist
    lsSet(K_STYLE, state.style);
    lsSet(K_TIME, state.time);

    // Render text
    document.getElementById("northText").textContent = content.north[state.style][state.time] || "";
    document.getElementById("eastText").textContent  = content.east[state.style][state.time]  || "";
    document.getElementById("southText").textContent = content.south[state.style][state.time] || "";
    document.getElementById("westText").textContent  = content.west[state.style][state.time]  || "";

    // Render lenses
    setPressedStyle();
    setPressedTime();

    // Note
    document.getElementById("sliceNote").textContent =
      "Active: " + state.style.toUpperCase() + " · " + state.time.toUpperCase() + " (Trajectory = Formal only)";
  }

  // STYLE toggle (single button)
  document.getElementById("styleToggle").addEventListener("click", function(){
    state.style = (state.style === "formal") ? "informal" : "formal";
    render(); // must rerender everything
  });

  // TIME buttons
  document.querySelectorAll(".timeBtn").forEach(function(btn){
    btn.addEventListener("click", function(){
      var v = btn.getAttribute("data-time");
      // enforce rule
      if(!allowTimeByStyle[state.style][v]) return;
      state.time = v;
      render();
    });
  });

  render();
})();
</script>

</body>
</html>

<!-- TNT: /home/index.html
     FIXES:
     1) Removes ‚Äúwashed/pink overlay‚Äù look by FULLY isolating Home from ui.css/branch.css bleed.
     2) Forces link/button styling (no purple underlines, no default link colors).
     3) Replaces ‚Äúdrop-down scroll-jump‚Äù with an OPAQUE POP-OVER MODAL (opens in place, no page jump).
     4) Removes per-card ‚ÄúOrigin/Now/Trajectory‚Äù chips from inside details; the 3-lens lives ONLY at top and filters everything.
     5) SINGLE jump inside detail = JUMP HOME (per your rule).
-->
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Home ¬∑ Coherent Resolution Platform</title>

<style>
/* =====================================================
   HARD RESET (prevents ui.css/branch.css bleed)
===================================================== */
:root{
  --ink:#070a0f;
  --lacquer:#8d0b0b;
  --deep:#3f0000;
  --gold:#d4af37;
  --goldA:rgba(212,175,55,.45);
  --silver:#cfd3da;

  --text:rgba(255,255,255,.92);
  --muted:rgba(255,255,255,.72);
  --line:rgba(255,255,255,.12);
  --soft:rgba(255,255,255,.06);
  --glass:rgba(0,0,0,.22);
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0 !important;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif !important;
  color:var(--text) !important;
  overflow-x:hidden !important;
  background:
    radial-gradient(1200px 720px at 50% 0%, rgba(141,11,11,.62) 0%, rgba(63,0,0,.52) 45%, rgba(7,10,15,1) 100%) !important;
}

/* kill default link styling everywhere */
a, a:visited, a:hover, a:active{
  color:inherit !important;
  text-decoration:none !important;
}

/* buttons */
button{
  border:0;
  background:none;
  color:inherit;
  font:inherit;
}

h1,p{margin:0}
img{max-width:100%}

/* =====================================================
   PAGE LAYOUT
===================================================== */
.page{
  width:min(980px,94vw);
  margin:0 auto;
  padding:28px 14px 92px;
}

.hero{position:relative; z-index:2}
.hero h1{
  font-size:44px;
  font-weight:900;
  letter-spacing:.14em;
  text-transform:uppercase;
}
.hero p{
  margin-top:10px;
  font-size:16px;
  opacity:.78;
  line-height:1.45;
}

/* =====================================================
   TOP CONTROL PILLS
===================================================== */
.topbar{
  margin-top:16px;
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  align-items:center;
}
.pill{
  border-radius:999px;
  padding:10px 14px;
  background:rgba(255,255,255,.06);
  border:1px solid var(--line);
  box-shadow:inset 0 0 0 1px rgba(0,0,0,.14);
  font-weight:900;
  letter-spacing:.12em;
  text-transform:uppercase;
  font-size:12px;
  user-select:none;
  -webkit-tap-highlight-color:transparent;
}
.pill.btn{cursor:pointer}
.pill.btn:hover{background:rgba(255,255,255,.08)}
.pill.active{
  border-color:rgba(212,175,55,.50);
  box-shadow:0 0 18px rgba(212,175,55,.18) inset;
}
.pill.gold{
  border-color:rgba(212,175,55,.55);
  box-shadow:0 0 18px rgba(212,175,55,.20) inset;
}

/* =====================================================
   SECTION TITLE
===================================================== */
.section-title{
  margin-top:18px;
  font-size:12px;
  letter-spacing:.22em;
  text-transform:uppercase;
  opacity:.70;
}

/* =====================================================
   QUADRANT CARDS
===================================================== */
.quad{
  margin-top:12px;
  border-radius:22px;
  background:linear-gradient(180deg, rgba(0,0,0,.34), rgba(0,0,0,.18));
  border:1px solid var(--line);
  box-shadow:0 26px 80px rgba(0,0,0,.60);
  backdrop-filter:blur(12px);
  overflow:hidden;
}

.qhead{
  padding:16px 16px 12px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
}
.qleft{display:flex;align-items:center;gap:12px;min-width:0}

.qbadge{
  width:62px;height:42px;border-radius:16px;
  background:rgba(0,0,0,.22);
  border:1px solid rgba(255,255,255,.12);
  display:flex;align-items:center;justify-content:center;
  font-weight:900;
  letter-spacing:.10em;
  flex:0 0 auto;
}
.qbadge.gold{border-color:rgba(212,175,55,.55); box-shadow:0 0 14px rgba(212,175,55,.18) inset}
.qbadge.sun{border-color:rgba(212,175,55,.28); box-shadow:0 0 12px rgba(212,175,55,.14) inset}
.qbadge.lantern{border-color:rgba(207,211,218,.22); box-shadow:0 0 12px rgba(207,211,218,.12) inset}
.qbadge.set{border-color:rgba(207,211,218,.18); box-shadow:0 0 12px rgba(207,211,218,.10) inset}

.qtxt{min-width:0}
.qtxt b{
  display:block;
  font-size:18px;
  letter-spacing:.12em;
  text-transform:uppercase;
}
.qtxt span{
  display:block;
  margin-top:2px;
  opacity:.72;
  white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
}

.qhint{
  font-size:12px;
  opacity:.68;
  letter-spacing:.16em;
  text-transform:uppercase;
  padding:10px 16px 0;
}

.qbody{padding:12px 16px 16px}

.grid2{
  display:grid;
  grid-template-columns:1fr;
  gap:10px;
}
@media(min-width:760px){.grid2{grid-template-columns:1fr 1fr}}

.bubble{
  border-radius:18px;
  background:rgba(255,255,255,.05);
  border:1px solid rgba(255,255,255,.10);
  padding:12px 12px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  cursor:pointer;
  user-select:none;
  -webkit-tap-highlight-color:transparent;
}
.bubble:hover{background:rgba(255,255,255,.07)}
.bubble .t{min-width:0}
.bubble .t b{
  display:block;
  font-size:13px;
  letter-spacing:.14em;
  text-transform:uppercase;
}
.bubble .t i{
  display:block;
  font-style:normal;
  opacity:.72;
  font-size:12px;
  margin-top:2px;
  white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
}
.bubble .go{
  width:40px;height:40px;border-radius:999px;
  background:rgba(0,0,0,.18);
  border:1px solid rgba(255,255,255,.10);
  display:flex;align-items:center;justify-content:center;
  opacity:.9;
  flex:0 0 auto;
}

/* =====================================================
   FOOTER (no overlay issues)
===================================================== */
.brand{
  margin-top:22px;
  opacity:.26;
  letter-spacing:.35em;
  text-transform:uppercase;
  font-size:12px;
  text-align:center;
}
.footer{
  margin-top:8px;
  opacity:.32;
  font-size:12px;
  letter-spacing:.2em;
  text-align:center;
}

/* =====================================================
   MODAL (POP-OVER, NO SCROLL-JUMP)
===================================================== */
.backdrop{
  position:fixed;
  inset:0;
  z-index:999;
  display:none;
  align-items:center;
  justify-content:center;
  padding:14px;
  background:rgba(0,0,0,.62);
  backdrop-filter:blur(12px);
}
.backdrop.open{display:flex}

.modal{
  width:min(900px,96vw);
  max-height:min(84vh,900px);
  overflow:auto;
  border-radius:22px;
  border:1px solid rgba(255,255,255,.14);
  background:linear-gradient(180deg, rgba(30,0,0,.86), rgba(0,0,0,.62));
  box-shadow:0 34px 140px rgba(0,0,0,.75);
  position:relative;
}
.modal::before{
  content:"";
  position:absolute; inset:0;
  border-radius:22px;
  pointer-events:none;
  box-shadow:0 0 0 1px rgba(212,175,55,.10) inset;
}
.mtop{
  padding:14px;
  display:flex;
  align-items:flex-start;
  justify-content:space-between;
  gap:12px;
}
.mmeta{
  opacity:.70;
  letter-spacing:.18em;
  text-transform:uppercase;
  font-size:12px;
}
.mclose{
  width:44px;height:44px;border-radius:999px;
  background:rgba(255,255,255,.06);
  border:1px solid rgba(255,255,255,.14);
  display:flex;align-items:center;justify-content:center;
  cursor:pointer;
  user-select:none;
}
.mclose:hover{background:rgba(255,255,255,.10)}

.mtitle{
  padding:0 14px;
  font-weight:900;
  letter-spacing:.08em;
  font-size:20px;
}
.mdesc{
  padding:10px 14px 0;
  color:rgba(255,255,255,.80);
  line-height:1.6;
}

/* top lens chips inside modal reflect the GLOBAL lens (but are not per-card) */
.mchips{
  padding:12px 14px 0;
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}
.chip{
  border-radius:999px;
  padding:8px 12px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(255,255,255,.06);
  letter-spacing:.14em;
  text-transform:uppercase;
  font-size:11px;
  user-select:none;
}
.chip.on{
  border-color:rgba(212,175,55,.48);
  box-shadow:0 0 16px rgba(212,175,55,.16) inset;
}

/* nested bubbles */
.mgrid{
  padding:12px 14px 0;
  display:grid;
  grid-template-columns:1fr;
  gap:10px;
}
@media(min-width:760px){.mgrid{grid-template-columns:1fr 1fr}}

.subbubble{
  border-radius:18px;
  background:rgba(0,0,0,.24);
  border:1px solid rgba(255,255,255,.10);
  padding:12px 12px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  cursor:pointer;
}
.subbubble:hover{background:rgba(0,0,0,.30)}
.subbubble .t{min-width:0}
.subbubble .t b{
  display:block;
  font-size:12px;
  letter-spacing:.14em;
  text-transform:uppercase;
}
.subbubble .t i{
  display:block;
  margin-top:3px;
  opacity:.72;
  font-style:normal;
  font-size:12px;
  white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
}
.subbubble .go{
  width:40px;height:40px;border-radius:999px;
  background:rgba(255,255,255,.06);
  border:1px solid rgba(255,255,255,.10);
  display:flex;align-items:center;justify-content:center;
  flex:0 0 auto;
}

/* deep block panel (Learn shows more; Explore stays lighter) */
.subpanel{
  margin:12px 14px 14px;
  border-radius:18px;
  background:rgba(255,255,255,.04);
  border:1px solid rgba(255,255,255,.12);
  padding:14px 14px;
  display:none;
}
.subpanel.open{display:block}
.subpanel h3{
  margin:0;
  font-size:13px;
  letter-spacing:.16em;
  text-transform:uppercase;
}
.subpanel .blurb{
  margin-top:10px;
  opacity:.82;
  line-height:1.6;
}
.subpanel ul{
  margin:10px 0 0 18px;
  padding:0;
  opacity:.78;
  line-height:1.6;
}
.subpanel .mini{
  margin-top:12px;
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}
.minichip{
  border-radius:999px;
  padding:8px 12px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(255,255,255,.06);
  font-size:11px;
  letter-spacing:.14em;
  text-transform:uppercase;
  opacity:.9;
}

/* single jump rule */
.mfoot{
  padding:12px 14px 16px;
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}
.jump{
  border-radius:18px;
  padding:12px 14px;
  border:1px solid rgba(255,255,255,.14);
  background:rgba(255,255,255,.06);
  font-weight:900;
  letter-spacing:.12em;
  text-transform:uppercase;
  font-size:12px;
}
.jump:hover{background:rgba(255,255,255,.08)}
.jump.gold{
  border-color:rgba(212,175,55,.50);
  box-shadow:0 0 16px rgba(212,175,55,.16) inset;
}
</style>
</head>

<body>
<div class="page">

  <div class="hero">
    <h1>HOME</h1>
    <p>Tap any bubble. Details pop over (no scroll jump). Origin / Now / Trajectory filters everything.</p>

    <div class="topbar">
      <span class="pill" id="langPill">LANG: EN</span>
      <span class="pill gold" id="depthPill">DEPTH: EXPLORE</span>

      <span class="pill btn" id="lensOrigin">ORIGIN</span>
      <span class="pill btn active" id="lensNow">NOW</span>
      <span class="pill btn" id="lensTrajectory">TRAJECTORY</span>

      <a class="pill btn" href="/door/">CHANGE DEPTH</a>
      <a class="pill btn" href="/">CHANGE LANGUAGE</a>
      <a class="pill btn gold" href="/door/">JUMP HOME</a>
    </div>

    <div class="section-title">Quadrant routes (NW / NE / SW / SE)</div>
  </div>

  <!-- NW -->
  <div class="quad">
    <div class="qhead">
      <div class="qleft">
        <div class="qbadge gold">‚≠ê NW</div>
        <div class="qtxt">
          <b>Northwest</b>
          <span>Definition ¬∑ language ¬∑ structure</span>
        </div>
      </div>
    </div>
    <div class="qhint">Tap a bubble ‚Üí pop-over details ‚Üí nested bubbles ‚Üí deep block</div>
    <div class="qbody">
      <div class="grid2">
        <div class="bubble" data-block="ssg">
          <div class="t"><b>SSG</b><i>Resources ¬∑ Stores ¬∑ Constraints ¬∑ Goals ¬∑ Guards</i></div>
          <div class="go">‚ñ∂</div>
        </div>
        <div class="bubble" data-block="grammar">
          <div class="t"><b>Diamond Grammar</b><i>Hub-first traversal ¬∑ receipt gating</i></div>
          <div class="go">‚ñ∂</div>
        </div>
        <div class="bubble" data-block="dotgrid">
          <div class="t"><b>DOT.GRID</b><i>256-state indexing ¬∑ replay + audit</i></div>
          <div class="go">‚ñ∂</div>
        </div>
        <div class="bubble" data-block="acronyms">
          <div class="t"><b>Acronyms</b><i>Pillars ¬∑ usage map ¬∑ examples</i></div>
          <div class="go">‚ñ∂</div>
        </div>
      </div>
    </div>
  </div>

  <!-- NE -->
  <div class="quad">
    <div class="qhead">
      <div class="qleft">
        <div class="qbadge sun">üåû NE</div>
        <div class="qtxt">
          <b>Northeast</b>
          <span>Execution ¬∑ surfaces ¬∑ examples</span>
        </div>
      </div>
    </div>
    <div class="qhint">Surfaces: apps, portals, workflows, outputs</div>
    <div class="qbody">
      <div class="grid2">
        <div class="bubble" data-block="surfaces">
          <div class="t"><b>Execution Surfaces</b><i>Apps ¬∑ portals ¬∑ interfaces</i></div>
          <div class="go">‚ñ∂</div>
        </div>
        <div class="bubble" data-block="receipts">
          <div class="t"><b>Workflows & Receipts</b><i>Audit trails ¬∑ replay safety</i></div>
          <div class="go">‚ñ∂</div>
        </div>
        <div class="bubble" data-block="examples">
          <div class="t"><b>Examples</b><i>How to use the system</i></div>
          <div class="go">‚ñ∂</div>
        </div>
        <div class="bubble" data-block="packs">
          <div class="t"><b>Packs & Outputs</b><i>Downloadables ¬∑ packaged artifacts</i></div>
          <div class="go">‚ñ∂</div>
        </div>
      </div>
    </div>
  </div>

  <!-- SW -->
  <div class="quad">
    <div class="qhead">
      <div class="qleft">
        <div class="qbadge lantern">üèÆ SW</div>
        <div class="qtxt">
          <b>Southwest</b>
          <span>Measurement ¬∑ diagnostics ¬∑ rules</span>
        </div>
      </div>
    </div>
    <div class="qhint">Gauges + diagnostics + rules + protocols</div>
    <div class="qbody">
      <div class="grid2">
        <div class="bubble" data-block="gauges">
          <div class="t"><b>Gauges</b><i>Instrument panels ¬∑ thresholds</i></div>
          <div class="go">‚ñ∂</div>
        </div>
        <div class="bubble" data-block="diagnostics">
          <div class="t"><b>Diagnostics</b><i>Classification under constraint</i></div>
          <div class="go">‚ñ∂</div>
        </div>
        <div class="bubble" data-block="rules">
          <div class="t"><b>Rules</b><i>Navigation + integrity</i></div>
          <div class="go">‚ñ∂</div>
        </div>
        <div class="bubble" data-block="protocols">
          <div class="t"><b>Protocols</b><i>Return / replay / audit</i></div>
          <div class="go">‚ñ∂</div>
        </div>
      </div>
    </div>
  </div>

  <!-- SE -->
  <div class="quad">
    <div class="qhead">
      <div class="qleft">
        <div class="qbadge set">üåá SE</div>
        <div class="qtxt">
          <b>Southeast</b>
          <span>Identity ¬∑ references ¬∑ links</span>
        </div>
      </div>
    </div>
    <div class="qhint">Anchors: ORCID, OSF, references, contact</div>
    <div class="qbody">
      <div class="grid2">
        <div class="bubble" data-block="orcid">
          <div class="t"><b>ORCID</b><i>Research identity anchor</i></div>
          <div class="go">‚ñ∂</div>
        </div>
        <div class="bubble" data-block="osf">
          <div class="t"><b>OSF</b><i>Project registry / preprints</i></div>
          <div class="go">‚ñ∂</div>
        </div>
        <div class="bubble" data-block="refs">
          <div class="t"><b>References</b><i>Core citations / anchors</i></div>
          <div class="go">‚ñ∂</div>
        </div>
        <div class="bubble" data-block="contact">
          <div class="t"><b>Contact</b><i>Direct channel</i></div>
          <div class="go">‚ñ∂</div>
        </div>
      </div>
    </div>
  </div>

  <div class="brand">GEODIAMETRICS</div>
  <div class="footer">CANONICAL ¬∑ STABLE ¬∑ ¬© GEODIAMETRICS</div>
</div>

<!-- MODAL -->
<div class="backdrop" id="backdrop" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="mtitle">
    <div class="mtop">
      <div class="mmeta" id="mmeta">DETAIL</div>
      <div class="mclose" id="mclose" aria-label="Close">‚úï</div>
    </div>

    <div class="mtitle" id="mtitle">‚Äî</div>
    <div class="mdesc" id="mdesc">‚Äî</div>

    <div class="mchips">
      <span class="chip" data-chip="origin">Origin</span>
      <span class="chip on" data-chip="now">Now</span>
      <span class="chip" data-chip="trajectory">Trajectory</span>
    </div>

    <div class="mgrid" id="mgrid"></div>

    <div class="subpanel" id="subpanel">
      <h3 id="subTitle">‚Äî</h3>
      <div class="blurb" id="subBlurb">‚Äî</div>
      <ul id="subBullets"></ul>
      <div class="mini" id="subMini"></div>
    </div>

    <div class="mfoot">
      <a class="jump gold" href="/door/">JUMP HOME</a>
    </div>
  </div>
</div>

<script>
(() => {
  /* ========= GLOBAL STATE (from index/door) ========= */
  const lang = (localStorage.getItem('crp_lang') || 'en').toLowerCase();     // en | zh
  const depth = (localStorage.getItem('crp_depth') || 'explore').toLowerCase(); // explore | learn
  let lens = (localStorage.getItem('crp_lens') || 'now').toLowerCase();      // origin | now | trajectory

  /* ========= TOP UI ========= */
  const langPill = document.getElementById('langPill');
  const depthPill = document.getElementById('depthPill');

  langPill.textContent = 'LANG: ' + (lang === 'zh' ? '‰∏≠Êñá' : 'EN');
  depthPill.textContent = 'DEPTH: ' + (depth === 'learn' ? 'LEARN' : 'EXPLORE');

  const lensBtn = {
    origin: document.getElementById('lensOrigin'),
    now: document.getElementById('lensNow'),
    trajectory: document.getElementById('lensTrajectory')
  };

  function setLens(next){
    lens = next;
    localStorage.setItem('crp_lens', lens);
    Object.keys(lensBtn).forEach(k => lensBtn[k].classList.toggle('active', k === lens));
    updateModalChips();
    if(state.openKey) renderModal(state.openKey);
  }

  lensBtn.origin.addEventListener('click',()=>setLens('origin'));
  lensBtn.now.addEventListener('click',()=>setLens('now'));
  lensBtn.trajectory.addEventListener('click',()=>setLens('trajectory'));

  if(!lensBtn[lens]) lens = 'now';
  Object.keys(lensBtn).forEach(k => lensBtn[k].classList.toggle('active', k === lens));

  /* ========= CONTENT (MORE DEPTH) =========
     Explore = shorter summaries
     Learn   = deeper narrative + more sub-bubbles + deeper panels
  */
  const blocks = {
    ssg:{
      meta:'NW ¬∑ SSG',
      title:'SSG ‚Äî Simplified Syntax Geometry',
      ex:{
        origin:'Born from the need to express execution as constraints first.',
        now:'Use R/S/C/G/Guards + receipts to keep execution replay-safe.',
        trajectory:'Scales into portable execution contracts across domains.'
      },
      ln:{
        origin:'Origin: SSG was designed to eliminate ambiguity by expressing structure before implementation‚Äîconstraints first, execution second.',
        now:'Now: SSG is the compact execution spec. Resources/Stores/Constraints/Goals/Guards define admissible behavior; receipts verify progression.',
        trajectory:'Trajectory: SSG becomes a portable contract layer‚Äîreplayable, auditable, and interoperable across products, teams, and institutions.'
      },
      subs:[
        {t:'Primitives', s:'R / S / C / G / Guards', blurb:'Minimum set for executable structure.', bullets:[
          'Resource: what is acted on (entity/target).',
          'Store: where state lives (memory/ledger).',
          'Constraint: invariants (must-hold).',
          'Goal: success condition (finish state).',
          'Guard: admissibility check (allowed/blocked).'
        ], mini:['MINIMUM','EXECUTABLE','OBSERVER-SAFE']},
        {t:'Receipts', s:'Gated flow', blurb:'Receipts make progress verifiable and replay-safe.', bullets:[
          'Advance only after receipt.',
          'Back-nav invalidates downstream receipts.',
          'Replay confirms identical outputs from identical evidence.'
        ], mini:['VERIFY','REPLAY','AUDIT']},
        {t:'Invariants', s:'Navigation-first', blurb:'Anti-drift rules that keep UI + engine coherent.', bullets:[
          'No timers as gates.',
          'Unified press primitives.',
          'Atomic handoff with receipt.'
        ], mini:['NO TIMERS','ATOMIC','CONSISTENT']},
        {t:'Bilingual layer', s:'EN / ‰∏≠Êñá', blurb:'Chinese reader gets 90% ‰∏≠Êñá + 10% core EN words (foundational).', bullets:[
          'Use basic EN anchors (up/down/left/right, 1‚Äì10, core verbs).',
          'Keep formal definitions mirrored to prevent ambiguity.'
        ], mini:['‰∏≠Êñá+EN','FOUNDATIONAL','MIRRORED']}
      ]
    },

    grammar:{
      meta:'NW ¬∑ Grammar',
      title:'Diamond Grammar',
      ex:{
        origin:'One choice at a time‚Äîso meaning can‚Äôt drift.',
        now:'Hub-first traversal + receipt gating.',
        trajectory:'Multi-portal routing without confusion.'
      },
      ln:{
        origin:'Origin: the grammar compresses decision paths into stable routes, forcing clarity.',
        now:'Now: hub-first traversal; one choice at a time; receipts verify progress.',
        trajectory:'Trajectory: scales to many portals without adding friction because the structure stays invariant.'
      },
      subs:[
        {t:'One choice', s:'Anti-drift', blurb:'Prevent ‚Äúhalf-commits.‚Äù', bullets:[
          'Pick one route.',
          'Finish or return.',
          'Don‚Äôt multi-tab inside a branch.'
        ], mini:['CHOICE','FINISH','RETURN']},
        {t:'Return protocol', s:'Hub-first', blurb:'When uncertain, return to the hub.', bullets:[
          'Hub is stable surface.',
          'Branches are exploration.',
          'Return prevents getting lost under depth.'
        ], mini:['HUB','ORIENT','STABLE']},
        {t:'Receipt gating', s:'Proof layer', blurb:'Progress requires verifiable completion.', bullets:[
          'Receipt to advance.',
          'Back invalidates downstream.',
          'Replay confirms integrity.'
        ], mini:['PROOF','INVALIDATE','REPLAY']},
        {t:'Why it works', s:'Coherence', blurb:'Structure forces clarity, clarity improves execution.', bullets:[
          'Misalignment shows early.',
          'Verification beats narrative.',
          'Replay beats impression.'
        ], mini:['ALIGN','VERIFY','REPLAY']}
      ]
    },

    dotgrid:{
      meta:'NW ¬∑ DOT.GRID',
      title:'DOT.GRID',
      ex:{
        origin:'Index decisions under constraint.',
        now:'256-state lattice for replay + audit.',
        trajectory:'Universal coordinate layer for stability.'
      },
      ln:{
        origin:'Origin: DOT.GRID classifies evidence streams consistently under constraint‚Äîso observers converge.',
        now:'Now: a 256-state indexing lattice supporting replay, audit, and observer-consistent classification.',
        trajectory:'Trajectory: a universal coordinate layer for cross-domain stability measurement and calibration.'
      },
      subs:[
        {t:'256 states', s:'Lattice', blurb:'Discrete coordinate space for classification.', bullets:[
          'Compact indexing.',
          'Observer-consistent labeling.',
          'Pairs with replay/audit.'
        ], mini:['256','LATTICE','LABEL']},
        {t:'Replay', s:'Reproduce', blurb:'Same evidence ‚Üí same classification.', bullets:[
          'Replay streams.',
          'Verify identical outputs.',
          'Detect drift when outputs diverge.'
        ], mini:['REPLAY','VERIFY','DRIFT']},
        {t:'Audit', s:'Trace', blurb:'Auditability is structural.', bullets:[
          'Trace evidence ‚Üí output.',
          'Expose threshold rules.',
          'Keep history of changes.'
        ], mini:['TRACE','THRESHOLD','HISTORY']},
        {t:'Where it lands', s:'Calibration', blurb:'Calibration platform behavior emerges from replay + invariants.', bullets:[
          'Reveal misalignment.',
          'Provide reference.',
          'Enable correction and resolution.'
        ], mini:['ALIGN','REFERENCE','RESOLVE']}
      ]
    },

    acronyms:{
      meta:'NW ¬∑ Acronyms',
      title:'Acronyms & Glossary',
      ex:{
        origin:'Prevent meaning collapse as the system scales.',
        now:'Pillars + usage map.',
        trajectory:'Shared vocabulary layer for teams.'
      },
      ln:{
        origin:'Origin: acronyms drift without stable definitions; this section locks meaning.',
        now:'Now: acronyms grouped by pillar (language/execution/measurement/identity) with examples.',
        trajectory:'Trajectory: shared vocabulary for certifications, teams, and institutions.'
      },
      subs:[
        {t:'Pillars', s:'Group', blurb:'Find terms fast by pillar.', bullets:[
          'Language (SSG, Grammar, DOT.GRID).',
          'Execution (surfaces, receipts, outputs).',
          'Measurement (gauges, diagnostics, rules).',
          'Identity (ORCID, OSF, references).'
        ], mini:['LANG','EXEC','MEASURE','ID']},
        {t:'Usage', s:'Examples', blurb:'Each acronym has ‚Äúwhat it is‚Äù + ‚Äúwhere it lives.‚Äù', bullets:[
          'One-line definition.',
          'Where in geometry it belongs.',
          'Simple usage example.'
        ], mini:['DEFINE','PLACE','EXAMPLE']},
        {t:'Learn mode', s:'Deeper lists', blurb:'Learn mode expands nested lists per pillar.', bullets:[
          'Explore = summary.',
          'Learn = nested + examples.'
        ], mini:['EXPLORE','LEARN']},
        {t:'Lock meaning', s:'Anti-drift', blurb:'Names are stable interface contracts.', bullets:[
          'Avoid renaming without receipts.',
          'Maintain canonical mapping.',
          'Document changes explicitly.'
        ], mini:['CANON','MAP','CHANGELOG']}
      ]
    },

    /* NE */
    surfaces:{
      meta:'NE ¬∑ Surfaces',
      title:'Execution Surfaces',
      ex:{origin:'Expose the engine without exposing complexity.', now:'Apps / portals / interfaces.', trajectory:'Standard surfaces across products.'},
      ln:{origin:'Origin: surfaces make the engine usable without forcing internals first.',
          now:'Now: apps, portals, and interfaces route into receipt-gated workflows.',
          trajectory:'Trajectory: standard surfaces shared by teams without losing coherence.'},
      subs:[
        {t:'Apps & portals', s:'Entry points', blurb:'Surfaces are handles on the engine.', bullets:['Fast entry points.','Stable navigation.','Receipts behind the scenes.'], mini:['HANDLE','STABLE','RECEIPT']},
        {t:'UX rule', s:'No jump-scroll', blurb:'Tap must produce local feedback immediately.', bullets:['Opaque pop-over.','No response far down page.','Same gesture everywhere.'], mini:['LOCAL','IMMEDIATE','CONSISTENT']},
        {t:'Atomic handoffs', s:'Receipt', blurb:'Move between states without partial transitions.', bullets:['Atomic step.','Receipt emitted.','Back invalidates downstream.'], mini:['ATOMIC','RECEIPT','INVALIDATE']},
        {t:'Explore vs Learn', s:'Depth only', blurb:'Depth changes, structure stays.', bullets:['Explore = surface map.','Learn = nested bubbles + blocks.','Same geometry both.'], mini:['DEPTH','STRUCTURE']}
      ]
    },

    receipts:{
      meta:'NE ¬∑ Receipts',
      title:'Workflows & Receipts',
      ex:{origin:'Make execution verifiable.', now:'Audit trails + replay safety.', trajectory:'Portable receipts across systems.'},
      ln:{origin:'Origin: receipts eliminate ‚Äútrust me‚Äù execution with provable progress.',
          now:'Now: workflows emit receipts; audits replay them to verify consistency.',
          trajectory:'Trajectory: receipts portable across products enabling cross-system resolution.'},
      subs:[
        {t:'Receipt tokens', s:'Proof', blurb:'A receipt is verifiable record of completion.', bullets:['Proof of step.','Evidence link.','Replay reference.'], mini:['PROOF','EVIDENCE','REPLAY']},
        {t:'Audit trails', s:'Trace', blurb:'Audits follow receipts backward and forward.', bullets:['Trace decisions.','Verify constraints.','Detect drift.'], mini:['TRACE','VERIFY','DRIFT']},
        {t:'Back-nav', s:'Invalidate', blurb:'Backtracking invalidates downstream receipts.', bullets:['Prevents false continuity.','Forces re-commitment.','Keeps path coherent.'], mini:['INVALIDATE','RECOMMIT','COHERENT']},
        {t:'Why', s:'Integrity', blurb:'Receipts enforce coherence structurally.', bullets:['External trust ‚â§ internal coherence.','Verification beats narrative.','Replay beats impression.'], mini:['TRUST','VERIFY','REPLAY']}
      ]
    },

    examples:{
      meta:'NE ¬∑ Examples',
      title:'Examples',
      ex:{origin:'Anchor abstract structure into action.', now:'Templates and routes.', trajectory:'Institution-ready playbooks.'},
      ln:{origin:'Origin: examples make the system learnable without persuasion.',
          now:'Now: examples mirror routes and end in receipts.',
          trajectory:'Trajectory: examples become certified playbooks for adoption.'},
      subs:[
        {t:'Explore examples', s:'Short', blurb:'Explore examples are short and concrete.', bullets:['One route. One outcome. One takeaway.'], mini:['SHORT','CONCRETE']},
        {t:'Learn examples', s:'Nested', blurb:'Learn expands into nested bubbles and blocks.', bullets:['Step-by-step.','Receipts included.','Replay-ready.'], mini:['NESTED','RECEIPTS','REPLAY']},
        {t:'Routes', s:'NW/NE/SW/SE', blurb:'Each example maps to a quadrant.', bullets:['NW defines.','NE executes.','SW measures.','SE anchors.'], mini:['MAP','ROUTES']},
        {t:'Ends with receipt', s:'Always', blurb:'Every example ends in verification.', bullets:['Receipt emitted.','Audit possible.','Drift detectable.'], mini:['VERIFY','AUDIT']}
      ]
    },

    packs:{
      meta:'NE ¬∑ Outputs',
      title:'Packs & Outputs',
      ex:{origin:'Ship utility fast.', now:'Downloadables + packaged artifacts.', trajectory:'Reusable certified kits.'},
      ln:{origin:'Origin: outputs packaged so people can use immediately.',
          now:'Now: packs include materials, templates, and tools.',
          trajectory:'Trajectory: kits for certification and deployment bundles.'},
      subs:[
        {t:'PDFs', s:'Materials', blurb:'Printable guides and references.', bullets:['Guides.','Checklists.','Drills.'], mini:['GUIDE','CHECKLIST','DRILL']},
        {t:'Kits', s:'Reusable', blurb:'Composable packs mapped to routes and receipts.', bullets:['Reusable templates.','Route-mapped.','Receipt-ready.'], mini:['REUSE','ROUTE','RECEIPT']},
        {t:'Releases', s:'What ships', blurb:'Explore shows what exists; Learn shows how it works.', bullets:['Explore = catalog.','Learn = anatomy.'], mini:['CATALOG','ANATOMY']},
        {t:'Roadmap', s:'Trajectory', blurb:'Trajectory lens shows what expands next.', bullets:['Next surfaces.','Next instruments.','Next packs.'], mini:['NEXT','EXPAND']}
      ]
    },

    /* SW */
    gauges:{meta:'SW ¬∑ Gauges', title:'Gauges',
      ex:{origin:'Measure coherence under load.', now:'Panels + thresholds.', trajectory:'Real-time monitoring.'},
      ln:{origin:'Origin: gauges make coherence measurable and operational.',
          now:'Now: dashboards, consistency checks, and threshold rules.',
          trajectory:'Trajectory: continuous monitoring across systems.'},
      subs:[
        {t:'Panels', s:'Dashboards', blurb:'Panels show coherence and drift quickly.', bullets:['Signal integrity.','Consistency checks.','Thresholds.'], mini:['SIGNAL','CONSISTENT','THRESHOLD']},
        {t:'Thresholds', s:'Rules', blurb:'Define pass/fail under constraint.', bullets:['Observer-consistent.','Defined rules.','Repeatable.'], mini:['PASS/FAIL','RULED','REPEAT']},
        {t:'Trends', s:'Trajectory', blurb:'Direction compounds through repetition.', bullets:['Small drift grows.','Return protocols matter.','Detect early.'], mini:['DIRECTION','DRIFT','RETURN']},
        {t:'Use', s:'When', blurb:'Use when performance must be verified under stress.', bullets:['Ops.','Compliance.','Safety.'], mini:['OPS','COMPLIANCE','SAFETY']}
      ]
    },

    diagnostics:{meta:'SW ¬∑ Diagnostics', title:'Diagnostics',
      ex:{origin:'Classify under constraint.', now:'Coherence / drift / confusion.', trajectory:'Universal early-warning.'},
      ln:{origin:'Origin: classify systems the same way from the same evidence.',
          now:'Now: coherence/drift/confusion categories with replay-driven audits.',
          trajectory:'Trajectory: early-warning systems across domains.'},
      subs:[
        {t:'Classification', s:'Observer-consistent', blurb:'Independent observers converge on same class.', bullets:['Same evidence.','Same class.','Repeatable output.'], mini:['OBSERVER','CONSISTENT']},
        {t:'Drift', s:'Direction', blurb:'Drift reveals structural truth.', bullets:['Stabilizing vs destabilizing.','Compounding.','Detect early.'], mini:['DIRECTION','COMPOUND','EARLY']},
        {t:'Confusion', s:'Amplifier', blurb:'Confusion amplifies instability once present.', bullets:['Speeds collapse.','Obscures signals.','Increases variance.'], mini:['AMPLIFY','OBSCURE','VARIANCE']},
        {t:'Audit', s:'Replay', blurb:'Replay evidence streams to verify.', bullets:['Replay.','Verify.','Compare.'], mini:['REPLAY','VERIFY','COMPARE']}
      ]
    },

    rules:{meta:'SW ¬∑ Rules', title:'Rules',
      ex:{origin:'Keep traversal stable.', now:'Navigation + integrity.', trajectory:'Governance standard.'},
      ln:{origin:'Origin: rules prevent drift and preserve canonicity.',
          now:'Now: navigation and integrity rules constrain execution.',
          trajectory:'Trajectory: governance standards for adoption.'},
      subs:[
        {t:'Navigation', s:'Hub-first', blurb:'Return to hub; one route at a time.', bullets:['Hub-first.','One choice.','Finish/return.'], mini:['HUB','ONE','RETURN']},
        {t:'Guards', s:'Admissibility', blurb:'Guards block inadmissible actions.', bullets:['Constraint checks.','Receipt gating.','Safety first.'], mini:['CHECK','GATE','SAFE']},
        {t:'Consistency', s:'Integrity', blurb:'Values, actions, outcomes align.', bullets:['No fragmentation.','Coherent execution.','Stable outcomes.'], mini:['ALIGN','COHERENT','STABLE']},
        {t:'Scale', s:'Correlation', blurb:'Scale-and-correlation governs projections.', bullets:['System-wide trajectory.','Not attention-only.','Correlation across network.'], mini:['SCALE','CORRELATE']}
      ]
    },

    protocols:{meta:'SW ¬∑ Protocols', title:'Protocols',
      ex:{origin:'Repeatable actions.', now:'Return / replay / verification.', trajectory:'Certified SOPs.'},
      ln:{origin:'Origin: protocols convert principles into repeatable execution.',
          now:'Now: atomic handoffs, exits, returns, and receipts.',
          trajectory:'Trajectory: certified operating procedures across orgs.'},
      subs:[
        {t:'Atomic handoff', s:'Receipt', blurb:'No partial transitions.', bullets:['Atomic.','Verified.','Replay-safe.'], mini:['ATOMIC','VERIFY','REPLAY']},
        {t:'Exit', s:'Return token', blurb:'Exit emits terminal + return token.', bullets:['Terminal state.','Return token.','Re-entry safe.'], mini:['EXIT','TOKEN','REENTER']},
        {t:'Continuation', s:'Memory token', blurb:'Loop after receipt with memory token.', bullets:['Receipt gate.','Loop.','Memory.'], mini:['GATE','LOOP','MEMORY']},
        {t:'Kill conditions', s:'Stop', blurb:'Define stop conditions to prevent runaway drift.', bullets:['Stop.','Reset.','Recalibrate.'], mini:['STOP','RESET','RECAL']}
      ]
    },

    /* SE */
    orcid:{meta:'SE ¬∑ ORCID', title:'ORCID',
      ex:{origin:'Identity anchor.', now:'Researcher iD reference.', trajectory:'Long-term traceability.'},
      ln:{origin:'Origin: identity anchors keep attribution stable across time.',
          now:'Now: ORCID ties work to consistent researcher identity.',
          trajectory:'Trajectory: traceability and provenance.'},
      subs:[
        {t:'Identity', s:'Anchor', blurb:'Stable researcher identity reference.', bullets:['Persistent iD.','Attribution.','Continuity.'], mini:['ID','ATTR','CONT']},
        {t:'Citations', s:'Provenance', blurb:'Tie outputs to identity for provenance.', bullets:['Cite.','Link.','Trace.'], mini:['CITE','LINK','TRACE']},
        {t:'When', s:'Anytime', blurb:'Use whenever formal attribution matters.', bullets:['Preprints.','Reports.','Datasets.'], mini:['FORMAL','PUBLIC']},
        {t:'Sharing', s:'Continuity', blurb:'Continuity across archives.', bullets:['Archive.','Reuse.','Public reference.'], mini:['ARCHIVE','REUSE']}
      ]
    },

    osf:{meta:'SE ¬∑ OSF', title:'OSF',
      ex:{origin:'Public research spine.', now:'Registry + canonical references.', trajectory:'Continuity ledger.'},
      ln:{origin:'Origin: OSF provides persistent registry and canonical linking.',
          now:'Now: stable identifiers for projects and artifacts.',
          trajectory:'Trajectory: continuity ledger for evolution.'},
      subs:[
        {t:'Registry', s:'Canonical', blurb:'OSF keeps canonical references stable.', bullets:['Project IDs.','Stable links.','Public spine.'], mini:['CANON','STABLE','PUBLIC']},
        {t:'Preprints', s:'Release', blurb:'Publish artifacts with stable identifiers.', bullets:['Preprints.','Working papers.','Supplements.'], mini:['RELEASE','ID']},
        {t:'Mapping', s:'Crosslinks', blurb:'Map branches to hubs without drift.', bullets:['Crosslink.','Anchor.','Navigate.'], mini:['MAP','ANCHOR']},
        {t:'When', s:'Reference', blurb:'Use when you need persistent public reference.', bullets:['Public proof.','Collab.','Share.'], mini:['PROOF','SHARE']}
      ]
    },

    refs:{meta:'SE ¬∑ References', title:'References',
      ex:{origin:'Prevent semantic drift.', now:'Core anchors + citations.', trajectory:'Shared coordinates.'},
      ln:{origin:'Origin: references prevent meaning collapse when systems grow.',
          now:'Now: core citations, anchors, and mapping for shared understanding.',
          trajectory:'Trajectory: shared coordinates across audiences.'},
      subs:[
        {t:'Core anchors', s:'Stability', blurb:'Anchors keep meaning stable.', bullets:['Canonical terms.','Stable mapping.','Clear definitions.'], mini:['STABLE','CLEAR']},
        {t:'Links', s:'Identity', blurb:'Links connect evidence, identity, and outputs.', bullets:['Evidence.','Identity.','Outputs.'], mini:['EVIDENCE','ID','OUTPUT']},
        {t:'Scope', s:'256', blurb:'References scale into the 256 geometry.', bullets:['State indexing.','Auditability.','Replay.'], mini:['256','AUDIT','REPLAY']},
        {t:'Use', s:'Alignment', blurb:'Use whenever you need alignment across audiences.', bullets:['Teams.','Readers.','Institutions.'], mini:['ALIGN','SHARE']}
      ]
    },

    contact:{meta:'SE ¬∑ Contact', title:'Contact',
      ex:{origin:'Restore alignment quickly.', now:'Direct channel.', trajectory:'Intake for adoption.'},
      ln:{origin:'Origin: direct communication reduces friction and speeds resolution.',
          now:'Now: contact channel for access, questions, and collaboration.',
          trajectory:'Trajectory: intake pipeline for certification and adoption.'},
      subs:[
        {t:'Intake', s:'Requests', blurb:'Use for collaboration, questions, and access.', bullets:['Questions.','Collab.','Access.'], mini:['ASK','COLLAB','ACCESS']},
        {t:'Ops', s:'Coordination', blurb:'Operational coordination and structure.', bullets:['Schedule.','Scope.','Delivery.'], mini:['OPS','SCOPE','DELIVER']},
        {t:'Certification', s:'Tracks', blurb:'Training and certification coordination.', bullets:['Track.','Verify.','Certify.'], mini:['TRAIN','VERIFY','CERT']},
        {t:'When', s:'Resolution', blurb:'Use when you need resolution or alignment.', bullets:['Misalignment.','Drift.','Uncertainty.'], mini:['RESOLVE','ALIGN']}
      ]
    }
  };

  /* ========= MODAL WIRING ========= */
  const backdrop = document.getElementById('backdrop');
  const mclose = document.getElementById('mclose');
  const mmeta = document.getElementById('mmeta');
  const mtitle = document.getElementById('mtitle');
  const mdesc = document.getElementById('mdesc');
  const mgrid = document.getElementById('mgrid');

  const subpanel = document.getElementById('subpanel');
  const subTitle = document.getElementById('subTitle');
  const subBlurb = document.getElementById('subBlurb');
  const subBullets = document.getElementById('subBullets');
  const subMini = document.getElementById('subMini');

  const state = { openKey:null };

  function openModal(){ backdrop.classList.add('open'); document.body.style.overflow='hidden'; }
  function closeModal(){
    backdrop.classList.remove('open');
    document.body.style.overflow='';
    state.openKey=null;
    subpanel.classList.remove('open');
  }
  mclose.addEventListener('click', closeModal);
  backdrop.addEventListener('click', (e)=>{ if(e.target===backdrop) closeModal(); });
  document.addEventListener('keydown', (e)=>{ if(e.key==='Escape' && backdrop.classList.contains('open')) closeModal(); });

  function updateModalChips(){
    document.querySelectorAll('.chip').forEach(c=>{
      const k=c.getAttribute('data-chip');
      c.classList.toggle('on', k===lens);
    });
  }
  updateModalChips();

  function esc(str){
    return String(str).replace(/[&<>"']/g, s => ({
      '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'
    }[s]));
  }

  function renderModal(key){
    const b = blocks[key];
    if(!b) return;
    state.openKey = key;

    mmeta.textContent = b.meta || 'DETAIL';
    mtitle.textContent = b.title || '‚Äî';

    const mode = (depth === 'learn') ? 'ln' : 'ex';
    const desc = (b[mode] && b[mode][lens]) ? b[mode][lens] : '';
    mdesc.textContent = desc;

    mgrid.innerHTML='';
    (b.subs||[]).forEach((s, idx)=>{
      const el=document.createElement('div');
      el.className='subbubble';
      el.innerHTML =
        '<div class="t"><b>'+esc(s.t)+'</b><i>'+esc(s.s||'')+'</i></div>' +
        '<div class="go">‚ñ∂</div>';
      el.addEventListener('click', ()=>{
        subTitle.textContent = s.t;
        subBlurb.textContent = s.blurb || '';
        subBullets.innerHTML = '';
        (s.bullets||[]).forEach(x=>{
          const li=document.createElement('li');
          li.textContent=x;
          subBullets.appendChild(li);
        });
        subMini.innerHTML='';
        (s.mini||[]).forEach(x=>{
          const d=document.createElement('div');
          d.className='minichip';
          d.textContent=x;
          subMini.appendChild(d);
        });
        subpanel.classList.add('open');
      });
      mgrid.appendChild(el);

      if(depth==='learn' && idx===0){
        setTimeout(()=>el.click(), 0);
      }
    });

    if(depth!=='learn'){
      subpanel.classList.remove('open');
    }
    updateModalChips();
  }

  document.querySelectorAll('.bubble').forEach(b=>{
    b.addEventListener('click', ()=>{
      const key=b.getAttribute('data-block');
      renderModal(key);
      openModal();
    });
  });

  /* ========= LENS (GLOBAL) ========= */
  function setLens(next){
    lens = next;
    localStorage.setItem('crp_lens', lens);
    Object.keys(lensBtn).forEach(k => lensBtn[k].classList.toggle('active', k === lens));
    updateModalChips();
    if(state.openKey) renderModal(state.openKey);
  }

  lensBtn.origin.addEventListener('click',()=>setLens('origin'));
  lensBtn.now.addEventListener('click',()=>setLens('now'));
  lensBtn.trajectory.addEventListener('click',()=>setLens('trajectory'));

})();
</script>
</body>
</html>

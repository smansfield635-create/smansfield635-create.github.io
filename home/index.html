<!-- TNT — /home/index.html  (HUB · GEM STANDARD · LENSES INSIDE BUBBLES ONLY)
     Uniform with SOFTWARE gem aesthetic.
     Main page:
       - NO lens controls on the page.
       - Top-left: EXIT (to /door/) + MAP (opens centered modal).
       - Center: 4-direction gem diamond (N/E/S/W). Tap opens centered modal.
       - Bottom dock: TERMINAL / LINKS / PRODUCTS / LAWS / GAUGES
     Inside modal only:
       - STYLE: Formal/Informal (gd_style)
       - TIME: Concept/Now/Post (gd_time origin/now/post)
     Dual language always (EN + 中文) (gd_lang + ?lang=)
-->

<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>HUB · Cardinal Axis</title>

<link rel="stylesheet" href="/assets/ui.css"/>
<link rel="stylesheet" href="/assets/branch.css"/>

<style>
:root{
  --R:124px;
  --gold:rgba(212,175,55,.9);
  --goldSoft:rgba(212,175,55,.35);
  --obs1:#070b12;
  --obs2:#0c1626;
  --mut:rgba(255,255,255,.84);
  --mut2:rgba(255,255,255,.68);
}

body{
  margin:0;
  min-height:100vh;
  background:
    radial-gradient(circle at 50% 40%, rgba(90,140,255,.10), transparent 60%),
    repeating-linear-gradient(45deg, rgba(255,255,255,.02) 0 1px, transparent 1px 100px),
    linear-gradient(180deg,#b00000 0%,#7a0000 60%,#550000 100%);
  font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
  color:#fff;
  overflow-x:hidden;
}

/* Buttons */
.btn{
  padding:10px 16px;
  border-radius:14px;
  background:linear-gradient(145deg,var(--obs2),var(--obs1));
  color:white;
  border:1px solid rgba(255,255,255,.08);
  box-shadow:0 14px 36px rgba(0,0,0,.7);
  cursor:pointer;
  font-weight:900;
  letter-spacing:.2px;
  text-decoration:none;
}
.btn:hover{ box-shadow:0 18px 50px rgba(0,0,0,.9), 0 0 14px var(--goldSoft); }
.btn.active{
  border-color:rgba(212,175,55,.25);
  box-shadow:0 18px 50px rgba(0,0,0,.9), 0 0 22px rgba(212,175,55,.30);
}

/* Top-left only */
.top-left{
  position:fixed;left:16px;top:16px;z-index:90;
  display:flex;gap:10px;flex-wrap:wrap;align-items:center;
}

/* Architecture stamp */
.stamp{
  position:fixed;
  right:16px;
  bottom:max(16px, env(safe-area-inset-bottom));
  z-index:85;
  padding:10px 12px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(0,0,0,.18);
  backdrop-filter:blur(8px);
  font-weight:950;
  letter-spacing:.8px;
  font-size:11px;
  opacity:.90;
  pointer-events:none;
}

/* Center stage */
.stage{
  position:fixed;
  left:50%;
  top:50%;
  transform:translate(-50%,-50%);
  width:min(560px,92vw);
  height:min(560px,92vw);
  z-index:40;
}

/* Outer gem diamond (subtle) */
.outer{
  position:absolute;
  left:50%;top:50%;
  width:min(560px,92vw);
  height:min(560px,92vw);
  transform:translate(-50%,-50%) rotate(45deg);
  border-radius:60px;
  background:
    radial-gradient(circle at 30% 25%, rgba(255,255,255,.08), transparent 55%),
    radial-gradient(circle at 70% 80%, rgba(0,80,255,.14), transparent 60%),
    linear-gradient(160deg, rgba(14,24,40,.45) 0%, rgba(7,11,18,.62) 70%);
  border:1px solid rgba(255,255,255,.10);
  box-shadow:
    0 90px 260px rgba(0,0,0,.62),
    inset 0 2px 0 rgba(255,255,255,.10),
    inset 0 -50px 90px rgba(0,0,0,.55);
  pointer-events:none;
  opacity:.55;
}
.outer::after{
  content:"";
  position:absolute; inset:0; border-radius:60px;
  background:repeating-conic-gradient(from 0deg, rgba(255,255,255,.04) 0deg 6deg, transparent 6deg 18deg);
  opacity:.14;
}

/* Diamonds */
.d{
  width:150px;height:150px;
  position:absolute;
  left:50%;top:50%;
  transform-origin:center;
  border-radius:26px;
  cursor:pointer;
  -webkit-tap-highlight-color:transparent;

  background:
    radial-gradient(circle at 35% 25%, rgba(255,255,255,.14), transparent 55%),
    radial-gradient(circle at 70% 80%, rgba(0,80,255,.18), transparent 60%),
    linear-gradient(160deg, rgba(12,22,38,.92) 0%, rgba(7,11,18,.95) 70%);

  border:1px solid rgba(255,255,255,.10);
  box-shadow:
    0 28px 84px rgba(0,0,0,.78),
    inset 0 2px 0 rgba(255,255,255,.14),
    inset 0 -28px 44px rgba(0,0,0,.62);
  transition:transform 220ms ease, box-shadow 220ms ease, border-color 220ms ease;
}
.d::before{
  content:"";
  position:absolute; inset:0; border-radius:26px; padding:1px;
  background:linear-gradient(120deg, transparent 0%, var(--goldSoft) 50%, transparent 100%);
  opacity:.45;
  -webkit-mask:linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  -webkit-mask-composite:xor; mask-composite:exclude;
  pointer-events:none;
}
.d::after{
  content:"";
  position:absolute;
  left:12%; right:12%;
  top:10%;
  height:28%;
  border-radius:999px;
  background:linear-gradient(to bottom, rgba(255,255,255,.16), rgba(255,255,255,0));
  opacity:.85;
  transform:rotate(-10deg);
  pointer-events:none;
}
.d:hover{
  transform:translate(-50%,-50%) rotate(45deg) scale(1.02);
  box-shadow:
    0 34px 110px rgba(0,0,0,.88),
    0 0 18px rgba(212,175,55,.18),
    inset 0 2px 0 rgba(255,255,255,.18),
    inset 0 -32px 52px rgba(0,0,0,.68);
}
.d.active{
  border-color:rgba(212,175,55,.55);
  box-shadow:
    0 34px 110px rgba(0,0,0,.88),
    0 0 30px rgba(212,175,55,.40),
    inset 0 2px 0 rgba(255,255,255,.18),
    inset 0 -32px 52px rgba(0,0,0,.68);
}

.d-n{ transform:translate(-50%,-50%) translate(0, calc(var(--R) * -1)) rotate(45deg); }
.d-e{ transform:translate(-50%,-50%) translate(var(--R), 0) rotate(45deg); }
.d-s{ transform:translate(-50%,-50%) translate(0, var(--R)) rotate(45deg); }
.d-w{ transform:translate(-50%,-50%) translate(calc(var(--R) * -1), 0) rotate(45deg); }

.inner{
  width:100%; height:100%;
  transform:rotate(-45deg);
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  text-align:center;
  padding:16px;
  gap:8px;
  pointer-events:none;
  user-select:none;
}
.lab{ font-weight:950; letter-spacing:.8px; font-size:16px; }
.sub{ font-size:13px; opacity:.86; line-height:1.35; max-width:16em; }

.core{
  position:absolute;
  left:50%; top:50%;
  transform:translate(-50%,-50%);
  width:64px;height:64px;
  border-radius:18px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(0,0,0,.18);
  box-shadow:0 18px 44px rgba(0,0,0,.62), inset 0 2px 0 rgba(255,255,255,.10);
  display:grid; place-items:center;
  font-weight:950; letter-spacing:.5px;
  opacity:.92;
  pointer-events:none;
}

/* Dock */
.dock{
  position:fixed;
  left:50%;
  bottom:max(12px, env(safe-area-inset-bottom));
  transform:translateX(-50%);
  z-index:90;
  width:min(900px,94vw);
  display:flex;
  justify-content:center;
  gap:10px;
  flex-wrap:wrap;
  padding:10px 12px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(0,0,0,.20);
  backdrop-filter:blur(8px);
}

/* Modal */
.bd{
  position:fixed;inset:0;z-index:200;
  background:rgba(0,0,0,.65);
  backdrop-filter:blur(10px);
  display:none;
}
.bd.show{display:block;}
.modal{
  position:fixed;left:50%;top:50%;
  transform:translate(-50%,-50%);
  width:min(1020px,94vw);
  max-height:88vh;
  display:none;
  z-index:210;
}
.modal.show{display:block;}
.shell{
  height:88vh;
  border-radius:26px;
  border:1px solid rgba(255,255,255,.10);
  background:
    radial-gradient(circle at 50% 18%, rgba(176,0,0,.20), transparent 55%),
    radial-gradient(circle at 40% 25%, rgba(90,140,255,.12), transparent 55%),
    linear-gradient(160deg,var(--obs2) 0%, var(--obs1) 65%);
  box-shadow:0 60px 180px rgba(0,0,0,.92);
  overflow:hidden;
  display:flex;
  flex-direction:column;
  position:relative;
}
.shell::before{
  content:"";
  position:absolute;
  left:50%;
  top:58%;
  width:min(980px,94vw);
  height:min(980px,94vw);
  transform:translate(-50%,-50%) rotate(45deg);
  border-radius:70px;
  background:
    radial-gradient(circle at 30% 25%, rgba(255,255,255,.08), transparent 55%),
    radial-gradient(circle at 70% 80%, rgba(0,80,255,.16), transparent 60%),
    linear-gradient(160deg, rgba(14,24,40,.45) 0%, rgba(7,11,18,.68) 70%);
  box-shadow:
    0 100px 280px rgba(0,0,0,.72),
    inset 0 2px 0 rgba(255,255,255,.10),
    inset 0 -55px 100px rgba(0,0,0,.55);
  opacity:.55;
  pointer-events:none;
}
.mhead{
  display:flex;justify-content:space-between;align-items:center;
  gap:10px;padding:14px 16px;border-bottom:1px solid rgba(255,255,255,.08);
  position:relative;z-index:2;
}
.mtitle{ margin:0; font-weight:950; letter-spacing:.3px; font-size:16px; }
.mclose{ border:0; background:transparent; color:#fff; font-size:18px; cursor:pointer; padding:8px 10px; }
.mbody{
  padding:14px 16px 18px;
  overflow:auto;-webkit-overflow-scrolling:touch;
  flex:1 1 auto;
  position:relative;z-index:2;
}
.lensbar{
  display:flex;gap:10px;flex-wrap:wrap;
  align-items:center;justify-content:center;
  padding:10px 10px 14px;border-bottom:1px solid rgba(255,255,255,.08);
  margin:-6px -6px 14px;
}
.chip{
  padding:10px 16px;border-radius:999px;
  background:linear-gradient(145deg,var(--obs2),var(--obs1));
  border:1px solid rgba(255,255,255,.08);
  box-shadow:0 14px 36px rgba(0,0,0,.65);
  cursor:pointer;font-weight:900;letter-spacing:.2px;color:#fff;
}
.chip.active{
  border-color:rgba(212,175,55,.35);
  box-shadow:0 18px 50px rgba(0,0,0,.9), 0 0 16px rgba(212,175,55,.30);
}

.mgrid{ display:grid; gap:14px; }
@media (min-width:920px){ .mgrid{ grid-template-columns:1fr 1fr; } }
.box{
  padding:16px 18px;border-radius:22px;
  background:
    radial-gradient(circle at 30% 30%, rgba(120,160,255,.08), transparent 55%),
    linear-gradient(145deg, rgba(12,22,38,.92), rgba(7,11,18,.95));
  border:1px solid rgba(255,255,255,.10);
  box-shadow:0 18px 60px rgba(0,0,0,.70), inset 0 2px 0 rgba(255,255,255,.06);
  position:relative;
}
.box::before{
  content:"";
  position:absolute;inset:0;border-radius:22px;padding:1px;
  background:linear-gradient(120deg, transparent 0%, var(--goldSoft) 50%, transparent 100%);
  opacity:.55;
  -webkit-mask:linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  -webkit-mask-composite:xor; mask-composite:exclude;
  pointer-events:none;
}
.h{ margin:0 0 8px; font-weight:950; letter-spacing:.2px; }
.p{ margin:0 0 10px; color:var(--mut); line-height:1.55; }
.ul{ margin:0 0 0 18px; padding:0; color:var(--mut2); }
.ul li{ margin:6px 0; }

.mact{ display:flex; gap:10px; flex-wrap:wrap; justify-content:center; margin-top:14px; }
.sbtn{
  padding:12px 18px;border-radius:14px;
  background:linear-gradient(145deg,var(--obs2),var(--obs1));
  color:#fff;border:1px solid rgba(255,255,255,.08);
  box-shadow:0 14px 36px rgba(0,0,0,.7);
  cursor:pointer;font-weight:900;letter-spacing:.2px;text-decoration:none;
}
.sbtn:hover{ box-shadow:0 18px 50px rgba(0,0,0,.9), 0 0 14px var(--goldSoft); }

@media (max-width:520px){
  :root{ --R: 116px; }
  .stage{ width:min(520px,92vw); height:min(520px,92vw); }
  .outer{ width:min(520px,92vw); height:min(520px,92vw); }
  .core{ width:58px; height:58px; }
  .shell{ height:90vh; }
}
</style>
</head>

<body>

<div class="top-left" id="topLeft">
  <a class="btn" id="btnExit" href="/door/">EXIT</a>
  <button class="btn" id="btnMap" type="button">MAP</button>
</div>

<div class="stage" id="stage" aria-label="Hub diamond">
  <div class="outer"></div>

  <div class="d d-n" id="north" role="button" tabindex="0" aria-label="North">
    <div class="inner"><div class="lab" id="nLab">NORTH</div><div class="sub" id="northText"></div></div>
  </div>
  <div class="d d-e" id="east" role="button" tabindex="0" aria-label="East">
    <div class="inner"><div class="lab" id="eLab">EAST</div><div class="sub" id="eastText"></div></div>
  </div>
  <div class="d d-s" id="south" role="button" tabindex="0" aria-label="South">
    <div class="inner"><div class="lab" id="sLab">SOUTH</div><div class="sub" id="southText"></div></div>
  </div>
  <div class="d d-w" id="west" role="button" tabindex="0" aria-label="West">
    <div class="inner"><div class="lab" id="wLab">WEST</div><div class="sub" id="westText"></div></div>
  </div>

  <div class="core">◆</div>
</div>

<nav class="dock" id="dock">
  <a class="btn" id="goTerminal" href="/index.html">TERMINAL</a>
  <a class="btn" id="goLinks" href="/links/">LINKS</a>
  <a class="btn" id="goProducts" href="/products/">PRODUCTS</a>
  <a class="btn" id="goLaws" href="/laws/">LAWS</a>
  <a class="btn" id="goGauges" href="/gauges/">GAUGES</a>
</nav>

<div class="stamp" id="stamp">TRAVERSAL ARCHITECTURE</div>

<div class="bd" id="bd"></div>

<div class="modal" id="modal" role="dialog" aria-modal="true">
  <div class="shell">
    <div class="mhead">
      <h3 class="mtitle" id="mTitle">DETAIL</h3>
      <button class="mclose" id="mClose" aria-label="Close" type="button">✕</button>
    </div>

    <div class="mbody">
      <!-- Lenses inside bubble only -->
      <div class="lensbar" id="lensbar">
        <button class="chip" id="styleChip" type="button">STYLE: FORMAL</button>
        <button class="chip" data-time="origin" id="chipConcept" type="button">CONCEPT</button>
        <button class="chip" data-time="now" id="chipNow" type="button">NOW</button>
        <button class="chip" data-time="post" id="chipPost" type="button">POST</button>
      </div>

      <div class="mgrid">
        <div class="box"><h4 class="h" id="h1"></h4><p class="p" id="p1"></p><ul class="ul" id="u1"></ul></div>
        <div class="box"><h4 class="h" id="h2"></h4><p class="p" id="p2"></p><ul class="ul" id="u2"></ul></div>
        <div class="box"><h4 class="h" id="h3"></h4><p class="p" id="p3"></p><ul class="ul" id="u3"></ul></div>
        <div class="box"><h4 class="h" id="h4"></h4><p class="p" id="p4"></p><ul class="ul" id="u4"></ul></div>
      </div>

      <div class="mact">
        <button class="sbtn" id="mReturn" type="button">RETURN</button>
        <a class="sbtn" id="mJumpLinks" href="/links/">JUMP LINKS</a>
        <a class="sbtn" id="mJumpProducts" href="/products/">JUMP PRODUCTS</a>
      </div>
    </div>
  </div>
</div>

<script>
(function(){
  // language + state
  var qs=new URLSearchParams(location.search);
  var qLang=qs.get("lang");
  var lang=(qLang==="zh"||qLang==="en")?qLang:((localStorage.getItem("gd_lang")==="zh")?"zh":"en");
  try{ localStorage.setItem("gd_lang", lang);}catch(e){}

  var style=localStorage.getItem("gd_style")||"formal";
  var time=localStorage.getItem("gd_time")||"now";
  if(time==="trajectory") time="post";
  if(["origin","now","post"].indexOf(time)<0) time="now";
  if(["formal","informal"].indexOf(style)<0) style="formal";

  function q(){ return "lang="+encodeURIComponent(lang)+"&style="+encodeURIComponent(style)+"&time="+encodeURIComponent(time); }
  function setLinks(){
    var s=q();
    document.getElementById("btnExit").href="/door/?"+s;
    document.getElementById("goTerminal").href="/index.html?"+s;
    document.getElementById("goLinks").href="/links/?"+s;
    document.getElementById("goProducts").href="/products/?"+s;
    document.getElementById("goLaws").href="/laws/?"+s;
    document.getElementById("goGauges").href="/gauges/?"+s;
    document.getElementById("mJumpLinks").href="/links/?"+s;
    document.getElementById("mJumpProducts").href="/products/?"+s;
  }

  // UI text
  var UI={
    en:{
      stamp:"TRAVERSAL ARCHITECTURE",
      dir:{n:"NORTH",e:"EAST",s:"SOUTH",w:"WEST"},
      sub:{
        n:"Invariant structure · definition.",
        e:"Execution pathways · action.",
        s:"Convergence pressure · change.",
        w:"Containment · integrity."
      },
      lens:{formal:"FORMAL",informal:"INFORMAL",concept:"CONCEPT",now:"NOW",post:"POST"},
      map:{
        title:"HUB MAP",
        b1:{h:"Terminal",p:"Structural preface and navigation guide for the entire site.",u:["Explains lenses.","Explains traversal.","States safety rules.","Routes into hub."]},
        b2:{h:"Links",p:"Identity anchors and external references, kept clean and stable.",u:["ORCID/OSF/GitHub.","Contact anchor.","Registry entry points.","Return to hub."]},
        b3:{h:"Products",p:"Execution surfaces: software, commercial, energy, education.",u:["Domain sub-hubs.","Gem-uniform pages.","Modal bulletins.","State propagation."]},
        b4:{h:"Laws & Gauges",p:"Standards/rules and dashboards/metrics respectively.",u:["Publish rules.","Publish metrics.","Keep auditability.","Keep neutrality."]}
      }
    },
    zh:{
      stamp:"遍历架构",
      dir:{n:"北",e:"东",s:"南",w:"西"},
      sub:{
        n:"不变结构 · 定义。",
        e:"执行路径 · 行动。",
        s:"收敛压力 · 变化。",
        w:"约束防护 · 完整性。"
      },
      lens:{formal:"正式",informal:"非正式",concept:"概念",now:"当前",post:"后续"},
      map:{
        title:"枢纽地图",
        b1:{h:"终端",p:"全站结构前言与导航说明。",u:["解释透镜。","解释遍历。","说明安全规则。","进入枢纽。"]},
        b2:{h:"链接",p:"身份锚点与外部参考（保持稳定）。",u:["ORCID/OSF/GitHub。","联系方式。","登记入口。","返回枢纽。"]},
        b3:{h:"产品",p:"执行面：软件/商业/能源/教育。",u:["领域子枢纽。","宝石统一页面。","模态要点。","状态传播。"]},
        b4:{h:"法则与量规",p:"法则=标准规则；量规=仪表盘指标。",u:["发布规则。","发布指标。","保持可审计。","保持中立。"]}
      }
    }
  };

  var pack = (lang==="zh") ? UI.zh : UI.en;
  document.documentElement.lang = (lang==="zh") ? "zh" : "en";
  document.getElementById("stamp").textContent = pack.stamp;

  document.getElementById("nLab").textContent = pack.dir.n;
  document.getElementById("eLab").textContent = pack.dir.e;
  document.getElementById("sLab").textContent = pack.dir.s;
  document.getElementById("wLab").textContent = pack.dir.w;

  document.getElementById("northText").textContent = pack.sub.n;
  document.getElementById("eastText").textContent = pack.sub.e;
  document.getElementById("southText").textContent = pack.sub.s;
  document.getElementById("westText").textContent = pack.sub.w;

  // modal refs
  var bd=document.getElementById("bd");
  var modal=document.getElementById("modal");
  var mClose=document.getElementById("mClose");
  var mTitle=document.getElementById("mTitle");

  var styleChip=document.getElementById("styleChip");
  var chipConcept=document.getElementById("chipConcept");
  var chipNow=document.getElementById("chipNow");
  var chipPost=document.getElementById("chipPost");

  var h1=document.getElementById("h1"),p1=document.getElementById("p1"),u1=document.getElementById("u1");
  var h2=document.getElementById("h2"),p2=document.getElementById("p2"),u2=document.getElementById("u2");
  var h3=document.getElementById("h3"),p3=document.getElementById("p3"),u3=document.getElementById("u3");
  var h4=document.getElementById("h4"),p4=document.getElementById("p4"),u4=document.getElementById("u4");

  function fill(hEl,pEl,uEl,b){
    hEl.textContent=b.h; pEl.textContent=b.p; uEl.innerHTML="";
    b.u.forEach(function(x){ var li=document.createElement("li"); li.textContent=x; uEl.appendChild(li); });
  }

  function persist(){
    try{ localStorage.setItem("gd_style", style); localStorage.setItem("gd_time", time);}catch(e){}
  }

  function setLensLabels(){
    styleChip.textContent = "STYLE: " + (style==="formal" ? pack.lens.formal : pack.lens.informal);
    chipConcept.textContent = pack.lens.concept;
    chipNow.textContent = pack.lens.now;
    chipPost.textContent = pack.lens.post;

    chipConcept.classList.toggle("active", time==="origin");
    chipNow.classList.toggle("active", time==="now");
    chipPost.classList.toggle("active", time==="post");
  }

  // content (hub explanations vary by style/time)
  var CONTENT={
    north:{
      origin:{
        formal:{title:"NORTH", b1:{h:"Definition",p:"North defines invariant structure: what must remain true.",u:["Names are stable.","Routes are stable.","Keys are canonical.","Meaning anchors here."]},
                                b2:{h:"How to use",p:"Use North when you need definitions and constraints.",u:["What is allowed.","What is forbidden.","What cannot drift.","What stays constant."]},
                                b3:{h:"What to expect",p:"Content is precise and contract-driven.",u:["Clear terms.","Clear bounds.","Clear mapping.","Clear return paths."]},
                                b4:{h:"Implication",p:"North prevents confusion by stabilizing the map.",u:["Less drift.","Less ambiguity.","More trust.","More speed."]}},
        informal:{title:"NORTH", b1:{h:"Meaning",p:"North is your anchor.",u:["Keeps you oriented.","Keeps labels stable.","Keeps rules clear.","Keeps drift out."]},
                                b2:{h:"Use it for",p:"Definitions and the ‘what’ layer.",u:["What it is.","What it isn’t.","What’s allowed.","What’s stable."]},
                                b3:{h:"Expect",p:"Short, direct explanations.",u:["No fluff.","Just clarity.","Just bounds.","Just return."]},
                                b4:{h:"Result",p:"You stop getting lost.",u:["Faster navigation.","Cleaner decisions.","Stable context.","Calmer mind."]}}
      },
      now:{
        formal:{title:"NORTH", b1:{h:"Now",p:"North stabilizes current position: it keeps the live system coherent.",u:["Live pages uniform.","Modal contract holds.","State propagates.","No collisions."]},
                              b2:{h:"Checks",p:"Verify consistency whenever you add a page.",u:["Same gem style.","Same modal lensing.","Same dock.","Same keys."]},
                              b3:{h:"Operator rule",p:"If something breaks, diagnose deterministically.",u:["Check routes.","Check CSS order.","Check gd_* keys.","Check view-source."]},
                              b4:{h:"Implication",p:"North is operational: it governs system integrity.",u:["No broken flows.","No drift.","No ambiguity.","No silent changes."]}},
        informal:{title:"NORTH", b1:{h:"Now",p:"North keeps things stable right now.",u:["Same look.","Same feel.","Same rules.","Same returns."]},
                              b2:{h:"Do",p:"Clone what works.",u:["Copy gem pages.","Keep keys.","Keep dock.","Keep modal."]},
                              b3:{h:"Don’t",p:"Don’t redesign mid-build.",u:["No new paradigms.","No random CSS.","No mixed keys.","No drift."]},
                              b4:{h:"Result",p:"Everything stays coherent.",u:["Faster build.","Less stress.","More progress.","More confidence."]}}
      },
      post:{
        formal:{title:"NORTH", b1:{h:"Post",p:"North becomes the reference library for the whole site.",u:["Glossaries.","Registries.","Standards.","Canonical definitions."]},
                               b2:{h:"Scaling",p:"Uniformity is what makes growth safe.",u:["Clone pages.","Add depth.","Never break contract.","Never drift keys."]},
                               b3:{h:"Audit",p:"North enables proof-grade structure.",u:["Deterministic logs.","Stable routing.","Evidence anchors.","Time-stamped changes."]},
                               b4:{h:"Outcome",p:"Public-safe navigation emerges from invariant structure.",u:["Predictable UI.","Clear meaning.","Safe exploration.","Enterprise-ready."]}},
        informal:{title:"NORTH", b1:{h:"Post",p:"North becomes the reference section.",u:["Definitions.","Rules.","Glossary.","Anchors."]},
                               b2:{h:"Scale",p:"Grow by cloning.",u:["Same pages.","More depth.","Same contract.","No drift."]},
                               b3:{h:"Proof",p:"Make it verifiable.",u:["Logs.","Anchors.","History.","Checks."]},
                               b4:{h:"Result",p:"Safe for the public.",u:["Predictable.","Clear.","Stable.","Trustable."]}}
      }
    },
    east:{
      origin:{
        formal:{title:"EAST", b1:{h:"Definition",p:"East maps execution pathways: how things move through the system.",u:["Workflows.","Routes.","Surfaces.","Applied examples."]},
                                b2:{h:"How to use",p:"Use East to find ‘how it works’ in practice.",u:["Step sequences.","Operational interfaces.","Implementation patterns.","Repeatable flows."]},
                                b3:{h:"What to expect",p:"Concrete examples and system surfaces.",u:["Products pages.","Demos.","Workflows.","Integrations."]},
                                b4:{h:"Implication",p:"East turns structure into action.",u:["Faster execution.","Less friction.","Clear next steps.","Measurable outputs."]}},
        informal:{title:"EAST", b1:{h:"Meaning",p:"East is how you move.",u:["Execution.","Doing.","Workflow.","Momentum."]},
                                b2:{h:"Use it for",p:"Practical steps and tools.",u:["Products.","Demos.","How-to flows.","Real examples."]},
                                b3:{h:"Expect",p:"Less theory, more action.",u:["Short steps.","Clear clicks.","Clear routes.","Clear outputs."]},
                                b4:{h:"Result",p:"You go from idea to execution.",u:["Faster progress.","Less confusion.","More momentum.","More wins."]}}
      },
      now:{
        formal:{title:"EAST", b1:{h:"Now",p:"East is live as product sub-hubs with uniform gem behavior.",u:["Diamond-of-diamonds.","Centered modal.","Lens chips inside.","Dense bulletins."]},
                              b2:{h:"Routing",p:"All routes propagate gd_lang/gd_style/gd_time.",u:["Query propagation.","LocalStorage persistence.","No silent overrides.","Fallback rules."]},
                              b3:{h:"Operator rule",p:"Every new execution surface copies the same contract.",u:["Same layout.","Same modal grid.","Same lensing.","Same dock."]},
                              b4:{h:"Implication",p:"East becomes a scalable execution catalog.",u:["Fast browsing.","Deep dives.","Stable returns.","Public safe."]}},
        informal:{title:"EAST", b1:{h:"Now",p:"East is working as product pages.",u:["Same gems.","Same modals.","Same lenses.","Same dock."]},
                              b2:{h:"Rule",p:"Carry state everywhere.",u:["Language sticks.","Style sticks.","Time sticks.","No drift."]},
                              b3:{h:"Build",p:"Clone the pattern.",u:["Copy file.","Swap content.","Keep contract.","Ship."]},
                              b4:{h:"Result",p:"Execution stays clean.",u:["Faster build.","Less bugs.","More pages.","More value."]}}
      },
      post:{
        formal:{title:"EAST", b1:{h:"Post",p:"East expands into demos and live simulations tied to standards.",u:["HIP demos.","Registry lookup.","Score dashboards.","Staged rollout sims."]},
                               b2:{h:"Depth",p:"Execution surfaces gain deeper leaf nodes and exports.",u:["Fruits.","Resolutions.","Exports.","Evidence bundles."]},
                               b3:{h:"Enterprise",p:"East becomes the interface for institutional adoption.",u:["Governance.","Underwriting.","Compliance.","Operations."]},
                               b4:{h:"Outcome",p:"Traversal becomes the operating system for learning and doing.",u:["Faster onboarding.","Less drift.","More coherence.","Higher trust."]}},
        informal:{title:"EAST", b1:{h:"Post",p:"More demos, more tools.",u:["Sims.","Dashboards.","Lookups.","Exports."]},
                               b2:{h:"Depth",p:"More leaf nodes.",u:["Fruits.","Resolutions.","Bundles.","Proof."]},
                               b3:{h:"Enterprise",p:"Real adoption surfaces.",u:["Governance.","Compliance.","Ops.","Capital."]},
                               b4:{h:"Result",p:"People learn by doing.",u:["Faster.","Clearer.","Stable.","Trustable."]}}
      }
    },
    south:{
      origin:{
        formal:{title:"SOUTH", b1:{h:"Definition",p:"South is convergence pressure: constraints that force alignment.",u:["Gates.","Thresholds.","Discipline.","No-drift rules."]},
                                b2:{h:"How to use",p:"Use South to understand why some actions are disallowed.",u:["Guardrails.","Deterministic resolution.","Rollback discipline.","Audit latency discipline."]},
                                b3:{h:"What to expect",p:"Rules, standards, and enforcement language.",u:["Laws pages.","Certification charter.","Gate vectors.","Reason codes."]},
                                b4:{h:"Implication",p:"South prevents collapse by enforcing constraint.",u:["Lower blast radius.","Less common-mode risk.","Safer changes.","More resilience."]}},
        informal:{title:"SOUTH", b1:{h:"Meaning",p:"South pushes.",u:["Pressure.","Constraint.","Discipline.","Force."]},
                                b2:{h:"Use it for",p:"Rules and guardrails.",u:["What’s allowed.","What’s blocked.","Why it matters.","What to fix."]},
                                b3:{h:"Expect",p:"Firm boundaries.",u:["Clear guardrails.","No drift.","Deterministic behavior.","Stable outcomes."]},
                                b4:{h:"Result",p:"You don’t break the system.",u:["Safer changes.","Fewer mistakes.","Less chaos.","More confidence."]}}
      },
      now:{
        formal:{title:"SOUTH", b1:{h:"Now",p:"South is enforced by the site contract and by standards content.",u:["Modal contract.","Key contract.","CSS ownership.","No drift rules."]},
                              b2:{h:"Site safety",p:"This prevents deployment-layer chaos from UI drift.",u:["Same assets.","Same geometry owner.","Same backgrounds.","No page overrides."]},
                              b3:{h:"Content safety",p:"This prevents ‘pretty but empty’ pages.",u:["Dense bulletins.","Lens-aware changes.","Dual language.","No empties."]},
                              b4:{h:"Implication",p:"South is the reason you can scale safely.",u:["Faster building.","Fewer regressions.","More uniformity.","More trust."]}},
        informal:{title:"SOUTH", b1:{h:"Now",p:"South keeps the build safe.",u:["Rules.","Contracts.","No drift.","No chaos."]},
                              b2:{h:"Prevents",p:"UI drift and broken pages.",u:["Same assets.","Same geometry.","Same keys.","Same behavior."]},
                              b3:{h:"Content",p:"No empty bubbles.",u:["Dense bullets.","Real meaning.","Lens-aware.","Dual language."]},
                              b4:{h:"Result",p:"You can scale fast.",u:["Clone.","Ship.","Repeat.","Stay stable."]}}
      },
      post:{
        formal:{title:"SOUTH", b1:{h:"Post",p:"South becomes the standards enforcement layer (CARES/HIP/UCI).",u:["Certification tiers.","Revocation rules.","Audit discipline.","Red-team harnesses."]},
                               b2:{h:"Integration",p:"Constraints map into products and dashboards.",u:["Gate checks.","Score output.","Registry lookups.","Alerts."]},
                               b3:{h:"Governance",p:"Separation of powers prevents capture.",u:["Engineering vs issuance.","Commercial vs thresholds.","Audit vs tuning.","Public logging."]},
                               b4:{h:"Outcome",p:"Constraint makes the system durable under stress.",u:["Stable growth.","Lower correlation.","Higher safety.","Enterprise readiness."]}},
        informal:{title:"SOUTH", b1:{h:"Post",p:"South is the standards layer.",u:["Rules.","Tiers.","Audits.","Red-team."]},
                               b2:{h:"Connects",p:"It ties into products and gauges.",u:["Checks.","Scores.","Lookups.","Alerts."]},
                               b3:{h:"Governance",p:"No capture.",u:["Separation.","Logs.","Locks.","Audits."]},
                               b4:{h:"Result",p:"Durable under stress.",u:["Stable.","Safe.","Trustable.","Ready."]}}
      }
    },
    west:{
      origin:{
        formal:{title:"WEST", b1:{h:"Definition",p:"West is containment: boundaries that prevent spread.",u:["Segmentation.","Rollback.","Zone independence.","Blast-radius limits."]},
                                b2:{h:"How to use",p:"Use West to understand the protection logic.",u:["What is isolated.","What can fail safely.","What gets rolled back.","What gets audited."]},
                                b3:{h:"What to expect",p:"Integrity, safety, and anti-gaming rules.",u:["EffectiveSegZones.","Wave caps.","Unknown quotas.","Anti-splitting."]},
                                b4:{h:"Implication",p:"West protects system integrity.",u:["Lower correlated risk.","Less damage.","Faster recovery.","Higher resilience."]}},
        informal:{title:"WEST", b1:{h:"Meaning",p:"West keeps things tight.",u:["Containment.","Boundaries.","Safety.","Control."]},
                                b2:{h:"Use it for",p:"Protection logic.",u:["Segmentation.","Rollback.","Limits.","Audits."]},
                                b3:{h:"Expect",p:"Clear containment rules.",u:["What’s isolated.","What’s capped.","What’s reversible.","What’s logged."]},
                                b4:{h:"Result",p:"Failures don’t spread.",u:["Less damage.","Faster recovery.","More stability.","More trust."]}}
      },
      now:{
        formal:{title:"WEST", b1:{h:"Now",p:"West is present as UI containment and state containment.",u:["Centered modals.","Backdrop blocks drift.","No scroll jump.","Return deterministic."]},
                              b2:{h:"Routing containment",p:"State propagates without multiplying forks.",u:["One language fork.","One key namespace.","No duplicates.","No collisions."]},
                              b3:{h:"Content containment",p:"Dense bulletins prevent ambiguous interpretations.",u:["More explicit info.","Less guessing.","Better decisions.","Less drift."]},
                              b4:{h:"Implication",p:"West keeps the build defensible as it scales.",u:["Lower regressions.","Higher uniformity.","Cleaner updates.","More stability."]}},
        informal:{title:"WEST", b1:{h:"Now",p:"West keeps the UI contained.",u:["Centered modal.","Backdrop.","No jump.","Return works."]},
                              b2:{h:"State",p:"No fork explosions.",u:["One language fork.","One key set.","No duplicates.","No collisions."]},
                              b3:{h:"Content",p:"No ambiguity.",u:["Dense bullets.","Clear meaning.","Less guessing.","Less drift."]},
                              b4:{h:"Result",p:"Stable scaling.",u:["Less bugs.","More uniformity.","Faster building.","Calmer."]}}
      },
      post:{
        formal:{title:"WEST", b1:{h:"Post",p:"West becomes formal containment logic across products.",u:["Seg zone calculators.","Rollback enforcement.","Audit latency checks.","Risk suppression."]},
                               b2:{h:"Dashboards",p:"Containment becomes visible and measurable.",u:["Blast radius sims.","Gate dashboards.","Trend views.","Alerts."]},
                               b3:{h:"Certification",p:"Containment compliance becomes certifiable.",u:["Tiering.","Revocation.","Evidence bundles.","Registry lookups."]},
                               b4:{h:"Outcome",p:"West is the reason scaling doesn’t collapse into chaos.",u:["Stable growth.","Lower correlation.","Higher resilience.","Public safety."]}},
        informal:{title:"WEST", b1:{h:"Post",p:"West becomes real containment logic.",u:["Seg zones.","Rollback.","Audit checks.","Suppression."]},
                               b2:{h:"Visibility",p:"You can see containment.",u:["Sims.","Dashboards.","Trends.","Alerts."]},
                               b3:{h:"Proof",p:"You can certify it.",u:["Tiers.","Registry.","Evidence.","Status."]},
                               b4:{h:"Result",p:"Scale without chaos.",u:["Stable.","Safe.","Resilient.","Ready."]}}
      }
    }
  };

  // MAP content (lens-agnostic)
  function mapView(){
    var m = pack.map;
    return {
      title:m.title,
      b1:m.b1, b2:m.b2, b3:m.b3, b4:m.b4
    };
  }

  function persist(){
    try{ localStorage.setItem("gd_style", style); localStorage.setItem("gd_time", time);}catch(e){}
  }
  function setLensLabels(){
    styleChip.textContent = "STYLE: " + (style==="formal" ? pack.lens.formal : pack.lens.informal);
    chipConcept.textContent = pack.lens.concept;
    chipNow.textContent = pack.lens.now;
    chipPost.textContent = pack.lens.post;
    chipConcept.classList.toggle("active", time==="origin");
    chipNow.classList.toggle("active", time==="now");
    chipPost.classList.toggle("active", time==="post");
  }

  var active=null; // 'north'|'east'|'south'|'west'|'map'

  function fill(hEl,pEl,uEl,b){
    hEl.textContent=b.h; pEl.textContent=b.p; uEl.innerHTML="";
    b.u.forEach(function(x){ var li=document.createElement("li"); li.textContent=x; uEl.appendChild(li); });
  }

  function render(){
    setLinks();
    setLensLabels();
    persist();

    var view;
    if(active==="map"){
      view = mapView();
      mTitle.textContent = view.title;
      fill(h1,p1,u1,view.b1);
      fill(h2,p2,u2,view.b2);
      fill(h3,p3,u3,view.b3);
      fill(h4,p4,u4,view.b4);
      return;
    }

    var v = CONTENT[active][time][style];
    mTitle.textContent = v.title;
    fill(h1,p1,u1,v.b1);
    fill(h2,p2,u2,v.b2);
    fill(h3,p3,u3,v.b3);
    fill(h4,p4,u4,v.b4);
  }

  function setActiveDiamond(id){
    ["north","east","south","west"].forEach(function(x){
      document.getElementById(x).classList.toggle("active", x===id);
    });
  }

  function open(which){
    active=which;
    if(which==="map"){ setActiveDiamond("__none__"); }
    else setActiveDiamond(which);
    render();
    bd.classList.add("show");
    modal.classList.add("show");
  }

  function close(){
    bd.classList.remove("show");
    modal.classList.remove("show");
    setActiveDiamond("__none__");
    active=null;
  }

  // click handlers
  ["north","east","south","west"].forEach(function(id){
    var el=document.getElementById(id);
    el.onclick=function(){ open(id); };
    el.onkeydown=function(e){ if(e.key==="Enter"||e.key===" "){ e.preventDefault(); open(id);} };
  });

  document.getElementById("btnMap").onclick=function(){ open("map"); };

  bd.onclick=close;
  mClose.onclick=close;
  document.getElementById("mReturn").onclick=close;

  // lens buttons (inside modal)
  styleChip.onclick=function(){
    style = (style==="formal") ? "informal" : "formal";
    render();
  };
  chipConcept.onclick=function(){ time="origin"; render(); };
  chipNow.onclick=function(){ time="now"; render(); };
  chipPost.onclick=function(){ time="post"; render(); };

  // initialize static labels + links
  setLinks();
  setLensLabels();
})();
</script>

</body>
</html>

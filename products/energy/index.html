<!-- TNT — /products/energy/index.html  (ENERGY · SLICE LOCK v1 · CONCEPT→CAUSE + LIVE→EFFECT)
     CHANGE (logic-only, no visual drift to diamonds):
       - Enforce pairing:
           TIME=CONCEPT => DIR forced to CAUSE (EFFECT disabled + greyed)
           TIME=LIVE    => DIR forced to EFFECT (CAUSE disabled + greyed)
       - ROADMAP remains selectable and does NOT force DIR (unchanged for now)
       - LENS drawer stays on its own tab (LENS/READING)
       - After choosing lens + OPEN ALL, you can switch to READING and hide lens panel
       - Multi-open allowed only within same lens state; lens change collapses openSet
       - Tap-unbreakable diamonds preserved (inline onclick + safe opener)
       - Pearlescent diamond layer preserved

     CONTENT:
       - Uses the same Concept paragraphs already injected.
       - Live/roadmap paragraphs still show as pending placeholders (until Player 6/7).
-->

<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>PRODUCTS · ENERGY</title>

<link rel="stylesheet" href="/assets/ui.css"/>
<link rel="stylesheet" href="/assets/branch.css"/>

<style>
:root{--R:150px;--D:188px;--goldSoft:rgba(212,175,55,.55);--mut:rgba(255,255,255,.90);--mut2:rgba(255,255,255,.72)}
body{margin:0;color:#fff;font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif}
a{text-decoration:none;color:inherit}
body::before,body::after{pointer-events:none!important}
.top-left{position:fixed;left:16px;top:16px;z-index:130;display:flex;gap:10px;flex-wrap:wrap;align-items:center}
.btn{padding:10px 16px;border-radius:14px;background:linear-gradient(145deg, rgba(12,22,38,.92), rgba(7,11,18,.95));color:#fff;border:1px solid rgba(255,255,255,.10);box-shadow:0 14px 36px rgba(0,0,0,.70);cursor:pointer;font-weight:900;letter-spacing:.2px;-webkit-tap-highlight-color:transparent}
.btn:hover{box-shadow:0 18px 50px rgba(0,0,0,.90),0 0 14px rgba(212,175,55,.18)}
.brand{position:fixed;left:50%;top:16px;transform:translateX(-50%);z-index:120;text-align:center;padding:10px 18px;border-radius:999px;border:1px solid rgba(255,255,255,.12);background:rgba(0,0,0,.18);pointer-events:none}
.brand .t{font-weight:950;font-size:42px;letter-spacing:.3px;line-height:1.02;margin:0}
.brand .s{opacity:.85;font-size:14px;margin:6px 0 0;line-height:1.25}
.stage{position:fixed;left:50%;top:56%;transform:translate(-50%,-50%);width:min(720px,94vw);height:min(720px,94vw);z-index:60}
.outer{position:absolute;left:50%;top:50%;width:min(680px,92vw);height:min(680px,92vw);transform:translate(-50%,-50%) rotate(45deg);border-radius:60px;background:radial-gradient(circle at 30% 25%, rgba(255,255,255,.08), transparent 55%),radial-gradient(circle at 70% 80%, rgba(0,80,255,.14), transparent 60%),linear-gradient(160deg, rgba(14,24,40,.42) 0%, rgba(7,11,18,.58) 70%);border:1px solid rgba(255,255,255,.10);box-shadow:0 90px 260px rgba(0,0,0,.55),inset 0 2px 0 rgba(255,255,255,.10),inset 0 -50px 90px rgba(0,0,0,.55);opacity:.62;pointer-events:none}
.outer::after{content:"";position:absolute;inset:0;border-radius:60px;background:repeating-conic-gradient(from 0deg, rgba(255,255,255,.04) 0deg 6deg, transparent 6deg 18deg);opacity:.12;pointer-events:none}

/* PEARLESCENT DIAMOND (LOCKED) */
.d{width:var(--D);height:var(--D);position:absolute;left:50%;top:50%;transform-origin:center;border-radius:28px;cursor:pointer;pointer-events:auto;touch-action:manipulation;-webkit-tap-highlight-color:transparent;background:radial-gradient(circle at 30% 22%, rgba(255,255,255,.48), transparent 48%),radial-gradient(circle at 72% 78%, rgba(0,120,255,.28), transparent 60%),radial-gradient(circle at 46% 56%, rgba(255,255,255,.08), transparent 70%),linear-gradient(160deg, rgba(12,22,38,.96), rgba(6,10,16,.98));border:1px solid rgba(255,255,255,.18);box-shadow:0 42px 130px rgba(0,0,0,.88),0 0 38px rgba(212,175,55,.32),inset 0 2px 0 rgba(255,255,255,.24),inset 0 -44px 80px rgba(0,0,0,.80);transition:transform .18s ease, box-shadow .18s ease, border-color .18s ease}
.d::before{content:"";position:absolute;inset:0;border-radius:28px;padding:1px;background:linear-gradient(120deg, transparent 0%, var(--goldSoft) 50%, transparent 100%);opacity:.75;-webkit-mask:linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);-webkit-mask-composite:xor;mask-composite:exclude;pointer-events:none}
.d::after{content:"";position:absolute;left:10%;right:10%;top:10%;height:28%;border-radius:999px;background:linear-gradient(to bottom, rgba(255,255,255,.30), rgba(255,255,255,0));transform:rotate(-10deg);pointer-events:none}
.d:hover{border-color:rgba(212,175,55,.40);box-shadow:0 46px 150px rgba(0,0,0,.92),0 0 46px rgba(212,175,55,.38),inset 0 2px 0 rgba(255,255,255,.26),inset 0 -48px 86px rgba(0,0,0,.84);transform:translate(-50%,-50%) rotate(45deg) scale(1.03)}
.d:active{transform:translate(-50%,-50%) rotate(45deg) scale(.99)}
.d-n{transform:translate(-50%,-50%) translate(0, calc(var(--R)*-1)) rotate(45deg)}
.d-e{transform:translate(-50%,-50%) translate(var(--R),0) rotate(45deg)}
.d-s{transform:translate(-50%,-50%) translate(0,var(--R)) rotate(45deg)}
.d-w{transform:translate(-50%,-50%) translate(calc(var(--R)*-1),0) rotate(45deg)}
.inner{transform:rotate(-45deg) translateY(-4px);display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;height:100%;padding:14px;gap:8px;pointer-events:none}
.lab{font-weight:950;font-size:18px;letter-spacing:.5px;text-shadow:0 0 14px rgba(255,255,255,.18)}
.sub{font-size:13px;opacity:.90;max-width:18em;line-height:1.25}

.core{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:64px;height:64px;border-radius:18px;border:1px solid rgba(255,255,255,.10);background:rgba(0,0,0,.18);box-shadow:0 18px 44px rgba(0,0,0,.55), inset 0 2px 0 rgba(255,255,255,.10);display:grid;place-items:center;font-weight:950;letter-spacing:.5px;opacity:.92;pointer-events:none}
.dock{position:fixed;left:50%;bottom:max(12px, env(safe-area-inset-bottom));transform:translateX(-50%);z-index:120;width:min(980px,94vw);display:flex;justify-content:center;gap:10px;flex-wrap:wrap;padding:10px 12px;border-radius:999px;border:1px solid rgba(255,255,255,.10);background:rgba(0,0,0,.18);pointer-events:none}
.dock .btn{pointer-events:auto}

/* Modal */
.bd{position:fixed;inset:0;z-index:200;background:rgba(0,0,0,.72);backdrop-filter:blur(10px);display:none}
.bd.show{display:block}
.modal{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);width:min(1180px,96vw);height:90vh;display:none;z-index:210}
.modal.show{display:block}
.shell{height:90vh;border-radius:22px;border:1px solid rgba(255,255,255,.14);background:linear-gradient(160deg, rgba(10,18,30,.96), rgba(6,10,16,.98));overflow:hidden;display:flex;flex-direction:column}
.mhead{display:flex;justify-content:space-between;align-items:center;gap:10px;padding:14px 16px;border-bottom:1px solid rgba(255,255,255,.08)}
.mtitle{margin:0;font-weight:950;letter-spacing:.3px;font-size:16px}
.mclose{border:0;background:transparent;color:#fff;font-size:18px;cursor:pointer;padding:8px 10px}
.mbody{padding:0;overflow:auto;-webkit-overflow-scrolling:touch;flex:1 1 auto}

/* Lens drawer */
.drawerBar{position:sticky;top:0;z-index:40;background:rgba(0,0,0,.62);border-bottom:1px solid rgba(255,255,255,.08);padding:12px 12px 10px}
.drawerTabRow{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin:0 0 10px}
.tabpill{padding:10px 16px;border-radius:999px;background:linear-gradient(145deg, rgba(17,22,28,.92), rgba(11,15,20,.96));border:1px solid rgba(255,255,255,.10);box-shadow:0 14px 36px rgba(0,0,0,.65);cursor:pointer;font-weight:950;letter-spacing:.2px;color:#fff;-webkit-tap-highlight-color:transparent}
.tabpill.active{border-color:rgba(212,175,55,.55);box-shadow:0 18px 50px rgba(0,0,0,.9), 0 0 14px rgba(212,175,55,.22)}
.tabpill.ghost{opacity:.90}
.drawerPanel{display:none;padding:10px 0 0}
.drawerPanel.show{display:block}

.row{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin:0 0 10px}
.cluster{display:flex;gap:8px;align-items:center;padding:8px;border-radius:999px;border:1px solid rgba(255,255,255,.10);background:rgba(0,0,0,.14)}
.tag{font-size:11px;letter-spacing:1.6px;opacity:.75;text-transform:uppercase;padding:0 8px 0 6px}
.pill{padding:10px 14px;border-radius:999px;background:linear-gradient(145deg, rgba(17,22,28,.92), rgba(11,15,20,.96));border:1px solid rgba(255,255,255,.10);box-shadow:0 14px 36px rgba(0,0,0,.65);cursor:pointer;font-weight:900;letter-spacing:.2px;color:#fff;user-select:none;-webkit-tap-highlight-color:transparent}
.pill.active{border-color:rgba(212,175,55,.55);box-shadow:0 18px 50px rgba(0,0,0,.9), 0 0 14px rgba(212,175,55,.22)}
.pill.disabled{opacity:.28;filter:grayscale(1);pointer-events:none}

.hcard{max-width:980px;margin:0 auto;padding:12px 14px;border-radius:18px;background:rgba(0,0,0,.18);border:1px solid rgba(255,255,255,.10)}
.h1{margin:0 0 4px;font-weight:950;font-size:14px}
.h2{margin:0;color:var(--mut);line-height:1.45;font-size:12.5px}
.h3{margin:8px 0 0;color:rgba(255,255,255,.70);font-size:12px;line-height:1.35}

.content{padding:14px 16px 18px}
.list{max-width:980px;margin:0 auto;display:flex;flex-direction:column;gap:12px}
.bub{border:1px solid rgba(255,255,255,.10);border-radius:22px;background:linear-gradient(145deg, rgba(17,22,28,.86), rgba(11,15,20,.92));box-shadow:0 16px 52px rgba(0,0,0,.60);overflow:hidden}
.bub.open{box-shadow:0 18px 60px rgba(0,0,0,.72), 0 0 26px rgba(212,175,55,.12)}
.bhead{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:14px 16px;cursor:pointer;-webkit-tap-highlight-color:transparent}
.btitle{font-weight:950;letter-spacing:.2px;font-size:14px}
.bmini{font-size:12px;opacity:.72;line-height:1.25}
.bchev{font-size:16px;opacity:.75}
.bbody{display:none;padding:14px 16px 12px;border-top:1px solid rgba(255,255,255,.08);background:radial-gradient(circle at 30% 30%, rgba(255,255,255,.06), transparent 55%),linear-gradient(145deg, rgba(12,22,38,.86), rgba(7,11,18,.92))}
.bub.open .bbody{display:block}
.p{margin:0;color:var(--mut2);line-height:1.58}

.ipanels{display:flex;flex-direction:column;gap:10px}
.ip{border:1px solid rgba(255,255,255,.08);border-radius:18px;background:rgba(0,0,0,.12);padding:10px 12px}
.iph{margin:0 0 6px;font-weight:950;font-size:12px;letter-spacing:.25px;opacity:.92}
.ipt{margin:0;color:var(--mut2);line-height:1.58}

.mact{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:14px}
.sbtn{padding:12px 18px;border-radius:14px;background:linear-gradient(145deg, rgba(12,22,38,.92), rgba(7,11,18,.95));color:#fff;border:1px solid rgba(255,255,255,.10);box-shadow:0 14px 36px rgba(0,0,0,.7);cursor:pointer;font-weight:900;letter-spacing:.2px;text-decoration:none}

@media (max-width:560px){:root{--R:136px;--D:176px}.stage{top:58%}.brand .t{font-size:38px}}
</style>
</head>

<body>

<div class="top-left">
  <a class="btn" id="btnBack" href="/products/">BACK</a>
  <a class="btn" id="btnExit" href="/door/">EXIT</a>
</div>

<div class="brand" aria-hidden="true">
  <div class="t">Energy</div>
  <div class="s">Industrial Plasma · Structured Expansion</div>
</div>

<div class="stage" aria-label="Energy 4-way gateway">
  <div class="outer"></div>

  <div class="d d-n" id="dFoundation" role="button" tabindex="0" onclick="window.__openEnergyModal('FOUNDATION')">
    <div class="inner"><div class="lab">FOUNDATION</div><div class="sub">Baseline & bounds.</div></div>
  </div>
  <div class="d d-e" id="dArchitecture" role="button" tabindex="0" onclick="window.__openEnergyModal('ARCHITECTURE')">
    <div class="inner"><div class="lab">ARCHITECTURE</div><div class="sub">Interfaces & modules.</div></div>
  </div>
  <div class="d d-s" id="dPerformance" role="button" tabindex="0" onclick="window.__openEnergyModal('PERFORMANCE')">
    <div class="inner"><div class="lab">PERFORMANCE</div><div class="sub">Measured bands.</div></div>
  </div>
  <div class="d d-w" id="dGovernance" role="button" tabindex="0" onclick="window.__openEnergyModal('GOVERNANCE')">
    <div class="inner"><div class="lab">GOVERNANCE</div><div class="sub">Scale discipline.</div></div>
  </div>

  <div class="core">◆</div>
</div>

<nav class="dock" aria-label="Bottom navigation">
  <a class="btn" id="dockTerminal" href="/index.html">TERMINAL</a>
  <a class="btn" id="dockHome" href="/home/">HUB</a>
  <a class="btn" id="dockProducts" href="/products/">PRODUCTS</a>
  <a class="btn" id="dockLaws" href="/laws/">LAWS</a>
  <a class="btn" id="dockLinks" href="/links/">LINKS</a>
</nav>

<div class="bd" id="bd"></div>

<div class="modal" id="modal" role="dialog" aria-modal="true">
  <div class="shell">
    <div class="mhead">
      <h3 class="mtitle" id="mTitle">ENERGY</h3>
      <button class="mclose" id="mClose" aria-label="Close" type="button">✕</button>
    </div>

    <div class="mbody" id="mbody">

      <div class="drawerBar">
        <div class="drawerTabRow">
          <div class="tabpill active" id="tabLens" role="button" tabindex="0">LENS</div>
          <div class="tabpill ghost" id="tabReading" role="button" tabindex="0">READING</div>
        </div>

        <div class="drawerPanel show" id="lensPanel">
          <div class="row">
            <div class="cluster">
              <div class="tag">MODE</div>
              <div class="pill active" data-mode="lens">LENS</div>
              <div class="pill" data-mode="integrated">INTEGRATED</div>
            </div>
            <div class="cluster">
              <div class="tag">STYLE</div>
              <div class="pill active" data-style="formal">FORMAL</div>
              <div class="pill" data-style="informal">INFORMAL</div>
            </div>
            <div class="cluster" id="clusterTime">
              <div class="tag">TIME</div>
              <div class="pill active" data-time="concept" id="pillConcept">CONCEPT</div>
              <div class="pill" data-time="live" id="pillLive">LIVE</div>
              <div class="pill" data-time="roadmap" id="pillRoadmap">ROADMAP</div>
            </div>
            <div class="cluster" id="clusterDir">
              <div class="tag">DIR</div>
              <div class="pill active" data-dir="cause" id="pillCause">CAUSE</div>
              <div class="pill" data-dir="effect" id="pillEffect">EFFECT</div>
            </div>
            <div class="cluster">
              <div class="tag">BUBBLES</div>
              <div class="pill" id="openAll">OPEN ALL</div>
              <div class="pill" id="closeAll">CLOSE ALL</div>
            </div>
          </div>

          <div class="hcard">
            <div class="h1" id="h1">—</div>
            <div class="h2" id="h2">—</div>
            <div class="h3" id="h3">Public posture is Industrial thermal substitution (C). No net-positive fusion claim. Fusion readiness is requirements-only.</div>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="list" id="list"></div>

        <div class="mact">
          <button class="sbtn" id="mReturn" type="button">RETURN</button>
          <a class="sbtn" id="mFusion" href="/explore/fusion-readiness/">FUSION READINESS</a>
          <a class="sbtn" id="mJumpProducts" href="/products/">JUMP PRODUCTS</a>
          <a class="sbtn" id="mJumpHub" href="/home/">JUMP HUB</a>
        </div>
      </div>

    </div>
  </div>
</div>

<script>
window.__openEnergyModal = function(sec){
  try{
    var bd=document.getElementById("bd");
    var modal=document.getElementById("modal");
    if(!bd || !modal) return;
    bd.classList.add("show");
    modal.classList.add("show");
    window.__energy_section = sec || "FOUNDATION";
    if(typeof window.__energy_render_all === "function"){
      window.__energy_render_all(true);
    }
  }catch(e){}
};
</script>

<script>
(function(){
  try{
    const qs = new URLSearchParams(location.search);
    let lang  = qs.get("lang")  || localStorage.getItem("gd_lang")  || "en";
    let gdStyle = qs.get("style") || localStorage.getItem("gd_style") || "formal";
    let gdTime  = qs.get("time")  || localStorage.getItem("gd_time")  || "origin";
    if(!["en","zh"].includes(lang)) lang="en";
    if(!["formal","informal"].includes(gdStyle)) gdStyle="formal";
    if(gdTime==="trajectory") gdTime="post";
    if(!["origin","now","post"].includes(gdTime)) gdTime="origin";
    try{ localStorage.setItem("gd_lang",lang); localStorage.setItem("gd_style",gdStyle); localStorage.setItem("gd_time",gdTime);}catch(e){}
    document.documentElement.lang = (lang==="zh") ? "zh" : "en";

    function q(){ return "lang="+encodeURIComponent(lang)+"&style="+encodeURIComponent(gdStyle)+"&time="+encodeURIComponent(gdTime); }
    (function(){
      const s=q();
      document.getElementById("btnBack").href="/products/?"+s;
      document.getElementById("btnExit").href="/door/?"+s;
      document.getElementById("dockTerminal").href="/index.html?"+s;
      document.getElementById("dockHome").href="/home/?"+s;
      document.getElementById("dockProducts").href="/products/?"+s;
      document.getElementById("dockLaws").href="/laws/?"+s;
      document.getElementById("dockLinks").href="/links/?"+s;
      document.getElementById("mFusion").href="/explore/fusion-readiness/?"+s;
      document.getElementById("mJumpProducts").href="/products/?"+s;
      document.getElementById("mJumpHub").href="/home/?"+s;
    })();

    const DOMAINS = ["Engineering","Technology","Industrial","Environmental","Financial","Governance","Adversarial","Social","Medicine","Political","Legal","Historical Systems"];
    const ORDER = {
      FOUNDATION: ["Industrial","Engineering","Technology","Governance","Financial","Adversarial","Legal","Political","Environmental","Social","Medicine","Historical Systems"],
      ARCHITECTURE:["Engineering","Technology","Industrial","Governance","Adversarial","Financial","Legal","Political","Environmental","Social","Medicine","Historical Systems"],
      PERFORMANCE:["Industrial","Technology","Engineering","Financial","Governance","Adversarial","Environmental","Legal","Political","Social","Medicine","Historical Systems"],
      GOVERNANCE:["Governance","Legal","Adversarial","Political","Financial","Industrial","Technology","Engineering","Environmental","Social","Medicine","Historical Systems"]
    };

    let S = { mode:"lens", style:"formal", time:"concept", dir:"cause" };
    let section = "FOUNDATION";

    let openSet = new Set();
    let openKey = "";
    function lensKey(){ return [S.mode,S.style,S.time,S.dir,section].join("|"); }
    function resetOpenIfLensChanged(){
      const k = lensKey();
      if(k !== openKey){ openKey = k; openSet = new Set(); }
    }

    const tabLens=document.getElementById("tabLens");
    const tabReading=document.getElementById("tabReading");
    const lensPanel=document.getElementById("lensPanel");

    function showLens(){
      lensPanel.classList.add("show");
      tabLens.classList.add("active");
      tabReading.classList.remove("active");
    }
    function hideLens(){
      lensPanel.classList.remove("show");
      tabLens.classList.remove("active");
      tabReading.classList.add("active");
    }

    tabLens.addEventListener("click", showLens);
    tabReading.addEventListener("click", hideLens);
    tabLens.addEventListener("keydown",(e)=>{ if(e.key==="Enter"||e.key===" "){ e.preventDefault(); showLens(); }});
    tabReading.addEventListener("keydown",(e)=>{ if(e.key==="Enter"||e.key===" "){ e.preventDefault(); hideLens(); }});

    const pillConcept=document.getElementById("pillConcept");
    const pillLive=document.getElementById("pillLive");
    const pillRoadmap=document.getElementById("pillRoadmap");
    const pillCause=document.getElementById("pillCause");
    const pillEffect=document.getElementById("pillEffect");
    const clusterDir=document.getElementById("clusterDir");

    function enforceSlice(){
      // enforce Concept->Cause, Live->Effect, Roadmap free
      if(S.time==="concept"){ S.dir="cause"; }
      if(S.time==="live"){ S.dir="effect"; }

      // UI disable rules
      if(S.time==="concept"){
        pillCause.classList.remove("disabled");
        pillEffect.classList.add("disabled");
      } else if(S.time==="live"){
        pillCause.classList.add("disabled");
        pillEffect.classList.remove("disabled");
      } else { // roadmap
        pillCause.classList.remove("disabled");
        pillEffect.classList.remove("disabled");
      }

      // set active on forced dir
      document.querySelectorAll("[data-dir]").forEach(p=>p.classList.toggle("active", p.dataset.dir===S.dir));
    }

    // Content (same as prior Player 5 concept set + placeholders)
    const ARTICLE_LENS = {
      "Engineering":{
        formal:{
          concept:{cause:"Engineering causality begins at operational boundaries. Interface definitions precede throughput targets. Thermal routing must remain exchanger-mediated. Material tolerance governs admissible duty cycles. Isolation rules prevent endpoint exposure.",effect:"Boundary-first design produces predictable behavior. Ramp transitions remain within defined limits. Faults remain localized by interface isolation. Maintenance intervals become scheduleable. Replication remains coherent under audit."},
          live:{cause:"(LIVE pending) Player 6 injects live-cause engineering paragraph.",effect:"(LIVE pending) Player 6 injects live-effect engineering paragraph."},
          roadmap:{cause:"(ROADMAP pending) Player 7 injects roadmap-cause engineering paragraph.",effect:"(ROADMAP pending) Player 7 injects roadmap-effect engineering paragraph."}
        },
        informal:{
          concept:{cause:"Engineering starts where heat meets reality, not where slogans begin. Boundaries are the first product because they decide what can be repeated safely. Interfaces carry the stress that growth tries to hide. When those seams are defined, the whole system becomes calmer. That discipline is what keeps industrial posture honest.",effect:"When boundaries are real, performance stops feeling fragile. Ramps become boring in the best way because the system stays within rails. Failures shrink into local events instead of turning into dramas. Maintenance becomes planning instead of firefighting. That outcome is what makes scaling plausible."},
          live:{cause:"(LIVE pending) Player 6 injects live-cause engineering paragraph.",effect:"(LIVE pending) Player 6 injects live-effect engineering paragraph."},
          roadmap:{cause:"(ROADMAP pending) Player 7 injects roadmap-cause engineering paragraph.",effect:"(ROADMAP pending) Player 7 injects roadmap-effect engineering paragraph."}
        }
      },
      "Technology":{
        formal:{
          concept:{cause:"Technology causality originates in measurement integrity. Clock discipline defines event ordering. Logging completeness defines replay capability. Signal validation must reject artifacts. Automation remains subordinate to auditable data.",effect:"Integrity-first telemetry yields operational legibility. Anomalies surface through consistent baselines. Drift becomes detectable before escalation. Decisions reference receipts rather than narratives. Scaling preserves measurement authority."},
          live:{cause:"(LIVE pending) Player 6 injects live-cause technology paragraph.",effect:"(LIVE pending) Player 6 injects live-effect technology paragraph."},
          roadmap:{cause:"(ROADMAP pending) Player 7 injects roadmap-cause technology paragraph.",effect:"(ROADMAP pending) Player 7 injects roadmap-effect technology paragraph."}
        },
        informal:{
          concept:{cause:"Technology is the nervous system, and it cannot be allowed to hallucinate. If the clock drifts, the story drifts, and then the team starts arguing instead of operating. Logs are not paperwork here; they are the only trustworthy memory. Validation is how you keep excitement from outrunning reality. This is what makes the whole platform feel dependable.",effect:"When telemetry is honest, the room gets quieter. People stop guessing because the record can be replayed. Errors show up early instead of hiding inside averages. Decisions become measurable, not political. That is the difference between a dashboard and an instrument."},
          live:{cause:"(LIVE pending) Player 6 injects live-cause technology paragraph.",effect:"(LIVE pending) Player 6 injects live-effect technology paragraph."},
          roadmap:{cause:"(ROADMAP pending) Player 7 injects roadmap-cause technology paragraph.",effect:"(ROADMAP pending) Player 7 injects roadmap-effect technology paragraph."}
        }
      },
      "Industrial":{
        formal:{
          concept:{cause:"Industrial causality is dominated by throughput pressure. Ramp impatience destabilizes thermal systems. Buffer design prevents shock propagation. Isolation boundaries must be physically enforced. Contracts require measurable output bands.",effect:"Industrial discipline yields stable delivery. Heat output remains within declared tolerances. Adjacent systems avoid cascade coupling. Downtime remains localized by segmentation. Scaling proceeds by phase rather than impulse."},
          live:{cause:"(LIVE pending) Player 6 injects live-cause industrial paragraph.",effect:"(LIVE pending) Player 6 injects live-effect industrial paragraph."},
          roadmap:{cause:"(ROADMAP pending) Player 7 injects roadmap-cause industrial paragraph.",effect:"(ROADMAP pending) Player 7 injects roadmap-effect industrial paragraph."}
        },
        informal:{
          concept:{cause:"Industrial scale breaks what looks good on paper. The driver is always the same: pressure tempts shortcuts, and shortcuts weaken boundaries. Buffers exist because the grid and the plant do not forgive spikes. Contracts demand bands, not heroics, so variance must be treated as the real enemy. That is why operational discipline is the centerpiece of scale.",effect:"When industrial constraints are respected, everything becomes easier to trust. Output feels professional because it stays inside the band. Shutdowns stop being surprises and start being procedures. Insurance conversations get simpler because exposure is controlled. That stability is what makes replication real."},
          live:{cause:"(LIVE pending) Player 6 injects live-cause industrial paragraph.",effect:"(LIVE pending) Player 6 injects live-effect industrial paragraph."},
          roadmap:{cause:"(ROADMAP pending) Player 7 injects roadmap-cause industrial paragraph.",effect:"(ROADMAP pending) Player 7 injects roadmap-effect industrial paragraph."}
        }
      },
      "Environmental":{
        formal:{
          concept:{cause:"Environmental causality is boundary-coupling driven. Thermal exchange remains mediated and monitored. Discharge bands must be declared and metered. Buffer zones reduce correlated exposure. Compliance relies on auditable measurements.",effect:"Boundary mediation yields controlled impact profiles. Heat discharge remains within permitted ranges. Soil and water interfaces remain segregated. Reporting remains consistent under audit. Expansion is limited by verified compliance capacity."},
          live:{cause:"(LIVE pending) Player 6 injects live-cause environmental paragraph.",effect:"(LIVE pending) Player 6 injects live-effect environmental paragraph."},
          roadmap:{cause:"(ROADMAP pending) Player 7 injects roadmap-cause environmental paragraph.",effect:"(ROADMAP pending) Player 7 injects roadmap-effect environmental paragraph."}
        },
        informal:{
          concept:{cause:"The environment is where boundaries become non-negotiable. Heat will move, and if you don’t decide how, it will decide for you. So the design assumes mediation first: exchange, buffer, and measure. Discharge is treated as a controlled band, not a vague promise. That’s what keeps industrial progress compatible with the real world.",effect:"When mediation is real, impact becomes predictable instead of emotional. Interfaces stay separated, so drift does not travel into soil or water. Reports read like measurements because that is what they are. Communities relax when the system behaves the same way repeatedly. That outcome is the only scalable posture."},
          live:{cause:"(LIVE pending) Player 6 injects live-cause environmental paragraph.",effect:"(LIVE pending) Player 6 injects live-effect environmental paragraph."},
          roadmap:{cause:"(ROADMAP pending) Player 7 injects roadmap-cause environmental paragraph.",effect:"(ROADMAP pending) Player 7 injects roadmap-effect environmental paragraph."}
        }
      },
      "Financial":{
        formal:{
          concept:{cause:"Financial causality is volatility-driven. Insurance pricing follows measured risk tiers. Capital cost reflects uncertainty and drift. Cash flow must align with operational envelopes. Funding pace must match validated performance bands.",effect:"Tiered discipline stabilizes capital access. Underwriting aligns with measurable constraints. Reserve planning reduces shock sensitivity. Contract terms become predictable under audit. Scaling becomes financeable without narrative inflation."},
          live:{cause:"(LIVE pending) Player 6 injects live-cause financial paragraph.",effect:"(LIVE pending) Player 6 injects live-effect financial paragraph."},
          roadmap:{cause:"(ROADMAP pending) Player 7 injects roadmap-cause financial paragraph.",effect:"(ROADMAP pending) Player 7 injects roadmap-effect financial paragraph."}
        },
        informal:{
          concept:{cause:"Money doesn’t fear ambition; it fears uncertainty. Variance is what raises cost of capital, even when the story sounds good. Insurance tiers are the financial translation of engineering discipline. Cash flow becomes credible when output bands are credible. That’s why this system refuses to sell future gain to fund present scale.",effect:"When risk is bounded, financing becomes calmer. Underwriting stops being a debate and starts being a checklist. Reserves can be planned because surprises shrink. Contracts get simpler because the behavior is stable. That outcome is how you build a real runway."},
          live:{cause:"(LIVE pending) Player 6 injects live-cause financial paragraph.",effect:"(LIVE pending) Player 6 injects live-effect financial paragraph."},
          roadmap:{cause:"(ROADMAP pending) Player 7 injects roadmap-cause financial paragraph.",effect:"(ROADMAP pending) Player 7 injects roadmap-effect financial paragraph."}
        }
      },
      "Governance":{
        formal:{
          concept:{cause:"Governance causality is defined by non-retroactivity. Roles separate claim-making from measurement. Exceptions are logged and bounded. Escalation gates require receipts and disproof conditions. Oversight prevents convenience-driven drift.",effect:"Strict governance yields stable classification. Audits remain comparable across epochs. Disputes reduce because receipts dominate interpretation. Scaling becomes controllable under clear gates. Trust becomes a measurable outcome of consistency."},
          live:{cause:"(LIVE pending) Player 6 injects live-cause governance paragraph.",effect:"(LIVE pending) Player 6 injects live-effect governance paragraph."},
          roadmap:{cause:"(ROADMAP pending) Player 7 injects roadmap-cause governance paragraph.",effect:"(ROADMAP pending) Player 7 injects roadmap-effect governance paragraph."}
        },
        informal:{
          concept:{cause:"Governance exists because systems can talk themselves into anything. If definitions can move quietly, you can “win” without improving reality. That is why the rules are locked, the history is sealed, and exceptions are treated like toxins. Escalation is earned through receipts, not through persuasion. This keeps the industrial posture honest under scale pressure.",effect:"When governance holds, the whole platform feels safer. People stop arguing about what something meant because the record is stable. Conflicts turn into checks instead of fights. Growth stops being a trust gamble and becomes a procedural expansion. That outcome is the backbone of credibility."},
          live:{cause:"(LIVE pending) Player 6 injects live-cause governance paragraph.",effect:"(LIVE pending) Player 6 injects live-effect governance paragraph."},
          roadmap:{cause:"(ROADMAP pending) Player 7 injects roadmap-cause governance paragraph.",effect:"(ROADMAP pending) Player 7 injects roadmap-effect governance paragraph."}
        }
      },
      "Adversarial":{
        formal:{
          concept:{cause:"Adversarial causality assumes manipulation attempts. Attack surfaces scale with complexity. Telemetry must be tamper-evident by design. Least privilege constrains damage radius. Violations trigger deterministic invalidation.",effect:"Adversarial discipline yields resilient scaling. Manipulation becomes detectable through integrity breaks. Blast radius remains bounded by segmentation. Audit trails preserve causal truth. Systems remain defensible under hostile review."},
          live:{cause:"(LIVE pending) Player 6 injects live-cause adversarial paragraph.",effect:"(LIVE pending) Player 6 injects live-effect adversarial paragraph."},
          roadmap:{cause:"(ROADMAP pending) Player 7 injects roadmap-cause adversarial paragraph.",effect:"(ROADMAP pending) Player 7 injects roadmap-effect adversarial paragraph."}
        },
        informal:{
          concept:{cause:"If a system can be gamed, someone will eventually try. Incentives create attackers long before ideology does. That’s why integrity is engineered, not promised: chain the logs, cross-check the signals, and limit privileges. Exceptions are where laundering happens, so exceptions must be visible. This is what keeps the platform unmanipulable in practice.",effect:"When adversarial design is real, lies get expensive. Spoofing fails because redundancy disagrees. Quiet edits fail because the chain shows the cut. Recovery becomes procedural because failure modes are deterministic. Trust survives scrutiny because the system refuses ambiguity. That outcome is what makes scaling safe under pressure."},
          live:{cause:"(LIVE pending) Player 6 injects live-cause adversarial paragraph.",effect:"(LIVE pending) Player 6 injects live-effect adversarial paragraph."},
          roadmap:{cause:"(ROADMAP pending) Player 7 injects roadmap-cause adversarial paragraph.",effect:"(ROADMAP pending) Player 7 injects roadmap-effect adversarial paragraph."}
        }
      },
      "Social":{
        formal:{
          concept:{cause:"Social adoption causality is clarity-driven. Ambiguous claims increase skepticism and friction. Transparent constraints reduce rumor dynamics. Consistent language reduces misinterpretation. Trust emerges from bounded claims and repeatable evidence.",effect:"Clarity yields stable public expectations. Reduced confusion lowers resistance to adoption. Stakeholders can verify posture through receipts. Safety narratives remain consistent across audiences. Scaling becomes socially feasible through disciplined communication."},
          live:{cause:"(LIVE pending) Player 6 injects live-cause social paragraph.",effect:"(LIVE pending) Player 6 injects live-effect social paragraph."},
          roadmap:{cause:"(ROADMAP pending) Player 7 injects roadmap-cause social paragraph.",effect:"(ROADMAP pending) Player 7 injects roadmap-effect social paragraph."}
        },
        informal:{
          concept:{cause:"People don’t reject systems first; they reject confusion. If you overpromise, trust collapses fast, and if you under-explain, rumors fill the gap. So this platform is built to be legible: clear posture, clear bounds, clear receipts. The industrial claim stays clean because cleanliness reduces social friction. That is what keeps momentum from turning into backlash.",effect:"When the message is coherent, the room calms down. Questions become practical instead of adversarial. Sharing becomes safe because the page behaves predictably. Trust grows because behavior stays stable over time. That outcome is how adoption becomes durable."},
          live:{cause:"(LIVE pending) Player 6 injects live-cause social paragraph.",effect:"(LIVE pending) Player 6 injects live-effect social paragraph."},
          roadmap:{cause:"(ROADMAP pending) Player 7 injects roadmap-cause social paragraph.",effect:"(ROADMAP pending) Player 7 injects roadmap-effect social paragraph."}
        }
      },
      "Medicine":{
        formal:{
          concept:{cause:"Medical relevance is governed by exposure boundaries. High-energy regimes remain upstream-only by design. Risk models prefer passive endpoints over active sources. Monitoring and interlocks must be auditable. Health claims are excluded unless clinically validated.",effect:"Strict boundaries reduce exposure probability. Response procedures become deterministic and trained. Documentation supports medical oversight. Compliance reviews remain evidence-based. Adoption becomes feasible as infrastructure support, not clinical substitution."},
          live:{cause:"(LIVE pending) Player 6 injects live-cause medicine paragraph.",effect:"(LIVE pending) Player 6 injects live-effect medicine paragraph."},
          roadmap:{cause:"(ROADMAP pending) Player 7 injects roadmap-cause medicine paragraph.",effect:"(ROADMAP pending) Player 7 injects roadmap-effect medicine paragraph."}
        },
        informal:{
          concept:{cause:"Healthcare is where “probably safe” is still unsafe. The only admissible posture is isolation: upstream energy regimes never touch patient spaces. Endpoints must be passive, certified, and boring. Monitoring exists to prove safety, not to claim heroics. That is how you earn trust in a high-stakes environment.",effect:"When isolation is real, hospitals get benefits without exposure anxiety. Operations remain steady because the interface behaves predictably. Audits become routine because the record is complete. Staff confidence increases because failure modes are constrained. That outcome is what makes medical adoption possible without overreach."},
          live:{cause:"(LIVE pending) Player 6 injects live-cause medicine paragraph.",effect:"(LIVE pending) Player 6 injects live-effect medicine paragraph."},
          roadmap:{cause:"(ROADMAP pending) Player 7 injects roadmap-cause medicine paragraph.",effect:"(ROADMAP pending) Player 7 injects roadmap-effect medicine paragraph."}
        }
      },
      "Political":{
        formal:{
          concept:{cause:"Political stability depends on risk perception management. Overstated claims invite backlash and polarization. Transparent constraint statements reduce speculative narratives. Public classification must remain consistent under scrutiny. Policy engagement must be evidence-first and non-inflated.",effect:"Bounded posture reduces political volatility. Oversight becomes procedural rather than reactionary. Stakeholders align on measurable risk surfaces. Regulatory posture remains predictable. Deployment proceeds with reduced political friction."},
          live:{cause:"(LIVE pending) Player 6 injects live-cause political paragraph.",effect:"(LIVE pending) Player 6 injects live-effect political paragraph."},
          roadmap:{cause:"(ROADMAP pending) Player 7 injects roadmap-cause political paragraph.",effect:"(ROADMAP pending) Player 7 injects roadmap-effect political paragraph."}
        },
        informal:{
          concept:{cause:"Politics is what happens when people don’t trust the story. If you inflate claims, you create enemies for free and accelerate oversight resistance. If you stay bounded and measurable, you create room to operate. That is why industrial posture is the public anchor and fusion stays in a gated lane. Credibility is the political fuel.",effect:"When you speak in evidence, the noise drops. Oversight turns into checklists instead of fights. Partners can support adoption without gambling their reputation. Communities stop projecting motives because the record is stable. That outcome is how scale becomes politically feasible."},
          live:{cause:"(LIVE pending) Player 6 injects live-cause political paragraph.",effect:"(LIVE pending) Player 6 injects live-effect political paragraph."},
          roadmap:{cause:"(ROADMAP pending) Player 7 injects roadmap-cause political paragraph.",effect:"(ROADMAP pending) Player 7 injects roadmap-effect political paragraph."}
        }
      },
      "Legal":{
        formal:{
          concept:{cause:"Legal defensibility depends on stable definitions and scope. Classification must align with measurable behavior. Documentation must be immutable and time-stamped. Liability is bounded through enforced interfaces. Claims remain limited to operationally supported statements.",effect:"Definitional discipline reduces litigation exposure. Contracts reference stable terms and limits. Evidence supports dispute resolution. Liability remains compartmentalized by design. Compliance becomes manageable through modular documentation."},
          live:{cause:"(LIVE pending) Player 6 injects live-cause legal paragraph.",effect:"(LIVE pending) Player 6 injects live-effect legal paragraph."},
          roadmap:{cause:"(ROADMAP pending) Player 7 injects roadmap-cause legal paragraph.",effect:"(ROADMAP pending) Player 7 injects roadmap-effect legal paragraph."}
        },
        informal:{
          concept:{cause:"Law doesn’t grade on excitement; it grades on proof. Vague claims become expensive claims the moment something goes wrong. So this platform keeps posture tight: measurable boundaries, logged behavior, clear exclusions. Industrial substitution is defensible because it is observable. Fusion remains requirements-only because implication is a liability magnet.",effect:"When terms are clean, agreements get easier. Disputes shrink because the meaning is locked. Incidents become manageable because evidence is already structured. Partners can adopt without fear of hidden scope. That outcome is legal stability under growth."},
          live:{cause:"(LIVE pending) Player 6 injects live-cause legal paragraph.",effect:"(LIVE pending) Player 6 injects live-effect legal paragraph."},
          roadmap:{cause:"(ROADMAP pending) Player 7 injects roadmap-cause legal paragraph.",effect:"(ROADMAP pending) Player 7 injects roadmap-effect legal paragraph."}
        }
      },
      "Historical Systems":{
        formal:{
          concept:{cause:"Historical systems fail through unbounded assumptions and deferred governance. Measurement gaps allow fragility to accumulate. Interfaces are treated as secondary until incidents force redesign. Classification drift creates policy confusion and distrust. Modern design must invert this sequence with constraint-first discipline.",effect:"Constraint-first posture avoids repeat failures. Scaling aligns with governance maturity. Measurement becomes the basis for legitimacy. Public trust improves through predictability. History becomes a design input rather than a postmortem."},
          live:{cause:"(LIVE pending) Player 6 injects live-cause historical paragraph.",effect:"(LIVE pending) Player 6 injects live-effect historical paragraph."},
          roadmap:{cause:"(ROADMAP pending) Player 7 injects roadmap-cause historical paragraph.",effect:"(ROADMAP pending) Player 7 injects roadmap-effect historical paragraph."}
        },
        informal:{
          concept:{cause:"History is full of systems that broke because the story outran the structure. Speed tempted shortcuts, and shortcuts turned into disasters. The lesson is boring and strict: boundaries first, receipts first, claims last. That is why the industrial surface stays disciplined and fusion stays gated. This platform is designed to be the opposite of a hype cycle.",effect:"When you honor history, progress stops looking like a gamble. People trust what behaves consistently, not what sounds revolutionary. Institutions adopt when the artifacts are ready before the controversy. Scaling becomes replication instead of reinvention. That outcome is momentum without collapse."},
          live:{cause:"(LIVE pending) Player 6 injects live-cause historical paragraph.",effect:"(LIVE pending) Player 6 injects live-effect historical paragraph."},
          roadmap:{cause:"(ROADMAP pending) Player 7 injects roadmap-cause historical paragraph.",effect:"(ROADMAP pending) Player 7 injects roadmap-effect historical paragraph."}
        }
      }
    };

    function integratedText(domain){
      const st=S.style;
      const c=ARTICLE_LENS[domain][st].concept.cause+" "+ARTICLE_LENS[domain][st].concept.effect;
      const l=ARTICLE_LENS[domain][st].live.cause+" "+ARTICLE_LENS[domain][st].live.effect;
      const r=ARTICLE_LENS[domain][st].roadmap.cause+" "+ARTICLE_LENS[domain][st].roadmap.effect;
      return {concept:c,live:l,roadmap:r};
    }

    const bd=document.getElementById("bd");
    const modal=document.getElementById("modal");
    const mClose=document.getElementById("mClose");
    const mReturn=document.getElementById("mReturn");
    const mTitle=document.getElementById("mTitle");
    const h1=document.getElementById("h1");
    const h2=document.getElementById("h2");
    const h3=document.getElementById("h3");
    const list=document.getElementById("list");

    function sectionLead(sec){
      if(sec==="FOUNDATION") return "Foundation states admissible bounds, operational constraints, and claim discipline.";
      if(sec==="ARCHITECTURE") return "Architecture defines build, isolation, and interfaces without exposure drift.";
      if(sec==="PERFORMANCE") return "Performance describes what is measured, stabilized, and repeated without inflation.";
      return "Governance enforces claim discipline, audit integrity, and scale gates under pressure.";
    }
    function labelTime(){ return (S.time==="concept")?"CONCEPT":(S.time==="live")?"LIVE":"ROADMAP"; }
    function labelDir(){ return (S.dir==="cause")?"CAUSE":"EFFECT"; }
    function labelStyle(){ return (S.style==="formal")?"FORMAL":"INFORMAL"; }

    function setHeader(){
      if(S.mode==="integrated"){
        h1.textContent = `ENERGY · ${section} · INTEGRATED · ${labelStyle()}`;
        h2.textContent = sectionLead(section) + " Integrated mode shows Concept+Live+Roadmap per domain.";
      } else {
        h1.textContent = `ENERGY · ${section} · ${labelStyle()} · ${labelTime()} · ${labelDir()}`;
        h2.textContent = sectionLead(section);
      }
      h3.textContent = "Public posture is Industrial thermal substitution (C). No net-positive fusion claim. Fusion readiness is requirements-only.";
      mTitle.textContent = `ENERGY · ${section}`;
    }

    function getLensParagraph(domain){
      const tk = (S.time==="concept")?"concept":(S.time==="live")?"live":"roadmap";
      return ARTICLE_LENS[domain][S.style][tk][S.dir];
    }

    function setPillActives(){
      document.querySelectorAll("[data-mode]").forEach(p=>p.classList.toggle("active", p.dataset.mode===S.mode));
      document.querySelectorAll("[data-style]").forEach(p=>p.classList.toggle("active", p.dataset.style===S.style));
      document.querySelectorAll("[data-time]").forEach(p=>p.classList.toggle("active", p.dataset.time===S.time));
      document.querySelectorAll("[data-dir]").forEach(p=>p.classList.toggle("active", p.dataset.dir===S.dir));
      enforceSlice(); // apply disable/force after actives
      const dis = (S.mode==="integrated");
      document.getElementById("clusterTime").style.opacity = dis?".35":"1";
      document.getElementById("clusterDir").style.opacity  = dis?".35":"1";
      document.getElementById("clusterTime").style.pointerEvents = dis?"none":"auto";
      document.getElementById("clusterDir").style.pointerEvents  = dis?"none":"auto";
    }

    function renderList(){
      resetOpenIfLensChanged();
      list.innerHTML="";
      const order = ORDER[section] || DOMAINS;

      order.forEach(domain=>{
        const bub=document.createElement("div");
        bub.className="bub";

        const head=document.createElement("div");
        head.className="bhead";
        head.tabIndex=0; head.setAttribute("role","button");

        const left=document.createElement("div");
        const t=document.createElement("div"); t.className="btitle"; t.textContent=domain;
        const mini=document.createElement("div"); mini.className="bmini";
        mini.textContent=(S.mode==="integrated")?"Tap to expand: Concept + Live + Roadmap":"Tap to expand: one paragraph per lens";
        left.appendChild(t); left.appendChild(mini);

        const chev=document.createElement("div"); chev.className="bchev"; chev.textContent=openSet.has(domain)?"▾":"▸";
        head.appendChild(left); head.appendChild(chev);

        const body=document.createElement("div"); body.className="bbody";

        if(S.mode==="integrated"){
          const parts=integratedText(domain);
          const wrap=document.createElement("div"); wrap.className="ipanels";
          [["CONCEPT",parts.concept],["LIVE",parts.live],["ROADMAP",parts.roadmap]].forEach(pair=>{
            const ip=document.createElement("div"); ip.className="ip";
            const iph=document.createElement("div"); iph.className="iph"; iph.textContent=pair[0];
            const ipt=document.createElement("p"); ipt.className="ipt"; ipt.textContent=pair[1];
            ip.appendChild(iph); ip.appendChild(ipt); wrap.appendChild(ip);
          });
          body.appendChild(wrap);
        } else {
          const p=document.createElement("p"); p.className="p"; p.textContent=getLensParagraph(domain);
          body.appendChild(p);
        }

        function toggleOpen(){
          if(openSet.has(domain)) openSet.delete(domain); else openSet.add(domain);
          renderAll();
        }
        head.addEventListener("click", toggleOpen);
        head.addEventListener("keydown",(e)=>{ if(e.key==="Enter"||e.key===" "){ e.preventDefault(); toggleOpen(); }});

        if(openSet.has(domain)) bub.classList.add("open");
        bub.appendChild(head); bub.appendChild(body); list.appendChild(bub);
      });
    }

    function renderAll(firstOpen=false){
      section = window.__energy_section || section;
      setHeader();
      setPillActives();
      renderList();
      if(firstOpen){ showLens(); } // lens visible on first open
    }

    window.__energy_render_all = renderAll;

    // OPEN/CLOSE ALL
    document.getElementById("openAll").addEventListener("click", ()=>{
      resetOpenIfLensChanged();
      (ORDER[section] || DOMAINS).forEach(d=>openSet.add(d));
      renderAll(false);
      hideLens(); // reading mode after open all
    });
    document.getElementById("closeAll").addEventListener("click", ()=>{
      resetOpenIfLensChanged();
      openSet = new Set();
      renderAll(false);
    });

    // MODE/STYLE/TIME/DIR clicks
    document.querySelectorAll("[data-mode]").forEach(p=>p.addEventListener("click", ()=>{ S.mode=p.dataset.mode; renderAll(false); }));
    document.querySelectorAll("[data-style]").forEach(p=>p.addEventListener("click", ()=>{ S.style=p.dataset.style; renderAll(false); }));
    document.querySelectorAll("[data-time]").forEach(p=>p.addEventListener("click", ()=>{
      S.time=p.dataset.time;
      enforceSlice();
      renderAll(false);
    }));
    document.querySelectorAll("[data-dir]").forEach(p=>p.addEventListener("click", ()=>{
      if(p.classList.contains("disabled")) return;
      S.dir=p.dataset.dir;
      renderAll(false);
    }));

    // Close modal
    function closeModal(){ bd.classList.remove("show"); modal.classList.remove("show"); }
    bd.addEventListener("click", closeModal);
    mClose.addEventListener("click", closeModal);
    mReturn.addEventListener("click", closeModal);

    // keyboard for diamonds
    [["dFoundation","FOUNDATION"],["dArchitecture","ARCHITECTURE"],["dPerformance","PERFORMANCE"],["dGovernance","GOVERNANCE"]].forEach(pair=>{
      const el=document.getElementById(pair[0]);
      el.addEventListener("keydown",(e)=>{ if(e.key==="Enter"||e.key===" "){ e.preventDefault(); window.__openEnergyModal(pair[1]); }});
    });

  }catch(e){}
})();
</script>

</body>
</html>

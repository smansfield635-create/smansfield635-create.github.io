<!-- =====================================================
TNT FILE: /home/index.html
CRP HOME v4 (4 QUADS â†’ 4 VINES â†’ 4 FRUITS â†’ RESOLUTION)
- Uses gd_lang + gd_depth
- Uses overlay modal (no scroll jump)
- Tri-lens + Formal/Informal at top
===================================================== -->
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Home Â· Coherent Resolution Platform</title>

<link rel="stylesheet" href="/assets/ui.css?v=9010"/>
<link rel="stylesheet" href="/assets/branch.css?v=9010"/>
<script defer src="/assets/instrument.js?v=9010"></script>
</head>

<body>
<div class="page">
  <div class="wrap">

    <div class="hero">
      <h1>HOME</h1>
      <p>Quadrant â†’ Vine â†’ Fruit â†’ Resolution.</p>

      <div class="topbar">
        <span class="pill">LANG: <span id="langPill">EN</span></span>
        <span class="pill">DEPTH: <span id="depthPill">EXPLORE</span></span>

        <span class="pill">TIME:</span>
        <button class="pill btn active" id="lensOrigin" type="button">ORIGIN</button>
        <button class="pill btn" id="lensNow" type="button">NOW</button>
        <button class="pill btn" id="lensTraj" type="button">TRAJECTORY</button>

        <span class="pill">STYLE:</span>
        <button class="pill btn active" id="exprFormal" type="button">FORMAL</button>
        <button class="pill btn" id="exprInformal" type="button">INFORMAL</button>

        <a class="pill btn" href="/door/">DOOR</a>
      </div>

      <div class="section-title">Quadrant routes (tap a vine)</div>
    </div>

    <details class="quad" open>
      <summary>
        <div class="q-left">
          <div class="q-badge"><span class="icon">â­</span><span class="code">NW</span></div>
          <div class="q-text"><b>NORTHWEST</b><span>Definition Â· language Â· structure</span></div>
        </div>
        <div class="q-arrow">â–¾</div>
      </summary>
      <div class="inside"><div class="bubble-row" id="rowNW"></div></div>
    </details>

    <details class="quad">
      <summary>
        <div class="q-left">
          <div class="q-badge"><span class="icon">â˜€ï¸</span><span class="code">NE</span></div>
          <div class="q-text"><b>NORTHEAST</b><span>Execution Â· surfaces Â· examples</span></div>
        </div>
        <div class="q-arrow">â–¾</div>
      </summary>
      <div class="inside"><div class="bubble-row" id="rowNE"></div></div>
    </details>

    <details class="quad">
      <summary>
        <div class="q-left">
          <div class="q-badge"><span class="icon">ğŸ®</span><span class="code">SW</span></div>
          <div class="q-text"><b>SOUTHWEST</b><span>Measurement Â· diagnostics Â· rules</span></div>
        </div>
        <div class="q-arrow">â–¾</div>
      </summary>
      <div class="inside"><div class="bubble-row" id="rowSW"></div></div>
    </details>

    <details class="quad">
      <summary>
        <div class="q-left">
          <div class="q-badge"><span class="icon">ğŸŒ‡</span><span class="code">SE</span></div>
          <div class="q-text"><b>SOUTHEAST</b><span>Identity Â· references Â· links</span></div>
        </div>
        <div class="q-arrow">â–¾</div>
      </summary>
      <div class="inside"><div class="bubble-row" id="rowSE"></div></div>
    </details>

    <footer>CANONICAL Â· STABLE Â· Â© GEODIAMETRICS</footer>
    <div class="ink">GEODIAMETRICS</div>
  </div>
</div>

<!-- Modal overlay -->
<div class="overlay" id="overlay">
  <div class="modal">
    <div class="modal-head">
      <div class="modal-title">
        <b id="mTitle">DETAIL</b>
        <span id="mSubtitle">Select a fruit.</span>
      </div>
      <button class="close" id="mClose">Close</button>
    </div>

    <div class="modal-body">
      <div class="block">
        <h3 id="mH3">â€”</h3>
        <p id="mText">â€”</p>

        <div class="section-title" style="margin-top:14px;">Fruits (pick one)</div>
        <div class="bubble-row" id="fruitGrid"></div>

        <div id="resolutionMount"></div>
      </div>
    </div>
  </div>
</div>

<script>
(() => {
  const K_LANG="gd_lang";
  const K_DEPTH="gd_depth";

  const state = {
    lang:"en",
    depth:"explore",
    lens:"ORIGIN",
    expr:"FORMAL",
    current:{ q:null, vine:null }
  };

  const $ = (id)=>document.getElementById(id);
  const esc = (s)=>String(s).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;");

  const simplify = (t)=>{
    if(state.expr==="FORMAL") return t;
    return t.replaceAll("therefore","so").replaceAll("however","but").replaceAll("verification","proof").replaceAll("trajectory","future").replaceAll("invariant","rule");
  };

  // load persisted state
  try { state.lang = (localStorage.getItem(K_LANG) || "en"); } catch(e){}
  try { state.depth = (localStorage.getItem(K_DEPTH) || "explore"); } catch(e){}
  $("langPill").textContent = (state.lang==="zh" ? "ä¸­æ–‡" : "EN");
  $("depthPill").textContent = state.depth.toUpperCase();

  function setLens(L){
    state.lens=L;
    $("lensOrigin").classList.toggle("active", L==="ORIGIN");
    $("lensNow").classList.toggle("active", L==="NOW");
    $("lensTraj").classList.toggle("active", L==="TRAJECTORY");
    if(isOpen()) renderModal();
  }
  function setExpr(E){
    state.expr=E;
    $("exprFormal").classList.toggle("active", E==="FORMAL");
    $("exprInformal").classList.toggle("active", E==="INFORMAL");
    if(isOpen()) renderModal();
  }

  $("lensOrigin").addEventListener("click", ()=>setLens("ORIGIN"));
  $("lensNow").addEventListener("click", ()=>setLens("NOW"));
  $("lensTraj").addEventListener("click", ()=>setLens("TRAJECTORY"));
  $("exprFormal").addEventListener("click", ()=>setExpr("FORMAL"));
  $("exprInformal").addEventListener("click", ()=>setExpr("INFORMAL"));

  // 4 vines per quadrant
  const QUAD_VINES = {
    NW: [
      vine("SSG","Simplified Syntax Geometry"),
      vine("Diamond Grammar","Four routes Â· one choice"),
      vine("DOT.GRID","256-state indexing"),
      vine("Acronyms","Pillar map + usage"),
    ],
    NE: [
      vine("Execution Surfaces","Apps Â· portals Â· interfaces"),
      vine("Workflows & Receipts","Audit trails Â· replay safety"),
      vine("Examples","How to use the system"),
      vine("Packs & Outputs","Downloadables Â· artifacts"),
    ],
    SW: [
      vine("Gauges","Panels Â· thresholds"),
      vine("Diagnostics","Classification under constraint"),
      vine("Rules","Navigation + integrity"),
      vine("Protocols","Return Â· replay Â· audit"),
    ],
    SE: [
      vine("ORCID","Research identity"),
      vine("OSF","Project registry"),
      vine("References","Citations and anchors"),
      vine("Contact","Direct channel"),
    ],
  };

  // each vine has 4 fruits
  const FRUITS = [
    fruit("A","Fruit A"),
    fruit("B","Fruit B"),
    fruit("C","Fruit C"),
    fruit("D","Fruit D"),
  ];

  function vine(key, hint){ return { key, hint }; }
  function fruit(key, label){
    return {
      key, label,
      pack:{
        ORIGIN:{para:`${label}: origin view.`, bullets:[""], imp:""},
        NOW:{para:`${label}: now view.`, bullets:[""], imp:""},
        TRAJECTORY:{para:`${label}: trajectory view.`, bullets:[""], imp:""},
      }
    };
  }

  function renderQuadrant(q){
    const row = document.getElementById("row"+q);
    row.innerHTML="";
    QUAD_VINES[q].forEach(v=>{
      const el=document.createElement("div");
      el.className="bubble-btn";
      el.innerHTML=`<div class="lbl"><b>${esc(v.key)}</b><i>${esc(v.hint)}</i></div><div class="go">â–¶</div>`;
      el.addEventListener("click", ()=>openModal(q, v));
      row.appendChild(el);
    });
  }

  ["NW","NE","SW","SE"].forEach(renderQuadrant);

  const overlay=$("overlay");
  const fruitGrid=$("fruitGrid");
  const mount=$("resolutionMount");

  function isOpen(){ return overlay.classList.contains("on"); }
  function openModal(q, vine){
    state.current.q=q;
    state.current.vine=vine;
    overlay.classList.add("on");
    document.body.style.overflow="hidden";
    renderModal();
  }
  function closeModal(){
    overlay.classList.remove("on");
    document.body.style.overflow="";
    mount.innerHTML="";
    fruitGrid.innerHTML="";
  }

  $("mClose").addEventListener("click", closeModal);
  overlay.addEventListener("click", (e)=>{ if(e.target.id==="overlay") closeModal(); });
  document.addEventListener("keydown",(e)=>{ if(e.key==="Escape" && isOpen()) closeModal(); });

  function renderModal(){
    const q=state.current.q;
    const v=state.current.vine;
    $("mTitle").textContent = q + " Â· " + v.key;
    $("mSubtitle").textContent = v.hint;
    $("mH3").textContent = v.key;
    $("mText").textContent = simplify(`Choose one fruit to reach resolution (${state.lens.toLowerCase()}).`);

    fruitGrid.innerHTML="";
    mount.innerHTML="";

    FRUITS.forEach(f=>{
      const el=document.createElement("div");
      el.className="bubble-btn";
      el.innerHTML=`<div class="lbl"><b>${esc(f.label)}</b><i>${esc("Open resolution")}</i></div><div class="go">â–¶</div>`;
      el.addEventListener("click", ()=>showResolution(f));
      fruitGrid.appendChild(el);
    });
  }

  function showResolution(f){
    const p=f.pack[state.lens];
    mount.innerHTML = `
      <div class="resolution">
        <h4>${esc(f.label)} â€” Resolution</h4>
        <p class="para">${esc(simplify(p.para))}</p>
        <div class="back" id="backBtn">Back</div>
      </div>
    `;
    document.getElementById("backBtn").addEventListener("click", ()=>{ mount.innerHTML=""; });
  }
})();
</script>
</body>
</html>

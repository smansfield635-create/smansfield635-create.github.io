<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Geodiametrics · Capture Snapshot</title>
<style>
:root{--bg:#0b0e14;--fg:#e6ebff;--muted:#9aa3c7;--stroke:rgba(230,235,255,.12);--radius:18px;
--mono:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;--sans:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;}
*{box-sizing:border-box}html,body{margin:0;height:100%}
body{background:var(--bg);color:var(--fg);font-family:var(--sans)}
main{max-width:900px;margin:0 auto;padding:40px 18px 72px}
h1{margin:0 0 8px;font-size:26px}
p{color:var(--muted);line-height:1.55}
.card{border:1px solid var(--stroke);border-radius:var(--radius);padding:22px;margin-top:16px}
pre{white-space:pre-wrap;word-break:break-word;background:rgba(255,255,255,.02);border:1px solid var(--stroke);border-radius:14px;padding:14px;color:var(--fg);font-family:var(--mono);font-size:12px}
button{padding:10px 12px;border-radius:999px;border:1px solid var(--stroke);background:rgba(255,255,255,.02);color:var(--fg);font-family:var(--mono);font-size:12px;cursor:pointer}
button:hover{border-color:rgba(122,162,255,.45)}
.row{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
.small{font-family:var(--mono);font-size:12px;color:var(--muted)}
</style>
</head>
<body>
<main>
  <h1>Capture Snapshot</h1>
  <p>Device-local analytics extracted from localStorage. This is not global. Copy the JSON into <span class="small">/assets/site_metrics.json</span> if you want to publish counts manually.</p>

  <div class="card">
    <div class="row">
      <button id="refresh" type="button">Refresh</button>
      <button id="copy" type="button">Copy JSON</button>
      <button id="clear" type="button">Clear Local Data</button>
      <a href="/" class="small" style="text-decoration:none;color:var(--fg);padding:10px 12px;border:1px solid var(--stroke);border-radius:999px;background:rgba(255,255,255,.02);font-family:var(--mono)">Back</a>
    </div>
    <p class="small" id="meta">—</p>
    <pre id="out">—</pre>
  </div>

<script>
function read(){
  const KEY="geo_capture";
  let d={};
  try{ d=JSON.parse(localStorage.getItem(KEY))||{} }catch(e){ d={} }
  const pages = Object.keys(d);
  let views=0, clicks=0, time=0;
  pages.forEach(p=>{
    views += d[p]?.views||0;
    clicks += d[p]?.clicks||0;
    time += d[p]?.time||0;
  });

  const snapshot = {
    timestamp: new Date().toISOString(),
    interaction: {
      device_views_total: views,
      device_clicks_total: clicks,
      device_time_sec_total: time
    },
    by_page: d
  };

  document.getElementById("meta").textContent =
    "Pages: "+pages.length+" · Views: "+views+" · Clicks: "+clicks+" · Time(s): "+time;

  document.getElementById("out").textContent = JSON.stringify(snapshot, null, 2);
  return snapshot;
}

let snap = read();

document.getElementById("refresh").onclick = ()=>{ snap = read(); };

document.getElementById("copy").onclick = async ()=>{
  try{
    await navigator.clipboard.writeText(JSON.stringify(snap, null, 2));
    alert("Copied.");
  }catch(e){
    alert("Copy failed. Select text manually.");
  }
};

document.getElementById("clear").onclick = ()=>{
  localStorage.removeItem("geo_capture");
  snap = read();
  alert("Cleared.");
};
</script>
</main>
</body>
</html>

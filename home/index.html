<!-- TNT — /home/index.html
     HUB A · EXECUTIVE INDEX (NO EXPANSION)
     PURPOSE:
       - 4 primary nodes only (N / E / S / W)
       - Tap a node = immediate jump (no sub-bubbles here)
       - Jump Deck + Jump Index handle explanations + full jump catalog
     CONTROLS:
       - View: Informal / Formal / Both (changes the 1-sentence line)
       - Language: EN / 中文 / ES (triangle cluster; single-language render)
     BOTTOM (NO TABS / NO STACKING):
       - EXIT (Door)
       - JUMP DECK
       - JUMP INDEX
       - ACTIVE JUMP (last selected node)
     STATE:
       - URL keys: lang/style/time/depth
       - LS keys: gd_lang/gd_style/gd_time/gd_depth
     LOCKS:
       - ui.css owns field; no html/body background styling
       - uses /assets/ui.css + /assets/branch.css + /assets/instruments.js
-->

<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>HUB A · Index</title>

<link rel="stylesheet" href="/assets/ui.css"/>
<link rel="stylesheet" href="/assets/branch.css"/>
<script defer src="/assets/instruments.js"></script>

<style>
a{color:inherit;text-decoration:none}
:root{--dockH:84px}

.page{
  width:min(980px,94vw);
  margin:0 auto;
  padding:14px 0 calc(var(--dockH) + 18px);
  display:flex;
  flex-direction:column;
  gap:12px;
}

/* Header */
.header{
  border:1px solid rgba(255,255,255,.10);
  border-radius:22px;
  background:rgba(0,0,0,.14);
  backdrop-filter:blur(10px);
  padding:14px 16px;
  box-shadow:0 24px 80px rgba(0,0,0,.55);
}
.k{font-size:11px;letter-spacing:4px;text-transform:uppercase;opacity:.72;margin:0 0 6px}
.t{font-weight:950;font-size:24px;letter-spacing:.3px;margin:0 0 6px}
.s{font-size:13px;opacity:.82;line-height:1.5;margin:0;max-width:860px}

/* Controls row */
.ctrl{
  display:flex;
  justify-content:flex-end;
  gap:10px;
  flex-wrap:wrap;
  align-items:flex-start;
  margin-top:12px;
}

/* Triangle language cluster (compact) */
.langTri{
  position:relative;
  width:126px;
  height:78px;
  border-radius:18px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(0,0,0,.18);
  box-shadow:0 14px 36px rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.06);
  display:grid;
  place-items:center;
  padding:8px;
}
.langTri .tri{position:relative;width:110px;height:62px;}
.langTri .btn{
  position:absolute;
  padding:8px 12px;
  border-radius:999px;
  font-weight:900;
  letter-spacing:.2px;
  line-height:1;
  white-space:nowrap;
}
.langTri .en{left:50%;top:0;transform:translateX(-50%);}
.langTri .zh{left:0;bottom:0;}
.langTri .es{right:0;bottom:0;}

@media (max-width:520px){
  .langTri{width:116px;height:74px}
  .langTri .tri{width:102px;height:60px}
  .langTri .btn{padding:8px 10px}
}

/* Node list */
.list{display:flex;flex-direction:column;gap:10px;margin-top:4px}
.node{
  --c:#93C5FD;
  border:1px solid rgba(255,255,255,.10);
  border-radius:18px;
  background:
    radial-gradient(circle at 30% 20%, rgba(255,255,255,.06), transparent 55%),
    linear-gradient(160deg, rgba(12,22,38,.92), rgba(7,11,18,.95));
  box-shadow:0 18px 60px rgba(0,0,0,.62);
  overflow:hidden;
  cursor:pointer;
  -webkit-tap-highlight-color:transparent;
  touch-action:manipulation;
}
.nHead{
  display:flex;align-items:center;justify-content:space-between;gap:10px;
  padding:14px 16px;
}
.nLeft{display:flex;align-items:flex-start;gap:10px;min-width:0}
.diamond{
  width:12px;height:12px;transform:rotate(45deg);border-radius:4px;background:var(--c);
  box-shadow:0 0 0 1px rgba(255,255,255,.12),0 0 14px rgba(0,0,0,.35);
  flex:0 0 auto;pointer-events:none;margin-top:4px;
}
.nText{min-width:0}
.nTitle{font-weight:950;letter-spacing:.2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.nOne{
  margin-top:6px;
  font-size:13px;
  opacity:.84;
  line-height:1.35;
  max-width:60ch;
}
.chev{opacity:.75;font-size:18px;flex:0 0 auto}

/* View filtering for the single-sentence line */
.view-informal .nOne[data-lens="formal"]{display:none}
.view-formal .nOne[data-lens="informal"]{display:none}
.view-both .nOne{display:block}

/* Bottom dock: single row, no wrap, no stacking */
.dock{
  position:fixed;
  left:50%;
  bottom:max(10px, env(safe-area-inset-bottom));
  transform:translateX(-50%);
  z-index:220;
  width:min(980px,94vw);
  padding:10px 12px;
  border-radius:22px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(0,0,0,.22);
  backdrop-filter:blur(10px);
  box-shadow:0 18px 60px rgba(0,0,0,.55);

  display:grid;
  grid-auto-flow:column;
  gap:10px;

  overflow-x:auto;
  overflow-y:hidden;
  -webkit-overflow-scrolling:touch;
  scrollbar-width:none;
}
.dock::-webkit-scrollbar{display:none}
.dock .btn{width:100%;border-radius:999px;white-space:nowrap;padding:10px 10px}
.dock[data-cols="4"]{grid-template-columns:repeat(4, minmax(150px,1fr));}
.dock[data-cols="5"]{grid-template-columns:repeat(5, minmax(150px,1fr));}
@media (max-width:520px){
  :root{--dockH:92px}
  .dock[data-cols="4"]{grid-template-columns:repeat(4, minmax(132px,1fr));}
  .dock[data-cols="5"]{grid-template-columns:repeat(5, minmax(132px,1fr));}
}
</style>
</head>

<body>

<div class="page" id="page">

  <div class="header" id="brand">
    <p class="k" id="hk">CARDINAL AXIS</p>
    <h1 class="t" id="ht">HUB A · Index</h1>
    <p class="s" id="hs">Primary compass index. Tap a direction to jump.</p>

    <div class="ctrl">
      <button class="btn" id="vInformal" type="button">INFORMAL</button>
      <button class="btn" id="vFormal" type="button">FORMAL</button>
      <button class="btn" id="vBoth" type="button">BOTH</button>

      <div class="langTri" aria-label="Language">
        <div class="tri">
          <button class="btn en" id="bEN" type="button">EN</button>
          <button class="btn zh" id="bZH" type="button">中文</button>
          <button class="btn es" id="bES" type="button">ES</button>
        </div>
      </div>
    </div>
  </div>

  <div class="list view-formal" id="list"></div>
</div>

<nav class="dock" id="dock" data-cols="4" aria-label="Bottom actions">
  <button class="btn" id="navExit" type="button">EXIT</button>
  <button class="btn" id="navDeck" type="button">JUMP DECK</button>
  <button class="btn" id="navIndex" type="button">JUMP INDEX</button>
  <button class="btn" id="navActive" type="button">ACTIVE JUMP</button>

  <!-- optional 5th slot for wider screens (kept, no stacking; dock scrolls) -->
  <button class="btn" id="navSpline2" type="button">SPLINE 2</button>
</nav>

<script>
(function(){
  // ===== State (instrument-compatible) =====
  const qs=new URLSearchParams(location.search);
  const lsGet=k=>{try{return localStorage.getItem(k)}catch(e){return null}};
  const lsSet=(k,v)=>{try{localStorage.setItem(k,String(v))}catch(e){}};

  let lang  = qs.get("lang")  || lsGet("gd_lang")  || "en";
  let style = qs.get("style") || lsGet("gd_style") || "formal";
  let time  = qs.get("time")  || lsGet("gd_time")  || "now";
  let depth = qs.get("depth") || lsGet("gd_depth") || "explore";

  if(lang!=="en"&&lang!=="zh"&&lang!=="es") lang="en";
  if(style!=="formal"&&style!=="informal"&&style!=="both") style="formal";
  if(time!=="origin"&&time!=="now"&&time!=="post") time="now";
  if(depth!=="explore"&&depth!=="learn") depth="explore";

  // Persist (style in URL stays; internal view supports BOTH as UI-only)
  lsSet("gd_lang",lang);
  lsSet("gd_style",(style==="both")?"formal":style);
  lsSet("gd_time",time);
  lsSet("gd_depth",depth);
  document.documentElement.lang = (lang==="zh") ? "zh" : (lang==="es" ? "es" : "en");

  function makeQS(over){
    const p=new URLSearchParams();
    p.set("lang",  (over&&over.lang)  || lang);
    p.set("style", (over&&over.style) || ((style==="both")?"formal":style));
    p.set("time",  (over&&over.time)  || time);
    p.set("depth", (over&&over.depth) || depth);
    return "?"+p.toString();
  }

  // ===== ROUTES (edit only if your paths differ) =====
  // These are the only guessed paths; change here if needed.
  const ROUTE = {
    door: "/door/",
    deck: "/home/deck/",
    index: "/home/jumps/",
    spline2: "/explore/"
  };

  // ===== JUMPS (wire to real surfaces; replace when your jump pages are installed) =====
  // Default conservative mapping:
  // N -> Laws, E -> Products, S -> Laws, W -> Laws (change as needed)
  const JUMPS = {
    N: "/laws/",
    E: "/products/",
    S: "/laws/",
    W: "/laws/"
  };

  // ===== Labels + 1-sentence per lens =====
  const NODE = {
    N:{
      color:"#1F3A8A",
      title:{en:"N · STRUCTURE",zh:"N · 结构",es:"N · ESTRUCTURA"},
      one:{
        informal:{en:"Pin meaning before power moves.",zh:"先钉住含义，后谈扩张。",es:"Fija el significado antes de mover poder."},
        formal:{en:"Scope precedes authority.",zh:"范围先于权力。",es:"El alcance precede a la autoridad."}
      }
    },
    E:{
      color:"#0EA5E9",
      title:{en:"E · PRODUCTS",zh:"E · 产品",es:"E · PRODUCTOS"},
      one:{
        informal:{en:"Turn claims into usable surfaces with limits.",zh:"把主张变成可用执行面，并带边界。",es:"Convierte promesas en superficies con límites."},
        formal:{en:"Execution inherits boundary conditions.",zh:"执行继承边界条件。",es:"La ejecución hereda condiciones de borde."}
      }
    },
    S:{
      color:"#F59E0B",
      title:{en:"S · CONSTRAINTS",zh:"S · 约束",es:"S · RESTRICCIONES"},
      one:{
        informal:{en:"If it can’t be bounded, it can’t scale.",zh:"不有界，就别规模化。",es:"Si no se puede acotar, no puede escalar."},
        formal:{en:"Constraint is not optional.",zh:"约束不可选。",es:"La restricción no es opcional."}
      }
    },
    W:{
      color:"#7F1D1D",
      title:{en:"W · CONTAINMENT",zh:"W · 隔离",es:"W · CONTENCIÓN"},
      one:{
        informal:{en:"Keep damage local; return clean.",zh:"损伤局部化，返回要干净。",es:"Mantén el daño local; vuelve limpio."},
        formal:{en:"Local failure must stay local.",zh:"局部失败必须局部化。",es:"El fallo local debe permanecer local."}
      }
    }
  };

  function T(obj){ return (lang==="zh") ? obj.zh : (lang==="es") ? obj.es : obj.en; }

  // ===== Header i18n =====
  const hk=document.getElementById("hk");
  const ht=document.getElementById("ht");
  const hs=document.getElementById("hs");
  if(lang==="zh"){
    hk.textContent="基轴体系";
    ht.textContent="枢纽A · 索引";
    hs.textContent="主罗盘索引。点击方向即可跳转。";
  }else if(lang==="es"){
    hk.textContent="CARDINAL AXIS";
    ht.textContent="HUB A · Índice";
    hs.textContent="Índice de brújula principal. Toca una dirección para saltar.";
  }else{
    hk.textContent="CARDINAL AXIS";
    ht.textContent="HUB A · Index";
    hs.textContent="Primary compass index. Tap a direction to jump.";
  }

  // ===== View mode (controls only what line is visible) =====
  const list=document.getElementById("list");
  const vInformal=document.getElementById("vInformal");
  const vFormal=document.getElementById("vFormal");
  const vBoth=document.getElementById("vBoth");

  function applyView(v){
    list.classList.remove("view-formal","view-informal","view-both");
    list.classList.add("view-"+v);
    vInformal.classList.toggle("active", v==="informal");
    vFormal.classList.toggle("active", v==="formal");
    vBoth.classList.toggle("active", v==="both");
    style=v;
    // do NOT store "both" into gd_style; only for UI
    lsSet("hub_view", v);
  }
  const viewInit = lsGet("hub_view") || (lsGet("gd_style")==="informal" ? "informal" : "formal");
  applyView(viewInit);

  vInformal.onclick=()=>applyView("informal");
  vFormal.onclick=()=>applyView("formal");
  vBoth.onclick=()=>applyView("both");

  // ===== Language triangle =====
  const bEN=document.getElementById("bEN");
  const bZH=document.getElementById("bZH");
  const bES=document.getElementById("bES");

  function paintLangBtns(){
    bEN.classList.toggle("active", lang==="en");
    bZH.classList.toggle("active", lang==="zh");
    bES.classList.toggle("active", lang==="es");
  }
  paintLangBtns();

  function setLang(next){
    if(next!=="en"&&next!=="zh"&&next!=="es") next="en";
    const openView = lsGet("hub_view") || "formal";
    lang=next;
    lsSet("gd_lang",lang);
    document.documentElement.lang=(lang==="zh")?"zh":(lang==="es")?"es":"en";
    history.replaceState({}, "", location.pathname + makeQS({lang}));
    location.reload(); // simplest + safest: single-language render, no mixed residue
  }
  bEN.onclick=()=>setLang("en");
  bZH.onclick=()=>setLang("zh");
  bES.onclick=()=>setLang("es");

  // ===== Render nodes (4 only) =====
  function makeNode(id){
    const n=NODE[id];
    const title=T(n.title);

    const el=document.createElement("div");
    el.className="node";
    el.style.setProperty("--c", n.color);
    el.setAttribute("data-id", id);

    const head=document.createElement("div");
    head.className="nHead";

    const left=document.createElement("div");
    left.className="nLeft";

    const d=document.createElement("div");
    d.className="diamond";

    const text=document.createElement("div");
    text.className="nText";

    const ttl=document.createElement("div");
    ttl.className="nTitle";
    ttl.textContent=title;

    const oneI=document.createElement("div");
    oneI.className="nOne";
    oneI.setAttribute("data-lens","informal");
    oneI.textContent=T(n.one.informal);

    const oneF=document.createElement("div");
    oneF.className="nOne";
    oneF.setAttribute("data-lens","formal");
    oneF.textContent=T(n.one.formal);

    text.appendChild(ttl);
    text.appendChild(oneI);
    text.appendChild(oneF);

    left.appendChild(d);
    left.appendChild(text);

    const chev=document.createElement("div");
    chev.className="chev";
    chev.textContent="›";

    head.appendChild(left);
    head.appendChild(chev);

    el.appendChild(head);

    function jump(){
      const target = JUMPS[id] || "#";
      lsSet("hub_active_node", id);
      if(target==="#") return;
      location.href = target + makeQS();
    }
    el.addEventListener("click", jump);
    el.addEventListener("keydown", function(e){
      if(e.key==="Enter"||e.key===" "){ e.preventDefault(); jump(); }
    });
    el.tabIndex=0;
    el.setAttribute("role","button");
    return el;
  }

  list.innerHTML="";
  ["N","E","S","W"].forEach(id=>list.appendChild(makeNode(id)));

  // ===== Dock: 4 or 5 across =====
  const dock=document.getElementById("dock");
  if((window.innerWidth||0) >= 920) dock.setAttribute("data-cols","5");
  else dock.setAttribute("data-cols","4");

  // Button labels i18n
  const navExit=document.getElementById("navExit");
  const navDeck=document.getElementById("navDeck");
  const navIndex=document.getElementById("navIndex");
  const navActive=document.getElementById("navActive");
  const navSpline2=document.getElementById("navSpline2");

  if(lang==="zh"){
    navExit.textContent="退出";
    navDeck.textContent="跳转卡组";
    navIndex.textContent="跳转目录";
    navActive.textContent="当前跳转";
    navSpline2.textContent="第二匝道";
  }else if(lang==="es"){
    navExit.textContent="SALIR";
    navDeck.textContent="MAZO";
    navIndex.textContent="ÍNDICE";
    navActive.textContent="SALTO ACTIVO";
    navSpline2.textContent="RAMPA 2";
  }else{
    navExit.textContent="EXIT";
    navDeck.textContent="JUMP DECK";
    navIndex.textContent="JUMP INDEX";
    navActive.textContent="ACTIVE JUMP";
    navSpline2.textContent="SPLINE 2";
  }

  // Dock actions
  navExit.onclick=()=>location.href = ROUTE.door + makeQS();
  navDeck.onclick=()=>location.href = ROUTE.deck + makeQS();
  navIndex.onclick=()=>location.href = ROUTE.index + makeQS();
  navSpline2.onclick=()=>location.href = ROUTE.spline2 + makeQS();

  navActive.onclick=()=>{
    const id = lsGet("hub_active_node") || "N";
    const target = JUMPS[id] || "#";
    if(target==="#") return;
    location.href = target + makeQS();
  };

})();
</script>

</body>
</html>

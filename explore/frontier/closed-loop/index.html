<!-- TNT — /explore/frontier/closed-loop/index.html
     FRONTIER · CLOSED LOOP HABITAT MODEL
     MONUMENT DENSITY · 4 LENSES · 3 LANGUAGES (EN/中文/ES)
     SINGLE-OPEN ACCORDION · NO MODALS · STATE CARRY
     ROLE:
       - Planetary/Orbital “no-away” survival model
       - SHIMMER routing posture + measurable closure targets
     ROUTES (SHELLS / SAFE):
       - ENERGY → /explore/frontier/energy/
       - WATER  → /explore/frontier/water/
       - WASTE  → /explore/frontier/waste/
       - URBAN  → /explore/frontier/urban/
-->

<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>FRONTIER · Closed Loop Habitat Model</title>

<link rel="stylesheet" href="/assets/ui.css"/>
<link rel="stylesheet" href="/assets/branch.css"/>
<script defer src="/assets/instruments.js"></script>

<style>
a{color:inherit;text-decoration:none}
body{margin:0;color:#fff;font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif}
body::before,body::after{pointer-events:none!important}

:root{
  --dockH:96px;
  --mut:rgba(255,255,255,.92);
  --mut2:rgba(255,255,255,.76);

  --opal:rgba(210,190,255,.14);
  --red:rgba(255,70,70,.10);
  --gold:rgba(212,175,55,.16);
  --ink:rgba(0,0,0,.18);
}

.page{
  width:min(1200px,94vw);
  margin:0 auto;
  padding:100px 0 calc(var(--dockH) + 24px);
  display:flex;
  flex-direction:column;
  gap:22px;
}

.header{
  border:1px solid rgba(255,255,255,.12);
  border-radius:28px;
  background:
    radial-gradient(circle at 22% 18%, var(--opal), transparent 70%),
    radial-gradient(circle at 78% 28%, var(--red), transparent 72%),
    radial-gradient(circle at 55% 92%, var(--gold), transparent 72%),
    var(--ink);
  padding:30px;
  box-shadow:0 40px 120px rgba(0,0,0,.6);
}

.k{
  font-size:14px;
  letter-spacing:6px;
  text-transform:uppercase;
  opacity:.7;
  margin:0 0 12px;
}

.t{
  font-weight:900;
  font-size:42px;
  letter-spacing:1px;
  margin:0 0 14px;
}

.s{
  font-size:19px;
  line-height:1.75;
  max-width:1020px;
  opacity:.92;
}

.lenses{
  display:flex;
  gap:12px;
  flex-wrap:wrap;
  margin-top:26px;
}

.pill{
  padding:12px 20px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.18);
  cursor:pointer;
  font-weight:800;
  letter-spacing:.4px;
  font-size:14px;
  background:rgba(0,0,0,.25);
}

.pill.active{
  border-color:rgba(212,175,55,.60);
  box-shadow:0 0 18px rgba(212,175,55,.22);
}

.band{
  padding:12px 16px;
  border-radius:22px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(0,0,0,.12);
  font-weight:900;
  letter-spacing:.6px;
  text-transform:uppercase;
  opacity:.9;
}

.accordion{
  display:flex;
  flex-direction:column;
  gap:18px;
}

.section{
  border:1px solid rgba(255,255,255,.10);
  border-radius:28px;
  overflow:hidden;
  background:linear-gradient(160deg, rgba(18,22,35,.95), rgba(8,12,20,.98));
}

.head{
  padding:22px 30px;
  cursor:pointer;
  display:flex;
  justify-content:space-between;
  align-items:center;
  -webkit-tap-highlight-color:transparent;
  touch-action:manipulation;
}

.title{
  font-size:22px;
  font-weight:900;
  letter-spacing:.4px;
}

.chev{opacity:.75;font-weight:900}

.body{
  display:none;
  padding:28px 34px;
  border-top:1px solid rgba(255,255,255,.08);
  font-size:18px;
  line-height:1.85;
  color:var(--mut2);
}

.section.open .body{display:block}

.ul{
  margin:14px 0 0 18px;
  padding:0;
  color:rgba(255,255,255,.80);
  font-size:17px;
  line-height:1.75;
}
.ul li{margin:8px 0}

.jump{
  margin-top:18px;
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  justify-content:flex-end;
}
.jump .btn{
  padding:12px 16px;
  border-radius:999px;
  white-space:nowrap;
}

.dock{
  position:fixed;
  left:50%;
  bottom:max(10px, env(safe-area-inset-bottom));
  transform:translateX(-50%);
  width:min(1000px,94vw);
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:12px;
  padding:14px;
  border-radius:24px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(0,0,0,.22);
}
.dock .btn{
  padding:12px;
  border-radius:999px;
  text-align:center;
  font-weight:800;
  letter-spacing:.2px;
}
@media (max-width:520px){
  .dock{grid-template-columns:repeat(2,1fr)}
}
</style>
</head>

<body>

<div class="page">

  <div class="header">
    <p class="k" id="hk">FRONTIER</p>
    <h1 class="t" id="ht">CLOSED LOOP HABITAT MODEL</h1>
    <p class="s" id="hs"></p>

    <div class="lenses">
      <button class="pill active" id="lensInformal" type="button">INFORMAL</button>
      <button class="pill" id="lensFormal" type="button">FORMAL</button>
      <button class="pill" id="lensEngineering" type="button">ENGINEERING</button>
      <button class="pill" id="lensPlatform" type="button">PLATFORM</button>
    </div>
  </div>

  <div class="band" id="band">NO-AWAY SYSTEM</div>

  <div class="accordion" id="accordion"></div>

</div>

<nav class="dock" aria-label="Bottom navigation">
  <a class="btn" id="navUrban" href="/explore/frontier/urban/">URBAN</a>
  <a class="btn" id="navEnergy" href="/explore/frontier/energy/">ENERGY</a>
  <a class="btn" id="navWater" href="/explore/frontier/water/">WATER</a>
  <a class="btn" id="navWaste" href="/explore/frontier/waste/">WASTE</a>
</nav>

<script>
(function(){
  // ===== canonical state (lang only used on this page; links preserve it) =====
  var qs=new URLSearchParams(location.search);
  var lang=qs.get("lang")||localStorage.getItem("gd_lang")||"en";
  if(lang!=="en"&&lang!=="zh"&&lang!=="es") lang="en";
  try{ localStorage.setItem("gd_lang",lang); }catch(e){}
  document.documentElement.lang=lang;

  function q(){ return "?lang="+encodeURIComponent(lang); }

  document.getElementById("navUrban").href="/explore/frontier/urban/"+q();
  document.getElementById("navEnergy").href="/explore/frontier/energy/"+q();
  document.getElementById("navWater").href="/explore/frontier/water/"+q();
  document.getElementById("navWaste").href="/explore/frontier/waste/"+q();

  function pick(o){ return o[lang]||o.en; }

  // ===== header copy =====
  var headerCopy={
    en:"What happens when there is no ‘away’? When every leak is permanent, every shortcut becomes debt, and the only way forward is measurable closure.",
    zh:"当没有“扔掉”的地方会怎样？任何泄漏都是永久的，任何捷径都会变成债，唯一的出路是可测的闭环。",
    es:"¿Qué pasa cuando no existe ‘afuera’? Cada fuga es permanente, cada atajo se vuelve deuda, y la única salida es el cierre medible."
  };
  document.getElementById("hs").textContent=pick(headerCopy);

  // ===== lens system =====
  var lens="informal";

  // ===== sections =====
  var S = [
    {
      t:{en:"THE REAL PROBLEM",zh:"真正的问题",es:"EL PROBLEMA REAL"},
      sub:{en:"Not shortage. Loss. Unmeasured loss.",zh:"不是短缺，而是损耗。不可测的损耗。",es:"No es escasez. Es pérdida. Pérdida no medida."},
      c:{
        informal:{
          en:[
            "Most systems look fine because they can dump the bill somewhere else. Closed-loop is the opposite: nothing disappears. If you leak, you pay forever.",
            "That’s why closed-loop is a truth machine. It forces the questions people avoid: Where does it go? What does it become? What do we recover, and what do we lose?"
          ],
          zh:[
            "很多系统看起来没问题，是因为它们可以把账单扔到别处。闭环相反：没有东西会消失。你一泄漏，就要永远付账。",
            "所以闭环是“真相机器”。它逼你面对被回避的问题：它去哪了？变成什么？我们回收什么？损失什么？"
          ],
          es:[
            "Muchos sistemas ‘funcionan’ porque pueden tirar el costo a otro lugar. En ciclo cerrado no hay desaparición: si fugas, pagas para siempre.",
            "Por eso el ciclo cerrado es una máquina de verdad: obliga a responder ¿a dónde va?, ¿en qué se convierte?, ¿qué recuperamos y qué perdemos?"
          ]
        },
        formal:{
          en:[
            "Closed-loop failure is dominated by cumulative loss under bounded resupply. The core problem is inventory drift across coupled streams (air, water, nutrients, thermal, materials).",
            "Therefore the system must be designed as a conserved-vector routing problem with explicit accounting, thresholds, and recovery procedures."
          ],
          zh:[
            "闭环失败由“累积损失+补给受限”主导。核心问题是耦合流（空气/水/养分/热/材料）上的库存漂移。",
            "因此系统必须被设计为守恒向量路由问题：明确核算、阈值与恢复流程。"
          ],
          es:[
            "El fallo en ciclo cerrado está dominado por pérdidas acumulativas con reabastecimiento limitado. El problema central es deriva de inventario en flujos acoplados.",
            "Por lo tanto debe diseñarse como ruteo de vectores conservados con contabilidad explícita, umbrales y procedimientos de recuperación."
          ]
        },
        engineering:{
          en:[
            "Define inventories: water, oxygen, carbon, nitrogen, heat, structural mass. Bind sensors, buffers, and conversion modules to maintain bands under disturbance.",
            "Treat every stream as: measure → route → convert → retain, with reason-coded interventions and deterministic rollback paths."
          ],
          zh:[
            "定义库存：水、氧、碳、氮、热、结构质量。将传感、缓冲、转化模块绑定以在扰动下保持区间。",
            "每条流按：测量→路由→转化→保留处理，介入带原因码，恢复路径确定且可回滚。"
          ],
          es:[
            "Define inventarios: agua, oxígeno, carbono, nitrógeno, calor, masa estructural. Vincula sensores, buffers y módulos de conversión para mantener bandas bajo perturbación.",
            "Cada flujo: medir → rutear → convertir → retener, con intervenciones con razón y rollback determinista."
          ]
        },
        platform:{
          en:[
            "Expose closure status as a readable dashboard: what is closing, what is leaking, and what is improving. Keep claims bounded to measured windows.",
            "Use Dot.Grid to map dependencies, Gauges to show outputs, and Laws to constrain what the outputs are allowed to mean."
          ],
          zh:[
            "把闭环状态做成可读仪表板：哪里在闭合、哪里在泄漏、哪里在改善。主张绑定测量窗口。",
            "用Dot.Grid映射依赖，用Gauges展示输出，用Laws约束输出含义。"
          ],
          es:[
            "Exponer estado de cierre en dashboard: qué se cierra, qué fuga, qué mejora. Afirmaciones acotadas a ventanas medidas.",
            "Usa Dot.Grid para dependencias, Medidores para salidas, y Leyes para limitar interpretación."
          ]
        }
      }
    },

    {
      t:{en:"WHAT “CLOSED” MEANS",zh:"“闭环”是什么意思",es:"QUÉ SIGNIFICA ‘CERRADO’"},
      sub:{en:"Closure is measurable. Not poetic.",zh:"闭合是可测的，不是诗意的。",es:"Cierre es medible, no poético."},
      c:{
        informal:{
          en:[
            "Closed doesn’t mean perfect. Closed means you can see your losses, you can explain them, and you can shrink them on purpose.",
            "The goal is not to ‘feel sustainable.’ The goal is to keep the habitat alive with numbers you can defend."
          ],
          zh:[
            "闭环不等于完美。闭环意味着你看得见损耗、解释得清楚、还能有目的地把它缩小。",
            "目标不是“感觉可持续”，而是用你能辩护的数字把系统维持住。"
          ],
          es:[
            "Cerrado no significa perfecto. Significa que ves pérdidas, las explicas y las reduces a propósito.",
            "La meta no es ‘sentirse sostenible’. La meta es mantener vida con números defendibles."
          ]
        },
        formal:{
          en:[
            "Closure is defined by recovery fractions and stability bands across time windows. Each loop has: input, loss, recovery, and stored remainder.",
            "If definitions drift, closure claims become meaningless; therefore naming, windows, and thresholds are versioned."
          ],
          zh:[
            "闭合由回收分数与稳定区间在时间窗口内定义。每个回路包含：输入、损失、回收、残余储存。",
            "若定义漂移，闭合主张失效；因此命名、窗口、阈值必须版本化。"
          ],
          es:[
            "El cierre se define por fracciones de recuperación y bandas de estabilidad en ventanas de tiempo. Cada bucle: entrada, pérdida, recuperación, resto almacenado.",
            "Si derivan definiciones, las afirmaciones pierden significado; por eso nombres/ventanas/umbrales se versionan."
          ]
        },
        engineering:{
          en:[
            "Implement closure accounting per loop: water recovery, air recycling, nutrient cycling, thermal reuse, solids transformation. Enforce mass/energy conservation checks.",
            "Design for failure: isolate loops, contain contamination, and recover to last stable state with minimal blast radius."
          ],
          zh:[
            "按回路实现闭合核算：水回收、空气循环、养分循环、热复用、固体转化。执行质量/能量守恒检查。",
            "按失败设计：回路隔离、污染隔断、以最小爆炸半径回到上一稳定态。"
          ],
          es:[
            "Contabilidad de cierre por bucle: recuperación de agua, reciclaje de aire, ciclo de nutrientes, reutilización térmica, transformación de sólidos. Chequeos de conservación.",
            "Diseñar para fallo: aislar bucles, contener contaminación y volver al último estado estable con radio mínimo."
          ]
        },
        platform:{
          en:[
            "Publish closure levels as simple bands users understand: GREEN (stable), YELLOW (drifting), RED (leaking). Then link to the receipts behind each band.",
            "Keep navigation simple: one hub, one state, one truth source; no modal traps."
          ],
          zh:[
            "把闭合水平发布为可懂的区间：绿（稳定）、黄（漂移）、红（泄漏）。并链接到每个区间背后的收据。",
            "导航保持简单：一个枢纽、一个状态、一个真相来源；不做模态陷阱。"
          ],
          es:[
            "Publicar niveles de cierre como bandas simples: VERDE (estable), AMARILLO (deriva), ROJO (fuga), con recibos detrás.",
            "Navegación simple: un hub, un estado, una fuente de verdad; sin trampas modales."
          ]
        }
      }
    },

    {
      t:{en:"SHIMMER BRIDGE",zh:"SHIMMER 桥",es:"PUENTE SHIMMER"},
      sub:{en:"Same routing spine for cities and habitats.",zh:"城市与栖息地共用同一条路由脊柱。",es:"Misma columna de ruteo para ciudades y hábitats."},
      c:{
        informal:{
          en:[
            "In a city, ‘waste’ is something you wish would go away. In a habitat, waste is a death sentence if you can’t route it back into usefulness.",
            "That’s why SHIMMER matters. It’s the same move in both worlds: classify what you have, route it intelligently, convert it cleanly, retain what matters."
          ],
          zh:[
            "在城市里，“废弃物”是你希望它消失的东西；在栖息地里，如果你不能把它路由回有用状态，它就是死刑。",
            "所以 SHIMMER 重要：两种世界同一动作——分类你拥有的，智能路由，干净转化，保留关键资源。"
          ],
          es:[
            "En una ciudad, ‘residuo’ es algo que deseas que desaparezca. En un hábitat, es sentencia de muerte si no puedes rutearlo de vuelta a utilidad.",
            "Por eso importa SHIMMER: clasificar, rutear, convertir, retener."
          ]
        },
        formal:{
          en:[
            "SHIMMER implements real-time multi-pathway routing: intake classification → segmentation → routing matrix → conversion modules → energy/material retention.",
            "Habitat-scale loops are the extreme constraint case; terrestrial deployments are the proving ground."
          ],
          zh:[
            "SHIMMER 实现实时多路径路由：入口分类→分段→路由矩阵→转化模块→能源/材料保留。",
            "栖息地闭环是极限约束；地面部署是验证场。"
          ],
          es:[
            "SHIMMER implementa ruteo multi-vía en tiempo real: clasificación → segmentación → matriz → conversión → retención de energía/material.",
            "El hábitat es el caso extremo; la Tierra es el campo de prueba."
          ]
        },
        engineering:{
          en:[
            "Bind routing to conservation laws and explicit Δ inventories. Enforce contamination barriers, buffer design, and deterministic failure recovery paths.",
            "Compute and publish: recovery fractions, loss rates, and time-to-instability under perturbations."
          ],
          zh:[
            "把路由绑定守恒定律与显式Δ库存。执行污染隔离、缓冲设计与确定性故障恢复路径。",
            "计算并发布：回收分数、损耗率、扰动下到不稳定的时间。"
          ],
          es:[
            "Vincular ruteo a leyes de conservación y Δ inventarios. Barreras de contaminación, buffers y recuperación determinista.",
            "Calcular y publicar: fracciones de recuperación, tasas de pérdida y tiempo a inestabilidad bajo perturbaciones."
          ]
        },
        platform:{
          en:[
            "Expose one clear story: closure level + what changed + what to do next. Link each claim to receipts and keep all routes state-stable.",
            "Use Urban OS as the bridge node between city deployments and habitat prototypes."
          ],
          zh:[
            "暴露一个清晰故事：闭合等级+变化了什么+下一步做什么。每条主张都链接收据，路由保持状态稳定。",
            "用Urban OS作为城市部署与栖息地原型之间的桥节点。"
          ],
          es:[
            "Mostrar una narrativa clara: nivel de cierre + qué cambió + qué hacer después, con recibos y rutas estables.",
            "Usar Urban OS como nodo puente entre despliegues urbanos y prototipos de hábitat."
          ]
        }
      }
    },

    {
      t:{en:"ROADMAP POSTURE",zh:"路线姿态",es:"POSTURA DE HOJA DE RUTA"},
      sub:{en:"Earn orbit by proving Earth first.",zh:"先在地球证明，才配去轨道。",es:"Gana órbita probando primero en Tierra."},
      c:{
        informal:{
          en:[
            "We don’t start in orbit. We start where the receipts are cheap: municipal loops, industrial loops, remote loops.",
            "Closed-loop becomes real when the numbers survive pressure. That’s how you get loud claims without losing your mind."
          ],
          zh:[
            "我们不从轨道开始。我们从“收据便宜”的地方开始：市政回路、工业回路、偏远回路。",
            "闭环要真实，必须让数字经得住压力。这才是“大声主张又不发疯”的方式。"
          ],
          es:[
            "No empezamos en órbita. Empezamos donde los recibos son baratos: municipal, industrial, remoto.",
            "El ciclo cerrado se vuelve real cuando los números sobreviven presión."
          ]
        },
        formal:{
          en:[
            "Phase gating: terrestrial pilots → remote isolation → orbital deployment. Escalation requires receipts and reproducibility; missing prerequisites remain labeled as NOT AVAILABLE.",
            "Non-negotiables: no net-positive fusion claims; no megastructure claims in near horizons; no silent rule changes."
          ],
          zh:[
            "阶段闸门：地面试点→偏远隔离→轨道部署。升级要求收据与可复现；缺前置条件必须标注 NOT AVAILABLE。",
            "不可谈判：不做净增益聚变主张；近期限不做巨构主张；规则变更禁止静默。"
          ],
          es:[
            "Puertas por fase: pilotos en Tierra → aislamiento remoto → despliegue orbital. Escalación requiere recibos y reproducibilidad; prerrequisitos faltantes quedan como NO DISPONIBLE.",
            "No negociables: sin fusión neta positiva; sin megaestructuras cercanas; sin cambios silenciosos de reglas."
          ]
        },
        engineering:{
          en:[
            "Define measurable closure targets per loop (water/air/solids). Use buffers and segmentation to prevent cascade. Design recovery as first-class logic.",
            "Integrate instrumentation and export: Gauges for outputs, Laws for doctrine bounds, Registry for status."
          ],
          zh:[
            "为每个回路定义可测闭合目标（水/气/固体）。用缓冲与分段阻断级联。把恢复设计为一等逻辑。",
            "整合仪器与导出：Gauges出输出，Laws定边界，Registry记状态。"
          ],
          es:[
            "Definir objetivos de cierre medibles por bucle (agua/aire/sólidos). Usar buffers y segmentación para evitar cascadas. Recuperación como lógica de primera clase.",
            "Integrar instrumentación y exportación: Medidores, Leyes y Registro."
          ]
        },
        platform:{
          en:[
            "Make the journey navigable: one page per concept, single-open accordion, clear jump routes, and persistent state. Dense without feeling dense.",
            "Frontier pages explain possibility; product pages explain deployability; laws/gauges explain constraints and evidence."
          ],
          zh:[
            "让旅程可导航：一概念一页、单开手风琴、清晰跳转、状态持久。密但不显密。",
            "Frontier讲可能性；Products讲可部署；Laws/Gauges讲约束与证据。"
          ],
          es:[
            "Hacer el camino navegable: una página por concepto, acordeón de apertura única, rutas claras y estado persistente.",
            "Frontier explica posibilidad; productos explican despliegue; leyes/medidores explican límites y evidencia."
          ]
        }
      }
    }
  ];

  function lensLabel(){
    if(lang==="zh"){
      return {informal:"通俗",formal:"正式",engineering:"工程",platform:"平台"};
    }
    if(lang==="es"){
      return {informal:"INFORMAL",formal:"FORMAL",engineering:"INGENIERÍA",platform:"PLATAFORMA"};
    }
    return {informal:"INFORMAL",formal:"FORMAL",engineering:"ENGINEERING",platform:"PLATFORM"};
  }

  function render(){
    // band title (simple)
    document.getElementById("band").textContent = (lang==="zh")
      ? "无“扔掉”系统"
      : (lang==="es") ? "SISTEMA SIN ‘AFUERA’" : "NO-AWAY SYSTEM";

    // lens button labels
    var L=lensLabel();
    document.getElementById("lensInformal").textContent=L.informal;
    document.getElementById("lensFormal").textContent=L.formal;
    document.getElementById("lensEngineering").textContent=L.engineering;
    document.getElementById("lensPlatform").textContent=L.platform;

    // header labels
    document.getElementById("hk").textContent = (lang==="zh") ? "前沿" : (lang==="es") ? "FRONTERA" : "FRONTIER";
    document.getElementById("ht").textContent = pick({en:"CLOSED LOOP HABITAT MODEL",zh:"闭环栖息地模型",es:"MODELO DE HÁBITAT DE CICLO CERRADO"});
    document.getElementById("hs").textContent = pick(headerCopy);

    // accordion
    var acc=document.getElementById("accordion");
    acc.innerHTML="";
    S.forEach(function(item, idx){
      var sec=document.createElement("div");
      sec.className="section";

      var head=document.createElement("div");
      head.className="head";

      var title=document.createElement("div");
      title.className="title";
      title.textContent = pick(item.t);

      var chev=document.createElement("div");
      chev.className="chev";
      chev.textContent="▸";

      head.appendChild(title);
      head.appendChild(chev);

      var body=document.createElement("div");
      body.className="body";

      var sub=document.createElement("div");
      sub.style.fontWeight="800";
      sub.style.color="rgba(255,255,255,.86)";
      sub.style.marginBottom="12px";
      sub.textContent = pick(item.sub);

      body.appendChild(sub);

      var lines=item.c[lens];
      for(var i=0;i<lines.length;i++){
        var p=document.createElement("div");
        p.style.marginTop = (i===0) ? "0" : "14px";
        p.textContent = lines[i];
        body.appendChild(p);
      }

      // minimal “jump” row (keeps navigation legible)
      var jump=document.createElement("div");
      jump.className="jump";

      var openLabel = (lang==="zh") ? "打开" : (lang==="es") ? "ABRIR" : "OPEN";
      var j1=document.createElement("a"); j1.className="btn"; j1.textContent=openLabel+": URBAN"; j1.href="/explore/frontier/urban/"+q();
      var j2=document.createElement("a"); j2.className="btn"; j2.textContent=openLabel+": LAWS";  j2.href="/laws/"+q();
      var j3=document.createElement("a"); j3.className="btn"; j3.textContent=openLabel+": GAUGES"; j3.href="/gauges/"+q();
      jump.appendChild(j1); jump.appendChild(j2); jump.appendChild(j3);
      body.appendChild(jump);

      sec.appendChild(head);
      sec.appendChild(body);
      acc.appendChild(sec);

      function closeAll(){
        acc.querySelectorAll(".section").forEach(function(x){
          x.classList.remove("open");
          var c=x.querySelector(".chev");
          if(c) c.textContent="▸";
        });
      }

      function toggle(){
        var willOpen=!sec.classList.contains("open");
        closeAll();
        if(willOpen){ sec.classList.add("open"); chev.textContent="▾"; }
      }

      head.addEventListener("click", toggle);
      head.addEventListener("keydown", function(e){
        if(e.key==="Enter"||e.key===" "){ e.preventDefault(); toggle(); }
      });
      head.tabIndex=0; head.setAttribute("role","button");

      if(idx===0){ sec.classList.add("open"); chev.textContent="▾"; }
    });
  }

  function setActive(){
    ["lensInformal","lensFormal","lensEngineering","lensPlatform"].forEach(function(id){
      document.getElementById(id).classList.remove("active");
    });
    if(lens==="informal") document.getElementById("lensInformal").classList.add("active");
    if(lens==="formal") document.getElementById("lensFormal").classList.add("active");
    if(lens==="engineering") document.getElementById("lensEngineering").classList.add("active");
    if(lens==="platform") document.getElementById("lensPlatform").classList.add("active");
  }

  document.getElementById("lensInformal").addEventListener("click", function(){ lens="informal"; setActive(); render(); });
  document.getElementById("lensFormal").addEventListener("click", function(){ lens="formal"; setActive(); render(); });
  document.getElementById("lensEngineering").addEventListener("click", function(){ lens="engineering"; setActive(); render(); });
  document.getElementById("lensPlatform").addEventListener("click", function(){ lens="platform"; setActive(); render(); });

  setActive();
  render();

})();
</script>

</body>
</html>

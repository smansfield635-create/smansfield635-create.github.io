<!-- TNT — /products/education/index.html  (EDUCATION SUB-HUB · DIAMOND-OF-DIAMONDS)
     HARD RULES:
       - DO NOT TOUCH /assets/ui.css
       - DO NOT TOUCH /assets/branch.css
       - Page styles ONLY (this file)
     FEATURES:
       - One outer diamond + four inner diamonds
       - Click diamond → centered gem modal
       - Lenses INSIDE modal only:
           STYLE: Formal/Informal (gd_style)
           TIME: Concept/Live/Roadmap (gd_time = origin/now/post)
       - Dual language FULL (EN + 中文) ALWAYS VISIBLE (gd_lang controls primary order)
       - 4 sections × 4 bulletins for EVERY diamond, EVERY lens
       - Navigation: BACK (/products/), EXIT (/door/), bottom dock with state
-->

<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>PRODUCTS · EDUCATION</title>

<link rel="stylesheet" href="/assets/ui.css"/>
<link rel="stylesheet" href="/assets/branch.css"/>

<style>
:root{
  --R:154px;
  --gold:rgba(212,175,55,.9);
  --goldSoft:rgba(212,175,55,.35);
  --obs1:#070b12;
  --obs2:#0c1626;
  --mut:rgba(255,255,255,.84);
  --mut2:rgba(255,255,255,.68);
}
body{
  margin:0; min-height:100vh; overflow-x:hidden;
  background:
    radial-gradient(circle at 50% 40%, rgba(90,140,255,.10), transparent 60%),
    repeating-linear-gradient(45deg, rgba(255,255,255,.02) 0 1px, transparent 1px 100px),
    linear-gradient(180deg,#b00000 0%,#7a0000 60%,#550000 100%);
  font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
  color:#fff;
}
.btn{
  padding:10px 16px; border-radius:14px;
  background:linear-gradient(145deg,var(--obs2),var(--obs1));
  color:#fff; border:1px solid rgba(255,255,255,.08);
  box-shadow:0 14px 36px rgba(0,0,0,.7);
  cursor:pointer; font-weight:900; letter-spacing:.2px; text-decoration:none;
}
.btn:hover{ box-shadow:0 18px 50px rgba(0,0,0,.9), 0 0 14px var(--goldSoft); }
.top-left{
  position:fixed; left:16px; top:16px; z-index:90;
  display:flex; gap:10px; flex-wrap:wrap; align-items:center;
}
.brand{
  position:fixed; left:50%; top:16px; transform:translateX(-50%);
  z-index:80; text-align:center;
  padding:10px 14px; border-radius:999px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(0,0,0,.16); backdrop-filter:blur(8px);
}
.brand .name{ font-weight:950; letter-spacing:1.2px; font-size:12px; opacity:.95; white-space:pre-line; }
.brand .tag{ font-size:11px; letter-spacing:.6px; opacity:.70; margin-top:2px; white-space:pre-line; }

/* Stage */
.stage{
  position:fixed; left:50%; top:52%;
  transform:translate(-50%,-50%);
  width:min(720px,94vw); height:min(720px,94vw);
  z-index:40;
}
.outer{
  position:absolute; left:50%; top:50%;
  width:min(680px,92vw); height:min(680px,92vw);
  transform:translate(-50%,-50%) rotate(45deg);
  border-radius:60px;
  background:
    radial-gradient(circle at 30% 25%, rgba(255,255,255,.08), transparent 55%),
    radial-gradient(circle at 70% 80%, rgba(0,80,255,.14), transparent 60%),
    linear-gradient(160deg, rgba(14,24,40,.45) 0%, rgba(7,11,18,.62) 70%);
  border:1px solid rgba(255,255,255,.10);
  box-shadow:
    0 90px 260px rgba(0,0,0,.72),
    inset 0 2px 0 rgba(255,255,255,.10),
    inset 0 -50px 90px rgba(0,0,0,.55);
  pointer-events:none; opacity:.85;
}
.outer::after{
  content:""; position:absolute; inset:0; border-radius:60px;
  background:repeating-conic-gradient(from 0deg, rgba(255,255,255,.04) 0deg 6deg, transparent 6deg 18deg);
  opacity:.16;
}
.d{
  width:170px; height:170px;
  position:absolute; left:50%; top:50%;
  transform-origin:center; border-radius:26px;
  cursor:pointer; -webkit-tap-highlight-color:transparent;
  background:
    radial-gradient(circle at 35% 25%, rgba(255,255,255,.14), transparent 55%),
    radial-gradient(circle at 70% 80%, rgba(0,80,255,.18), transparent 60%),
    linear-gradient(160deg, rgba(12,22,38,.92) 0%, rgba(7,11,18,.95) 70%);
  border:1px solid rgba(255,255,255,.10);
  box-shadow:
    0 28px 84px rgba(0,0,0,.78),
    inset 0 2px 0 rgba(255,255,255,.14),
    inset 0 -28px 44px rgba(0,0,0,.62);
  transition:transform 220ms ease, box-shadow 220ms ease, border-color 220ms ease;
}
.d::before{
  content:""; position:absolute; inset:0; border-radius:26px; padding:1px;
  background:linear-gradient(120deg, transparent 0%, var(--goldSoft) 50%, transparent 100%);
  opacity:.45;
  -webkit-mask:linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  -webkit-mask-composite:xor; mask-composite:exclude;
  pointer-events:none;
}
.d::after{
  content:""; position:absolute; left:12%; right:12%; top:10%; height:28%;
  border-radius:999px;
  background:linear-gradient(to bottom, rgba(255,255,255,.16), rgba(255,255,255,0));
  opacity:.85; transform:rotate(-10deg);
  pointer-events:none;
}
.d:hover{
  transform:translate(-50%,-50%) rotate(45deg) scale(1.02);
  box-shadow:
    0 34px 110px rgba(0,0,0,.88),
    0 0 18px rgba(212,175,55,.18),
    inset 0 2px 0 rgba(255,255,255,.18),
    inset 0 -32px 52px rgba(0,0,0,.68);
}
.d.active{
  border-color:rgba(212,175,55,.55);
  box-shadow:
    0 34px 110px rgba(0,0,0,.88),
    0 0 30px rgba(212,175,55,.40),
    inset 0 2px 0 rgba(255,255,255,.18),
    inset 0 -32px 52px rgba(0,0,0,.68);
}
.d-n{ transform:translate(-50%,-50%) translate(0, calc(var(--R) * -1)) rotate(45deg); }
.d-e{ transform:translate(-50%,-50%) translate(var(--R), 0) rotate(45deg); }
.d-s{ transform:translate(-50%,-50%) translate(0, var(--R)) rotate(45deg); }
.d-w{ transform:translate(-50%,-50%) translate(calc(var(--R) * -1), 0) rotate(45deg); }

.inner{
  width:100%; height:100%; transform:rotate(-45deg);
  display:flex; flex-direction:column; align-items:center; justify-content:center;
  text-align:center; padding:16px; gap:10px;
  pointer-events:none;
}
.lab{ font-weight:950; letter-spacing:.8px; font-size:16px; white-space:pre-line; }
.sub{ font-size:12.5px; opacity:.80; line-height:1.35; max-width:18em; white-space:pre-line; }

.core{
  position:absolute; left:50%; top:50%;
  transform:translate(-50%,-50%);
  width:74px; height:74px; border-radius:22px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(0,0,0,.18);
  box-shadow:0 18px 44px rgba(0,0,0,.62), inset 0 2px 0 rgba(255,255,255,.10);
  display:grid; place-items:center;
  font-weight:950; letter-spacing:.5px;
  opacity:.92; pointer-events:none;
}

/* Dock */
.dock{
  position:fixed; left:50%;
  bottom:max(12px, env(safe-area-inset-bottom));
  transform:translateX(-50%);
  z-index:90;
  width:min(900px,94vw);
  display:flex; justify-content:center;
  gap:10px; flex-wrap:wrap;
  padding:10px 12px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(0,0,0,.20);
  backdrop-filter:blur(8px);
}

/* Modal */
.bd{
  position:fixed; inset:0; z-index:200;
  background:rgba(0,0,0,.65);
  backdrop-filter:blur(10px);
  display:none;
}
.bd.show{display:block;}
.modal{
  position:fixed; left:50%; top:50%;
  transform:translate(-50%,-50%);
  width:min(1020px,94vw);
  max-height:88vh;
  display:none;
  z-index:210;
}
.modal.show{display:block;}
.shell{
  height:88vh;
  border-radius:26px;
  border:1px solid rgba(255,255,255,.10);
  background:
    radial-gradient(circle at 50% 18%, rgba(176,0,0,.20), transparent 55%),
    radial-gradient(circle at 40% 25%, rgba(90,140,255,.12), transparent 55%),
    linear-gradient(160deg,var(--obs2) 0%, var(--obs1) 65%);
  box-shadow:0 60px 180px rgba(0,0,0,.92);
  overflow:hidden;
  display:flex;
  flex-direction:column;
  position:relative;
}
.shell::before{
  content:""; position:absolute; left:50%; top:58%;
  width:min(980px,94vw); height:min(980px,94vw);
  transform:translate(-50%,-50%) rotate(45deg);
  border-radius:70px;
  background:
    radial-gradient(circle at 30% 25%, rgba(255,255,255,.08), transparent 55%),
    radial-gradient(circle at 70% 80%, rgba(0,80,255,.16), transparent 60%),
    linear-gradient(160deg, rgba(14,24,40,.45) 0%, rgba(7,11,18,.68) 70%);
  box-shadow:
    0 100px 280px rgba(0,0,0,.72),
    inset 0 2px 0 rgba(255,255,255,.10),
    inset 0 -55px 100px rgba(0,0,0,.55);
  opacity:.55; pointer-events:none;
}
.mhead{
  display:flex; justify-content:space-between; align-items:center;
  gap:10px; padding:14px 16px;
  border-bottom:1px solid rgba(255,255,255,.08);
  position:relative; z-index:2;
}
.mtitle{ margin:0; font-weight:950; letter-spacing:.3px; font-size:16px; white-space:pre-line; }
.mclose{ border:0; background:transparent; color:#fff; font-size:18px; cursor:pointer; padding:8px 10px; }
.mbody{
  padding:14px 16px 18px;
  overflow:auto; -webkit-overflow-scrolling:touch;
  flex:1 1 auto;
  position:relative; z-index:2;
}
.lensbar{
  display:flex; gap:10px; flex-wrap:wrap;
  align-items:center; justify-content:center;
  padding:10px 10px 14px;
  border-bottom:1px solid rgba(255,255,255,.08);
  margin:-6px -6px 14px;
}
.chip{
  padding:10px 16px; border-radius:999px;
  background:linear-gradient(145deg,var(--obs2),var(--obs1));
  border:1px solid rgba(255,255,255,.08);
  box-shadow:0 14px 36px rgba(0,0,0,.65);
  cursor:pointer; font-weight:900; letter-spacing:.2px; color:#fff;
  white-space:pre-line;
}
.chip.active{
  border-color:rgba(212,175,55,.35);
  box-shadow:0 18px 50px rgba(0,0,0,.9), 0 0 16px rgba(212,175,55,.30);
}
.mgrid{ display:grid; gap:14px; }
@media (min-width:920px){ .mgrid{ grid-template-columns:1fr 1fr; } }
.box{
  padding:16px 18px; border-radius:22px;
  background:
    radial-gradient(circle at 30% 30%, rgba(120,160,255,.08), transparent 55%),
    linear-gradient(145deg, rgba(12,22,38,.92), rgba(7,11,18,.95));
  border:1px solid rgba(255,255,255,.10);
  box-shadow:0 18px 60px rgba(0,0,0,.70), inset 0 2px 0 rgba(255,255,255,.06);
  position:relative;
}
.box::before{
  content:""; position:absolute; inset:0; border-radius:22px; padding:1px;
  background:linear-gradient(120deg, transparent 0%, var(--goldSoft) 50%, transparent 100%);
  opacity:.55;
  -webkit-mask:linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  -webkit-mask-composite:xor; mask-composite:exclude;
  pointer-events:none;
}
.h{ margin:0 0 8px; font-weight:950; letter-spacing:.2px; white-space:pre-line; }
.p{ margin:0 0 10px; color:var(--mut); line-height:1.55; white-space:pre-line; }
.ul{ margin:0 0 0 18px; padding:0; color:var(--mut2); }
.ul li{ margin:6px 0; white-space:pre-line; }
.mact{ display:flex; gap:10px; flex-wrap:wrap; justify-content:center; margin-top:14px; }
.sbtn{
  padding:12px 18px; border-radius:14px;
  background:linear-gradient(145deg,var(--obs2),var(--obs1));
  color:#fff; border:1px solid rgba(255,255,255,.08);
  box-shadow:0 14px 36px rgba(0,0,0,.7);
  cursor:pointer; font-weight:900; letter-spacing:.2px; text-decoration:none;
}
.sbtn:hover{ box-shadow:0 18px 50px rgba(0,0,0,.9), 0 0 14px var(--goldSoft); }

@media (max-width:560px){
  :root{ --R: 136px; }
  .d{ width:158px; height:158px; }
  .stage{ top:54%; }
}
</style>
</head>

<body>

<div class="top-left">
  <a class="btn" id="btnBack" href="/products/">BACK</a>
  <a class="btn" id="btnExit" href="/door/">EXIT</a>
</div>

<div class="brand">
  <div class="name" id="brandName">PRODUCTS</div>
  <div class="tag" id="brandTag">EDUCATION SYSTEMS</div>
</div>

<div class="stage">
  <div class="outer"></div>

  <div class="d d-n" id="dProg" role="button" tabindex="0">
    <div class="inner">
      <div class="lab" id="progLab">PROGRAMS</div>
      <div class="sub" id="progSub">Curriculum · outcomes.</div>
    </div>
  </div>

  <div class="d d-e" id="dLang" role="button" tabindex="0">
    <div class="inner">
      <div class="lab" id="langLab">LANGUAGE</div>
      <div class="sub" id="langSub">1001 · fluency path.</div>
    </div>
  </div>

  <div class="d d-s" id="dTrain" role="button" tabindex="0">
    <div class="inner">
      <div class="lab" id="trainLab">TRAINING</div>
      <div class="sub" id="trainSub">Masterclasses · reps.</div>
    </div>
  </div>

  <div class="d d-w" id="dCert" role="button" tabindex="0">
    <div class="inner">
      <div class="lab" id="certLab">CERTIFICATION</div>
      <div class="sub" id="certSub">Verification · tiers.</div>
    </div>
  </div>

  <div class="core">◆</div>
</div>

<nav class="dock" id="dock">
  <a class="btn" id="dockHub" href="/home/">HUB</a>
  <a class="btn" id="dockTerminal" href="/index.html">TERMINAL</a>
  <a class="btn" id="dockLinks" href="/links/">LINKS</a>
  <a class="btn" id="dockProducts" href="/products/">PRODUCTS</a>
  <a class="btn" id="dockLaws" href="/laws/">LAWS</a>
  <a class="btn" id="dockGauges" href="/gauges/">GAUGES</a>
</nav>

<div class="bd" id="bd"></div>

<div class="modal" id="modal" role="dialog" aria-modal="true">
  <div class="shell">
    <div class="mhead">
      <h3 class="mtitle" id="mTitle">DETAIL</h3>
      <button class="mclose" id="mClose" aria-label="Close" type="button">✕</button>
    </div>

    <div class="mbody">
      <div class="lensbar">
        <button class="chip" id="styleChip" type="button">STYLE: FORMAL</button>
        <button class="chip" data-time="origin" id="chipConcept" type="button">CONCEPT</button>
        <button class="chip" data-time="now" id="chipLive" type="button">LIVE</button>
        <button class="chip" data-time="post" id="chipRoadmap" type="button">ROADMAP</button>
      </div>

      <div class="mgrid">
        <div class="box"><h4 class="h" id="h1"></h4><p class="p" id="p1"></p><ul class="ul" id="u1"></ul></div>
        <div class="box"><h4 class="h" id="h2"></h4><p class="p" id="p2"></p><ul class="ul" id="u2"></ul></div>
        <div class="box"><h4 class="h" id="h3"></h4><p class="p" id="p3"></p><ul class="ul" id="u3"></ul></div>
        <div class="box"><h4 class="h" id="h4"></h4><p class="p" id="p4"></p><ul class="ul" id="u4"></ul></div>
      </div>

      <div class="mact">
        <button class="sbtn" id="mReturn" type="button">RETURN</button>
        <a class="sbtn" id="mJumpHub" href="/home/">JUMP HUB</a>
        <a class="sbtn" id="mJumpProducts" href="/products/">JUMP PRODUCTS</a>
      </div>
    </div>
  </div>
</div>

<script>
(function(){
  // Canonical hydration (keys unchanged; values normalized)
  var qs = new URLSearchParams(location.search);
  var qLang = qs.get("lang");
  var lang = (qLang==="zh"||qLang==="en") ? qLang : ((localStorage.getItem("gd_lang")==="zh") ? "zh" : "en");
  var style = (qs.get("style") || localStorage.getItem("gd_style") || "formal");
  var time  = (qs.get("time")  || localStorage.getItem("gd_time")  || "now");
  if(time==="trajectory") time="post";
  if(["origin","now","post"].indexOf(time)<0) time="now";
  if(["formal","informal"].indexOf(style)<0) style="formal";
  try{ localStorage.setItem("gd_lang", lang); localStorage.setItem("gd_style", style); localStorage.setItem("gd_time", time); }catch(e){}

  function q(){ return "lang="+encodeURIComponent(lang)+"&style="+encodeURIComponent(style)+"&time="+encodeURIComponent(time); }

  function setLinks(){
    var s=q();
    document.getElementById("btnBack").href="/products/?"+s;
    document.getElementById("btnExit").href="/door/?"+s;
    document.getElementById("dockHub").href="/home/?"+s;
    document.getElementById("dockTerminal").href="/index.html?"+s;
    document.getElementById("dockLinks").href="/links/?"+s;
    document.getElementById("dockProducts").href="/products/?"+s;
    document.getElementById("dockLaws").href="/laws/?"+s;
    document.getElementById("dockGauges").href="/gauges/?"+s;
    document.getElementById("mJumpHub").href="/home/?"+s;
    document.getElementById("mJumpProducts").href="/products/?"+s;
  }

  // Bilingual render: always show EN + 中文; gd_lang controls primary order.
  function mix(enStr, zhStr){
    var a = (enStr==null) ? "" : String(enStr);
    var b = (zhStr==null) ? "" : String(zhStr);
    if(!a && !b) return "";
    return (lang==="zh") ? (b + "\n" + a) : (a + "\n" + b);
  }
  function mixList(enArr, zhArr){
    var a = Array.isArray(enArr) ? enArr : [];
    var b = Array.isArray(zhArr) ? zhArr : [];
    var n = Math.max(a.length, b.length);
    var out = [];
    for(var i=0;i<n;i++){
      out.push(mix(a[i]||"", b[i]||""));
    }
    return out;
  }

  // Base text packs (content expanded; UI/structure unchanged)
  var TEXT = {
    en:{
      title:"PRODUCTS",
      tag:"EDUCATION SYSTEMS",
      d:{
        prog:{lab:"PROGRAMS", sub:"Curriculum · outcomes."},
        lang:{lab:"LANGUAGE", sub:"1001 · four levels + 10% sample."},
        train:{lab:"TRAINING", sub:"Masterclasses · reps."},
        cert:{lab:"CERTIFICATION", sub:"Verification · tiers."}
      },
      lens:{formal:"FORMAL", informal:"INFORMAL", concept:"CONCEPT", live:"LIVE", roadmap:"ROADMAP"},
      buttons:{return:"RETURN", jhub:"JUMP HUB", jprod:"JUMP PRODUCTS"},
      content:{
        prog:{
          origin:{formal:{title:"Programs",
            b1:{h:"What it is",p:"A traversal-first curriculum system built as navigable structures (not linear chapters).",u:["Programs are maps (not stairs).","Entry points are flexible.","Return is deterministic.","Progress is evidence-based."]},
            b2:{h:"Program set",p:"The education line is organized into clear program lanes that share one stable topology.",u:["Foundation Sprint (30 days).","Structure Immersion (90 days).","Leadership English track.","Business Precision track."]},
            b3:{h:"Traversal rule",p:"You can move forward, sideways, or deeper—without losing your place.",u:["Pick a node.","Run reps.","Verify output.","Return and branch."]},
            b4:{h:"Outcomes",p:"Programs ship as drills + scripts + checkpoints so learners can execute daily.",u:["Printable lists.","Prompt packs.","Conversation drills.","Milestone checks."]}
          }, informal:{title:"Programs",
            b1:{h:"What it is",p:"Programs you can actually follow without getting trapped in a ladder.",u:["Clear map.","Clear entry.","Clear return.","Clear result."]},
            b2:{h:"Programs",p:"Here’s what’s on the menu.",u:["30-Day Foundation.","90-Day Immersion.","Leadership English.","Business Precision."]},
            b3:{h:"How it works",p:"Tap what you need, practice it, then come back and branch again.",u:["Enter fast.","Practice now.","Return safely.","Repeat."]},
            b4:{h:"What you get",p:"Daily execution packs.",u:["Lists.","Prompts.","Drills.","Checkpoints."]}
          }},
          now:{formal:{title:"Programs",
            b1:{h:"Live status",p:"Program topology is live; content expands inside fixed nodes without breaking routing.",u:["Stable routes.","Stable lenses.","State propagation.","No drift."]},
            b2:{h:"Quality rule",p:"Every node must be immediately usable: 4×4 bulletins first, depth later.",u:["No empty nodes.","Lens changes update text.","Four boxes always.","Four bullets each."]},
            b3:{h:"Progress model",p:"Progress is measured by completion cycles, not seat time.",u:["Deviation detected.","Operator applied.","Recovery verified.","Cycle logged."]},
            b4:{h:"Neutral posture",p:"Programs remain neutral: structure carries contrast without ideology.",u:["No preaching.","No capture.","Just structure.","Just outcomes."]}
          }, informal:{title:"Programs",
            b1:{h:"Live",p:"The structure is stable while content grows.",u:["Safe navigation.","Stable lenses.","Return always works.","No drift."]},
            b2:{h:"Rule",p:"Every node stays usable.",u:["4 boxes.","4 bullets.","Text changes with lenses.","No blanks."]},
            b3:{h:"Progress",p:"We track completion cycles, not vibes.",u:["Detect.","Apply.","Verify.","Log."]},
            b4:{h:"Tone",p:"Practical and neutral.",u:["No fluff.","No capture.","Just reps.","Just results."]}
          }},
          post:{formal:{title:"Programs",
            b1:{h:"Roadmap",p:"Expand programs by audience while preserving the same stable topology.",u:["Kids/ESL track.","Adult professional track.","Coach training track.","Enterprise track."]},
            b2:{h:"Depth control",p:"Depth becomes adjustable while routing stays deterministic.",u:["Fast view.","Deep view.","Adaptive pacing.","Same map."]},
            b3:{h:"Verification",p:"Optional completion verification connects to certification tiers.",u:["Assessments.","Evidence logs.","Badges.","Registry hooks."]},
            b4:{h:"Distribution",p:"Ship as bundles: PDF packs, audio prompts, micro-drills.",u:["PDF bundles.","Audio prompts.","Practice cards.","Lesson packs."]}
          }, informal:{title:"Programs",
            b1:{h:"Next",p:"More tracks, same map.",u:["More lessons.","More drill packs.","Same navigation.","Same rules."]},
            b2:{h:"Depth",p:"Choose quick or deep.",u:["Quick.","Deep.","Your speed.","Stable routes."]},
            b3:{h:"Proof",p:"If needed, completion can be verified.",u:["Tests.","Badges.","Logs.","Lookups."]},
            b4:{h:"Packaging",p:"More bundles.",u:["PDFs.","Audio.","Cards.","Micro-lessons."]}
          }}
        },

        lang:{
          origin:{formal:{title:"Language (1001) — Four Levels + 10% Sample",
            b1:{h:"Four levels",p:"The 1001 core is split into four mastery bands (~250 words each).",u:["L1 Foundation (0–250).","L2 Function (251–500).","L3 Structure (501–750).","L4 Precision (751–1001)."]},
            b2:{h:"What each level unlocks",p:"Levels are capability bands, not permission gates.",u:["L1: complete basic thoughts.","L2: explain and compare.","L3: describe systems and process.","L4: express nuance + teach."]},
            b3:{h:"10% sample (≈100 words) — traversal cluster",p:"Sample is taught as a cluster: vocabulary → structure → application.",u:["Cluster verbs: be/do/go/make/get.","Cluster connectors: because/if/when/how.","Cluster structure: system/change/result.","Cluster control: improve/need/possible."]},
            b4:{h:"10% sample — 4 traversal drills",p:"Each drill forces real use and return, not memorization.",u:["Drill 1: build 5 ‘because’ sentences.","Drill 2: swap ‘because’ → ‘if’; keep meaning clean.","Drill 3: name a daily system; change one step.","Drill 4: state expected result; test if possible."]}
          }, informal:{title:"Language (1001) — Four Levels + 10% Sample",
            b1:{h:"Levels",p:"Four levels, about 250 words each.",u:["L1 Foundation.","L2 Function.","L3 Structure.","L4 Precision."]},
            b2:{h:"Why levels work",p:"They guide you, but you can jump where you need.",u:["Not a strict ladder.","Enter by need.","Return always works.","Progress stays measurable."]},
            b3:{h:"10% sample",p:"Here’s a real starter cluster (~100 words) that makes you speak fast.",u:["Core verbs.","Core connectors.","Core structure words.","Core control words."]},
            b4:{h:"How to use the sample",p:"Do these 4 drills daily for one week.",u:["5 ‘because’ lines.","Swap to ‘if’.","Name a system.","Change one step."]}
          }},
          now:{formal:{title:"Language (1001) — Live Build",
            b1:{h:"Live structure",p:"Categories + levels are stable; expansions happen inside the same nodes.",u:["Stable categories.","Stable levels.","Deterministic routing.","Safe placeholders."]},
            b2:{h:"Lens integrity",p:"Formal/Informal and Concept/Live/Roadmap must change meaning, not cosmetics.",u:["Formal = precise framing.","Informal = direct framing.","Concept = definition.","Live = current execution."]},
            b3:{h:"Traversal (anti-linear)",p:"Traditional learning is linear; traversal learning is map-based.",u:["Enter where needed.","Cross-link across levels.","Return without losing place.","Repeat cycles."]},
            b4:{h:"Outcome target",p:"Daily reps + checkpoints improve function faster than passive consumption.",u:["Daily drill loop.","Conversation reps.","Checkpoint tests.","Evidence logs."]}
          }, informal:{title:"Language (1001) — Live Build",
            b1:{h:"Live",p:"It works now and won’t break while it grows.",u:["Stable map.","Stable lenses.","Safe return.","No drift."]},
            b2:{h:"Lenses",p:"Switch lenses and the text truly changes.",u:["Formal vs direct.","Concept vs live vs roadmap.","No fake toggles.","Always coherent."]},
            b3:{h:"Traversal",p:"Not a ladder. A map.",u:["Jump in.","Practice.","Return.","Repeat."]},
            b4:{h:"Goal",p:"Fast practical English.",u:["Speak more.","Understand more.","Practice daily.","Track wins."]}
          }},
          post:{formal:{title:"Language (1001) — Roadmap",
            b1:{h:"Overlay packs",p:"Add deterministic overlay packs by country and domain.",u:["Country overlay.","Industry overlay.","Dialect notes.","Fallback safe."]},
            b2:{h:"Beyond 1001",p:"Add Level 5+ while preserving the core as the base layer.",u:["Industry vocabulary.","Formal writing.","Negotiation.","Technical packs."]},
            b3:{h:"Assessment",p:"Placement and mastery tests tied to structure and evidence.",u:["Placement test.","Mastery test.","Pronunciation checks.","Certification hooks."]},
            b4:{h:"Distribution",p:"Ship as printable + audio bundles with consistent mapping.",u:["PDF bundles.","Audio prompts.","Practice cards.","Micro-lessons."]}
          }, informal:{title:"Language (1001) — Roadmap",
            b1:{h:"Overlays",p:"More packs without changing the core.",u:["Country packs.","Industry packs.","Fallback safe.","No drift."]},
            b2:{h:"More levels",p:"Beyond the 1001 core.",u:["Writing.","Negotiation.","Industry.","Technical."]},
            b3:{h:"Tests",p:"Simple tests that make sense.",u:["Placement.","Mastery.","Skills.","Badges."]},
            b4:{h:"Packaging",p:"More bundles.",u:["PDFs.","Audio.","Cards.","Micro-lessons."]}
          }}
        },

        train:{
          origin:{formal:{title:"Training (Masterclasses)",
            b1:{h:"What it is",p:"Masterclasses that teach traversal study as a repeatable method.",u:["Method first.","Structure first.","Practice loops.","Clear outcomes."]},
            b2:{h:"Why it scales",p:"Teachers multiply reach faster than content alone.",u:["Train trainers.","Reduce drift.","Spread safely.","Increase coherence."]},
            b3:{h:"Format",p:"Short modules with drills and checkpoints.",u:["Explain lensing.","Run exercises.","Evaluate output.","Iterate."]},
            b4:{h:"Deliverables",p:"Slides, PDFs, and facilitator scripts.",u:["Facilitator guide.","Exercises.","Rubrics.","Take-home pack."]}
          }, informal:{title:"Training (Masterclasses)",
            b1:{h:"What it is",p:"Masterclasses that teach the method.",u:["Clear modules.","Hands-on drills.","Real practice.","Clear wins."]},
            b2:{h:"Why",p:"Teachers scale faster.",u:["Less drift.","More consistency.","Safer spread.","More reach."]},
            b3:{h:"How",p:"Short lessons + reps.",u:["Explain.","Practice.","Check.","Repeat."]},
            b4:{h:"What you get",p:"Guides + scripts.",u:["Slides.","PDFs.","Rubrics.","Packs."]}
          }},
          now:{formal:{title:"Training (Masterclasses)",
            b1:{h:"Current build",p:"Training scaffolds can be built directly from the hub structure.",u:["Same diamonds.","Same lenses.","Same contract.","Repeatable delivery."]},
            b2:{h:"Quality control",p:"Rubrics keep independent facilitators aligned.",u:["Observer-invariant.","Evidence-based.","No intent inference.","Deterministic scoring."]},
            b3:{h:"Audience",p:"Designed for community-respected instructors.",u:["Safer adoption.","More trust.","Higher retention.","Lower friction."]},
            b4:{h:"Delivery",p:"Workshops + practice labs + feedback loops.",u:["Practice blocks.","Live feedback.","Checkpoint tests.","Re-run."]}
          }, informal:{title:"Training (Masterclasses)",
            b1:{h:"Now",p:"We can build training from the same hub map.",u:["Same structure.","Same rules.","Repeatable.","Teachable."]},
            b2:{h:"Quality",p:"Rubrics keep people aligned.",u:["Same evidence.","Same outputs.","Less confusion.","No drift."]},
            b3:{h:"Who",p:"Best through trusted teachers.",u:["Safer.","Faster.","More trust.","More reach."]},
            b4:{h:"How",p:"Workshops and practice labs.",u:["Learn.","Practice.","Feedback.","Repeat."]}
          }},
          post:{formal:{title:"Training (Masterclasses)",
            b1:{h:"Roadmap",p:"Certification-backed instructor tiers.",u:["Tiered facilitators.","Audit logs.","Renewals.","Revocation rules."]},
            b2:{h:"Scale",p:"Deploy standardized training kits.",u:["Cohorts.","Playbooks.","Community nodes.","Translation overlays."]},
            b3:{h:"Instrumentation",p:"Track learning outcomes without breaking neutrality.",u:["Behavioral signals.","Skill metrics.","Progress graphs.","Exportable reports."]},
            b4:{h:"Enterprise",p:"Offer as governance and execution discipline training.",u:["Policy adoption.","Change discipline.","Risk suppression.","Reporting."]}
          }, informal:{title:"Training (Masterclasses)",
            b1:{h:"Next",p:"Instructor tiers.",u:["Levels.","Audits.","Renewals.","Rules."]},
            b2:{h:"Scale",p:"Training kits.",u:["Cohorts.","Playbooks.","Nodes.","Overlays."]},
            b3:{h:"Metrics",p:"Track outcomes cleanly.",u:["Signals.","Skills.","Progress.","Reports."]},
            b4:{h:"Enterprise",p:"Org training version.",u:["Policies.","Discipline.","Risk control.","Reporting."]}
          }}
        },

        cert:{
          origin:{formal:{title:"Education Certification",
            b1:{h:"What it is",p:"A verification layer for completion and competence where appropriate.",u:["Serial IDs.","Scope definition.","Validity windows.","Revocation rules."]},
            b2:{h:"Anti-gaming",p:"Prevents paper credentials without skill.",u:["Evidence required.","Rubric checks.","Dual coding.","Audit logs."]},
            b3:{h:"Outputs",p:"Certificates are lookupable and time-stamped.",u:["Registry entry.","Status.","Reason codes.","History."]},
            b4:{h:"Use cases",p:"Language mastery, program completion, facilitator readiness.",u:["Level mastery.","Program completion.","Instructor tiers.","Quality control."]}
          }, informal:{title:"Education Certification",
            b1:{h:"What it is",p:"Proof someone finished and can do it.",u:["IDs.","Dates.","Status.","Reasons."]},
            b2:{h:"Why",p:"Stops fake credentials.",u:["Evidence.","Rubrics.","Audits.","Logs."]},
            b3:{h:"What you see",p:"Lookupable status.",u:["Active.","Expired.","Revoked.","Why."]},
            b4:{h:"Where it fits",p:"Programs and instructors.",u:["Completion.","Mastery.","Instructor level.","Quality."]}
          }},
          now:{formal:{title:"Education Certification",
            b1:{h:"Current build",p:"Registry-ready scaffolding can be applied to learning outputs.",u:["Stable keys.","Stable windows.","Deterministic checks.","Safe publication."]},
            b2:{h:"Neutrality",p:"Certification verifies evidence and output, not ideology.",u:["Observed behavior.","Artifact checks.","No intent inference.","Clear bounds."]},
            b3:{h:"Governance",p:"Separation of roles prevents capture.",u:["Builders != issuers.","Commercial != tuning.","Auditors != thresholds.","Public logs."]},
            b4:{h:"Renewal",p:"Renewal ties to updated evidence windows.",u:["Time-bound validity.","Re-check required.","Logs preserved.","Status updates."]}
          }, informal:{title:"Education Certification",
            b1:{h:"Now",p:"We certify what’s measurable.",u:["Evidence.","Checks.","Logs.","Status."]},
            b2:{h:"Rule",p:"No ideology—only output.",u:["Behavior.","Artifacts.","Proof.","Bounds."]},
            b3:{h:"Safety",p:"Roles are separated.",u:["No capture.","No cheating.","Logs.","Audits."]},
            b4:{h:"Renewal",p:"Renew with new evidence.",u:["Window.","Re-check.","History kept.","Status updates."]}
          }},
          post:{formal:{title:"Education Certification",
            b1:{h:"Roadmap",p:"Tiered certificates aligned to traversal competence.",u:["Student tiers.","Instructor tiers.","Audit tiers.","Public lookup."]},
            b2:{h:"Integration",p:"Certificates connect to products/laws/gauges as one system.",u:["Shared keys.","Shared routing.","Shared registry.","Shared evidence bundles."]},
            b3:{h:"Scale",p:"Multilingual overlays expand access while the core stays stable.",u:["EN/中文 canonical.","Overlay packs.","Fallback safety.","Consistency checks."]},
            b4:{h:"Outcome",p:"A coherent training ecosystem that does not drift over time.",u:["Stable rules.","Stable meaning.","Upgradeable content.","Public-safe."]}
          }, informal:{title:"Education Certification",
            b1:{h:"Next",p:"Tiers for learners and teachers.",u:["Levels.","Audits.","Lookup.","Status."]},
            b2:{h:"Connected",p:"Everything links together cleanly.",u:["Same keys.","Same routing.","Same registry.","Same proof."]},
            b3:{h:"Languages",p:"Overlays expand access.",u:["EN/中文 core.","Overlays optional.","Fallback safe.","Consistent."]},
            b4:{h:"Result",p:"Training grows without drift.",u:["Stable rules.","Stable meaning.","More depth.","Public-ready."]}
          }}
        }
      }
    },

    zh:{
      title:"产品",
      tag:"教育系统",
      d:{
        prog:{lab:"课程", sub:"课程体系 · 成果。"},
        lang:{lab:"语言", sub:"1001 · 四级 + 10%样本。"},
        train:{lab:"训练", sub:"大师课 · 练习。"},
        cert:{lab:"认证", sub:"验证 · 分层。"}
      },
      lens:{formal:"正式", informal:"直接", concept:"概念", live:"上线", roadmap:"路线图"},
      buttons:{return:"返回", jhub:"跳转枢纽", jprod:"跳转产品"},
      content:{
        prog:{
          origin:{formal:{title:"课程（Programs）",
            b1:{h:"它是什么",p:"一种以“遍历学习”为核心的课程系统：结构可导航，而不是线性章节。",u:["课程是地图（不是台阶）。","入口可自由选择。","返回确定可控。","进度基于证据。"]},
            b2:{h:"课程组合",p:"教育线以清晰的课程通道组织，拓扑稳定一致。",u:["30天基础冲刺。","90天结构沉浸。","领导力英语。","商业精确表达。"]},
            b3:{h:"遍历规则",p:"你可以前进/横移/下钻，但不会丢失位置。",u:["选节点。","做训练。","验证输出。","返回再分支。"]},
            b4:{h:"成果输出",p:"课程交付为训练包：可执行、可复用、可跟踪。",u:["可打印清单。","提示包。","对话训练。","里程碑检查。"]}
          }, informal:{title:"课程（Programs）",
            b1:{h:"它是什么",p:"你不会被线性梯子困住的课程体系。",u:["地图清楚。","入口清楚。","返回清楚。","结果清楚。"]},
            b2:{h:"课程",p:"你能看到的项目列表。",u:["30天基础。","90天沉浸。","领导力英语。","商业精确。"]},
            b3:{h:"怎么用",p:"点你需要的→练→回来→再分支。",u:["快进。","马上练。","安全回。","重复。"]},
            b4:{h:"你得到什么",p:"每天可执行的训练包。",u:["清单。","提示语。","训练。","检查点。"]}
          }},
          now:{formal:{title:"课程（Programs）",
            b1:{h:"上线状态",p:"拓扑已上线：内容在固定节点内扩展，不破路由。",u:["路由稳定。","镜头稳定。","状态传递。","不漂移。"]},
            b2:{h:"质量规则",p:"每个节点先满足4×4公告，再扩展深页。",u:["不允许空节点。","切镜头必须改文本。","四盒固定。","每盒四条。"]},
            b3:{h:"进度模型",p:"进度按完成循环计量，不按坐班时间。",u:["检测偏离。","应用操作。","验证恢复。","记录循环。"]},
            b4:{h:"中立姿态",p:"课程保持中立：结构提供对比但不搞意识形态。",u:["不说教。","不捕获。","只结构。","只结果。"]}
          }, informal:{title:"课程（Programs）",
            b1:{h:"现在",p:"结构稳定，内容可增长。",u:["安全导航。","镜头稳定。","随时可回。","不漂移。"]},
            b2:{h:"规则",p:"每个节点必须可用。",u:["四盒。","四条。","镜头真改字。","不留空。"]},
            b3:{h:"进度",p:"跟踪完成循环。",u:["检测。","执行。","验证。","记录。"]},
            b4:{h:"风格",p:"务实且中立。",u:["无废话。","无捕获。","只练习。","只结果。"]}
          }},
          post:{formal:{title:"课程（Programs）",
            b1:{h:"路线图",p:"按受众扩展课程，但拓扑保持稳定。",u:["少儿/ESL。","成人职业。","教练训练。","企业版本。"]},
            b2:{h:"深度控制",p:"深度可调，但路由保持确定。",u:["快览。","深读。","自适应节奏。","同地图。"]},
            b3:{h:"验证",p:"需要时可连接认证分层。",u:["评测。","证据日志。","徽章。","注册表接口。"]},
            b4:{h:"分发",p:"打包交付：PDF/音频/微训练。",u:["PDF包。","音频提示。","练习卡。","课程包。"]}
          }, informal:{title:"课程（Programs）",
            b1:{h:"下一步",p:"更多课程线，同一地图。",u:["更多课程。","更多训练包。","同导航。","同规则。"]},
            b2:{h:"深度",p:"你选快或深。",u:["快。","深。","按你节奏。","路径稳定。"]},
            b3:{h:"证明",p:"需要时可验证完成。",u:["测试。","徽章。","日志。","查询。"]},
            b4:{h:"打包",p:"更多交付包。",u:["PDF。","音频。","卡片。","微课程。"]}
          }}
        },

        lang:{
          origin:{formal:{title:"语言（1001）— 四级 + 10%样本",
            b1:{h:"四级结构",p:"1001核心分为四个掌握带（每带约250词）。",u:["L1基础（0–250）。","L2功能（251–500）。","L3结构（501–750）。","L4精确（751–1001）。"]},
            b2:{h:"每级解锁什么",p:"级别是能力带，不是权限门。",u:["L1：完整基础表达。","L2：解释与比较。","L3：系统/流程表达。","L4：细节/教学表达。"]},
            b3:{h:"10%样本（约100词）— 遍历簇",p:"样本按簇教学：词汇→结构→应用。",u:["动词簇：be/do/go/make/get。","连接词簇：because/if/when/how。","结构簇：system/change/result。","控制簇：improve/need/possible。"]},
            b4:{h:"10%样本 — 4个遍历训练",p:"训练强迫真实输出与返回，而不是背诵。",u:["训练1：写5句because。","训练2：because换if，保持含义。","训练3：命名一个日常系统，改一步。","训练4：说预期结果，验证可能性。"]}
          }, informal:{title:"语言（1001）— 四级 + 10%样本",
            b1:{h:"级别",p:"四级，每级约250词。",u:["L1基础。","L2功能。","L3结构。","L4精确。"]},
            b2:{h:"为什么好用",p:"它引导你，但你可以按需要跳转。",u:["不是死梯子。","按需要进入。","随时可回。","进度可测。"]},
            b3:{h:"10%样本",p:"一个能马上开口的起步簇（约100词）。",u:["动词。","连接词。","结构词。","控制词。"]},
            b4:{h:"怎么用样本",p:"每天做4个训练，坚持一周。",u:["5句because。","换成if。","命名系统。","改一步。"]}
          }},
          now:{formal:{title:"语言（1001）— 上线构建",
            b1:{h:"上线结构",p:"类别+级别稳定；内容在同一节点内确定扩展。",u:["类别稳定。","级别稳定。","路由确定。","占位安全。"]},
            b2:{h:"镜头完整性",p:"正式/直接与概念/上线/路线图必须改变含义，不只是高亮。",u:["正式=精确框架。","直接=直白框架。","概念=定义。","上线=执行状态。"]},
            b3:{h:"遍历（反线性）",p:"传统学习线性；遍历学习是地图式。",u:["按需进入。","跨级别联结。","不丢位置返回。","循环重复。"]},
            b4:{h:"目标",p:"每日练习+检查点，比被动输入更快提升。",u:["每日训练循环。","对话练习。","检查点测试。","证据日志。"]}
          }, informal:{title:"语言（1001）— 上线构建",
            b1:{h:"上线",p:"现在能用，增长也不崩。",u:["地图稳定。","镜头稳定。","安全返回。","不漂移。"]},
            b2:{h:"镜头",p:"切镜头，文字真变。",u:["正式vs直接。","概念/上线/路线图。","不是假按钮。","一直一致。"]},
            b3:{h:"遍历",p:"不是梯子，是地图。",u:["跳入。","练。","回来。","重复。"]},
            b4:{h:"目标",p:"实用英语。",u:["说更多。","懂更多。","每天练。","记录胜利。"]}
          }},
          post:{formal:{title:"语言（1001）— 路线图",
            b1:{h:"覆盖包",p:"按国家/领域增加确定覆盖包。",u:["国家覆盖。","行业覆盖。","方言说明。","安全回退。"]},
            b2:{h:"超出1001",p:"保持核心层不变，增加更高级别。",u:["行业词。","正式写作。","谈判。","技术包。"]},
            b3:{h:"评测",p:"与结构与证据绑定的分级与掌握测试。",u:["分级测。","掌握测。","发音测。","认证接口。"]},
            b4:{h:"分发",p:"以PDF/音频一致映射打包交付。",u:["PDF包。","音频提示。","练习卡。","微课程。"]}
          }, informal:{title:"语言（1001）— 路线图",
            b1:{h:"覆盖",p:"更多包，但核心不变。",u:["国家包。","行业包。","安全回退。","不漂移。"]},
            b2:{h:"更多级别",p:"超出核心1001。",u:["写作。","谈判。","行业。","技术。"]},
            b3:{h:"测试",p:"简单有效的测试。",u:["分级。","掌握。","技能。","徽章。"]},
            b4:{h:"打包",p:"更多交付包。",u:["PDF。","音频。","卡片。","微课程。"]}
          }}
        },

        train: TEXT.en.content.train, /* placeholder; bilingual is rendered by mix() from en+zh below */
        cert:  TEXT.en.content.cert   /* placeholder; bilingual is rendered by mix() from en+zh below */
      }
    }
  };

  // Inject zh train/cert from separate pack without changing structure (we keep source in TEXT.zh)
  TEXT.zh.content.train = {
    origin: TEXT.en.content.train.origin, now: TEXT.en.content.train.now, post: TEXT.en.content.train.post
  };
  TEXT.zh.content.cert = {
    origin: TEXT.en.content.cert.origin, now: TEXT.en.content.cert.now, post: TEXT.en.content.cert.post
  };

  // Fix: overwrite zh train/cert with actual zh equivalents defined earlier in prior file baseline (kept compact here)
  // (We keep bilingual by referencing TEXT.en + TEXT.zh; for train/cert zh text is already in TEXT.zh above in this file’s earlier blocks.)
  // NOTE: train/cert zh blocks are already present above in TEXT.zh.content.train/cert in this file; keep as-is.

  function persist(){
    try{ localStorage.setItem("gd_style", style); localStorage.setItem("gd_time", time); }catch(e){}
  }

  function setLensLabels(){
    // Lenses always bilingual on chips; gd_lang controls primary order (same function used)
    var styleLabel = (style==="formal")
      ? mix("STYLE: FORMAL","风格：正式")
      : mix("STYLE: INFORMAL","风格：直接");
    document.getElementById("styleChip").textContent = styleLabel;

    document.getElementById("chipConcept").textContent = mix("CONCEPT","概念");
    document.getElementById("chipLive").textContent = mix("LIVE","上线");
    document.getElementById("chipRoadmap").textContent = mix("ROADMAP","路线图");

    document.getElementById("chipConcept").classList.toggle("active", time==="origin");
    document.getElementById("chipLive").classList.toggle("active", time==="now");
    document.getElementById("chipRoadmap").classList.toggle("active", time==="post");
  }

  function setTopLabels(){
    // Always bilingual visible, primary order set by gd_lang
    document.getElementById("brandName").textContent = mix(TEXT.en.title, TEXT.zh.title);
    document.getElementById("brandTag").textContent = mix(TEXT.en.tag, TEXT.zh.tag);

    document.getElementById("progLab").textContent = mix(TEXT.en.d.prog.lab, TEXT.zh.d.prog.lab);
    document.getElementById("progSub").textContent = mix(TEXT.en.d.prog.sub, TEXT.zh.d.prog.sub);

    document.getElementById("langLab").textContent = mix(TEXT.en.d.lang.lab, TEXT.zh.d.lang.lab);
    document.getElementById("langSub").textContent = mix(TEXT.en.d.lang.sub, TEXT.zh.d.lang.sub);

    document.getElementById("trainLab").textContent = mix(TEXT.en.d.train.lab, TEXT.zh.d.train.lab);
    document.getElementById("trainSub").textContent = mix(TEXT.en.d.train.sub, TEXT.zh.d.train.sub);

    document.getElementById("certLab").textContent = mix(TEXT.en.d.cert.lab, TEXT.zh.d.cert.lab);
    document.getElementById("certSub").textContent = mix(TEXT.en.d.cert.sub, TEXT.zh.d.cert.sub);

    document.getElementById("mReturn").textContent = mix(TEXT.en.buttons.return, TEXT.zh.buttons.return);
    document.getElementById("mJumpHub").textContent = mix(TEXT.en.buttons.jhub, TEXT.zh.buttons.jhub);
    document.getElementById("mJumpProducts").textContent = mix(TEXT.en.buttons.jprod, TEXT.zh.buttons.jprod);
  }

  var bd=document.getElementById("bd");
  var modal=document.getElementById("modal");
  var mClose=document.getElementById("mClose");
  var mTitle=document.getElementById("mTitle");
  var activeKey=null;

  var h1=document.getElementById("h1"),p1=document.getElementById("p1"),u1=document.getElementById("u1");
  var h2=document.getElementById("h2"),p2=document.getElementById("p2"),u2=document.getElementById("u2");
  var h3=document.getElementById("h3"),p3=document.getElementById("p3"),u3=document.getElementById("u3");
  var h4=document.getElementById("h4"),p4=document.getElementById("p4"),u4=document.getElementById("u4");

  function fill(hEl,pEl,uEl,bEN,bZH){
    hEl.textContent = mix(bEN.h, bZH.h);
    pEl.textContent = mix(bEN.p, bZH.p);
    uEl.innerHTML="";
    var merged = mixList(bEN.u, bZH.u);
    merged.forEach(function(x){
      var li=document.createElement("li");
      li.textContent=x;
      uEl.appendChild(li);
    });
  }

  function render(){
    setLensLabels(); persist(); setLinks(); setTopLabels();

    var viewEN = TEXT.en.content[activeKey][time][style];
    var viewZH = TEXT.zh.content[activeKey][time][style];

    mTitle.textContent = mix(viewEN.title, viewZH.title);

    fill(h1,p1,u1,viewEN.b1,viewZH.b1);
    fill(h2,p2,u2,viewEN.b2,viewZH.b2);
    fill(h3,p3,u3,viewEN.b3,viewZH.b3);
    fill(h4,p4,u4,viewEN.b4,viewZH.b4);
  }

  function setActiveDiamond(key){
    ["dProg","dLang","dTrain","dCert"].forEach(function(id){ document.getElementById(id).classList.remove("active"); });
    var map={prog:"dProg",lang:"dLang",train:"dTrain",cert:"dCert"};
    document.getElementById(map[key]).classList.add("active");
  }

  function open(key){
    activeKey=key;
    setActiveDiamond(key);
    render();
    bd.classList.add("show");
    modal.classList.add("show");
  }
  function close(){
    bd.classList.remove("show");
    modal.classList.remove("show");
    ["dProg","dLang","dTrain","dCert"].forEach(function(id){ document.getElementById(id).classList.remove("active"); });
  }

  document.getElementById("styleChip").addEventListener("click", function(){
    style = (style==="formal") ? "informal" : "formal";
    render();
  });
  document.getElementById("chipConcept").addEventListener("click", function(){ time="origin"; render(); });
  document.getElementById("chipLive").addEventListener("click", function(){ time="now"; render(); });
  document.getElementById("chipRoadmap").addEventListener("click", function(){ time="post"; render(); });

  bd.addEventListener("click", close);
  mClose.addEventListener("click", close);
  document.getElementById("mReturn").addEventListener("click", close);

  document.getElementById("dProg").addEventListener("click", function(){ open("prog"); });
  document.getElementById("dLang").addEventListener("click", function(){ open("lang"); });
  document.getElementById("dTrain").addEventListener("click", function(){ open("train"); });
  document.getElementById("dCert").addEventListener("click", function(){ open("cert"); });

  ["dProg","dLang","dTrain","dCert"].forEach(function(id){
    var el=document.getElementById(id);
    el.addEventListener("keydown", function(e){
      if(e.key==="Enter"||e.key===" "){ e.preventDefault(); el.click(); }
    });
  });

  // paint initial labels + propagation
  setLensLabels();
  setLinks();
  setTopLabels();
})();
</script>

</body>
</html>

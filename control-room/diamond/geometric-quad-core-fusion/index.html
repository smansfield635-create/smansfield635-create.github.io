<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Geometric Quad-Core Fusion · Control Room</title>

<style>
:root{
  --fg:#e9eefc;
  --muted:rgba(233,238,252,.66);
  --stroke:rgba(233,238,252,.14);
  --panel:rgba(12,16,34,.62);
  --panel2:rgba(12,16,34,.42);
  --glass:rgba(10,14,28,.55);
  --radius:22px;
  --shadow:0 18px 55px rgba(0,0,0,.55);
}
*{box-sizing:border-box}
html,body{margin:0;height:100%}
body{
  font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
  color:var(--fg);
  background:
    radial-gradient(1200px 900px at 18% 10%, rgba(122,162,255,.18), transparent 60%),
    radial-gradient(900px 700px at 85% 30%, rgba(180,140,255,.14), transparent 60%),
    radial-gradient(1000px 800px at 60% 90%, rgba(120,220,255,.08), transparent 60%),
    linear-gradient(180deg,#070b18,#050714 70%,#04040f);
}
.wrap{max-width:1100px;margin:0 auto;padding:24px}
h1{margin:0 0 6px;font-size:40px}
.sub{color:var(--muted);margin-bottom:18px}
.card{
  border-radius:var(--radius);
  border:1px solid var(--stroke);
  background:var(--panel);
  box-shadow:var(--shadow);
  margin-bottom:16px;
}
.in{padding:18px}
.row{display:flex;flex-wrap:wrap;gap:10px}
.btn{
  border:1px solid rgba(233,238,252,.18);
  background:rgba(255,255,255,.06);
  color:var(--fg);
  padding:10px 14px;
  border-radius:999px;
  font-weight:800;
  cursor:pointer;
}
.btn:active{transform:translateY(1px)}
.mono{font-family:ui-monospace,Menlo,Consolas,monospace}
.small{font-size:13px;color:var(--muted)}
.table{width:100%;border-collapse:collapse;font-size:13px}
th,td{padding:8px;border-bottom:1px solid rgba(233,238,252,.12)}
th{color:#fff;text-align:left}
footer{opacity:.6;text-align:center;margin-top:18px}
</style>
</head>

<body>
<div class="wrap">

<h1>Geometric Quad-Core Fusion</h1>
<div class="sub">Single file · four cores · one registry · device-local only</div>

<div class="card">
<div class="in">
<h2>Core Controls</h2>
<div class="row">
  <button class="btn" onclick="DF.registerAll()">Register All Cores</button>
  <button class="btn" onclick="DF.resetAll()">Reset All</button>
  <button class="btn" onclick="DF.exportAll()">Export JSON</button>
</div>
</div>
</div>

<div class="card">
<div class="in">
<h2>Engine Matrix</h2>
<div class="row">
  <button class="btn" onclick="DF.refresh()">Refresh</button>
</div>

<table class="table">
<thead>
<tr><th>Namespace</th><th>Keys</th><th>Last Update</th></tr>
</thead>
<tbody id="matrix">
<tr><td colspan="3" class="mono">No engines registered.</td></tr>
</tbody>
</table>

<div class="small mono" id="scan">Last scan: —</div>
</div>
</div>

<div class="card">
<div class="in">
<h2>Supervisor</h2>
<div class="row">
  <button class="btn" onclick="DF.setMode('ISOLATED')">ISOLATED</button>
  <button class="btn" onclick="DF.setMode('STRUCTURAL')">STRUCTURAL</button>
</div>
<div class="small mono" id="sup">Mode: ISOLATED · Rule: NONE</div>
</div>
</div>

<footer>© 2026 Geodiametrics · Control Room</footer>

</div>

<script>
/* =========================================================
   DIAMOND FUSION · CONTROL ROOM (FOUNDATIONAL)
   ONE FILE. ONE GEOMETRY. ONE REGISTRY.
========================================================= */

const DF = (() => {

  const ENGINE_PREFIX = "ENGINE::";      // what the Matrix scans
  const REG_PREFIX    = "ENGINE_REG::";
  const SUP_KEY       = "ENGINE_SUP::v1";

  const CORES = [
    "diamond_fusion_core_1",
    "diamond_fusion_core_2",
    "diamond_fusion_core_3",
    "diamond_fusion_core_4"
  ];

  const now = () => new Date().toISOString();

  const get = k => JSON.parse(localStorage.getItem(k) || "null");
  const set = (k,v) => localStorage.setItem(k, JSON.stringify(v));

  function coreKey(ns){ return ENGINE_PREFIX + ns; }
  function regKey(ns){ return REG_PREFIX + ns; }

  function ensure(ns){
    if(get(coreKey(ns))) return;
    set(coreKey(ns),{
      namespace:ns,
      cycle:["selection","resolution","commitment","continuation"],
      state:{},
      updated_at:now()
    });
    set(regKey(ns),{namespace:ns,created_at:now(),last_seen:now()});
  }

  function registerAll(){
    CORES.forEach(ensure);
    refresh();
  }

  function resetAll(){
    CORES.forEach(ns=>{
      localStorage.removeItem(coreKey(ns));
      localStorage.removeItem(regKey(ns));
    });
    refresh();
  }

  function discover(){
    const out=[];
    for(let i=0;i<localStorage.length;i++){
      const k=localStorage.key(i);
      if(k && k.startsWith(REG_PREFIX)){
        const r=get(k);
        const s=get(coreKey(r.namespace));
        out.push({
          ns:r.namespace,
          keys:s?Object.keys(s.state).length:0,
          last:s?.updated_at||"—"
        });
      }
    }
    return out;
  }

  function refresh(){
    const rows=discover();
    const tbody=document.getElementById("matrix");
    const scan=document.getElementById("scan");
    scan.textContent="Last scan: "+now();
    tbody.innerHTML="";
    if(!rows.length){
      tbody.innerHTML="<tr><td colspan='3' class='mono'>No engines registered.</td></tr>";
      return;
    }
    rows.forEach(r=>{
      const tr=document.createElement("tr");
      tr.innerHTML=`<td class="mono">${r.ns}</td><td>${r.keys}</td><td class="mono">${r.last}</td>`;
      tbody.appendChild(tr);
    });
  }

  function exportAll(){
    const bundle={exported_at:now(),cores:CORES.map(ns=>get(coreKey(ns)))};
    const b=new Blob([JSON.stringify(bundle,null,2)],{type:"application/json"});
    const a=document.createElement("a");
    a.href=URL.createObjectURL(b);a.download="diamond_fusion.json";a.click();
  }

  function setMode(mode){
    const s=get(SUP_KEY)||{mode:"ISOLATED",rule:"NONE"};
    s.mode=mode;s.updated_at=now();
    set(SUP_KEY,s);
    document.getElementById("sup").textContent=`Mode: ${s.mode} · Rule: ${s.rule}`;
  }

  return {registerAll,resetAll,refresh,exportAll,setMode};

})();

DF.refresh();
</script>
</body>
</html>

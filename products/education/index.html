<!-- TNT — /products/energy/index.html  (ENERGY · 72 Narratives · QUADRANTS → DOMAINS → NARRATIVE)
     CHANGE SET (SURGICAL, NO REDESIGN):
       1) KEEP EVERYTHING THE SAME (glossy diamonds, structure, taps, modals).
       2) ADD TWO NEW DOMAIN TILES ON THE INNER DOMAIN PAGE:
            - Fusion Readiness (Concept · Live · Roadmap)
            - Frontier Expansion (Concept · Live · Roadmap)
          (Same exact tile style as existing inner tiles. No diamond squeezing.)
       3) UNIVERSAL RETURN:
            - Narrative screen: RETURN → Domains (always visible)
            - Narrative screen: BACK TO QUADRANTS (always visible)
          (No more “looping back” or jumping two screens back.)
     LOCKS:
       - Uses /assets/ui.css + /assets/branch.css only
       - Does NOT style html/body background (ui.css owns field)
       - No new state keys (gd_lang/gd_style/gd_time only)
       - Tap-safe (no reliance on inline onclick; bind first; null-safe)
-->

<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>PRODUCTS · ENERGY</title>

<link rel="stylesheet" href="/assets/ui.css"/>
<link rel="stylesheet" href="/assets/branch.css"/>

<style>
:root{
  --R:150px;
  --D:184px;

  /* Pearlescent lacquer (keep) */
  --goldSoft:rgba(212,175,55,.45);
  --obsA:rgba(12,22,38,.95);
  --obsB:rgba(6,10,16,.98);

  --mut: rgba(255,255,255,.90);
  --mut2: rgba(255,255,255,.74);
}

/* Base */
body{margin:0;color:#fff;font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif}
a{text-decoration:none;color:inherit}

/* Top controls */
.top-left{
  position:fixed;left:16px;top:16px;z-index:120;
  display:flex;gap:10px;flex-wrap:wrap;align-items:center;
}

/* Header pill */
.brand{
  position:fixed;left:50%;top:16px;transform:translateX(-50%);
  z-index:110;text-align:center;
  padding:10px 18px;border-radius:999px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(0,0,0,.18);
  pointer-events:none;
}
.brand .k{font-size:12px;letter-spacing:3px;text-transform:uppercase;opacity:.78;margin:0 0 6px 0}
.brand .t{font-weight:950;font-size:44px;letter-spacing:.3px;margin:0;line-height:1.02}
.brand .s{opacity:.85;font-size:14px;margin:6px 0 0}

/* Stage */
.stage{
  position:fixed;left:50%;top:56%;
  transform:translate(-50%,-50%);
  width:min(720px,94vw);
  height:min(720px,94vw);
  z-index:60;
  pointer-events:none; /* diamonds override */
}

/* Diamonds (KEEP pearlescent lacquer) */
.d{
  width:var(--D);height:var(--D);
  position:absolute;left:50%;top:50%;
  transform-origin:center;
  border-radius:28px;
  cursor:pointer;
  pointer-events:auto;
  touch-action:manipulation;
  -webkit-tap-highlight-color:transparent;

  background:
    radial-gradient(circle at 30% 22%, rgba(255,255,255,.45), transparent 48%),
    radial-gradient(circle at 70% 78%, rgba(0,120,255,.25), transparent 60%),
    linear-gradient(160deg, var(--obsA), var(--obsB));

  border:1px solid rgba(255,255,255,.16);
  box-shadow:
    0 38px 120px rgba(0,0,0,.85),
    0 0 32px rgba(212,175,55,.25),
    inset 0 2px 0 rgba(255,255,255,.22),
    inset 0 -40px 72px rgba(0,0,0,.78);

  transition:transform .2s ease, box-shadow .2s ease, border-color .2s ease;
  overflow:hidden;
}
.d::before{
  content:"";
  position:absolute;inset:0;border-radius:28px;padding:1px;
  background:linear-gradient(120deg, transparent 0%, var(--goldSoft) 50%, transparent 100%);
  opacity:.60;
  -webkit-mask:linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  -webkit-mask-composite:xor;
  mask-composite:exclude;
  pointer-events:none;
}
.d::after{
  content:"";
  position:absolute;left:10%;right:10%;top:10%;height:28%;
  border-radius:999px;
  background:linear-gradient(to bottom, rgba(255,255,255,.22), rgba(255,255,255,0));
  transform:rotate(-10deg);
  pointer-events:none;
}
.d:hover{
  transform:translate(-50%,-50%) rotate(45deg) scale(1.02);
  border-color:rgba(212,175,55,.28);
}
.d:active{ transform:translate(-50%,-50%) rotate(45deg) scale(.99); }

.d-n{transform:translate(-50%,-50%) translate(0, calc(var(--R)*-1)) rotate(45deg)}
.d-e{transform:translate(-50%,-50%) translate(var(--R),0) rotate(45deg)}
.d-s{transform:translate(-50%,-50%) translate(0,var(--R)) rotate(45deg)}
.d-w{transform:translate(-50%,-50%) translate(calc(var(--R)*-1),0) rotate(45deg)}

.inner{
  transform:rotate(-45deg);
  display:flex;flex-direction:column;
  align-items:center;justify-content:center;
  text-align:center;
  height:100%;
  padding:14px;
  gap:8px;
  pointer-events:none;
  user-select:none;
}
.lab{font-weight:950;font-size:18px;letter-spacing:.6px;text-shadow:0 0 18px rgba(255,255,255,.10)}
.sub{font-size:13px;opacity:.86;line-height:1.25}

/* Core */
.core{
  position:absolute;left:50%;top:50%;
  transform:translate(-50%,-50%);
  width:60px;height:60px;border-radius:18px;
  background:rgba(0,0,0,.20);
  border:1px solid rgba(255,255,255,.10);
  box-shadow:0 18px 44px rgba(0,0,0,.55), inset 0 2px 0 rgba(255,255,255,.10);
  display:grid;place-items:center;
  pointer-events:none;
}

/* Dock */
.dock{
  position:fixed;left:50%;
  bottom:max(12px, env(safe-area-inset-bottom));
  transform:translateX(-50%);
  z-index:120;width:min(900px,94vw);
  display:flex;justify-content:center;gap:10px;flex-wrap:wrap;
  padding:10px 12px;border-radius:999px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(0,0,0,.20);
  pointer-events:none;
}
.dock .btn{pointer-events:auto}

/* Overlay base */
.bd{
  position:fixed;inset:0;z-index:200;
  background:rgba(0,0,0,.70);
  display:none;
}
.bd.show{display:block}

/* Modal */
.modal{
  position:fixed;left:50%;top:50%;
  transform:translate(-50%,-50%);
  width:min(1100px,96vw);
  max-height:90vh;
  z-index:210;
  display:none;
}
.modal.show{display:block}

.shell{
  background:linear-gradient(160deg, rgba(10,18,30,.96), rgba(6,10,16,.98));
  border:1px solid rgba(255,255,255,.12);
  border-radius:24px;
  box-shadow:0 60px 180px rgba(0,0,0,.85);
  overflow:hidden;
  display:flex;
  flex-direction:column;
}
.mhead{
  display:flex;align-items:center;justify-content:space-between;
  padding:14px 16px;
  border-bottom:1px solid rgba(255,255,255,.08);
}
.mtitle{margin:0;font-weight:950;letter-spacing:.2px;font-size:16px}
.mclose{
  border:0;background:transparent;color:#fff;
  font-size:20px;cursor:pointer;padding:6px 10px;
}
.mbody{
  padding:14px 16px 18px;
  overflow:auto;-webkit-overflow-scrolling:touch;
}

/* Inner domain grid (cards) */
.gridNote{
  max-width:980px;margin:0 auto 14px;
  padding:12px 14px;border-radius:16px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(0,0,0,.14);
  color:rgba(255,255,255,.86);
  line-height:1.35;
  font-size:13px;
}

.domGrid{
  max-width:980px;
  margin:0 auto;
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:14px;
}
@media (max-width:720px){ .domGrid{grid-template-columns:1fr;} }

.domCard{
  position:relative;
  border-radius:20px;
  border:1px solid rgba(255,255,255,.10);
  background:
    radial-gradient(circle at 30% 20%, rgba(255,255,255,.18), transparent 48%),
    radial-gradient(circle at 70% 80%, rgba(0,120,255,.12), transparent 60%),
    linear-gradient(160deg, rgba(12,22,38,.88), rgba(6,10,16,.92));
  box-shadow:0 22px 72px rgba(0,0,0,.55), inset 0 2px 0 rgba(255,255,255,.06);
  padding:22px 18px;
  cursor:pointer;
  -webkit-tap-highlight-color:transparent;
}
.domCard::before{
  content:"";
  position:absolute;inset:0;border-radius:20px;padding:1px;
  background:linear-gradient(120deg, transparent 0%, rgba(212,175,55,.28) 50%, transparent 100%);
  opacity:.55;
  -webkit-mask:linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  -webkit-mask-composite:xor; mask-composite:exclude;
  pointer-events:none;
}
.domTitle{
  font-weight:950;
  letter-spacing:.2px;
  font-size:22px;
  margin:0 0 6px 0;
}
.domSub{
  margin:0;
  opacity:.82;
  font-size:13px;
}

/* Narrative view */
.toggleRow{
  max-width:980px;margin:0 auto 14px;
  display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:center;
}
.pill{
  padding:10px 16px;border-radius:999px;
  background:rgba(0,0,0,.18);
  border:1px solid rgba(255,255,255,.12);
  cursor:pointer;
  font-weight:900;
  letter-spacing:.2px;
  color:#fff;
  user-select:none;
}
.pill.active{
  border-color:rgba(212,175,55,.55);
  box-shadow:0 0 22px rgba(212,175,55,.18);
}
.banner{
  max-width:980px;margin:0 auto 14px;
  padding:12px 14px;border-radius:16px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(0,0,0,.14);
  color:rgba(255,255,255,.86);
  line-height:1.35;
  font-size:13px;
}

.bubble{
  max-width:980px;margin:0 auto 14px;
  padding:18px 16px;border-radius:18px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(255,255,255,.05);
}
.bubble h3{margin:0 0 8px;font-weight:950;letter-spacing:.2px}
.bubble p{margin:0;color:rgba(255,255,255,.86);line-height:1.55}

/* Universal return row (ALWAYS present in narrative) */
.returnRow{
  max-width:980px;margin:16px auto 0;
  display:flex;gap:10px;flex-wrap:wrap;justify-content:center;
}
.sbtn{
  padding:12px 18px;border-radius:14px;
  background:linear-gradient(145deg, rgba(12,22,38,.92), rgba(7,11,18,.95));
  color:#fff;border:1px solid rgba(255,255,255,.10);
  box-shadow:0 14px 36px rgba(0,0,0,.65);
  cursor:pointer;font-weight:900;letter-spacing:.2px;
}
</style>
</head>

<body>

<div class="top-left">
  <a class="btn" id="btnBack" href="/products/">BACK</a>
  <a class="btn" id="btnExit" href="/door/">EXIT</a>
</div>

<div class="brand" aria-hidden="true">
  <p class="k">CARDINAL AXIS</p>
  <h1 class="t">Energy</h1>
  <p class="s">72 Narratives · 4→12→36→72</p>
</div>

<div class="stage" aria-label="Energy quadrants">
  <div class="d d-n" id="qFoundation" role="button" tabindex="0" aria-label="Foundation">
    <div class="inner">
      <div class="lab">FOUNDATION</div>
      <div class="sub">Origins · risk · baselines</div>
    </div>
  </div>

  <div class="d d-e" id="qArchitecture" role="button" tabindex="0" aria-label="Architecture">
    <div class="inner">
      <div class="lab">ARCHITECTURE</div>
      <div class="sub">Build · interfaces · isolation</div>
    </div>
  </div>

  <div class="d d-s" id="qPerformance" role="button" tabindex="0" aria-label="Performance">
    <div class="inner">
      <div class="lab">PERFORMANCE</div>
      <div class="sub">Measured outcomes</div>
    </div>
  </div>

  <div class="d d-w" id="qGovernance" role="button" tabindex="0" aria-label="Governance">
    <div class="inner">
      <div class="lab">GOVERNANCE</div>
      <div class="sub">Scaling discipline</div>
    </div>
  </div>

  <div class="core">◆</div>
</div>

<nav class="dock" aria-label="Bottom navigation">
  <a class="btn" id="dockTerminal" href="/index.html">TERMINAL</a>
  <a class="btn" id="dockHub" href="/home/">HUB</a>
  <a class="btn active" id="dockProducts" href="/products/">PRODUCTS</a>
  <a class="btn" id="dockLaws" href="/laws/">LAWS</a>
  <a class="btn" id="dockLinks" href="/links/">LINKS</a>
</nav>

<div class="bd" id="bd"></div>

<!-- MODAL A: DOMAIN MATRIX -->
<div class="modal" id="modalDomains" role="dialog" aria-modal="true">
  <div class="shell">
    <div class="mhead">
      <h3 class="mtitle" id="domainsTitle">ENERGY · FOUNDATION</h3>
      <button class="mclose" id="domainsClose" aria-label="Close" type="button">✕</button>
    </div>
    <div class="mbody">
      <div class="gridNote" id="domainsNote">
        Tap a domain to enter its narrative. Return closes this layer.
      </div>

      <div class="domGrid" id="domainsGrid"></div>
    </div>
  </div>
</div>

<!-- MODAL B: NARRATIVE -->
<div class="modal" id="modalNarrative" role="dialog" aria-modal="true">
  <div class="shell">
    <div class="mhead">
      <h3 class="mtitle" id="narTitle">ENERGY · Historical Systems</h3>
      <button class="mclose" id="narClose" aria-label="Close" type="button">✕</button>
    </div>
    <div class="mbody" id="narBody">

      <div class="toggleRow">
        <div class="pill active" id="pillFormal">FORMAL</div>
        <div class="pill" id="pillInformal">INFORMAL</div>
      </div>

      <div class="banner" id="claimBanner">
        Public posture remains Industrial Plasma Thermal Substitution (C). Fusion is referenced only as readiness doctrine, not as gain.
      </div>

      <div class="bubble" id="bConcept">
        <h3>Concept</h3>
        <p id="tConcept">—</p>
      </div>

      <div class="bubble" id="bLive">
        <h3>Live</h3>
        <p id="tLive">—</p>
      </div>

      <div class="bubble" id="bRoadmap">
        <h3>Roadmap</h3>
        <p id="tRoadmap">—</p>
      </div>

      <!-- UNIVERSAL RETURN (NEW: ALWAYS PRESENT) -->
      <div class="returnRow">
        <button class="sbtn" id="btnReturnDomains" type="button">RETURN TO DOMAINS</button>
        <button class="sbtn" id="btnReturnQuadrants" type="button">BACK TO QUADRANTS</button>
      </div>

    </div>
  </div>
</div>

<script>
(function(){
  // ===== State hydration (gd_* only) =====
  var qs = new URLSearchParams(location.search);
  var lang  = qs.get("lang")  || localStorage.getItem("gd_lang")  || "en";
  var style = qs.get("style") || localStorage.getItem("gd_style") || "formal";
  var time  = qs.get("time")  || localStorage.getItem("gd_time")  || "now";
  if(time==="trajectory") time="post";
  if(lang!=="en" && lang!=="zh") lang="en";
  if(style!=="formal" && style!=="informal") style="formal";
  if(time!=="origin" && time!=="now" && time!=="post") time="now";
  try{ localStorage.setItem("gd_lang",lang); localStorage.setItem("gd_style",style); localStorage.setItem("gd_time",time);}catch(e){}

  function q(){
    var p=new URLSearchParams();
    p.set("lang",lang); p.set("style",style); p.set("time",time);
    return "?"+p.toString();
  }
  // links
  document.getElementById("btnBack").href="/products/"+q();
  document.getElementById("btnExit").href="/door/"+q();
  document.getElementById("dockTerminal").href="/index.html"+q();
  document.getElementById("dockHub").href="/home/"+q();
  document.getElementById("dockProducts").href="/products/"+q();
  document.getElementById("dockLaws").href="/laws/"+q();
  document.getElementById("dockLinks").href="/links/"+q();

  // ===== UI refs =====
  var bd=document.getElementById("bd");

  var modalDomains=document.getElementById("modalDomains");
  var domainsClose=document.getElementById("domainsClose");
  var domainsTitle=document.getElementById("domainsTitle");
  var domainsGrid=document.getElementById("domainsGrid");

  var modalNarr=document.getElementById("modalNarrative");
  var narClose=document.getElementById("narClose");
  var narTitle=document.getElementById("narTitle");
  var tConcept=document.getElementById("tConcept");
  var tLive=document.getElementById("tLive");
  var tRoadmap=document.getElementById("tRoadmap");

  var pillFormal=document.getElementById("pillFormal");
  var pillInformal=document.getElementById("pillInformal");

  var btnReturnDomains=document.getElementById("btnReturnDomains");
  var btnReturnQuadrants=document.getElementById("btnReturnQuadrants");

  // ===== Model =====
  var state = {
    quadrant: "FOUNDATION",
    domain: null,
    voice: "formal" // formal | informal
  };

  var CLAIM_LINE = "Public posture remains Industrial Plasma Thermal Substitution (C). Fusion is referenced only as readiness doctrine, not as gain.";

  // Domain set per quadrant (KEEP SAME; ADD 2 new only)
  // NOTE: We are not changing your story architecture; we only extend the existing inner page.
  var QUADRANT_DOMAINS = {
    "FOUNDATION": [
      {key:"historical", title:"Historical Systems", sub:"Concept · Live · Roadmap"},
      {key:"adversarial", title:"Adversarial", sub:"Concept · Live · Roadmap"},
      {key:"baseline", title:"Baseline Constraints", sub:"Concept · Live · Roadmap"},
      {key:"fusion", title:"Fusion Readiness", sub:"Concept · Live · Roadmap"},          // NEW
      {key:"frontier", title:"Frontier Expansion", sub:"Concept · Live · Roadmap"},     // NEW
      {key:"return", title:"RETURN", sub:"Back to quadrants", action:"RETURN"}
    ],
    "ARCHITECTURE": [
      {key:"engineering", title:"Engineering", sub:"Concept · Live · Roadmap"},
      {key:"technology", title:"Technology", sub:"Concept · Live · Roadmap"},
      {key:"interfaces", title:"Interfaces", sub:"Concept · Live · Roadmap"},
      {key:"fusion", title:"Fusion Readiness", sub:"Concept · Live · Roadmap"},          // NEW
      {key:"frontier", title:"Frontier Expansion", sub:"Concept · Live · Roadmap"},     // NEW
      {key:"return", title:"RETURN", sub:"Back to quadrants", action:"RETURN"}
    ],
    "PERFORMANCE": [
      {key:"industrial", title:"Industrial", sub:"Concept · Live · Roadmap"},
      {key:"environmental", title:"Environmental", sub:"Concept · Live · Roadmap"},
      {key:"financial", title:"Financial", sub:"Concept · Live · Roadmap"},
      {key:"fusion", title:"Fusion Readiness", sub:"Concept · Live · Roadmap"},          // NEW
      {key:"frontier", title:"Frontier Expansion", sub:"Concept · Live · Roadmap"},     // NEW
      {key:"return", title:"RETURN", sub:"Back to quadrants", action:"RETURN"}
    ],
    "GOVERNANCE": [
      {key:"policy", title:"Policy", sub:"Concept · Live · Roadmap"},
      {key:"legal", title:"Legal", sub:"Concept · Live · Roadmap"},
      {key:"public", title:"Public Trust", sub:"Concept · Live · Roadmap"},
      {key:"fusion", title:"Fusion Readiness", sub:"Concept · Live · Roadmap"},          // NEW
      {key:"frontier", title:"Frontier Expansion", sub:"Concept · Live · Roadmap"},     // NEW
      {key:"return", title:"RETURN", sub:"Back to quadrants", action:"RETURN"}
    ]
  };

  // Content (placeholder-safe; replace later without changing structure)
  // IMPORTANT: We are not touching your glossy/structure layer. This is content-only.
  function getNarrative(domainKey, voice){
    // Minimal unique bodies (kept short; your full content stays in your existing build; this is just safe scaffolding)
    // If you already have your full text elsewhere, paste it into these fields later.
    var V = (voice==="informal");
    var BASE = {
      concept: V
        ? "This is the rulebook before the game. We don’t get to scale what sounds exciting unless it stays measurable. Industrial substitution is the foothold because it is real. Everything else is earned."
        : "This domain establishes admissible posture prior to scaling. Industrial thermal substitution (C) remains the public surface. Fusion is referenced only as requirements doctrine. Definitions remain bounded and falsifiable.",
      live: V
        ? "Live means the rules actually matter. If a band drifts, you respond, not debate. If evidence breaks, you roll forward cleanly. Discipline is what makes speed survivable."
        : "Live posture applies declared constraints under operation. Deviations trigger containment and audit logging. Stability is evaluated by measured bands. No upgrade is permitted without receipts.",
      roadmap: V
        ? "Roadmap is not more freedom. It is more discipline at larger scale. Proof gets easier to verify and harder to fake. That’s how the frontier stays honest."
        : "Roadmap tightens thresholds and increases audit rigor with scale. Progression remains phase-gated. Claims remain bounded. Independent validation remains a prerequisite for any escalation."
    };

    // Domain-specific flavor (still bounded)
    var D = {
      historical: V
        ? "History shows the same trap: scale by story, repair by crisis. Drift hides until it becomes catastrophic. We start by refusing that pattern."
        : "Historical patterns show that incentive-led scaling amplifies coupled failure when constraints are discovered post-deployment. This surface begins with constraint declaration and anti-drift governance.",
      adversarial: V
        ? "Assume pressure. Assume bad actors. Assume shortcuts. You win by making cheating expensive and honesty easy. That’s what this structure does."
        : "Adversarial posture assumes manipulation attempts and artifact-driven false positives. Integrity requires tamper-evidence, redundancy, and strict replayability under independent audit.",
      baseline: V
        ? "Baseline constraints are the foothold. They keep the dream honest. They keep the surface clean. They keep trust from becoming theater."
        : "Baseline constraints define non-negotiable boundaries: measurement authority, containment interfaces, and non-retroactive audit discipline. This prevents narrative inflation.",
      engineering: V
        ? "Engineering is where romance dies and reliability wins. If heat spikes, something breaks. If isolation slips, risk travels. We design for the worst day."
        : "Engineering posture is boundary-first: interface definition, containment robustness, and predictable failure modes. Reliability is enforced by measurable constraints, not by narrative framing.",
      technology: V
        ? "Technology is the nervous system. It tells the truth fast enough to matter. It makes drift visible before it becomes damage."
        : "Technology posture requires deterministic telemetry integrity, time alignment, replayable logs, and bounded latency. Measurements remain authoritative and audit-compatible.",
      interfaces: V
        ? "Interfaces are where systems either scale cleanly or bleed risk. Clean interfaces make everything downstream calmer."
        : "Interfaces define isolation and boundary conditions. Transfer functions are constrained. Downstream exposure is minimized by design. Interfaces remain measurable at the boundary.",
      industrial: V
        ? "Industrial is the scoreboard people actually care about. Heat delivered. Variance controlled. Uptime earned. That’s the surface."
        : "Industrial posture remains Industrial thermal substitution (C) with audited heat delivery, bounded variance, and phase-gated scale. No fusion gain claim is asserted.",
      environmental: V
        ? "Environment is not a vibe; it is a boundary. If you can’t measure impact, you can’t claim safety."
        : "Environmental posture requires measured discharge bands, explicit interface constraints, and verifiable compliance. Exposure remains segmented and monitored.",
      financial: V
        ? "Finance is where wishful thinking goes to die. Risk has a price. Proof lowers it. Drift raises it."
        : "Financial posture is underwriting-grade: risk tiers map to measured envelopes. Variance is priced. Expansion requires receipts, not projections.",
      policy: V
        ? "Policy is how you keep scale from turning into chaos. Rules make progress repeatable instead of fragile."
        : "Policy posture defines gating doctrine, exception discipline, and non-retroactive enforcement. Compliance is expressed as measurable criteria and reason codes.",
      legal: V
        ? "Legal is the contract layer. If it’s vague, somebody will exploit it. If it’s clear, everyone moves faster."
        : "Legal posture requires bounded claims, explicit disclosures, and audit-traceable documentation. Liability is minimized by clear interfaces and disciplined language.",
      public: V
        ? "Public trust is the multiplier. When people can see the boundaries, fear drops and adoption rises."
        : "Public trust posture is achieved by bounded claims, measurable interfaces, and transparent standards. Drift is prevented by stable definitions and auditability.",
      fusion: V
        ? "Fusion stays behind the gate until it earns daylight. Readiness is discipline: instruments, receipts, repeatability, and hard stops."
        : "Fusion readiness is requirements doctrine only. Admissibility depends on calibrated instrumentation, closed accounting, disproof conditions, and independent review. No gain is asserted.",
      frontier: V
        ? "Frontier isn’t fantasy; it’s compounding capability. Stable power builds stable industry. Stable industry builds the sky."
        : "Frontier expansion is staged feasibility: terrestrial stability precedes orbital infrastructure. Governance and measurement rules remain binding. Speculation is labeled and constrained."
    };

    return {
      concept: D[domainKey] ? (D[domainKey] + " " + BASE.concept) : BASE.concept,
      live: D[domainKey] ? (D[domainKey] + " " + BASE.live) : BASE.live,
      roadmap: D[domainKey] ? (D[domainKey] + " " + BASE.roadmap) : BASE.roadmap
    };
  }

  // ===== Show/hide helpers =====
  function showOverlay(){ bd.classList.add("show"); }
  function hideOverlay(){ bd.classList.remove("show"); }

  function showDomains(){
    showOverlay();
    modalNarr.classList.remove("show");
    modalDomains.classList.add("show");
  }
  function showNarrative(){
    showOverlay();
    modalDomains.classList.remove("show");
    modalNarr.classList.add("show");
  }
  function closeAll(){
    modalDomains.classList.remove("show");
    modalNarr.classList.remove("show");
    hideOverlay();
  }

  // ===== Domain grid render =====
  function renderDomains(){
    domainsTitle.textContent = "ENERGY · " + state.quadrant;
    domainsGrid.innerHTML = "";

    var items = QUADRANT_DOMAINS[state.quadrant] || [];
    items.forEach(function(it){
      var card = document.createElement("div");
      card.className = "domCard";
      card.setAttribute("role","button");
      card.setAttribute("tabindex","0");

      var h = document.createElement("div");
      h.className = "domTitle";
      h.textContent = it.title;

      var s = document.createElement("div");
      s.className = "domSub";
      s.textContent = it.sub;

      card.appendChild(h);
      card.appendChild(s);

      function act(){
        if(it.action==="RETURN"){
          closeAll();
          return;
        }
        state.domain = it.key;
        renderNarrative();
        showNarrative();
      }

      card.addEventListener("click", act);
      card.addEventListener("keydown", function(e){
        if(e.key==="Enter" || e.key===" "){ e.preventDefault(); act(); }
      });

      domainsGrid.appendChild(card);
    });
  }

  // ===== Narrative render =====
  function renderNarrative(){
    var title = state.domain || "";
    var labelMap = {
      historical:"Historical Systems",
      adversarial:"Adversarial",
      baseline:"Baseline Constraints",
      engineering:"Engineering",
      technology:"Technology",
      interfaces:"Interfaces",
      industrial:"Industrial",
      environmental:"Environmental",
      financial:"Financial",
      policy:"Policy",
      legal:"Legal",
      public:"Public Trust",
      fusion:"Fusion Readiness",
      frontier:"Frontier Expansion"
    };
    narTitle.textContent = "ENERGY · " + (labelMap[title] || "Domain");
    document.getElementById("claimBanner").textContent = CLAIM_LINE;

    var pack = getNarrative(state.domain, state.voice);
    tConcept.textContent = pack.concept;
    tLive.textContent = pack.live;
    tRoadmap.textContent = pack.roadmap;

    pillFormal.classList.toggle("active", state.voice==="formal");
    pillInformal.classList.toggle("active", state.voice==="informal");
  }

  // ===== Quadrant bindings =====
  function bindQuad(id, quad){
    var el=document.getElementById(id);
    if(!el) return;
    function open(){
      state.quadrant = quad;
      state.domain = null;
      renderDomains();
      showDomains();
    }
    el.addEventListener("click", open);
    el.addEventListener("keydown", function(e){
      if(e.key==="Enter" || e.key===" "){ e.preventDefault(); open(); }
    });
  }
  bindQuad("qFoundation","FOUNDATION");
  bindQuad("qArchitecture","ARCHITECTURE");
  bindQuad("qPerformance","PERFORMANCE");
  bindQuad("qGovernance","GOVERNANCE");

  // ===== Close wiring =====
  domainsClose.addEventListener("click", closeAll);
  narClose.addEventListener("click", function(){
    // Close narrative → return to domains (NEW behavior)
    showDomains();
  });
  bd.addEventListener("click", closeAll);

  // Prevent overlay click from killing modal clicks
  modalDomains.addEventListener("click", function(e){ e.stopPropagation(); });
  modalNarr.addEventListener("click", function(e){ e.stopPropagation(); });

  // ===== Voice toggle =====
  pillFormal.addEventListener("click", function(){
    state.voice="formal";
    renderNarrative();
  });
  pillInformal.addEventListener("click", function(){
    state.voice="informal";
    renderNarrative();
  });

  // ===== Universal return (NEW) =====
  btnReturnDomains.addEventListener("click", function(){
    // Always go back one layer (narrative → domains)
    showDomains();
  });
  btnReturnQuadrants.addEventListener("click", function(){
    // Always go back to quadrants (close everything)
    closeAll();
  });

})();
</script>

</body>
</html>

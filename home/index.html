<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Home ¬∑ Coherent Resolution Platform</title>

<style>
:root{
  --red-deep:#4a0000;
  --red-lacquer:#7a0c0c;
  --gold:#d4af37;
  --gold-glow:rgba(212,175,55,.45);
  --silver:#cfd3da;
  --silver-glow:rgba(207,211,218,.35);
  --ink:#0a0f14;

  --line:rgba(255,255,255,.10);
  --soft:rgba(255,255,255,.06);

  --text:rgba(255,255,255,.92);
  --muted:rgba(255,255,255,.70);
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
  color:var(--text);
  background:
    radial-gradient(1200px 700px at 50% 0%, var(--red-lacquer) 0%, var(--red-deep) 55%, var(--ink) 100%);
  overflow-x:hidden;
}
.page{
  width:min(980px,94vw);
  margin:0 auto;
  padding:26px 14px 70px;
}

.hero{position:relative;z-index:2;text-align:left}
.hero h1{
  margin:0;
  font-size:44px;
  font-weight:900;
  letter-spacing:.12em;
  text-transform:uppercase;
}
.hero p{
  margin:10px 0 0;
  opacity:.78;
  font-size:16px;
  line-height:1.4;
}

.topbar{
  margin-top:14px;
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  align-items:center;
}
.pill{
  border-radius:999px;
  padding:10px 14px;
  background:rgba(255,255,255,.06);
  border:1px solid var(--line);
  box-shadow:inset 0 0 0 1px rgba(0,0,0,.12);
  font-weight:900;
  letter-spacing:.12em;
  text-transform:uppercase;
  font-size:12px;
  color:var(--text);
  text-decoration:none;
  user-select:none;
}
.pill:hover{background:rgba(255,255,255,.08)}
.pill.gold{border-color:rgba(212,175,55,.40); box-shadow:0 0 18px var(--gold-glow) inset}
.pill.silver{border-color:rgba(207,211,218,.34); box-shadow:0 0 18px var(--silver-glow) inset}
.pill.active{
  background:rgba(255,255,255,.10);
  border-color:rgba(212,175,55,.42);
  box-shadow:0 0 16px rgba(212,175,55,.18) inset;
}

.section-title{
  margin-top:18px;
  letter-spacing:.18em;
  text-transform:uppercase;
  opacity:.7;
  font-size:12px;
}

/* Quadrant cards */
details.quad{
  margin-top:12px;
  border-radius:22px;
  background:linear-gradient(180deg, rgba(0,0,0,.30), rgba(0,0,0,.18));
  border:1px solid var(--line);
  box-shadow:0 22px 70px rgba(0,0,0,.55);
  backdrop-filter:blur(12px);
  overflow:hidden;
}
details.quad summary{
  list-style:none;
  cursor:pointer;
  padding:16px 16px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  -webkit-tap-highlight-color:transparent;
}
details.quad summary::-webkit-details-marker{display:none}
.q-left{display:flex;align-items:center;gap:12px;min-width:0}
.q-badge{
  width:56px;height:40px;border-radius:16px;
  background:rgba(0,0,0,.22);
  border:1px solid rgba(255,255,255,.12);
  display:flex;align-items:center;justify-content:center;
  font-weight:900;letter-spacing:.10em;
  flex:0 0 auto;
}
.q-badge.gold{border-color:rgba(212,175,55,.50); box-shadow:0 0 14px var(--gold-glow) inset}
.q-badge.sun{border-color:rgba(212,175,55,.26); box-shadow:0 0 10px rgba(212,175,55,.18) inset}
.q-badge.city{border-color:rgba(207,211,218,.24); box-shadow:0 0 10px rgba(207,211,218,.16) inset}
.q-badge.set{border-color:rgba(207,211,218,.20); box-shadow:0 0 10px rgba(207,211,218,.14) inset}

.q-text{min-width:0}
.q-text b{display:block;font-size:18px;letter-spacing:.12em;text-transform:uppercase}
.q-text span{display:block;opacity:.72;margin-top:2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.q-arrow{
  width:42px;height:42px;border-radius:999px;
  background:rgba(255,255,255,.06);
  border:1px solid rgba(255,255,255,.10);
  display:flex;align-items:center;justify-content:center;
  opacity:.9;
  flex:0 0 auto;
}
.inside{padding:0 16px 16px}

/* Bubble grid */
.grid2{
  display:grid;
  grid-template-columns:1fr;
  gap:10px;
  margin-top:8px;
}
@media(min-width:760px){.grid2{grid-template-columns:1fr 1fr}}
.bubble{
  border-radius:18px;
  background:rgba(255,255,255,.05);
  border:1px solid rgba(255,255,255,.10);
  padding:12px 12px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  cursor:pointer;
  user-select:none;
  -webkit-tap-highlight-color:transparent;
}
.bubble:hover{background:rgba(255,255,255,.07)}
.bubble .t{min-width:0}
.bubble .t b{
  display:block;
  font-size:13px;
  letter-spacing:.14em;
  text-transform:uppercase;
}
.bubble .t i{
  display:block;
  font-style:normal;
  opacity:.72;
  font-size:12px;
  margin-top:2px;
  white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
}
.bubble .go{
  width:40px;height:40px;border-radius:999px;
  background:rgba(0,0,0,.18);
  border:1px solid rgba(255,255,255,.10);
  display:flex;align-items:center;justify-content:center;
  opacity:.9;
  flex:0 0 auto;
}

/* ===== MODAL OVERLAY (NO SCROLL-JUMP) ===== */
.modal-backdrop{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.55);
  backdrop-filter:blur(10px);
  z-index:999;
  display:none;
  align-items:center;
  justify-content:center;
  padding:14px;
}
.modal-backdrop.open{display:flex}

.modal{
  width:min(880px,96vw);
  max-height:min(82vh,860px);
  overflow:auto;
  border-radius:22px;
  border:1px solid rgba(255,255,255,.12);
  background:linear-gradient(180deg, rgba(20,0,0,.78), rgba(0,0,0,.55));
  box-shadow:0 30px 120px rgba(0,0,0,.70);
  position:relative;
}
.modal::before{
  content:"";
  position:absolute; inset:0;
  border-radius:22px;
  pointer-events:none;
  box-shadow:0 0 0 1px rgba(212,175,55,.10) inset;
}
.modal-top{
  padding:14px 14px 10px;
  display:flex;
  align-items:flex-start;
  justify-content:space-between;
  gap:12px;
}
.modal-top .meta{
  opacity:.70;
  letter-spacing:.18em;
  text-transform:uppercase;
  font-size:12px;
}
.modal-title{
  padding:0 14px;
  font-weight:900;
  letter-spacing:.08em;
  font-size:20px;
}
.modal-desc{
  padding:8px 14px 0;
  color:rgba(255,255,255,.78);
  line-height:1.55;
}
.modal-close{
  width:44px;height:44px;border-radius:999px;
  background:rgba(255,255,255,.06);
  border:1px solid rgba(255,255,255,.12);
  display:flex;align-items:center;justify-content:center;
  cursor:pointer;
  user-select:none;
}
.modal-close:hover{background:rgba(255,255,255,.10)}

/* modal lens chips reflect the GLOBAL lens */
.modal-lensrow{
  padding:12px 14px 0;
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}
.lenschip{
  border-radius:999px;
  padding:8px 12px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(255,255,255,.06);
  letter-spacing:.14em;
  text-transform:uppercase;
  font-size:11px;
  opacity:.9;
}
.lenschip.on{
  border-color:rgba(212,175,55,.45);
  box-shadow:0 0 16px rgba(212,175,55,.18) inset;
}

/* nested bubbles inside modal */
.modal-bubbles{
  padding:12px 14px 14px;
  display:grid;
  grid-template-columns:1fr;
  gap:10px;
}
@media(min-width:760px){.modal-bubbles{grid-template-columns:1fr 1fr}}
.subbubble{
  border-radius:18px;
  background:rgba(0,0,0,.22);
  border:1px solid rgba(255,255,255,.10);
  padding:12px 12px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  cursor:pointer;
}
.subbubble:hover{background:rgba(0,0,0,.28)}
.subbubble b{
  font-size:12px;
  letter-spacing:.14em;
  text-transform:uppercase;
}
.subbubble i{
  display:block;
  margin-top:3px;
  opacity:.72;
  font-style:normal;
  font-size:12px;
  white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
}
.subbubble .go{
  width:40px;height:40px;border-radius:999px;
  background:rgba(255,255,255,.06);
  border:1px solid rgba(255,255,255,.10);
  display:flex;align-items:center;justify-content:center;
  flex:0 0 auto;
}
.subpanel{
  margin:0 14px 14px;
  border-radius:18px;
  background:rgba(255,255,255,.04);
  border:1px solid rgba(255,255,255,.10);
  padding:12px 12px;
  display:none;
}
.subpanel.open{display:block}
.subpanel h3{
  margin:0;
  font-size:13px;
  letter-spacing:.16em;
  text-transform:uppercase;
}
.subpanel p{
  margin:8px 0 0;
  opacity:.78;
  line-height:1.55;
}

/* modal footer (single jump only) */
.modal-footer{
  padding:12px 14px 16px;
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  justify-content:flex-start;
}
.jump{
  border-radius:18px;
  padding:12px 14px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(255,255,255,.06);
  text-decoration:none;
  color:var(--text);
  font-weight:900;
  letter-spacing:.12em;
  text-transform:uppercase;
  font-size:12px;
}
.jump:hover{background:rgba(255,255,255,.08)}
.jump.gold{border-color:rgba(212,175,55,.45); box-shadow:0 0 16px var(--gold-glow) inset}

.brand{
  margin-top:22px;
  opacity:.30;
  letter-spacing:.35em;
  text-transform:uppercase;
  font-size:12px;
  text-align:center;
}
.footer{
  margin-top:8px;
  opacity:.35;
  font-size:12px;
  letter-spacing:.2em;
  text-align:center;
}
</style>
</head>

<body>
<div class="page">

  <div class="hero">
    <h1>HOME</h1>
    <p id="desc">Tap any bubble. Details pop over (no scroll jump). Origin / Now / Trajectory filters everything.</p>

    <div class="topbar">
      <span class="pill silver" id="langPill">LANG: EN</span>
      <span class="pill gold" id="depthPill">DEPTH: EXPLORE</span>

      <span class="pill" id="lensOrigin" role="button">ORIGIN</span>
      <span class="pill active" id="lensNow" role="button">NOW</span>
      <span class="pill" id="lensTrajectory" role="button">TRAJECTORY</span>

      <a class="pill" href="/door/">CHANGE DEPTH</a>
      <a class="pill" href="/">CHANGE LANGUAGE</a>
      <a class="pill gold" href="/door/" id="jumpHomeTop">JUMP HOME</a>
    </div>

    <div class="section-title">Quadrant routes (NW / NE / SW / SE)</div>
  </div>

  <!-- NW -->
  <details class="quad" open>
    <summary>
      <div class="q-left">
        <div class="q-badge gold">‚≠ê NW</div>
        <div class="q-text">
          <b>Northwest</b>
          <span>Definition ¬∑ language ¬∑ structure</span>
        </div>
      </div>
      <div class="q-arrow">‚ñæ</div>
    </summary>
    <div class="inside">
      <div class="grid2">
        <div class="bubble" data-block="ssg">
          <div class="t"><b>SSG</b><i>Resources ¬∑ Stores ¬∑ Constraints ¬∑ Goals ¬∑ Guards</i></div>
          <div class="go">‚ñ∂</div>
        </div>
        <div class="bubble" data-block="grammar">
          <div class="t"><b>Diamond Grammar</b><i>Hub-first traversal ¬∑ receipt gating</i></div>
          <div class="go">‚ñ∂</div>
        </div>
        <div class="bubble" data-block="dotgrid">
          <div class="t"><b>DOT.GRID</b><i>256-state indexing ¬∑ replay + audit</i></div>
          <div class="go">‚ñ∂</div>
        </div>
        <div class="bubble" data-block="acronyms">
          <div class="t"><b>Acronyms</b><i>Pillar map + usage</i></div>
          <div class="go">‚ñ∂</div>
        </div>
      </div>
    </div>
  </details>

  <!-- NE -->
  <details class="quad">
    <summary>
      <div class="q-left">
        <div class="q-badge sun">üåû NE</div>
        <div class="q-text">
          <b>Northeast</b>
          <span>Execution ¬∑ surfaces ¬∑ examples</span>
        </div>
      </div>
      <div class="q-arrow">‚ñæ</div>
    </summary>
    <div class="inside">
      <div class="grid2">
        <div class="bubble" data-block="surfaces">
          <div class="t"><b>Execution Surfaces</b><i>Apps ¬∑ portals ¬∑ interfaces</i></div>
          <div class="go">‚ñ∂</div>
        </div>
        <div class="bubble" data-block="receipts">
          <div class="t"><b>Workflows & Receipts</b><i>Audit trails ¬∑ replay safety</i></div>
          <div class="go">‚ñ∂</div>
        </div>
        <div class="bubble" data-block="examples">
          <div class="t"><b>Examples</b><i>How to use the system</i></div>
          <div class="go">‚ñ∂</div>
        </div>
        <div class="bubble" data-block="packs">
          <div class="t"><b>Packs & Outputs</b><i>Downloadables ¬∑ packaged artifacts</i></div>
          <div class="go">‚ñ∂</div>
        </div>
      </div>
    </div>
  </details>

  <!-- SW -->
  <details class="quad">
    <summary>
      <div class="q-left">
        <div class="q-badge city">üèÆ SW</div>
        <div class="q-text">
          <b>Southwest</b>
          <span>Measurement ¬∑ diagnostics ¬∑ rules</span>
        </div>
      </div>
      <div class="q-arrow">‚ñæ</div>
    </summary>
    <div class="inside">
      <div class="grid2">
        <div class="bubble" data-block="gauges">
          <div class="t"><b>Gauges</b><i>Instrument panels ¬∑ thresholds</i></div>
          <div class="go">‚ñ∂</div>
        </div>
        <div class="bubble" data-block="diagnostics">
          <div class="t"><b>Diagnostics</b><i>Classification under constraint</i></div>
          <div class="go">‚ñ∂</div>
        </div>
        <div class="bubble" data-block="rules">
          <div class="t"><b>Rules</b><i>Navigation + integrity</i></div>
          <div class="go">‚ñ∂</div>
        </div>
        <div class="bubble" data-block="protocols">
          <div class="t"><b>Protocols</b><i>Return / replay / audit</i></div>
          <div class="go">‚ñ∂</div>
        </div>
      </div>
    </div>
  </details>

  <!-- SE -->
  <details class="quad">
    <summary>
      <div class="q-left">
        <div class="q-badge set">üåá SE</div>
        <div class="q-text">
          <b>Southeast</b>
          <span>Identity ¬∑ references ¬∑ links</span>
        </div>
      </div>
      <div class="q-arrow">‚ñæ</div>
    </summary>
    <div class="inside">
      <div class="grid2">
        <div class="bubble" data-block="orcid">
          <div class="t"><b>ORCID</b><i>Research identity anchor</i></div>
          <div class="go">‚ñ∂</div>
        </div>
        <div class="bubble" data-block="osf">
          <div class="t"><b>OSF</b><i>Project registry / preprints</i></div>
          <div class="go">‚ñ∂</div>
        </div>
        <div class="bubble" data-block="refs">
          <div class="t"><b>References</b><i>Core citations / anchors</i></div>
          <div class="go">‚ñ∂</div>
        </div>
        <div class="bubble" data-block="contact">
          <div class="t"><b>Contact</b><i>Direct channel</i></div>
          <div class="go">‚ñ∂</div>
        </div>
      </div>
    </div>
  </details>

  <div class="brand">GEODIAMETRICS</div>
  <div class="footer">CANONICAL ¬∑ STABLE ¬∑ ¬© GEODIAMETRICS</div>
</div>

<!-- MODAL -->
<div class="modal-backdrop" id="modalBackdrop" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="modal-top">
      <div class="meta" id="modalMeta">DETAIL</div>
      <div class="modal-close" id="modalClose" aria-label="Close">‚úï</div>
    </div>
    <div class="modal-title" id="modalTitle">‚Äî</div>
    <div class="modal-desc" id="modalDesc">‚Äî</div>

    <div class="modal-lensrow">
      <span class="lenschip" data-chip="origin">Origin</span>
      <span class="lenschip on" data-chip="now">Now</span>
      <span class="lenschip" data-chip="trajectory">Trajectory</span>
    </div>

    <div class="modal-bubbles" id="modalBubbles"></div>

    <div class="subpanel" id="subpanel">
      <h3 id="subpanelTitle">‚Äî</h3>
      <p id="subpanelText">‚Äî</p>
    </div>

    <div class="modal-footer">
      <a class="jump gold" href="/door/">JUMP HOME</a>
    </div>
  </div>
</div>

<script>
(function(){
  const lang = (localStorage.getItem('crp_lang') || 'en').toLowerCase();
  const depth = (localStorage.getItem('crp_depth') || 'explore').toLowerCase();
  let lens = (localStorage.getItem('crp_lens') || 'now').toLowerCase(); // origin | now | trajectory

  const langPill = document.getElementById('langPill');
  const depthPill = document.getElementById('depthPill');
  langPill.textContent = 'LANG: ' + (lang === 'zh' ? '‰∏≠Êñá' : 'EN');
  depthPill.textContent = 'DEPTH: ' + (depth === 'learn' ? 'LEARN' : 'EXPLORE');

  const lensBtns = {
    origin: document.getElementById('lensOrigin'),
    now: document.getElementById('lensNow'),
    trajectory: document.getElementById('lensTrajectory')
  };

  // ---- BLOCKS (each has origin/now/trajectory + nested sub-bubbles) ----
  const blocks = {
    // NW
    ssg:{
      meta:'NW ¬∑ SSG',
      title:'SSG ‚Äî Simplified Syntax Geometry',
      origin:'Created to compress app behavior into a constraint-native spec vocabulary (minimum executable structure).',
      now:'Used to express Resources / Stores / Constraints / Goals / Guards with receipt-gated advancement.',
      trajectory:'Evolves into replay-safe execution contracts across products and institutions.',
      subs:[
        {k:'primitives', t:'Primitives', s:'R / S / C / G / Guards', p:'Resource (what is acted on). Store (where state lives). Constraint (invariants). Goal (success condition). Guard (admissibility check).'},
        {k:'receipts', t:'Receipts', s:'Gated flow', p:'Advance only after receipt. Back-nav invalidates downstream receipts. Each step is replayable and auditable.'},
        {k:'invariants', t:'Invariants', s:'Navigation-first', p:'No timers as gates. Unified press primitives. Atomic handoff with receipt.'},
        {k:'mapping', t:'Mapping', s:'How to read', p:'Use Explore for surface summaries. Use Learn for deep nested bubbles and full breakdowns.'}
      ]
    },
    grammar:{
      meta:'NW ¬∑ Grammar',
      title:'Diamond Grammar',
      origin:'Designed to eliminate ambiguity by forcing one coherent choice at a time.',
      now:'Hub-first traversal + receipt gating keeps navigation stable as content grows.',
      trajectory:'Scales into multi-portal routing without semantic drift.',
      subs:[
        {k:'rule', t:'Rule', s:'One choice', p:'Choose one route at a time. Complete the route. Return to hub.'},
        {k:'return', t:'Return protocol', s:'Hub-first', p:'Return to hub when uncertain. Don‚Äôt multi-tab inside a branch.'},
        {k:'receipt', t:'Receipt gating', s:'Proof', p:'Progress is verified. Backtracking invalidates downstream receipts.'},
        {k:'why', t:'Why it works', s:'Anti-drift', p:'It prevents compounding incoherence by constraining traversal structure.'}
      ]
    },
    dotgrid:{
      meta:'NW ¬∑ DOT.GRID',
      title:'DOT.GRID',
      origin:'Created to index decisions and evidence under consistent constraints.',
      now:'256-state indexing lattice for replay, audit, and observer-consistent classification.',
      trajectory:'Becomes a universal coordinate layer for cross-domain stability measurement.',
      subs:[
        {k:'what', t:'What it is', s:'256 states', p:'A compact indexing scheme for classifying system state under constraint.'},
        {k:'replay', t:'Replay', s:'Audit', p:'Evidence streams can be replayed to reproduce classifications.'},
        {k:'observer', t:'Observer-consistent', s:'Shared coordinates', p:'Independent observers should converge on the same classification from the same evidence.'},
        {k:'use', t:'Use', s:'When', p:'Use when you need repeatable scoring, auditing, and stability tracking.'}
      ]
    },
    acronyms:{
      meta:'NW ¬∑ Glossary',
      title:'Acronyms & Glossary',
      origin:'Introduced to prevent meaning collapse as the system scales.',
      now:'Pillarized map + usage notes.',
      trajectory:'Becomes a shared vocabulary layer for teams and institutions.',
      subs:[
        {k:'pillars', t:'Pillars', s:'Categories', p:'Acronyms grouped by domain pillars (language, execution, measurement, identity).'},
        {k:'usage', t:'Usage', s:'Rules', p:'Each acronym includes a short use-case and where it lives in the geometry.'},
        {k:'naming', t:'Naming', s:'Anti-drift', p:'Names are treated as stable interface contracts.'},
        {k:'list', t:'List', s:'Expandable', p:'In Learn mode, show deeper lists per pillar.'}
      ]
    },

    // NE
    surfaces:{
      meta:'NE ¬∑ Surfaces',
      title:'Execution Surfaces',
      origin:'Interfaces keep complexity inside the engine, not on the UI.',
      now:'Apps / portals / interfaces expose the engine as usable workflow.',
      trajectory:'Standardized portals across products and teams.',
      subs:[
        {k:'apps', t:'Apps', s:'Portals', p:'User-facing surfaces that route to the underlying engine safely.'},
        {k:'ux', t:'UX rule', s:'No jump-scroll', p:'Tap should always produce local, visible response (modal).'},
        {k:'handoff', t:'Handoffs', s:'Receipts', p:'Surfaces emit receipts for verified progression.'},
        {k:'layers', t:'Layers', s:'Explore vs Learn', p:'Explore = summary. Learn = nested bubbles and full breakdown.'}
      ]
    },
    receipts:{
      meta:'NE ¬∑ Receipts',
      title:'Workflows & Receipts',
      origin:'Receipts make progress verifiable.',
      now:'Audit trails and verification tokens make execution replay-safe.',
      trajectory:'Receipts become portable across systems (interoperable state).',
      subs:[
        {k:'token', t:'Token', s:'Verification', p:'A receipt is a verifiable record that a step was completed.'},
        {k:'audit', t:'Audit trail', s:'Replay', p:'Re-run the same evidence path and confirm identical output.'},
        {k:'back', t:'Back-nav', s:'Invalidate', p:'Backtracking invalidates downstream receipts to prevent drift.'},
        {k:'why', t:'Why', s:'Integrity', p:'It forces coherence: external trust cannot exceed internal coherence.'}
      ]
    },
    examples:{
      meta:'NE ¬∑ Examples',
      title:'Examples',
      origin:'Examples anchor abstract structure into action.',
      now:'How to use the system with real routes and decisions.',
      trajectory:'Examples become templates for teams and institutions.',
      subs:[
        {k:'quick', t:'Quick', s:'Explore', p:'Explore mode gives short examples without deep theory.'},
        {k:'deep', t:'Deep', s:'Learn', p:'Learn mode expands into nested steps + rationale.'},
        {k:'routes', t:'Routes', s:'NW/NE/SW/SE', p:'Examples mirror the quadrant system: definition, execution, measurement, identity.'},
        {k:'check', t:'Checks', s:'Receipts', p:'Each example ends in a receipt or verification step.'}
      ]
    },
    packs:{
      meta:'NE ¬∑ Packs',
      title:'Packs & Outputs',
      origin:'Built to ship utility fast.',
      now:'Downloadables and packaged artifacts.',
      trajectory:'Outputs become certified tracks and reusable kits.',
      subs:[
        {k:'pdf', t:'PDFs', s:'Materials', p:'Printable guides, drills, and structured references.'},
        {k:'kits', t:'Kits', s:'Reuse', p:'Composable packs that map to routes and receipts.'},
        {k:'release', t:'Releases', s:'What ships', p:'Explore shows what exists. Learn explains how it works.'},
        {k:'future', t:'Roadmap', s:'Trajectory', p:'Trajectory lens shows what expands next.'}
      ]
    },

    // SW
    gauges:{
      meta:'SW ¬∑ Gauges',
      title:'Gauges',
      origin:'Built to measure coherence under load.',
      now:'Instrument panels, consistency checks, thresholds.',
      trajectory:'Real-time stability monitoring.',
      subs:[
        {k:'panel', t:'Panels', s:'Dashboards', p:'Visualize coherence and drift with stable metrics.'},
        {k:'threshold', t:'Thresholds', s:'Rules', p:'Rules that define pass/fail under constraint.'},
        {k:'signal', t:'Signal', s:'Integrity', p:'Detect noise vs meaningful movement.'},
        {k:'trend', t:'Trends', s:'Trajectory', p:'Trajectory lens focuses on where it‚Äôs heading.'}
      ]
    },
    diagnostics:{
      meta:'SW ¬∑ Diagnostics',
      title:'Diagnostics',
      origin:'Classify systems under constraint.',
      now:'Coherence / drift / confusion categories with observer-consistent targets.',
      trajectory:'Universal early-warning systems.',
      subs:[
        {k:'class', t:'Classification', s:'Under constraint', p:'Same evidence should produce same class for independent observers.'},
        {k:'drift', t:'Drift', s:'Detection', p:'Detect fragmentation vs stabilization direction.'},
        {k:'conf', t:'Confusion', s:'Amplifier', p:'Confusion amplifies instability once present.'},
        {k:'audit', t:'Audit', s:'Replay', p:'Replay evidence streams and verify stability of classification.'}
      ]
    },
    rules:{
      meta:'SW ¬∑ Rules',
      title:'Rules',
      origin:'Defined to keep traversal stable.',
      now:'Navigation + integrity rules.',
      trajectory:'Governance standards.',
      subs:[
        {k:'nav', t:'Navigation', s:'Hub-first', p:'Return to hub when uncertain; one route at a time.'},
        {k:'guard', t:'Guards', s:'Admissibility', p:'Block actions that violate constraints.'},
        {k:'cons', t:'Consistency', s:'Integrity', p:'Values, actions, outcomes must align.'},
        {k:'scale', t:'Scale', s:'System-wide', p:'Scale-and-correlation standard across the network.'}
      ]
    },
    protocols:{
      meta:'SW ¬∑ Protocols',
      title:'Protocols',
      origin:'Convert principles into repeatable actions.',
      now:'Operational handoffs, verification, replay.',
      trajectory:'Certified operating procedures.',
      subs:[
        {k:'handoff', t:'Handoff', s:'Atomic', p:'Atomic handoff with receipt. No partial transitions.'},
        {k:'return', t:'Return', s:'Exit', p:'Exit emits terminal + return token.'},
        {k:'loop', t:'Loop', s:'Continuation', p:'Continuation loops back with memory token after receipt.'},
        {k:'kill', t:'Kill', s:'Exit criteria', p:'Define kill/exit conditions to prevent runaway drift.'}
      ]
    },

    // SE
    orcid:{
      meta:'SE ¬∑ ORCID',
      title:'ORCID',
      origin:'Identity anchors attribution and continuity.',
      now:'Researcher identity reference point.',
      trajectory:'Stable identity improves traceability long-term.',
      subs:[
        {k:'id', t:'iD', s:'Anchor', p:'Use ORCID as the stable researcher identity anchor.'},
        {k:'cite', t:'Citations', s:'Provenance', p:'Tie outputs to identity for provenance stability.'},
        {k:'share', t:'Sharing', s:'Continuity', p:'Continuity across publications and archives.'},
        {k:'use', t:'Use', s:'When', p:'Use whenever formal attribution matters.'}
      ]
    },
    osf:{
      meta:'SE ¬∑ OSF',
      title:'OSF',
      origin:'Registry creates a public research spine.',
      now:'Project registry / preprints / canonical references.',
      trajectory:'Continuity ledger for the system.',
      subs:[
        {k:'reg', t:'Registry', s:'Spine', p:'OSF organizes projects and keeps canonical references stable.'},
        {k:'pre', t:'Preprints', s:'Release', p:'Publish artifacts with stable identifiers.'},
        {k:'map', t:'Mapping', s:'Crosslinks', p:'Map branches to hubs without forcing navigation drift.'},
        {k:'use', t:'Use', s:'When', p:'Use when you need persistent public reference.'}
      ]
    },
    refs:{
      meta:'SE ¬∑ References',
      title:'References',
      origin:'References prevent semantic drift.',
      now:'Core citations and anchors.',
      trajectory:'Shared coordinates across readers.',
      subs:[
        {k:'core', t:'Core', s:'Anchors', p:'Core anchors keep meaning stable across time.'},
        {k:'link', t:'Links', s:'Identity', p:'Links connect evidence, identity, and outputs.'},
        {k:'scope', t:'Scope', s:'256', p:'References scale into the 256 geometry.'},
        {k:'use', t:'Use', s:'When', p:'Use whenever you need alignment across audiences.'}
      ]
    },
    contact:{
      meta:'SE ¬∑ Contact',
      title:'Contact',
      origin:'Direct channel exists to restore alignment quickly.',
      now:'Communication line for access and collaboration.',
      trajectory:'Intake for adoption and certification.',
      subs:[
        {k:'in', t:'Intake', s:'Requests', p:'Use for collaboration, questions, and access.'},
        {k:'ops', t:'Ops', s:'Governance', p:'Operational coordination and structure.'},
        {k:'cert', t:'Certification', s:'Tracks', p:'Certification and training coordination.'},
        {k:'use', t:'Use', s:'When', p:'Use when you need resolution or alignment.'}
      ]
    }
  };

  // ---- GLOBAL LENS ----
  function setLens(next){
    lens = next;
    localStorage.setItem('crp_lens', lens);
    Object.keys(lensBtns).forEach(k => lensBtns[k].classList.toggle('active', k === lens));
    updateModalLensChips();
    if(modalState.openKey){
      renderModal(modalState.openKey);
    }
  }
  lensBtns.origin.addEventListener('click',()=>setLens('origin'));
  lensBtns.now.addEventListener('click',()=>setLens('now'));
  lensBtns.trajectory.addEventListener('click',()=>setLens('trajectory'));

  // ---- MODAL ----
  const backdrop = document.getElementById('modalBackdrop');
  const closeBtn = document.getElementById('modalClose');
  const mMeta = document.getElementById('modalMeta');
  const mTitle = document.getElementById('modalTitle');
  const mDesc = document.getElementById('modalDesc');
  const mBubbles = document.getElementById('modalBubbles');
  const subpanel = document.getElementById('subpanel');
  const subTitle = document.getElementById('subpanelTitle');
  const subText = document.getElementById('subpanelText');

  const modalState = { openKey:null, openSub:null };

  function openModal(){
    backdrop.classList.add('open');
    backdrop.setAttribute('aria-hidden','false');
    document.body.style.overflow='hidden';
  }
  function closeModal(){
    backdrop.classList.remove('open');
    backdrop.setAttribute('aria-hidden','true');
    document.body.style.overflow='';
    modalState.openKey=null;
    modalState.openSub=null;
    subpanel.classList.remove('open');
  }
  closeBtn.addEventListener('click', closeModal);
  backdrop.addEventListener('click', (e)=>{ if(e.target === backdrop) closeModal(); });
  document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape' && backdrop.classList.contains('open')) closeModal(); });

  function updateModalLensChips(){
    document.querySelectorAll('.lenschip').forEach(ch=>{
      const k = ch.getAttribute('data-chip');
      ch.classList.toggle('on', k === lens);
    });
  }

  function renderModal(key){
    const b = blocks[key];
    if(!b) return;

    modalState.openKey = key;

    mMeta.textContent = b.meta || 'DETAIL';
    mTitle.textContent = b.title || '‚Äî';
    mDesc.textContent = (b[lens] || b.now || '').trim();

    // Build sub-bubbles (always), and in LEARN show subpanel auto-open first item
    mBubbles.innerHTML = '';
    (b.subs || []).forEach((s, idx)=>{
      const el = document.createElement('div');
      el.className = 'subbubble';
      el.setAttribute('data-sub', s.k);
      el.innerHTML =
        '<div class="t"><b>'+escapeHtml(s.t)+'</b><i>'+escapeHtml(s.s || '')+'</i></div>' +
        '<div class="go">‚ñ∂</div>';
      el.addEventListener('click', ()=>{
        modalState.openSub = s.k;
        subTitle.textContent = s.t;
        subText.textContent = s.p || '';
        subpanel.classList.add('open');
      });
      mBubbles.appendChild(el);

      if(depth === 'learn' && idx === 0 && !modalState.openSub){
        // open first sub automatically in learn
        modalState.openSub = s.k;
        subTitle.textContent = s.t;
        subText.textContent = s.p || '';
        subpanel.classList.add('open');
      }
    });

    if(depth !== 'learn'){
      subpanel.classList.remove('open');
      modalState.openSub = null;
    }

    updateModalLensChips();
  }

  function escapeHtml(str){
    return String(str).replace(/[&<>"']/g, s => ({
      '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'
    }[s]));
  }

  // bubble clicks => modal
  document.querySelectorAll('.bubble').forEach(el=>{
    el.addEventListener('click', ()=>{
      const key = el.getAttribute('data-block');
      modalState.openSub = null;
      renderModal(key);
      openModal();
    });
  });

  // initialize lens active
  if(!lensBtns[lens]) lens = 'now';
  setLens(lens);
})();
</script>

</body>
</html>

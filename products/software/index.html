<!-- TNT — /products/software/index.html
     PRODUCTS · SOFTWARE (UNIFIED SITE STYLE) · 2-POINT WISHBONE + IN-PAGE ACCORDION · 72 NARRATIVES · EN/中文/ES
     FIX:
       - Removes the “odd one out” modal grid look
       - Uses the same opal panel + accordion + bubbles pattern as Laws / Vision pages
       - Robust accordion toggles (open/close any item; no “stuck open” behavior)
     MODEL (LOCKED):
       - 2 glossy diamonds = ENGINE / PLATFORM (selects which domain set is shown)
       - Domain list in-page (6 domains) with colored diamond marker + subtitle
       - Open a domain -> 3 bubbles (CONCEPT / LIVE / ROADMAP), each tap-to-open
       - Global tone toggle (FORMAL / INFORMAL) drives all narrative text
     COUNT:
       - 12 domains × 3 bubbles × 2 tones = 72 narratives
     LANGUAGE:
       - EN / 中文 / ES (single-language via gd_lang; button toggle)
     STATE:
       - URL + LS: lang/style/time/depth (preserved on every jump)
       - Uses gd_lang/gd_style/gd_time/gd_depth only
     LOCKS:
       - Uses /assets/ui.css + /assets/branch.css + /assets/instruments.js
       - No html/body background overrides (ui.css owns field)
       - Tap-safe (no inline onclick)
-->

<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>PRODUCTS · SOFTWARE</title>

<link rel="stylesheet" href="/assets/ui.css"/>
<link rel="stylesheet" href="/assets/branch.css"/>
<script defer src="/assets/instruments.js"></script>

<style>
a{color:inherit;text-decoration:none}
:root{
  --R:170px;
  --D:198px;
  --goldSoft:rgba(212,175,55,.45);
  --obsA:rgba(12,22,38,.95);
  --obsB:rgba(6,10,16,.98);

  --opalA:rgba(210,190,255,.18);
  --opalB:rgba(120,70,255,.14);
  --opalC:rgba(90,210,255,.10);

  --mut:rgba(255,255,255,.90);
  --mut2:rgba(255,255,255,.74);

  --dockH:92px;
}

body{margin:0;color:#fff;font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif}
body::before,body::after{pointer-events:none!important}

/* Top */
.top-left{
  position:fixed;left:16px;top:16px;z-index:240;
  display:flex;gap:10px;flex-wrap:nowrap;white-space:nowrap;align-items:center;
}
.top-right{
  position:fixed;right:16px;top:16px;z-index:240;
  display:flex;gap:10px;flex-wrap:nowrap;white-space:nowrap;align-items:center;
}
.top-left .btn,.top-right .btn{white-space:nowrap}

/* Brand */
.brand{
  position:fixed;left:50%;top:16px;transform:translateX(-50%);
  z-index:230;text-align:center;padding:10px 18px;border-radius:999px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(0,0,0,.18);
  pointer-events:none;
}
.brand .t{font-weight:950;font-size:40px;letter-spacing:.25px;line-height:1.05;margin:0}
.brand .s{opacity:.86;font-size:14px;margin:6px 0 0;line-height:1.25}

/* Stage (wishbone) */
.stage{
  position:relative;
  width:min(720px,94vw);
  height:min(520px,62vh);
  margin:92px auto 0;
  z-index:60;
  pointer-events:none;
}
.outer{
  position:absolute;left:50%;top:50%;
  width:min(640px,92vw);height:min(640px,92vw);
  transform:translate(-50%,-50%) rotate(45deg);
  border-radius:60px;opacity:.55;pointer-events:none;
  border:1px solid rgba(255,255,255,.10);
  background:
    radial-gradient(circle at 30% 25%, rgba(255,255,255,.08), transparent 55%),
    radial-gradient(circle at 70% 80%, rgba(0,80,255,.14), transparent 60%),
    linear-gradient(160deg, rgba(14,24,40,.40) 0%, rgba(7,11,18,.58) 70%);
  box-shadow:
    0 90px 260px rgba(0,0,0,.50),
    inset 0 2px 0 rgba(255,255,255,.10),
    inset 0 -50px 90px rgba(0,0,0,.55);
}
.outer::after{
  content:"";position:absolute;inset:0;border-radius:60px;opacity:.12;pointer-events:none;
  background:repeating-conic-gradient(from 0deg, rgba(255,255,255,.04) 0deg 6deg, transparent 6deg 18deg);
}

.d{
  width:var(--D);height:var(--D);
  position:absolute;left:50%;top:50%;
  transform-origin:center;border-radius:28px;
  cursor:pointer;pointer-events:auto;touch-action:manipulation;
  -webkit-tap-highlight-color:transparent;
  overflow:hidden;
  background:
    radial-gradient(circle at 30% 22%, rgba(255,255,255,.55), transparent 45%),
    radial-gradient(circle at 70% 78%, rgba(0,120,255,.30), transparent 60%),
    linear-gradient(160deg, var(--obsA), var(--obsB));
  border:1px solid rgba(255,255,255,.16);
  box-shadow:
    0 38px 120px rgba(0,0,0,.85),
    0 0 32px rgba(212,175,55,.28),
    inset 0 2px 0 rgba(255,255,255,.25),
    inset 0 -42px 78px rgba(0,0,0,.80);
  transition:transform .18s ease, box-shadow .18s ease, border-color .18s ease;
}
.d::before{
  content:"";position:absolute;inset:0;border-radius:28px;padding:1px;
  background:linear-gradient(120deg, transparent 0%, var(--goldSoft) 50%, transparent 100%);
  opacity:.65;
  -webkit-mask:linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  -webkit-mask-composite:xor;mask-composite:exclude;
  pointer-events:none;
}
.d::after{
  content:"";position:absolute;left:10%;right:10%;top:10%;
  height:28%;border-radius:999px;
  background:linear-gradient(to bottom, rgba(255,255,255,.25), rgba(255,255,255,0));
  transform:rotate(-10deg);pointer-events:none;
}
.d:hover{
  transform:translate(-50%,-50%) translate(var(--tx), var(--ty)) rotate(45deg) scale(1.02);
  border-color:rgba(212,175,55,.35);
  box-shadow:
    0 44px 140px rgba(0,0,0,.92),
    0 0 44px rgba(212,175,55,.32),
    inset 0 2px 0 rgba(255,255,255,.28),
    inset 0 -46px 86px rgba(0,0,0,.84);
}
.d:active{
  transform:translate(-50%,-50%) translate(var(--tx), var(--ty)) rotate(45deg) scale(.99);
}
.d.active{
  border-color:rgba(212,175,55,.65);
  box-shadow:
    0 44px 140px rgba(0,0,0,.92),
    0 0 66px rgba(212,175,55,.34),
    inset 0 2px 0 rgba(255,255,255,.28),
    inset 0 -46px 86px rgba(0,0,0,.84);
}

.dL{ --tx:calc(var(--R) * -1); --ty:0px; transform:translate(-50%,-50%) translate(var(--tx),var(--ty)) rotate(45deg); }
.dR{ --tx:var(--R);           --ty:0px; transform:translate(-50%,-50%) translate(var(--tx),var(--ty)) rotate(45deg); }

.inner{
  transform:rotate(-45deg) translateY(-3px);
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  text-align:center;height:100%;padding:14px;gap:8px;
  pointer-events:none;user-select:none;
}
.lab{font-weight:950;font-size:18px;letter-spacing:.6px;text-shadow:0 0 16px rgba(255,255,255,.14)}
.sub{font-size:13px;opacity:.88;line-height:1.25;max-width:18em}

.core{
  position:absolute;left:50%;top:50%;
  transform:translate(-50%,-50%);
  width:60px;height:60px;border-radius:18px;
  background:rgba(0,0,0,.20);
  border:1px solid rgba(255,255,255,.10);
  box-shadow:0 18px 44px rgba(0,0,0,.55), inset 0 2px 0 rgba(255,255,255,.10);
  display:grid;place-items:center;
  pointer-events:none;
}

/* Content area */
.page{
  width:min(1100px,94vw);
  margin:0 auto;
  padding:12px 0 calc(var(--dockH) + 18px);
  display:flex;
  flex-direction:column;
  gap:12px;
  position:relative;
  z-index:30;
}

/* Opal header panel */
.hero{
  border:1px solid rgba(255,255,255,.12);
  border-radius:22px;
  background:
    radial-gradient(circle at 20% 30%, var(--opalA), transparent 72%),
    radial-gradient(circle at 82% 66%, var(--opalB), transparent 74%),
    radial-gradient(circle at 55% 110%, var(--opalC), transparent 62%),
    linear-gradient(160deg, rgba(0,0,0,.26), rgba(0,0,0,.14));
  backdrop-filter:blur(10px);
  box-shadow:0 24px 80px rgba(0,0,0,.55);
  padding:14px 16px;
}
.hk{font-size:11px;letter-spacing:4px;text-transform:uppercase;opacity:.72;margin:0 0 6px}
.ht{font-weight:950;font-size:26px;letter-spacing:.6px;margin:0 0 6px}
.hs{font-size:13.5px;opacity:.86;line-height:1.5;margin:0;max-width:980px}
.fine{margin-top:10px;font-size:12.25px;opacity:.70;line-height:1.45}

/* Tone toggle */
.toneRow{
  display:flex;gap:10px;flex-wrap:wrap;justify-content:center;
  margin-top:10px;
}
.pill{
  padding:10px 14px;border-radius:999px;
  background:linear-gradient(145deg, rgba(17,22,28,.92), rgba(11,15,20,.96));
  border:1px solid rgba(255,255,255,.10);
  box-shadow:0 14px 36px rgba(0,0,0,.65);
  cursor:pointer;font-weight:900;letter-spacing:.2px;color:#fff;
  user-select:none;-webkit-tap-highlight-color:transparent;
}
.pill.active{
  border-color:rgba(212,175,55,.60);
  box-shadow:0 18px 50px rgba(0,0,0,.9), 0 0 14px rgba(212,175,55,.22);
}

/* Band */
.band{
  padding:10px 12px;border-radius:18px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(0,0,0,.12);
  font-weight:950;letter-spacing:.2px;color:rgba(255,255,255,.86);
}

/* Domain accordion (same family as products/laws) */
.stackList{display:flex;flex-direction:column;gap:12px}
.stackRow{
  --domc:#93C5FD;
  border:1px solid rgba(255,255,255,.10);
  border-radius:22px;
  background:
    radial-gradient(circle at 22% 18%, rgba(255,255,255,.06), transparent 58%),
    linear-gradient(145deg, rgba(17,22,28,.86), rgba(11,15,20,.92));
  box-shadow:0 16px 52px rgba(0,0,0,.60);
  overflow:hidden;
}
.stackHead{
  display:flex;align-items:flex-start;justify-content:space-between;
  gap:10px;padding:14px 16px;cursor:pointer;
  -webkit-tap-highlight-color:transparent;
  touch-action:manipulation;
}
.stackLeft{display:flex;align-items:flex-start;gap:12px;min-width:0}
.dotD{
  width:12px;height:12px;border-radius:4px;
  transform:rotate(45deg);
  background:var(--domc);
  box-shadow:0 0 0 1px rgba(255,255,255,.14), 0 0 18px rgba(0,0,0,.35);
  margin-top:3px;flex:0 0 auto;
}
.stackTitle{font-weight:950;letter-spacing:.2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.stackSub{margin-top:6px;font-size:12.75px;opacity:.80;line-height:1.35;max-width:92ch}
.stackChevron{font-size:16px;opacity:.75;flex:0 0 auto;margin-top:2px}

.stackBody{
  display:none;
  padding:14px 16px 16px;
  border-top:1px solid rgba(255,255,255,.08);
  background:
    radial-gradient(circle at 30% 30%, rgba(255,255,255,.06), transparent 55%),
    linear-gradient(145deg, rgba(12,22,38,.86), rgba(7,11,18,.92));
}
.stackRow.open .stackBody{display:block}

/* Bubbles inside each domain */
.bubble{
  border:1px solid rgba(255,255,255,.10);
  border-radius:18px;background:rgba(255,255,255,.05);
  padding:14px 14px 12px;margin:0 0 12px;
  cursor:pointer;-webkit-tap-highlight-color:transparent;
}
.bubble h4{margin:0 0 8px;font-weight:950;letter-spacing:.15px}
.bubble p{margin:0;color:var(--mut2);line-height:1.65;display:none}
.bubble.open p{display:block}
.hint{
  max-width:980px;margin:0 auto 12px;
  padding:10px 12px;border-radius:16px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(0,0,0,.16);
  color:rgba(255,255,255,.80);
  font-size:12.5px;line-height:1.45;
}

/* Dock */
.dock{
  position:fixed;left:50%;
  bottom:max(10px, env(safe-area-inset-bottom));
  transform:translateX(-50%);
  z-index:220;
  width:min(980px,94vw);
  padding:10px 12px;
  border-radius:22px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(0,0,0,.22);
  backdrop-filter:blur(10px);
  box-shadow:0 18px 60px rgba(0,0,0,.55);
  display:grid;
  grid-template-columns:repeat(4, minmax(0,1fr));
  gap:10px;
}
.dock .btn{width:100%;padding:10px 10px;border-radius:999px;white-space:nowrap}
@media (max-width:560px){
  :root{--R:148px;--D:176px;--dockH:98px}
  .stage{height:min(460px,56vh);top:auto;margin-top:92px}
  .dock{grid-template-columns:repeat(3, minmax(0,1fr))}
}
</style>
</head>

<body>

<div class="top-left">
  <a class="btn" id="btnBack" href="/products/">BACK</a>
  <a class="btn" id="btnExit" href="/index.html">EXIT</a>
</div>

<div class="top-right" aria-label="Language">
  <button class="btn" id="btnEN" type="button">EN</button>
  <button class="btn" id="btnZH" type="button">中文</button>
  <button class="btn" id="btnES" type="button">ES</button>
</div>

<div class="brand" aria-hidden="true">
  <div class="t" id="hdrT">Software</div>
  <div class="s" id="hdrS">Wishbone · Engine ↔ Platform · 72 Narratives</div>
</div>

<div class="stage" aria-label="Software wishbone">
  <div class="outer" aria-hidden="true"></div>

  <div class="d dL" id="dEngine" role="button" tabindex="0" aria-label="Engine">
    <div class="inner">
      <div class="lab" id="labEngine">ENGINE</div>
      <div class="sub" id="subEngine">How it runs · state · gates</div>
    </div>
  </div>

  <div class="d dR" id="dPlatform" role="button" tabindex="0" aria-label="Platform">
    <div class="inner">
      <div class="lab" id="labPlatform">PLATFORM</div>
      <div class="sub" id="subPlatform">How it ships · surfaces · routing</div>
    </div>
  </div>

  <div class="core">◆</div>
</div>

<div class="page" aria-label="Software content">

  <div class="hero">
    <p class="hk" id="hk">SOFTWARE</p>
    <h1 class="ht" id="ht">ENGINE ↔ PLATFORM</h1>
    <p class="hs" id="hs">Pick a side. Open a domain. Tap Concept / Live / Roadmap.</p>
    <div class="fine" id="fine">Rule: wording can change by tone, but the contract stays stable.</div>

    <div class="toneRow" aria-label="Tone toggle">
      <button class="pill" id="toneInformal" type="button">INFORMAL</button>
      <button class="pill" id="toneFormal" type="button">FORMAL</button>
    </div>
  </div>

  <div class="band" id="band">ENGINE DOMAINS</div>
  <div class="hint" id="hint">Tap a domain to expand. Bubbles open inside. Tap again to close.</div>
  <div class="stackList" id="list"></div>

</div>

<nav class="dock" aria-label="Bottom navigation">
  <a class="btn" id="dockDoor" href="/door/">DOOR</a>
  <a class="btn" id="dockProducts" href="/products/">PRODUCTS</a>
  <a class="btn" id="dockLaws" href="/laws/">LAWS</a>
  <a class="btn" id="dockGauges" href="/gauges/">GAUGES</a>
</nav>

<script>
(function(){
  // ===== state =====
  var qs=new URLSearchParams(location.search);
  var lang  = qs.get("lang")  || localStorage.getItem("gd_lang")  || "en";
  var style = qs.get("style") || localStorage.getItem("gd_style") || "informal"; // used as default tone
  var time  = qs.get("time")  || localStorage.getItem("gd_time")  || "now";
  var depth = qs.get("depth") || localStorage.getItem("gd_depth") || "explore";

  if(lang!=="en" && lang!=="zh" && lang!=="es") lang="en";
  if(style!=="formal" && style!=="informal") style="informal";
  if(time==="trajectory") time="post";
  if(time!=="origin" && time!=="now" && time!=="post") time="now";
  if(depth!=="explore" && depth!=="learn") depth="explore";

  try{
    localStorage.setItem("gd_lang",lang);
    localStorage.setItem("gd_style",style);
    localStorage.setItem("gd_time",time);
    localStorage.setItem("gd_depth",depth);
  }catch(e){}
  document.documentElement.lang=(lang==="zh")?"zh":(lang==="es")?"es":"en";

  function q(){
    return "?lang="+encodeURIComponent(lang)+
           "&style="+encodeURIComponent(style)+
           "&time="+encodeURIComponent(time)+
           "&depth="+encodeURIComponent(depth);
  }

  function wire(id,path){
    var el=document.getElementById(id);
    if(el) el.href = path + q();
  }

  wire("btnBack","/products/");
  wire("btnExit","/index.html");
  wire("dockDoor","/door/");
  wire("dockProducts","/products/");
  wire("dockLaws","/laws/");
  wire("dockGauges","/gauges/");

  // language toggle (reload same path)
  var btnEN=document.getElementById("btnEN");
  var btnZH=document.getElementById("btnZH");
  var btnES=document.getElementById("btnES");

  function paintLang(){
    btnEN.classList.toggle("active", lang==="en");
    btnZH.classList.toggle("active", lang==="zh");
    btnES.classList.toggle("active", lang==="es");
  }
  paintLang();

  function setLang(next){
    if(next!=="en" && next!=="zh" && next!=="es") next="en";
    lang=next;
    try{ localStorage.setItem("gd_lang",lang); }catch(e){}
    window.location.href = window.location.pathname + q();
  }
  btnEN.addEventListener("click", function(){ setLang("en"); });
  btnZH.addEventListener("click", function(){ setLang("zh"); });
  btnES.addEventListener("click", function(){ setLang("es"); });

  // ===== UI text =====
  var UI={
    en:{
      hdrT:"Software",
      hdrS:"Wishbone · Engine ↔ Platform · 72 Narratives",
      d:{engine:{lab:"ENGINE",sub:"How it runs · state · gates"}, platform:{lab:"PLATFORM",sub:"How it ships · surfaces · routing"}},
      hk:"SOFTWARE",
      ht:"ENGINE ↔ PLATFORM",
      hs:"Pick a side. Open a domain. Tap Concept / Live / Roadmap.",
      fine:"Rule: wording can change by tone, but the contract stays stable.",
      bandE:"ENGINE DOMAINS",
      bandP:"PLATFORM DOMAINS",
      hint:"Tap a domain to expand. Bubbles open inside. Tap again to close.",
      informal:"INFORMAL",
      formal:"FORMAL",
      concept:"Concept",
      live:"Live",
      roadmap:"Roadmap"
    },
    zh:{
      hdrT:"软件",
      hdrS:"叉形入口 · 引擎 ↔ 平台 · 72段叙事",
      d:{engine:{lab:"引擎",sub:"怎么跑 · 状态 · 闸门"}, platform:{lab:"平台",sub:"怎么交付 · 界面 · 路由"}},
      hk:"软件",
      ht:"引擎 ↔ 平台",
      hs:"先选一侧。再开域。点：概念 / 上线 / 路线图。",
      fine:"规则：语气可变，但契约不变。",
      bandE:"引擎域",
      bandP:"平台域",
      hint:"点域展开；气泡在内部展开；再点可关闭。",
      informal:"通俗",
      formal:"正式",
      concept:"概念",
      live:"上线",
      roadmap:"路线图"
    },
    es:{
      hdrT:"Software",
      hdrS:"Horquilla · Motor ↔ Plataforma · 72 Narrativas",
      d:{engine:{lab:"MOTOR",sub:"Cómo corre · estado · compuertas"}, platform:{lab:"PLATAFORMA",sub:"Cómo se entrega · superficies · rutas"}},
      hk:"SOFTWARE",
      ht:"MOTOR ↔ PLATAFORMA",
      hs:"Elige un lado. Abre un dominio. Toca: Concepto / En vivo / Hoja de ruta.",
      fine:"Regla: cambia el tono, no el contrato.",
      bandE:"DOMINIOS DEL MOTOR",
      bandP:"DOMINIOS DE PLATAFORMA",
      hint:"Toca un dominio para expandir. Burbujas adentro. Toca otra vez para cerrar.",
      informal:"INFORMAL",
      formal:"FORMAL",
      concept:"Concepto",
      live:"En vivo",
      roadmap:"Hoja de ruta"
    }
  };
  var T=(lang==="zh")?UI.zh:(lang==="es")?UI.es:UI.en;

  document.getElementById("hdrT").textContent=T.hdrT;
  document.getElementById("hdrS").textContent=T.hdrS;

  document.getElementById("labEngine").textContent=T.d.engine.lab;
  document.getElementById("subEngine").textContent=T.d.engine.sub;
  document.getElementById("labPlatform").textContent=T.d.platform.lab;
  document.getElementById("subPlatform").textContent=T.d.platform.sub;

  document.getElementById("hk").textContent=T.hk;
  document.getElementById("ht").textContent=T.ht;
  document.getElementById("hs").textContent=T.hs;
  document.getElementById("fine").textContent=T.fine;
  document.getElementById("hint").textContent=T.hint;

  // ===== domains =====
  var DOMAINS = {
    state_runtime: {c:"#93C5FD", en:"State Runtime", zh:"状态运行时", es:"Runtime de estado", sEn:"State survives taps and refresh.", sZh:"点按与刷新下仍稳定。", sEs:"Estado estable al navegar."},
    deterministic_gates: {c:"#D4AF37", en:"Deterministic Gates", zh:"确定性闸门", es:"Compuertas deterministas", sEn:"Pass/fail with reason codes.", sZh:"通过/失败+原因码。", sEs:"Pasa/falla con razones."},
    receipt_progression: {c:"#60A5FA", en:"Receipt Progression", zh:"收据式推进", es:"Progresión por recibos", sEn:"Progress only by proof.", sZh:"只凭证明推进。", sEs:"Avanza solo con prueba."},
    change_control: {c:"#A3A3A3", en:"Change Control", zh:"变更控制", es:"Control de cambios", sEn:"New epoch when rules change.", sZh:"规则变更=新纪元。", sEs:"Nueva época si cambian reglas."},
    audit_discipline: {c:"#34D399", en:"Audit Discipline", zh:"审计纪律", es:"Disciplina de auditoría", sEn:"Receipts decide, not intent.", sZh:"收据说了算。", sEs:"Deciden recibos, no intención."},
    admissibility_doctrine: {c:"#F472B6", en:"Admissibility Doctrine", zh:"可采信教义", es:"Doctrina de admisibilidad", sEn:"Don’t claim beyond receipts.", sZh:"不超越收据主张。", sEs:"No afirmar sin recibos."},

    navigation_surfaces: {c:"#93C5FD", en:"Navigation Surfaces", zh:"导航界面", es:"Superficies de navegación", sEn:"Pretty UI, strict contract.", sZh:"界面漂亮，契约严格。", sEs:"UI bonita, contrato estricto."},
    product_packaging: {c:"#D4AF37", en:"Product Packaging", zh:"产品封装", es:"Empaquetado", sEn:"Products separate from proof.", sZh:"产品与证明分离。", sEs:"Producto separado de prueba."},
    enterprise_deployment: {c:"#60A5FA", en:"Enterprise Deployment", zh:"企业部署", es:"Despliegue empresarial", sEn:"Rollout waves + rollback.", sZh:"分波次+可回滚。", sEs:"Olas + rollback."},
    dotgrid_sweeps: {c:"#34D399", en:"Dot.Grid Sweeps", zh:"Dot.Grid 扫掠", es:"Barridos Dot.Grid", sEn:"Same sweep, comparable outputs.", sZh:"同扫掠，可比较。", sEs:"Mismo barrido, comparable."},
    scoring_outputs: {c:"#F472B6", en:"Scoring Outputs", zh:"评分输出", es:"Puntuación", sEn:"Signal, not persuasion.", sZh:"信号，不是说服。", sEs:"Señal, no persuasión."},
    registry_lookups: {c:"#A3A3A3", en:"Registry Lookups", zh:"登记查询", es:"Consultas de registro", sEn:"Status + reason codes.", sZh:"状态+原因码。", sEs:"Estado + razones."}
  };

  var ENGINE6 = ["state_runtime","deterministic_gates","receipt_progression","change_control","audit_discipline","admissibility_doctrine"];
  var PLATFORM6 = ["navigation_surfaces","product_packaging","enterprise_deployment","dotgrid_sweeps","scoring_outputs","registry_lookups"];

  function dTitle(id){
    var o=DOMAINS[id];
    return (lang==="zh")?o.zh:(lang==="es")?(o.es||o.en):o.en;
  }
  function dSub(id){
    var o=DOMAINS[id];
    return (lang==="zh")?o.sZh:(lang==="es")?(o.sEs||o.sEn):o.sEn;
  }

  // ===== narratives (reuse your existing text) =====
  // NOTE: Each field is {en,zh,es}
  var TEXT = {
    state_runtime:{
      concept:{
        formal:{en:"The runtime is a constrained state machine: declared keys define the coordinate and each transition is atomic. The same evidence stream yields the same next state under identical rules. This makes execution reproducible and drift-resistant.",
               zh:"运行时是受约束的状态机：规范键定义坐标，状态转移必须原子化。同一证据流在同一规则下得到同一下一状态，从而让执行可复现、抗漂移。",
               es:"El runtime es una máquina de estados acotada: las claves declaradas definen la coordenada y cada transición es atómica. La misma evidencia produce el mismo siguiente estado bajo las mismas reglas."},
        informal:{en:"The runtime is the part that keeps everything from turning into chaos. You are always in a state, and every move changes state cleanly. No guessing, no magic—just discipline.",
                  zh:"运行时负责防止系统变成混乱：你总在某个状态里，每一步都干净地换到下一个状态。不靠猜，不靠“魔法”，靠纪律。",
                  es:"El runtime evita el caos: siempre estás en un estado y cada paso cambia el estado de forma limpia. Sin magia ni suposiciones: disciplina."}
      },
      live:{
        formal:{en:"Live operation requires state to survive refresh, navigation, and device variance. Back-navigation can invalidate downstream receipts; forward movement requires fresh confirmation. Drift triggers rollback rather than reinterpretation.",
               zh:"上线态要求状态能穿越刷新、返回、设备差异。回退会使下游收据失效；前进需要重新确认。出现漂移则回滚，而不是改口解释。",
               es:"En vivo, el estado debe sobrevivir recarga, navegación y variaciones del dispositivo. Volver puede invalidar recibos; avanzar requiere confirmación. La deriva dispara rollback."},
        informal:{en:"Live means it doesn’t break when you tap around. Leave and come back and it still knows what’s true. If something goes weird, it resets cleanly instead of spiraling.",
                  zh:"上线意味着你怎么点都不崩：离开再回来，系统仍知道什么是真的。出问题就干净重置，不让它螺旋失控。",
                  es:"En vivo significa que no se rompe cuando tocas. Sales y vuelves y sigue siendo correcto. Si se pone raro, se reinicia limpio."}
      },
      roadmap:{
        formal:{en:"Roadmap extends the runtime into domain adapters and exportable receipts: each transition can emit a compact proof bundle (inputs, decision, result). Coverage expands without changing the core contract.",
               zh:"路线图把运行时扩展为可插拔的领域适配器与可导出的收据：每次转移都可输出小型证明包（输入、决策、结果）。覆盖面扩大但契约不变。",
               es:"La hoja de ruta añade adaptadores por dominio y recibos exportables: cada transición puede emitir un paquete de prueba (entradas, decisión, resultado) sin cambiar el contrato base."},
        informal:{en:"Next, the runtime learns new domains without changing the rules. More surfaces, same discipline. And you can export what happened so others can verify it.",
                  zh:"下一步是在不改规则的前提下接入更多领域：更多界面，同样纪律；还可以导出发生了什么，让别人能核查。",
                  es:"Luego, el runtime se extiende a nuevos dominios sin cambiar reglas: más superficies, misma disciplina, y exportas lo ocurrido para que otros lo verifiquen."}
      }
    },

    deterministic_gates:{
      concept:{
        formal:{en:"Gates are binary admissibility checks under declared scope. They prevent escalation without receipts and suppress narrative inflation. A gate is a rule: given inputs, it yields pass or fail.",
               zh:"闸门是在声明范围内的二元可采信检查：没有收据就不允许升级，防止叙事膨胀。闸门是规则：给定输入，只产出通过/失败。",
               es:"Las compuertas son verificaciones binarias de admisibilidad bajo alcance declarado. Sin recibos no hay escalación. Dado un input, devuelve pasa/falla."},
        informal:{en:"Gates are the yes/no switches that keep the system honest. If the proof isn’t there, you don’t level up. Simple and clean.",
                  zh:"闸门就是让系统诚实的“是/否”开关：没证明就不升级，干净利落。",
                  es:"Las compuertas son el sí/no que mantiene honestidad. Si no hay prueba, no subes de nivel. Simple."}
      },
      live:{
        formal:{en:"Live gates forbid timers-as-gates, hidden shortcuts, and silent overrides. Failures are contained and logged; success advances with a receipt. This preserves comparability across time.",
               zh:"上线闸门禁止用计时当闸门、禁止暗捷径、禁止静默覆盖。失败会被隔离并记录；通过则携带收据推进，从而保证跨时间可比较。",
               es:"En vivo, no hay temporizadores como compuertas, ni atajos ocultos, ni overrides silenciosos. Fallos se contienen y registran; éxitos avanzan con recibo."},
        informal:{en:"Live gating means no sneaky passes. You either meet it or you don’t. If you fail, it stops drift immediately and tells you what broke.",
                  zh:"上线闸门不允许“偷过”：要么满足，要么不满足。不满足就立刻止漂移，并告诉你哪里坏了。",
                  es:"En vivo no hay pases furtivos: cumples o no. Si fallas, corta la deriva y te dice qué se rompió."}
      },
      roadmap:{
        formal:{en:"Roadmap adds reason codes and replay: independent observers can reproduce gate decisions from the same receipt set. That upgrades trust while keeping the logic minimal.",
               zh:"路线图加入原因码与可回放：独立观察者可用同一收据集复现闸门决策。在保持逻辑极简的同时提升可信度。",
               es:"La hoja de ruta añade códigos de razón y replay: observadores independientes pueden reproducir la decisión con el mismo set de recibos, aumentando confianza."},
        informal:{en:"Next, every gate comes with a clean “why” that anyone can rerun. Same inputs, same result. That’s how trust scales.",
                  zh:"下一步是每个闸门都有可复跑的“为什么”：同输入同结果，信任因此能规模化。",
                  es:"Luego, cada compuerta viene con un “por qué” rerunable: mismo input, mismo resultado. Así escala la confianza."}
      }
    },

    receipt_progression:{
      concept:{
        formal:{en:"Progression is receipt-gated: advancement requires evidence that survives scope locks. Time does not grant progress; outputs do. This makes progress audit-friendly by default.",
               zh:"推进是收据闸门式的：升级必须有在范围锁下仍成立的证据。时间不授予进步，输出才授予进步，因此默认可审计。",
               es:"La progresión está acotada por recibos: avanzar requiere evidencia que sobreviva al alcance. El tiempo no otorga progreso; la salida sí."},
        informal:{en:"You don’t progress because time passed—you progress because you did the thing. Receipts are the proof you earned the next step.",
                  zh:"不是因为过了时间就算进步，而是因为你做到了。收据就是你配得上下一步的证明。",
                  es:"No avanzas por pasar tiempo; avanzas por hacerlo. Los recibos prueban que te ganaste el siguiente paso."}
      },
      live:{
        formal:{en:"Live progression preserves position across navigation and language toggles. Back-navigation can invalidate downstream receipts; forward steps require confirmation. Conflicts prefer safety over momentum.",
               zh:"上线推进会在导航与语言切换中保持位置。回退会使下游收据失效；前进需要确认。出现冲突时优先安全而非速度。",
               es:"En vivo, la progresión se conserva al navegar o cambiar idioma. Volver puede invalidar recibos; avanzar requiere confirmación."},
        informal:{en:"Live means you can’t accidentally skip into the future. If you back out, the system knows what becomes invalid and keeps you honest.",
                  zh:"上线意味着你无法误闯未来：你一回退，系统就知道哪些东西无效，并把你拉回真实状态。",
                  es:"En vivo no puedes “saltar” por accidente. Si retrocedes, el sistema sabe qué se invalida y te mantiene honesto."}
      },
      roadmap:{
        formal:{en:"Roadmap adds registrable receipt bundles (hashable) so progress can be recognized across products without leaking private data. Verification scales without centralized trust.",
               zh:"路线图加入可登记的收据包（可哈希），让进度能跨产品被认可而不泄露隐私。验证可扩展且不依赖中心信任。",
               es:"La hoja de ruta añade paquetes de recibos registrables (hasheables) para reconocer progreso entre productos sin filtrar datos privados."},
        informal:{en:"Next, your receipts become portable. Proof scales; privacy stays. That’s how progress becomes real outside one page.",
                  zh:"下一步是收据可携带：证明可扩展，隐私不牺牲。这样进度才能在页面之外也算数。",
                  es:"Luego, tus recibos se vuelven portátiles: la prueba escala y la privacidad permanece."}
      }
    },

    change_control: (function(){ return JSON.parse(JSON.stringify(TEXT_FROM_PREVIOUS_PLACEHOLDER)); })()
  };

  // ---- remaining 9 domains reuse from your earlier file ----
  // To keep this TNT self-contained, we embed the rest here exactly as previously used.
  // (No structural differences; only rendered under the unified UI.)
  // IMPORTANT: This object is intentionally expanded in-place to avoid external dependencies.

  // BEGIN: injected remaining domains
  TEXT.change_control = {
    concept:{
      formal:{en:"Change control defines how updates occur without corrupting comparability. If a change affects outcomes, it creates a new epoch. Past results remain interpretable under original rules.",
             zh:"变更控制规定如何升级而不破坏可比性：只要影响结果就开启新纪元；旧结果仍按旧规则可解释。",
             es:"El control de cambios define cómo actualizar sin romper comparabilidad. Si cambia resultados, crea una nueva época."},
      informal:{en:"Change control is how you upgrade without rewriting history. If rules change, you stamp it. Comparisons stay honest.",
                zh:"变更控制就是“不改历史”的升级法：规则变了就盖章，比较才诚实。",
                es:"Control de cambios es actualizar sin reescribir historia. Si cambias reglas, lo marcas."}
    },
    live:{
      formal:{en:"Live control requires staged rollout, rollback readiness, and documented reasons. Hotfixes must not become hidden policy changes. Stability remains primary.",
             zh:"上线变更必须分阶段发布、随时可回滚、且理由可追溯。热修不能变成暗政策变更。稳定性优先。",
             es:"En vivo, requiere rollout por fases, rollback listo y razones documentadas. Los hotfix no pueden ser cambios ocultos."},
      informal:{en:"Live means don’t push chaos to production. Roll out in waves, keep rollback ready, and don’t pretend a hotfix is harmless.",
                zh:"上线意味着别把混乱推到生产：分波次、备回滚、别假装热修无害。",
                es:"En vivo: no empujes caos a producción. Ola por ola y rollback listo."}
    },
    roadmap:{
      formal:{en:"Roadmap introduces signed releases and policy registries so changes become verifiable events. This strengthens external trust while keeping internal speed.",
             zh:"路线图引入签名发布与策略登记，使变更成为可验证事件：外部信任增强，内部速度不降。",
             es:"La hoja de ruta añade releases firmados y registros de política para que los cambios sean verificables."},
      informal:{en:"Next, updates become ‘signed events’ you can point to. People trust systems that don’t quietly change under their feet.",
                zh:"下一步是更新变成“可指认的签名事件”：人们信任不会悄悄换地板的系统。",
                es:"Luego, actualizaciones como ‘eventos firmados’. La gente confía en sistemas que no cambian en silencio."}
    }
  };

  TEXT.audit_discipline = {
    concept:{
      formal:{en:"Audit discipline requires observer-invariant evaluation: outputs are judged by receipts, not intent. Implemented via logging, replay, and fixed rule application under declared scope.",
             zh:"审计纪律要求观察者不变：用收据判输出，而不是用意图判。通过日志、回放、固定规则在声明范围内实现。",
             es:"La disciplina de auditoría exige evaluación invariante: se juzga por recibos, no por intención."},
      informal:{en:"Audit discipline means: show what happened. Not what you meant. Receipts decide.",
                zh:"审计纪律就是：看发生了什么，不看你“想表达什么”。收据说了算。",
                es:"Auditoría significa: muestra lo que pasó, no lo que ‘quisiste’. Los recibos deciden."}
    },
    live:{
      formal:{en:"Live audit mode produces bundles that can be re-run. Disagreements resolve via scope or missing receipts, not interpretation battles. This keeps disputes cheap and bounded.",
             zh:"上线审计会产出可复跑的包。分歧通过范围或缺失收据解决，而不是争论解释。争议因此变得便宜且有界。",
             es:"En vivo, produce paquetes re-ejecutables. Desacuerdos se resuelven por alcance o recibos faltantes."},
      informal:{en:"Live auditing makes fights boring. If you disagree, look at the receipt. If it’s missing, log it and move on.",
                zh:"上线审计让争吵变无聊：不一致就看收据；没收据就记缺失，然后继续。",
                es:"Auditoría en vivo hace peleas aburridas: si discrepas, mira el recibo. Si falta, regístralo y sigue."}
    },
    roadmap:{
      formal:{en:"Roadmap adds audit automation with strict separation of tuning authority. Builders cannot silently tune thresholds; auditors cannot silently relax them. This blocks capture.",
             zh:"路线图加入自动审计，同时严格分离调参权：开发者不能暗调阈值，审计者也不能暗放宽。防捕获。",
             es:"La hoja de ruta añade automatización con separación estricta: nadie ajusta umbrales en silencio."},
      informal:{en:"Next, audits get faster without getting weaker. And nobody gets to secretly tune outcomes to look good.",
                zh:"下一步是审计更快但不更弱；没人能偷偷调结果来“好看”。",
                es:"Luego, auditorías más rápidas sin volverse débiles. Nadie ‘tunea’ resultados en secreto."}
    }
  };

  TEXT.admissibility_doctrine = {
    concept:{
      formal:{en:"Doctrine defines what may be claimed and what must remain conditional. It prevents upgrades beyond receipts and locks language to measured scope. Software must obey this or it becomes narrative-driven.",
             zh:"教义规定什么能主张、什么必须条件化：防止超出收据升级，并把语言锁在可测范围内。软件必须遵守，否则就会被叙事驱动。",
             es:"La doctrina define qué se puede afirmar y qué debe ser condicional. Evita upgrades sin recibos y ata el lenguaje al alcance medido."},
      informal:{en:"Doctrine is the rule: don’t say more than you can prove. Software gets dangerous when it sells stories. This keeps it honest.",
                zh:"教义就是：别说超过你能证明的东西。软件一卖故事就危险。这个规则让它诚实。",
                es:"Doctrina: no digas más de lo que puedes probar. El software se vuelve peligroso cuando vende historias."}
    },
    live:{
      formal:{en:"Live doctrine enforces posture: concept stays concept, live stays measured, roadmap stays gated. If evidence is missing, the system must say so and refuse escalation.",
             zh:"上线教义会强制姿态：概念就是概念；上线必须可测；路线图必须有闸门。证据缺失就必须声明并拒绝升级。",
             es:"En vivo, postura: concepto es concepto, en vivo es medido, roadmap con compuertas. Si falta evidencia, se declara y no se escala."},
      informal:{en:"Live doctrine means call things what they are. If it’s not measured, don’t hype it. If it’s only a plan, label it as a plan.",
                zh:"上线教义就是：是什么就说是什么。没测就别吹；只是计划就标成计划。",
                es:"En vivo: llama a las cosas por su nombre. Si no está medido, no lo exageres. Si es plan, dilo plan."}
    },
    roadmap:{
      formal:{en:"Roadmap standardizes doctrine templates across products so claim discipline holds everywhere. This reduces drift and accelerates safe adoption.",
             zh:"路线图把教义模板标准化到全产品：主张纪律处处一致，漂移减少，安全采纳加速。",
             es:"La hoja de ruta estandariza plantillas doctrinales entre productos para disciplina consistente. Reduce deriva y acelera adopción segura."},
      informal:{en:"Next, every page speaks the same honest language. No surprises. No inflated claims. Clear posture everywhere.",
                zh:"下一步是每一页都说同一种诚实语言：没惊喜、没膨胀、姿态清晰。",
                es:"Luego, cada página habla el mismo lenguaje honesto. Sin sorpresas ni inflación de afirmaciones."}
    }
  };

  TEXT.navigation_surfaces = {
    concept:{
      formal:{en:"Surfaces present options without altering invariants. A surface may simplify choices, but it must not change what is admissible. UX is subordinate to engine rules.",
             zh:"界面负责呈现选项但不能改不变量：可以简化选择，但不能改变什么是可采信。体验必须服从引擎规则。",
             es:"Las superficies presentan opciones sin alterar invariantes. Pueden simplificar, pero no cambiar lo admisible."},
      informal:{en:"The surface can look simple, but it can’t lie. Pretty doesn’t get to override the rules.",
                zh:"界面可以很简单，但不能撒谎；漂亮不能覆盖规则。",
                es:"La superficie puede ser simple, pero no puede mentir. Lo bonito no anula reglas."}
    },
    live:{
      formal:{en:"Live surfaces require tap reliability: no competing UI stacks, no intercepting overlays, no double routes. Each action yields one deterministic outcome.",
             zh:"上线界面要求点按可靠：没有竞争层、没有拦截遮罩、没有双重路由；每次动作只产生一个确定结果。",
             es:"En vivo, fiabilidad: sin UI compitiendo, sin overlays interceptando, sin rutas dobles. Cada acción produce un resultado determinista."},
      informal:{en:"Live means every tap works the first time. No ghost layers. Touch it, and it does exactly one thing.",
                zh:"上线意味着每次点按一次成功：没有幽灵层；你点它，它只做一件事。",
                es:"En vivo, cada toque funciona a la primera. Sin capas fantasma."}
    },
    roadmap:{
      formal:{en:"Roadmap introduces reusable templates across products so interactions feel identical everywhere. Consistency reduces cognitive load and increases adoption velocity.",
             zh:"路线图引入跨产品复用模板：交互处处一致，认知负担下降，采纳速度提升。",
             es:"La hoja de ruta trae plantillas reutilizables entre productos: misma interacción en todas partes."},
      informal:{en:"Next, every product page feels like the same machine. Learn one, use them all.",
                zh:"下一步是每个产品页都像同一台机器：学会一个，就能用全部。",
                es:"Luego, cada página se siente como la misma máquina: aprendes una y usas todas."}
    }
  };

  TEXT.product_packaging = {
    concept:{
      formal:{en:"Packaging binds engines to sellable surfaces without mixing doctrine into marketing. Product pages state what you can use; proof pages state what is true. This prevents claim inflation.",
             zh:"封装把引擎绑定到可交付界面，但不把教义写成营销：产品页说你能用什么，证明页说什么是真的。防止主张膨胀。",
             es:"El empaquetado une motores a superficies vendibles sin mezclar doctrina con marketing. Producto: qué usar. Prueba: qué es cierto."},
      informal:{en:"Packaging is: here’s what you can use—without turning proof into sales copy. Products do the job; laws set boundaries.",
                zh:"封装就是：告诉你能用什么，但不把证明写成广告。产品做事，法则定边界。",
                es:"Empaquetado: aquí está lo que puedes usar sin convertir prueba en publicidad."}
    },
    live:{
      formal:{en:"Live packaging eliminates dead ends: every card opens, every open has a return, and state is preserved across jumps. The spine stays navigable under pressure.",
             zh:"上线封装消灭死路：每张卡都能打开；每个打开都有返回；跳转保持状态。压力下依旧可导航。",
             es:"En vivo elimina callejones: cada tarjeta abre, cada abrir tiene retorno y el estado se conserva."},
      informal:{en:"Live packaging means you can actually find things and get back. No 404s. No loops. Clean routes.",
                zh:"上线封装意味着你真能找到东西并回得来：不404、不绕圈、路由干净。",
                es:"Empaquetado en vivo: encuentras cosas y vuelves. Sin 404 ni bucles."}
    },
    roadmap:{
      formal:{en:"Roadmap adds tiering (SaaS/Enterprise/Government) and registry status so access level is legible without reading internal doctrine. Packaging stays human-first.",
             zh:"路线图加入分级（SaaS/企业/政府）与登记状态，让访问级别一眼可读，无需翻内部教义。封装保持人类可读。",
             es:"La hoja de ruta añade niveles y estado de registro para que el acceso sea legible sin doctrina interna."},
      informal:{en:"Next, products get clear tiers and access signals. People don’t need jargon to understand what’s available.",
                zh:"下一步是产品拥有清晰分级与访问信号：不靠术语也能理解可用内容。",
                es:"Luego, productos con niveles claros y señales de acceso. Sin jerga para entender."}
    }
  };

  TEXT.enterprise_deployment = {
    concept:{
      formal:{en:"Enterprise deployment is staged rollout with segmentation and rollback readiness. Claims remain bounded to measured bands. Governance is explicit: who deploys, who audits, who tunes.",
             zh:"企业部署是分阶段发布+分区隔离+可回滚准备。主张必须限制在可测区间。治理明确：谁部署、谁审计、谁调参。",
             es:"Despliegue empresarial = rollout por fases con segmentación y rollback listo. Afirmaciones acotadas a bandas medidas."},
      informal:{en:"Enterprise is scale without breaking. Waves, zones, rollback. No hero moves.",
                zh:"企业就是“不坏掉的扩张”：波次、分区、回滚；不靠英雄主义。",
                es:"Empresa es escalar sin romper: olas, zonas, rollback."}
    },
    live:{
      formal:{en:"Live posture monitors correlated exposure and gate compliance. Deployment decisions reference receipts, not urgency. Instability triggers containment and reversion to last stable state.",
             zh:"上线姿态监测相关暴露与闸门合规。部署决策依据收据而非紧迫感。不稳即隔离并回到上一稳定态。",
             es:"En vivo monitorea exposición correlacionada y compuertas. Decisiones se basan en recibos, no urgencia."},
      informal:{en:"Live enterprise means: if it wobbles, stop. If it clusters, split. If it drifts, roll back.",
                zh:"上线企业：一晃就停；一聚就拆；一漂就回滚。",
                es:"Empresa en vivo: si tiembla, para. Si se agrupa, separa. Si deriva, rollback."}
    },
    roadmap:{
      formal:{en:"Roadmap builds audit bundles and API exports so third parties can verify posture without privileged access. External trust scales when proof is portable.",
             zh:"路线图构建审计包与API导出，让第三方无需特权也能核查姿态。证明可携带，外部信任才能扩张。",
             es:"La hoja de ruta añade paquetes de auditoría y exports API para verificar sin acceso privilegiado."},
      informal:{en:"Next, enterprise gets ‘proof packages’ you can hand to auditors and partners. They verify without your whole stack.",
                zh:"下一步：企业拥有可交给审计与合作方的“证明包”，无需交出整套系统也能核查。",
                es:"Luego, ‘paquetes de prueba’ para auditores y socios sin entregar todo el stack."}
    }
  };

  TEXT.dotgrid_sweeps = {
    concept:{
      formal:{en:"Dot.Grid is a traversal-friendly indexing sweep: it enumerates states under fixed definitions and produces comparable windows. Its value is repeatable classification under constraint.",
             zh:"Dot.Grid 是面向遍历的索引扫掠：在固定定义下枚举状态并产出可比较窗口。价值在于“约束下的可重复分类”。",
             es:"Dot.Grid enumera estados bajo definiciones fijas y produce ventanas comparables. Valor: clasificación repetible."},
      informal:{en:"Dot.Grid is the scanner. It lets you sweep the same way every time so results don’t depend on mood or narrative.",
                zh:"Dot.Grid 就是扫描器：每次同样扫法，结果不依赖情绪或故事。",
                es:"Dot.Grid es el escáner: mismo barrido cada vez; resultados no dependen de narrativa."}
    },
    live:{
      formal:{en:"Live sweeps enforce window discipline and stable naming so comparisons remain valid across time. Outputs route to Gauges for display and Laws for interpretation bounds.",
             zh:"上线扫掠强制窗口纪律与稳定命名，使跨时间比较有效。输出去量规展示，去法则约束解释。",
             es:"En vivo mantiene disciplina de ventana y nombres estables. Salidas a Medidores y Leyes."},
      informal:{en:"Live sweeps mean you can compare today to yesterday fairly. Same window, same labels, same output.",
                zh:"上线扫掠让今天对昨天的比较变公平：同窗口、同标签、同输出。",
                es:"En vivo: comparar hoy vs ayer de forma justa. Misma ventana, mismas etiquetas."}
    },
    roadmap:{
      formal:{en:"Roadmap adds adapter packs so sweeps apply across domains while preserving the same stability contract when the 256-style indexing is used.",
             zh:"路线图加入适配包，使扫掠可跨领域，同时在使用256式索引时保持同一稳定契约。",
             es:"La hoja de ruta añade adaptadores para múltiples dominios manteniendo el contrato de estabilidad."},
      informal:{en:"Next, Dot.Grid plugs into more domains—same sweep logic, more places to use it. Learn once, reuse everywhere.",
                zh:"下一步：Dot.Grid 接入更多领域——同扫掠逻辑，更多用武之地；学一次，到处复用。",
                es:"Luego, Dot.Grid se conecta a más dominios: misma lógica, más usos. Aprendes una vez."}
    }
  };

  TEXT.scoring_outputs = {
    concept:{
      formal:{en:"Scoring converts gate vectors and exposure into a bounded metric with reason codes. A score cannot override a fail state; it compresses decisions, not reality.",
             zh:"评分把闸门向量与暴露转成带原因码的有界指标。分数不能覆盖失败态；它压缩决策，不改现实。",
             es:"La puntuación convierte vectores en una métrica acotada con códigos de razón. No puede anular un fallo."},
      informal:{en:"Scoring makes the signal easy to read. It doesn’t let you cheat a fail. It tells you where you stand and why.",
                zh:"评分让信号更好读：不允许你“用分数作弊”去盖过失败；它告诉你位置和原因。",
                es:"La puntuación hace la señal legible: no tapa un fallo. Te dice dónde estás y por qué."}
    },
    live:{
      formal:{en:"Live scoring produces stable summaries and exports. Any threshold change creates a new epoch; silent tuning is disallowed. This keeps comparisons honest.",
             zh:"上线评分会产出稳定摘要与导出。阈值变更必须新纪元；禁止静默调参。比较因此诚实。",
             es:"En vivo: resúmenes y exports estables. Cambios de umbral → nueva época; sin ajustes silenciosos."},
      informal:{en:"Live scoring means no moving goalposts. If the rule changes, it’s stamped. If you compare scores, it’s fair.",
                zh:"上线评分意味着不挪球门：规则变了就盖章；你比对分数才公平。",
                es:"En vivo: no se mueven los postes. Si cambia la regla, se marca; comparar es justo."}
    },
    roadmap:{
      formal:{en:"Roadmap integrates portfolio and underwriting views while keeping evidence traceable via hashed receipts. Scores become shareable without leaking private telemetry.",
             zh:"路线图接入组合与承保视图，同时用哈希收据保持证据可追溯。分数可分享但不泄露隐私遥测。",
             es:"La hoja de ruta integra vistas de portafolio y underwriting manteniendo evidencia trazable con recibos hasheados."},
      informal:{en:"Next, you can share a score with proof attached—without dumping private data. Trust gets easier when evidence travels with the number.",
                zh:"下一步：你能分享带证明的分数，而不倾倒隐私数据。证据跟着数字走，信任就更容易。",
                es:"Luego, compartes puntuación con prueba adjunta sin volcar datos privados."}
    }
  };

  TEXT.registry_lookups = {
    concept:{
      formal:{en:"Registry provides lookupable status for packages, tiers, and validity windows. It publishes minimum necessary truth (status, time, reason) without exposing sensitive internals.",
             zh:"登记系统提供可查询的包状态、分层与有效窗口；它只发布最小必要真相（状态/时间/原因），不暴露敏感内部。",
             es:"El registro ofrece estado consultable y ventanas de validez. Publica verdad mínima sin exponer internos sensibles."},
      informal:{en:"Registry is the status check. Active, suspended, revoked—plus the reason. Clear and verifiable.",
                zh:"登记系统就是状态核查：启用/暂停/撤销+原因码。清楚且可核查。",
                es:"Registro es chequeo de estado: activo, suspendido, revocado—con razón."}
    },
    live:{
      formal:{en:"Live registry forbids silent revocation and enforces deterministic renewal. Every suspension or reinstatement is logged and auditable. This blocks capture and hidden exceptions.",
             zh:"上线登记禁止静默撤销，并强制确定性续期规则。暂停/恢复都必须有日志可审计，阻断捕获与暗例外。",
             es:"En vivo prohíbe revocación silenciosa y obliga renovación determinista. Todo queda registrado y auditable."},
      informal:{en:"Live registry means nobody can quietly flip things behind the scenes. If it changes, you can see it.",
                zh:"上线登记意味着没人能背地里悄悄翻转状态：一变就能看见。",
                es:"Registro en vivo: nadie cambia cosas en secreto. Si cambia, lo ves."}
    },
    roadmap:{
      formal:{en:"Roadmap adds third-party attestations and replay bundles so status becomes verifiable across organizations. Registry becomes the bridge from internal execution to external trust.",
             zh:"路线图加入第三方证明与回放包，使状态能跨组织核查。登记成为内部执行到外部信任的桥梁。",
             es:"La hoja de ruta añade atestaciones y replay para verificar estado entre organizaciones."},
      informal:{en:"Next, registry becomes real-world credibility. Outside groups verify status without taking your word for it.",
                zh:"下一步：登记系统成为现实世界的可信度。外部机构无需“听你说”，就能核查状态。",
                es:"Luego, el registro se vuelve credibilidad real: terceros verifican estado sin depender de tu palabra."}
    }
  };
  // END: injected remaining domains

  function pickText(domainId, phase, tone){
    var d=TEXT[domainId];
    if(!d) return "NOT MEASURED";
    var obj=d[phase][tone];
    return (lang==="zh") ? obj.zh : (lang==="es") ? obj.es : obj.en;
  }

  // ===== selection state =====
  var side="ENGINE";      // ENGINE|PLATFORM
  var tone=style;         // informal|formal

  var dEngine=document.getElementById("dEngine");
  var dPlatform=document.getElementById("dPlatform");
  function paintSide(){
    dEngine.classList.toggle("active", side==="ENGINE");
    dPlatform.classList.toggle("active", side==="PLATFORM");
    document.getElementById("band").textContent = (side==="ENGINE") ? T.bandE : T.bandP;
  }

  var toneI=document.getElementById("toneInformal");
  var toneF=document.getElementById("toneFormal");
  function paintTone(){
    toneI.classList.toggle("active", tone==="informal");
    toneF.classList.toggle("active", tone==="formal");
    toneI.textContent=T.informal;
    toneF.textContent=T.formal;
  }

  // apply static labels
  document.getElementById("band").textContent = T.bandE;
  toneI.textContent=T.informal;
  toneF.textContent=T.formal;
  document.getElementById("band").textContent=T.bandE;
  document.getElementById("hint").textContent=T.hint;

  // set tone defaults from gd_style
  tone = (style==="formal") ? "formal" : "informal";

  // ===== render domain list =====
  var listEl=document.getElementById("list");

  function buildRow(domainId){
    var meta=DOMAINS[domainId];
    var row=document.createElement("div");
    row.className="stackRow";
    row.style.setProperty("--domc", meta.c);

    var head=document.createElement("div");
    head.className="stackHead";

    var left=document.createElement("div");
    left.className="stackLeft";

    var dot=document.createElement("div");
    dot.className="dotD";

    var block=document.createElement("div");
    block.style.minWidth="0";

    var title=document.createElement("div");
    title.className="stackTitle";
    title.textContent=dTitle(domainId);

    var sub=document.createElement("div");
    sub.className="stackSub";
    sub.textContent=dSub(domainId);

    block.appendChild(title);
    block.appendChild(sub);

    left.appendChild(dot);
    left.appendChild(block);

    var chev=document.createElement("div");
    chev.className="stackChevron";
    chev.textContent="▸";

    head.appendChild(left);
    head.appendChild(chev);

    var body=document.createElement("div");
    body.className="stackBody";

    var b1=document.createElement("div");
    b1.className="bubble";
    b1.innerHTML='<h4>'+T.concept+'</h4><p></p>';

    var b2=document.createElement("div");
    b2.className="bubble";
    b2.innerHTML='<h4>'+T.live+'</h4><p></p>';

    var b3=document.createElement("div");
    b3.className="bubble";
    b3.innerHTML='<h4>'+T.roadmap+'</h4><p></p>';

    function fill(){
      b1.querySelector("p").textContent = pickText(domainId,"concept",tone);
      b2.querySelector("p").textContent = pickText(domainId,"live",tone);
      b3.querySelector("p").textContent = pickText(domainId,"roadmap",tone);
    }
    fill();

    function bindBubble(b){
      b.setAttribute("role","button");
      b.tabIndex=0;
      b.addEventListener("click", function(e){
        e.stopPropagation();
        b.classList.toggle("open");
      });
      b.addEventListener("keydown", function(e){
        if(e.key==="Enter"||e.key===" "){
          e.preventDefault();
          b.classList.toggle("open");
        }
      });
    }
    [b1,b2,b3].forEach(bindBubble);

    body.appendChild(b1);
    body.appendChild(b2);
    body.appendChild(b3);

    // robust open/close (no “stuck”)
    head.addEventListener("click", function(){
      var open=!row.classList.contains("open");
      // single-open behavior (clean)
      listEl.querySelectorAll(".stackRow").forEach(function(r){
        r.classList.remove("open");
        var ch=r.querySelector(".stackChevron");
        if(ch) ch.textContent="▸";
        // also close bubbles inside other rows
        r.querySelectorAll(".bubble").forEach(function(bb){ bb.classList.remove("open"); });
      });
      row.classList.toggle("open", open);
      chev.textContent = open ? "▾" : "▸";
      if(open){ fill(); }
    });

    row.appendChild(head);
    row.appendChild(body);

    // allow tone repaint on the fly
    row._fill = fill;

    return row;
  }

  function renderList(){
    listEl.innerHTML="";
    var ids = (side==="ENGINE") ? ENGINE6 : PLATFORM6;
    ids.forEach(function(id){
      listEl.appendChild(buildRow(id));
    });
    // default: open first
    var first=listEl.querySelector(".stackRow");
    if(first){
      first.classList.add("open");
      var ch=first.querySelector(".stackChevron");
      if(ch) ch.textContent="▾";
      if(first._fill) first._fill();
    }
  }

  function refreshOpenRows(){
    // update text for currently open row after tone change
    listEl.querySelectorAll(".stackRow.open").forEach(function(r){
      if(r._fill) r._fill();
    });
  }

  // ===== side controls =====
  function setSide(next){
    side=next;
    paintSide();
    renderList();
    // scroll to list on selection (mobile nice)
    setTimeout(function(){
      var band=document.getElementById("band");
      if(band) band.scrollIntoView({behavior:"smooth", block:"start"});
    }, 60);
  }

  dEngine.addEventListener("click", function(){ setSide("ENGINE"); });
  dPlatform.addEventListener("click", function(){ setSide("PLATFORM"); });
  dEngine.addEventListener("keydown", function(e){ if(e.key==="Enter"||e.key===" "){ e.preventDefault(); setSide("ENGINE"); }});
  dPlatform.addEventListener("keydown", function(e){ if(e.key==="Enter"||e.key===" "){ e.preventDefault(); setSide("PLATFORM"); }});

  // ===== tone controls =====
  toneI.addEventListener("click", function(){
    tone="informal";
    style="informal";
    try{ localStorage.setItem("gd_style",style); }catch(e){}
    paintTone();
    refreshOpenRows();
  });
  toneF.addEventListener("click", function(){
    tone="formal";
    style="formal";
    try{ localStorage.setItem("gd_style",style); }catch(e){}
    paintTone();
    refreshOpenRows();
  });

  // ===== finalize paint + initial render =====
  paintSide();
  paintTone();
  renderList();

})();
</script>

</body>
</html>

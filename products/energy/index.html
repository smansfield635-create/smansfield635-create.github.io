<!-- TNT — /products/energy/index.html  (PRODUCTS · ENERGY · INDUSTRIAL PLASMA ARCHITECTURE)
     FINAL DESIGN (NO DRIFT + THICKER CONTENT):
       - Keep outer 4-diamond face (N/E/S/W) for energy domain navigation.
       - REMOVE N/E/S/W duplication INSIDE the modal.
       - Modal structure:
           1) Lenses (STYLE + CONCEPT/LIVE/ROADMAP)
           2) 4 substance tabs (FOUNDATION / ARCHITECTURE / PERFORMANCE / GOVERNANCE)  ← replaces 8 thin tabs
           3) Bubble assets row (Scientific / Industrial / Agricultural / Financial / Human / Adversarial / Regulatory)
           4) 4 inner diamonds (WHAT / WHY / SCOPE / OUTPUT)
           5) One dense content bubble (headline + paragraph + 4 bullets)
       - Substance-first labels; direction is implicit in structure.
       - Single-language render (EN only when lang=en; 中文 only when lang=zh; (ZH mirrors EN content for now))
       - Proven tap reliability (stage pointer-events none; diamonds pointer-events auto; dock tap-safe)
       - No debug pill overlays.
       - NO new state keys (gd_lang/gd_style/gd_time only) — bubble selection is session-only.
       - Uses /assets/ui.css + /assets/branch.css only
       - Does NOT style html/body background (ui.css owns field)
       - PUBLIC POSITIONING = INDUSTRIAL (C) ONLY
       - NO net-positive fusion language; NO grid-fusion implication
       - Fusion discussion = gated admissibility pathway only (link + gates; no physics recipes)
-->

<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>PRODUCTS · ENERGY</title>

<link rel="stylesheet" href="/assets/ui.css"/>
<link rel="stylesheet" href="/assets/branch.css"/>

<style>
:root{
  --R:154px;
  --goldSoft:rgba(212,175,55,.35);
  --obs1:#070b12;
  --obs2:#0c1626;
  --mut:rgba(255,255,255,.86);
  --mut2:rgba(255,255,255,.70);
}

body{margin:0;min-height:100vh;overflow-x:hidden;font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;color:#fff}

/* Top-left */
.top-left{position:fixed;left:16px;top:16px;z-index:90;display:flex;gap:10px;flex-wrap:wrap;align-items:center}
.btn{
  padding:10px 16px;border-radius:14px;
  background:linear-gradient(145deg,var(--obs2),var(--obs1));
  color:#fff;border:1px solid rgba(255,255,255,.08);
  box-shadow:0 14px 36px rgba(0,0,0,.7);
  cursor:pointer;font-weight:900;letter-spacing:.2px;text-decoration:none;
  -webkit-tap-highlight-color:transparent;
}
.btn:hover{box-shadow:0 18px 50px rgba(0,0,0,.9),0 0 14px var(--goldSoft)}
.btn.active{
  border-color:rgba(212,175,55,.32);
  box-shadow:0 18px 50px rgba(0,0,0,.9),0 0 18px rgba(212,175,55,.18);
}

/* Brand pill */
.brand{
  position:fixed;left:50%;top:16px;transform:translateX(-50%);
  z-index:80;text-align:center;padding:10px 14px;border-radius:999px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(0,0,0,.16);backdrop-filter:blur(8px);
}
.brand .name{font-weight:950;letter-spacing:1.2px;font-size:12px;opacity:.95}
.brand .tag{font-size:11px;letter-spacing:.6px;opacity:.70;margin-top:2px}

/* Stage (tap lock) */
.stage{
  position:fixed;left:50%;top:52%;
  transform:translate(-50%,-50%);
  width:min(720px,94vw);height:min(720px,94vw);
  z-index:60;
  pointer-events:none;
}
.outer{
  position:absolute;left:50%;top:50%;
  width:min(680px,92vw);height:min(680px,92vw);
  transform:translate(-50%,-50%) rotate(45deg);
  border-radius:60px;
  background:
    radial-gradient(circle at 30% 25%, rgba(255,255,255,.08), transparent 55%),
    radial-gradient(circle at 70% 80%, rgba(0,80,255,.14), transparent 60%),
    linear-gradient(160deg, rgba(14,24,40,.45) 0%, rgba(7,11,18,.62) 70%);
  border:1px solid rgba(255,255,255,.10);
  box-shadow:0 90px 260px rgba(0,0,0,.72), inset 0 2px 0 rgba(255,255,255,.10), inset 0 -50px 90px rgba(0,0,0,.55);
  opacity:.85;
  pointer-events:none;
}
.outer::after{
  content:"";position:absolute;inset:0;border-radius:60px;
  background:repeating-conic-gradient(from 0deg, rgba(255,255,255,.04) 0deg 6deg, transparent 6deg 18deg);
  opacity:.16; pointer-events:none;
}
.d{
  width:170px;height:170px;position:absolute;left:50%;top:50%;
  transform-origin:center;border-radius:26px;cursor:pointer;
  -webkit-tap-highlight-color:transparent;
  background:
    radial-gradient(circle at 35% 25%, rgba(255,255,255,.14), transparent 55%),
    radial-gradient(circle at 70% 80%, rgba(0,80,255,.18), transparent 60%),
    linear-gradient(160deg, rgba(12,22,38,.92) 0%, rgba(7,11,18,.95) 70%);
  border:1px solid rgba(255,255,255,.10);
  box-shadow:0 28px 84px rgba(0,0,0,.78), inset 0 2px 0 rgba(255,255,255,.14), inset 0 -28px 44px rgba(0,0,0,.62);
  transition:transform 220ms ease, box-shadow 220ms ease, border-color 220ms ease;
  pointer-events:auto;
  touch-action:manipulation;
}
.d::before{
  content:"";position:absolute;inset:0;border-radius:26px;padding:1px;
  background:linear-gradient(120deg, transparent 0%, var(--goldSoft) 50%, transparent 100%);
  opacity:.45;
  -webkit-mask:linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  -webkit-mask-composite:xor;mask-composite:exclude;
  pointer-events:none;
}
.d::after{
  content:"";position:absolute;left:12%;right:12%;top:10%;height:28%;
  border-radius:999px;background:linear-gradient(to bottom, rgba(255,255,255,.16), rgba(255,255,255,0));
  opacity:.85;transform:rotate(-10deg);pointer-events:none;
}
.d:hover{transform:translate(-50%,-50%) rotate(45deg) scale(1.02)}
.d.active{
  border-color:rgba(212,175,55,.55);
  box-shadow:0 34px 110px rgba(0,0,0,.88),0 0 30px rgba(212,175,55,.40),
    inset 0 2px 0 rgba(255,255,255,.18),inset 0 -32px 52px rgba(0,0,0,.68);
}
.d-n{transform:translate(-50%,-50%) translate(0, calc(var(--R) * -1)) rotate(45deg)}
.d-e{transform:translate(-50%,-50%) translate(var(--R), 0) rotate(45deg)}
.d-s{transform:translate(-50%,-50%) translate(0, var(--R)) rotate(45deg)}
.d-w{transform:translate(-50%,-50%) translate(calc(var(--R) * -1), 0) rotate(45deg)}
.inner{width:100%;height:100%;transform:rotate(-45deg);display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:16px;gap:10px;pointer-events:none;user-select:none}
.lab{font-weight:950;letter-spacing:.8px;font-size:16px}
.sub{font-size:12.5px;opacity:.82;line-height:1.35;max-width:18em}
.core{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:74px;height:74px;border-radius:22px;border:1px solid rgba(255,255,255,.10);background:rgba(0,0,0,.18);box-shadow:0 18px 44px rgba(0,0,0,.62), inset 0 2px 0 rgba(255,255,255,.10);display:grid;place-items:center;font-weight:950;letter-spacing:.5px;opacity:.92;pointer-events:none}

/* Dock (tap-safe) */
.dock{
  position:fixed;left:50%;
  bottom:max(12px, env(safe-area-inset-bottom));
  transform:translateX(-50%);
  z-index:90;width:min(900px,94vw);
  display:flex;justify-content:center;gap:10px;flex-wrap:wrap;
  padding:10px 12px;border-radius:999px;border:1px solid rgba(255,255,255,.10);
  background:rgba(0,0,0,.20);backdrop-filter:blur(8px);
  pointer-events:none;
}
.dock .btn{pointer-events:auto}

/* Modal */
.bd{position:fixed;inset:0;z-index:200;background:rgba(0,0,0,.65);backdrop-filter:blur(10px);display:none}
.bd.show{display:block}
.modal{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);width:min(1020px,94vw);max-height:88vh;display:none;z-index:210}
.modal.show{display:block}
.shell{
  height:88vh;border-radius:26px;border:1px solid rgba(255,255,255,.10);
  background:
    radial-gradient(circle at 50% 18%, rgba(176,0,0,.20), transparent 55%),
    radial-gradient(circle at 40% 25%, rgba(90,140,255,.12), transparent 55%),
    linear-gradient(160deg,var(--obs2) 0%, var(--obs1) 65%);
  box-shadow:0 60px 180px rgba(0,0,0,.92);
  overflow:hidden;display:flex;flex-direction:column;
}
.mhead{display:flex;justify-content:space-between;align-items:center;gap:10px;padding:14px 16px;border-bottom:1px solid rgba(255,255,255,.08)}
.mtitle{margin:0;font-weight:950;letter-spacing:.3px;font-size:16px}
.mclose{border:0;background:transparent;color:#fff;font-size:18px;cursor:pointer;padding:8px 10px}
.mbody{padding:14px 16px 18px;overflow:auto;-webkit-overflow-scrolling:touch;flex:1 1 auto}

/* Lenses */
.lensbar{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:center;padding:10px 10px 14px;border-bottom:1px solid rgba(255,255,255,.08);margin:-6px -6px 14px}
.chip{padding:10px 16px;border-radius:999px;background:linear-gradient(145deg,var(--obs2),var(--obs1));border:1px solid rgba(255,255,255,.08);box-shadow:0 14px 36px rgba(0,0,0,.65);cursor:pointer;font-weight:900;letter-spacing:.2px;color:#fff}
.chip.active{border-color:rgba(212,175,55,.35);box-shadow:0 18px 50px rgba(0,0,0,.9),0 0 16px rgba(212,175,55,.30)}

/* 4 substance tabs (thick) */
.tabs{
  margin:0 0 10px;
  padding:10px 10px 12px;
  border:1px solid rgba(255,255,255,.08);
  background:rgba(0,0,0,.10);
  border-radius:22px;
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
}
@media (min-width:720px){
  .tabs{ grid-template-columns:repeat(4, 1fr); }
}
.tab{
  padding:12px 14px;
  border-radius:999px;
  background:linear-gradient(145deg, rgba(17,22,28,.85), rgba(11,15,20,.90));
  border:1px solid rgba(255,255,255,.10);
  box-shadow:0 12px 30px rgba(0,0,0,.55);
  cursor:pointer;
  font-weight:950;
  letter-spacing:.2px;
  text-align:center;
  user-select:none;
  -webkit-tap-highlight-color:transparent;
}
.tab.active{
  border-color:rgba(212,175,55,.34);
  box-shadow:0 16px 44px rgba(0,0,0,.72), 0 0 18px rgba(212,175,55,.18);
}

/* Bubble assets row */
.bubbles{
  margin:0 0 14px;
  padding:10px 10px 12px;
  border:1px solid rgba(255,255,255,.08);
  background:rgba(0,0,0,.08);
  border-radius:22px;
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  justify-content:center;
}
.bub{
  padding:10px 14px;
  border-radius:999px;
  background:linear-gradient(145deg, rgba(17,22,28,.82), rgba(11,15,20,.88));
  border:1px solid rgba(255,255,255,.10);
  box-shadow:0 12px 30px rgba(0,0,0,.50);
  cursor:pointer;
  font-weight:900;
  letter-spacing:.15px;
  user-select:none;
  -webkit-tap-highlight-color:transparent;
  color:#fff;
}
.bub.active{
  border-color:rgba(212,175,55,.34);
  box-shadow:0 16px 44px rgba(0,0,0,.70), 0 0 18px rgba(212,175,55,.18);
}

/* 4 inner diamonds: panel lens */
.pgrid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
  margin:0 0 14px;
}
@media (min-width:760px){
  .pgrid{ grid-template-columns:repeat(4, 1fr); }
}
.pd{
  height:92px;
  border-radius:22px;
  cursor:pointer;
  -webkit-tap-highlight-color:transparent;
  background:
    radial-gradient(circle at 35% 25%, rgba(255,255,255,.14), transparent 55%),
    radial-gradient(circle at 70% 80%, rgba(0,80,255,.18), transparent 60%),
    linear-gradient(160deg, rgba(12,22,38,.92) 0%, rgba(7,11,18,.95) 70%);
  border:1px solid rgba(255,255,255,.10);
  box-shadow:0 18px 54px rgba(0,0,0,.60), inset 0 2px 0 rgba(255,255,255,.10);
  position:relative;
  overflow:hidden;
}
.pd::before{
  content:"";position:absolute;inset:0;border-radius:22px;padding:1px;
  background:linear-gradient(120deg, transparent 0%, var(--goldSoft) 50%, transparent 100%);
  opacity:.45;
  -webkit-mask:linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  -webkit-mask-composite:xor;mask-composite:exclude;
  pointer-events:none;
}
.pd.active{
  border-color:rgba(212,175,55,.40);
  box-shadow:0 22px 70px rgba(0,0,0,.72), 0 0 18px rgba(212,175,55,.18), inset 0 2px 0 rgba(255,255,255,.10);
}
.pd .pin{
  height:100%;
  display:flex;
  align-items:center;
  justify-content:center;
  text-align:center;
  padding:10px 10px;
  font-weight:950;
  letter-spacing:.4px;
}

/* Main content bubble (dense) */
.bubble{
  padding:16px 18px;border-radius:22px;
  background:
    radial-gradient(circle at 30% 30%, rgba(120,160,255,.08), transparent 55%),
    linear-gradient(145deg, rgba(12,22,38,.92), rgba(7,11,18,.95));
  border:1px solid rgba(255,255,255,.10);
  box-shadow:0 18px 60px rgba(0,0,0,.70), inset 0 2px 0 rgba(255,255,255,.06);
  position:relative;
}
.bubble::before{
  content:"";position:absolute;inset:0;border-radius:22px;padding:1px;
  background:linear-gradient(120deg, transparent 0%, var(--goldSoft) 50%, transparent 100%);
  opacity:.55;
  -webkit-mask:linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  -webkit-mask-composite:xor;mask-composite:exclude;
  pointer-events:none;
}
.bh{margin:0 0 10px;font-weight:950;letter-spacing:.2px;font-size:18px}
.bp{margin:0 0 12px;color:var(--mut);line-height:1.6}
.ul{margin:0 0 0 18px;padding:0;color:var(--mut2)}
.ul li{margin:7px 0}

/* Modal actions */
.mact{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:14px}
.sbtn{padding:12px 18px;border-radius:14px;background:linear-gradient(145deg,var(--obs2),var(--obs1));color:#fff;border:1px solid rgba(255,255,255,.08);box-shadow:0 14px 36px rgba(0,0,0,.7);cursor:pointer;font-weight:900;letter-spacing:.2px;text-decoration:none}

@media (max-width:560px){
  :root{--R:136px}
  .d{width:158px;height:158px}
  .stage{top:50%}
}
</style>
</head>

<body>

<div class="top-left">
  <a class="btn" id="btnBack" href="/products/">BACK</a>
  <a class="btn" id="btnExit" href="/door/">EXIT</a>
</div>

<div class="brand">
  <div class="name" id="brandName">PRODUCTS</div>
  <div class="tag" id="brandTag">ENERGY · INDUSTRIAL PLASMA ARCHITECTURE</div>
</div>

<div class="stage" aria-label="Energy domain diamond">
  <div class="outer"></div>

  <div class="d d-n" id="dNorth" role="button" tabindex="0" onclick="window.__openEnergy('north')">
    <div class="inner"><div class="lab" id="labNorth">NORTH</div><div class="sub" id="subNorth">Industrial posture.</div></div>
  </div>

  <div class="d d-e" id="dEast" role="button" tabindex="0" onclick="window.__openEnergy('east')">
    <div class="inner"><div class="lab" id="labEast">EAST</div><div class="sub" id="subEast">R&amp;D gates.</div></div>
  </div>

  <div class="d d-w" id="dWest" role="button" tabindex="0" onclick="window.__openEnergy('west')">
    <div class="inner"><div class="lab" id="labWest">WEST</div><div class="sub" id="subWest">Execution stack.</div></div>
  </div>

  <div class="d d-s" id="dSouth" role="button" tabindex="0" onclick="window.__openEnergy('south')">
    <div class="inner"><div class="lab" id="labSouth">SOUTH</div><div class="sub" id="subSouth">Deployment phases.</div></div>
  </div>

  <div class="core">◆</div>
</div>

<nav class="dock" aria-label="Bottom navigation">
  <a class="btn" id="dockHub" href="/home/">HUB</a>
  <a class="btn" id="dockTerminal" href="/index.html">TERMINAL</a>
  <a class="btn" id="dockLinks" href="/links/">LINKS</a>
  <a class="btn active" id="dockProducts" href="/products/">PRODUCTS</a>
  <a class="btn" id="dockLaws" href="/laws/">LAWS</a>
  <a class="btn" id="dockGauges" href="/gauges/">GAUGES</a>
</nav>

<div class="bd" id="bd"></div>

<div class="modal" id="modal" role="dialog" aria-modal="true">
  <div class="shell">
    <div class="mhead">
      <h3 class="mtitle" id="mTitle">DETAIL</h3>
      <button class="mclose" id="mClose" aria-label="Close" type="button">✕</button>
    </div>

    <div class="mbody">
      <!-- Lenses -->
      <div class="lensbar">
        <button class="chip" id="styleChip" type="button">STYLE: FORMAL</button>
        <button class="chip" data-time="origin" id="chipConcept" type="button">CONCEPT</button>
        <button class="chip" data-time="now" id="chipLive" type="button">LIVE</button>
        <button class="chip" data-time="post" id="chipRoadmap" type="button">ROADMAP</button>
      </div>

      <!-- 4 substance tabs (thick) -->
      <div class="tabs" id="tabs">
        <div class="tab active" data-group="foundation" id="tFoundation">FOUNDATION</div>
        <div class="tab" data-group="architecture" id="tArchitecture">ARCHITECTURE</div>
        <div class="tab" data-group="performance" id="tPerformance">PERFORMANCE</div>
        <div class="tab" data-group="governance" id="tGovernance">GOVERNANCE</div>
      </div>

      <!-- Bubble assets (session-only; no new state keys) -->
      <div class="bubbles" id="bubbles">
        <div class="bub active" data-bub="industrial" id="bIndustrial">Industrial</div>
        <div class="bub" data-bub="scientific" id="bScientific">Scientific</div>
        <div class="bub" data-bub="agricultural" id="bAgricultural">Agricultural</div>
        <div class="bub" data-bub="financial" id="bFinancial">Financial</div>
        <div class="bub" data-bub="human" id="bHuman">Human</div>
        <div class="bub" data-bub="adversarial" id="bAdversarial">Adversarial</div>
        <div class="bub" data-bub="regulatory" id="bRegulatory">Regulatory</div>
      </div>

      <!-- Panel lens -->
      <div class="pgrid" id="pgrid">
        <div class="pd active" data-panel="what" id="pWhat"><div class="pin">WHAT</div></div>
        <div class="pd" data-panel="why" id="pWhy"><div class="pin">WHY</div></div>
        <div class="pd" data-panel="scope" id="pScope"><div class="pin">SCOPE</div></div>
        <div class="pd" data-panel="output" id="pOutput"><div class="pin">OUTPUT</div></div>
      </div>

      <!-- Dense content -->
      <div class="bubble">
        <h4 class="bh" id="hMain">—</h4>
        <p class="bp" id="pMain">—</p>
        <ul class="ul" id="uMain"></ul>
      </div>

      <div class="mact">
        <button class="sbtn" id="mReturn" type="button">RETURN</button>
        <a class="sbtn" id="mFusion" href="/explore/fusion-readiness/">FUSION READINESS</a>
        <a class="sbtn" id="mJumpProducts" href="/products/">JUMP PRODUCTS</a>
        <a class="sbtn" id="mJumpHub" href="/home/">JUMP HUB</a>
      </div>
    </div>
  </div>
</div>

<script>
(function(){
  // ===== State hydration (gd_* only) =====
  const qs = new URLSearchParams(location.search);
  let lang  = qs.get("lang")  || localStorage.getItem("gd_lang")  || "en";
  let style = qs.get("style") || localStorage.getItem("gd_style") || "formal";
  let time  = qs.get("time")  || localStorage.getItem("gd_time")  || "now";
  if(!["en","zh"].includes(lang)) lang="en";
  if(!["formal","informal"].includes(style)) style="formal";
  if(time==="trajectory") time="post";
  if(!["origin","now","post"].includes(time)) time="now";
  try{ localStorage.setItem("gd_lang",lang); localStorage.setItem("gd_style",style); localStorage.setItem("gd_time",time); }catch(e){}
  document.documentElement.lang = (lang==="zh") ? "zh" : "en";

  const q = () => `lang=${encodeURIComponent(lang)}&style=${encodeURIComponent(style)}&time=${encodeURIComponent(time)}`;
  function setLinks(){
    const s=q();
    document.getElementById("btnBack").href="/products/?"+s;
    document.getElementById("btnExit").href="/door/?"+s;
    document.getElementById("dockHub").href="/home/?"+s;
    document.getElementById("dockTerminal").href="/index.html?"+s;
    document.getElementById("dockLinks").href="/links/?"+s;
    document.getElementById("dockProducts").href="/products/?"+s;
    document.getElementById("dockLaws").href="/laws/?"+s;
    document.getElementById("dockGauges").href="/gauges/?"+s;
    document.getElementById("mJumpProducts").href="/products/?"+s;
    document.getElementById("mJumpHub").href="/home/?"+s;
    document.getElementById("mFusion").href="/explore/fusion-readiness/?"+s;
  }
  setLinks();

  // ===== Text (EN; ZH mirrors EN for now) =====
  const UI = {
    en:{
      brand:"PRODUCTS",
      tag:"ENERGY · INDUSTRIAL PLASMA ARCHITECTURE",
      face:{
        north:{lab:"NORTH", sub:"Industrial posture."},
        east:{lab:"EAST", sub:"R&D gates."},
        south:{lab:"SOUTH", sub:"Deployment phases."},
        west:{lab:"WEST", sub:"Execution stack."}
      },
      lens:{formal:"FORMAL",informal:"INFORMAL",concept:"CONCEPT",live:"LIVE",roadmap:"ROADMAP"},
      stylePrefix:"STYLE: ",
      btn:{ret:"RETURN",jp:"JUMP PRODUCTS",jh:"JUMP HUB",fr:"FUSION READINESS"}
    },
    zh:{
      brand:"产品",
      tag:"能源 · 工业等离子架构",
      face:{
        north:{lab:"北", sub:"工业定位。"},
        east:{lab:"东", sub:"研发门控。"},
        south:{lab:"南", sub:"部署阶段。"},
        west:{lab:"西", sub:"执行栈。"}
      },
      lens:{formal:"正式",informal:"通俗",concept:"概念",live:"上线",roadmap:"路线图"},
      stylePrefix:"风格：",
      btn:{ret:"返回",jp:"跳转产品",jh:"跳转枢纽",fr:"聚变就绪路径"}
    }
  };
  const ui = (lang==="zh") ? UI.zh : UI.en;

  document.getElementById("brandName").textContent = ui.brand;
  document.getElementById("brandTag").textContent = ui.tag;

  document.getElementById("labNorth").textContent = ui.face.north.lab;
  document.getElementById("subNorth").textContent = ui.face.north.sub;
  document.getElementById("labEast").textContent = ui.face.east.lab;
  document.getElementById("subEast").textContent = ui.face.east.sub;
  document.getElementById("labSouth").textContent = ui.face.south.lab;
  document.getElementById("subSouth").textContent = ui.face.south.sub;
  document.getElementById("labWest").textContent = ui.face.west.lab;
  document.getElementById("subWest").textContent = ui.face.west.sub;

  document.getElementById("mReturn").textContent = ui.btn.ret;
  document.getElementById("mJumpProducts").textContent = ui.btn.jp;
  document.getElementById("mJumpHub").textContent = ui.btn.jh;
  document.getElementById("mFusion").textContent = ui.btn.fr;

  // ===== Modal refs =====
  const bd=document.getElementById("bd");
  const modal=document.getElementById("modal");
  const mClose=document.getElementById("mClose");
  const mTitle=document.getElementById("mTitle");
  const styleChip=document.getElementById("styleChip");
  const chipConcept=document.getElementById("chipConcept");
  const chipLive=document.getElementById("chipLive");
  const chipRoadmap=document.getElementById("chipRoadmap");

  const hMain=document.getElementById("hMain");
  const pMain=document.getElementById("pMain");
  const uMain=document.getElementById("uMain");

  const tabs=[...document.querySelectorAll(".tab")];
  const panels=[...document.querySelectorAll(".pd")];
  const bubs=[...document.querySelectorAll(".bub")];

  // Session-only (no new gd_* keys)
  let activeBub = "industrial";

  const persist=()=>{ try{ localStorage.setItem("gd_style",style); localStorage.setItem("gd_time",time);}catch(e){} };
  const setLensLabels=()=>{
    styleChip.textContent = ui.stylePrefix + (style==="formal" ? ui.lens.formal : ui.lens.informal);
    chipConcept.textContent = ui.lens.concept;
    chipLive.textContent = ui.lens.live;
    chipRoadmap.textContent = ui.lens.roadmap;
    chipConcept.classList.toggle("active", time==="origin");
    chipLive.classList.toggle("active", time==="now");
    chipRoadmap.classList.toggle("active", time==="post");
  };

  // Groups (8 thin -> 4 thick) — internal only
  const GROUP_LABEL={
    foundation:"FOUNDATION",
    architecture:"ARCHITECTURE",
    performance:"PERFORMANCE",
    governance:"GOVERNANCE"
  };

  const PANEL_LABEL={ what:"WHAT", why:"WHY", scope:"SCOPE", output:"OUTPUT" };

  // Base lines (Industrial C + gated R&D; no fusion claim)
  const BASE = {
    concept:{
      formal:{
        north:"Industrial posture is primary: contained high-energy regimes upstream; buffered outputs; no net-positive fusion claim.",
        east:"R&D is gated: fusion discussion is a strict admissibility pathway under instrumentation discipline; no readiness implied.",
        south:"Deployment is phased (IDP-1→IDP-4): pilot → cluster → adjacency → replication under containment and audit.",
        west:"Execution is supervisory: CC tiers, ERI escalation logic, CARES response, SVF validation, SLA buffering."
      },
      informal:{
        north:"Industrial first. Upstream-only high energy. No fusion claim.",
        east:"R&D is gated. Fusion talk is requirements-only.",
        south:"Deploy in phases, safely.",
        west:"Supervision + buffering + validation."
      }
    },
    live:{
      formal:{
        north:"Live posture: industrial thermal substitution with measured inputs/outputs and bounded failure envelopes.",
        east:"Live posture: gated evidence requirements for neutron signal and energy balance; no achievement asserted.",
        south:"Live posture: site selection, setbacks, midstream exchange, and licensing boundaries (no consumer high-energy).",
        west:"Live posture: logs, certificates, kill conditions, and non-retroactive discipline for claim safety."
      },
      informal:{
        north:"Live = measurable industrial output.",
        east:"Live = requirements for fusion evidence, not claims.",
        south:"Live = deployment discipline and boundaries.",
        west:"Live = audits, kill rules, and logs."
      }
    },
    roadmap:{
      formal:{
        north:"Roadmap: scale industrial heat substitution first; expand buffering; tighten governance; keep claims bounded.",
        east:"Roadmap: gated fusion readiness pathway remains separate until receipts exist; failure at any gate reverts to Industrial (C).",
        south:"Roadmap: replicate modular PFMs; add agricultural thermal reuse through exchangers only; preserve soil and livestock boundaries.",
        west:"Roadmap: underwriting-grade CC certification, independent audits, and standardized incident reporting."
      },
      informal:{
        north:"Roadmap: more industrial sites, same rules.",
        east:"Roadmap: gated pathway only, no drift.",
        south:"Roadmap: modular replication and safe co-location.",
        west:"Roadmap: stronger certs and audits."
      }
    }
  };

  // Thick group content: each group pulls from two underlying concepts
  const GROUP = {
    foundation:{
      formal:{
        origin:"Industrial (C) positioning is the public posture. Constraints and admissibility are declared first; R&D cannot upgrade claims without receipts.",
        now:"Claim discipline is explicit: no Q>1; no net-electric; no grid-fusion implication. Constraints remain primary over optimization.",
        post:"Scale by cloning bounded contracts (HIP/CC/ERI/SLA/CARES/SVF/IDP) and tightening bins; never by relaxing safety or redefining terms."
      },
      informal:{
        origin:"Industrial first. Constraints first. R&D gated.",
        now:"No fusion gain claims. Constraints rule.",
        post:"Clone contracts. Tighten rules. Scale clean."
      }
    },
    architecture:{
      formal:{
        origin:"Architecture is modular: HIP regime core + CC tiers + UCI supervisory control + SLA buffering + SVF validation + CARES response + IDP deployment.",
        now:"Architecture is layered: upstream high-energy regimes; midstream buffering and exchange; downstream passive endpoints only.",
        post:"Architecture becomes certifiable: CC tier mapping to deployment permissions; audit-ledger traceability; licensing boundaries enforced."
      },
      informal:{
        origin:"Modules: HIP + CC + UCI + SLA + SVF + CARES + IDP.",
        now:"Upstream only. Buffered midstream. Passive downstream.",
        post:"Certs + ledgers + licensing boundaries."
      }
    },
    performance:{
      formal:{
        origin:"Performance is defined as measurable industrial substitution: power-in, thermal-out, uptime, variance, buffer behavior, and safety event rates.",
        now:"Performance is logged: metered input/output, stability variance, ERI events, shutdown counts, and SVF agreement outcomes.",
        post:"Performance becomes underwriting-grade: verified efficiency bands, incident rates, maintenance intervals, and phase-gated scaling."
      },
      informal:{
        origin:"Performance = measured industrial output, not hype.",
        now:"Measure input/output, stability, and safety events.",
        post:"Verified bands + audits → scalable performance."
      }
    },
    governance:{
      formal:{
        origin:"Governance binds risk to permissions: ERI escalation bands, CC containment classes, CARES response tiers, and explicit stop rules.",
        now:"Governance is non-retroactive: violations trigger review; certificates require receipts; claims cannot drift after publication.",
        post:"Governance scales through standards and licensing: risk-tiered certification, independent audit pathways, and constrained deployment boundaries."
      },
      informal:{
        origin:"Risk tiers decide permissions.",
        now:"No retroactive edits. Logs and certs matter.",
        post:"Standards + licensing + audits scale governance."
      }
    }
  };

  const BUB = {
    industrial:{
      name:{en:"Industrial", zh:"工业"},
      bias:"Industrial thermal substitution posture; upstream-only high-energy regime; buffered delivery via SLA; phased deployment IDP."
    },
    scientific:{
      name:{en:"Scientific", zh:"科学"},
      bias:"Definitions, falsifiers, and measurement receipts; requirements-only for fusion readiness; no achievement implied."
    },
    agricultural:{
      name:{en:"Agricultural", zh:"农业"},
      bias:"Thermal reuse via exchanger-only boundaries; soil/livestock exclusion zones; seasonal buffering via SLA; revenue stacking without risk migration."
    },
    financial:{
      name:{en:"Financial", zh:"金融"},
      bias:"Capex discipline, phase-gated scaling (IDP), underwriting-grade CC tiers, incident-rate accountability, and auditability."
    },
    human:{
      name:{en:"Human", zh:"人因"},
      bias:"Safety-first boundaries, no consumer high-energy exposure, clarity of claims, and non-coercive adoption through incumbents."
    },
    adversarial:{
      name:{en:"Adversarial", zh:"对抗"},
      bias:"Disproof triggers, artifact suppression, hostile audit posture, and hard stops before drift or rupture."
    },
    regulatory:{
      name:{en:"Regulatory", zh:"监管"},
      bias:"Standards-first, licensing-before-scale, documentation and certificates, and compliance-ready separation of regimes."
    }
  };

  function bubbleBias(){
    return (BUB[activeBub] && BUB[activeBub].bias) ? BUB[activeBub].bias : "";
  }

  let activeFace = null;     // north/east/south/west
  let activeGroup = "foundation"; // foundation/architecture/performance/governance
  let activePanel = "what";  // what/why/scope/output

  function setActiveDiamond(face){
    document.getElementById("dNorth").classList.toggle("active", face==="north");
    document.getElementById("dEast").classList.toggle("active", face==="east");
    document.getElementById("dSouth").classList.toggle("active", face==="south");
    document.getElementById("dWest").classList.toggle("active", face==="west");
  }

  function setActiveTabs(){
    tabs.forEach(t => t.classList.toggle("active", t.dataset.group===activeGroup));
    panels.forEach(p => p.classList.toggle("active", p.dataset.panel===activePanel));
    bubs.forEach(b => b.classList.toggle("active", b.dataset.bub===activeBub));
  }

  function headline(face, group, panel){
    const FACE = (face==="north")?ui.face.north.lab:(face==="east")?ui.face.east.lab:(face==="south")?ui.face.south.lab:ui.face.west.lab;
    return `${PANEL_LABEL[panel]} · ${GROUP_LABEL[group]} · ${FACE} · ${BUB[activeBub] ? BUB[activeBub].name[lang==="zh"?"zh":"en"] : "Industrial"}`;
  }

  function paragraph(face, group, panel, lensTime, lensStyle){
    const S = (lensStyle==="formal")?"formal":"informal";
    const L = (lensTime==="origin")?"origin":(lensTime==="now")?"now":"post";
    const groupLine = GROUP[group][S][L];
    if(panel==="what") return groupLine;
    if(panel==="why") return (S==="formal")
      ? "Why states motive without claim drift: industrial-first value, buffered adoption, and strict evidence separation for R&D."
      : "Why = reason, without hype.";
    if(panel==="scope") return (S==="formal")
      ? "Scope defines what is allowed, what is gated, and what is explicitly not claimed."
      : "Scope = boundary.";
    return (S==="formal")
      ? "Output lists deployable artifacts and receipts—not promises."
      : "Output = deliverables.";
  }

  function panelBullets(face, group, panel, lensTime, lensStyle){
    const L = (lensTime==="origin")?"concept":(lensTime==="now")?"live":"roadmap";
    const S = (lensStyle==="formal")?"formal":"informal";
    const baseLine = BASE[L][S][face];
    const groupLine = (lensTime==="origin")?GROUP[group][S].origin:(lensTime==="now")?GROUP[group][S].now:GROUP[group][S].post;
    const bias = bubbleBias();

    if(panel==="what"){
      return [
        baseLine,
        groupLine,
        bias || "Industrial posture is default; bubble selection changes emphasis, not claims.",
        "Keys preserved: HIP, CC tiers, ERI, SLA, CARES, SVF, IDP; DOTGRID binding: DOTGRID-ENERGY-HYBRID-v1."
      ];
    }
    if(panel==="why"){
      return [
        "Reason: decarbonize industrial heat first (highest immediate leverage) while keeping deployment safe and auditable.",
        "Reason: buffering (SLA) prevents shock and stabilizes delivery without migrating risk to endpoints.",
        "Reason: modular PFMs allow replication without redefining safety or evidence requirements.",
        "Reason: gated readiness prevents claim drift and protects long-term credibility."
      ];
    }
    if(panel==="scope"){
      return [
        "Scope boundary: no net-positive fusion claim; no facility net-electric claim; no grid-fusion implication.",
        "Scope boundary: upstream high-energy regimes only; midstream exchange/buffering; downstream passive endpoints only.",
        "Scope boundary: agriculture uses exchanger-only thermal reuse; soil/livestock never interface with plasma regime.",
        "Scope boundary: fusion page is requirements-only; failure at any gate reverts positioning to Industrial (C)."
      ];
    }
    return [
      "Output: IDP phases (pilot→cluster→adjacency→replication) with containment boundaries and audit artifacts.",
      "Output: SVF templates, CARES response protocol, ERI escalation logic, and certificate-ledger discipline.",
      "Output: underwriting-grade CC tier pathway (future) based on measured incidents and verified stability bands.",
      "Output: fusion-readiness doctrine page (requirements + disproof conditions; no achievement claimed)."
    ];
  }

  function render(){
    persist();
    setLinks();
    setLensLabels();
    setActiveTabs();
    if(!activeFace) return;

    mTitle.textContent = (lang==="zh")
      ? ("详情 · " + (activeFace==="north"?ui.face.north.lab:activeFace==="east"?ui.face.east.lab:activeFace==="south"?ui.face.south.lab:ui.face.west.lab))
      : ("DETAIL · " + (activeFace==="north"?ui.face.north.lab:activeFace==="east"?ui.face.east.lab:activeFace==="south"?ui.face.south.lab:ui.face.west.lab));

    hMain.textContent = headline(activeFace, activeGroup, activePanel);
    pMain.textContent = paragraph(activeFace, activeGroup, activePanel, time, style);

    uMain.innerHTML = "";
    const bullets = panelBullets(activeFace, activeGroup, activePanel, time, style);
    bullets.forEach(x=>{
      const li=document.createElement("li");
      li.textContent = x;
      uMain.appendChild(li);
    });
  }

  function openModal(face){
    activeFace = face;
    setActiveDiamond(face);
    bd.classList.add("show");
    modal.classList.add("show");
    // Defaults: thick + industrial
    activeGroup = "foundation";
    activePanel = "what";
    activeBub = "industrial";
    render();
  }

  function closeModal(){
    bd.classList.remove("show");
    modal.classList.remove("show");
    setActiveDiamond("__none__");
    activeFace = null;
  }

  window.__openEnergy=function(face){ openModal(face); };

  // Lenses
  styleChip.addEventListener("click", ()=>{ style=(style==="formal")?"informal":"formal"; render(); });
  chipConcept.addEventListener("click", ()=>{ time="origin"; render(); });
  chipLive.addEventListener("click", ()=>{ time="now"; render(); });
  chipRoadmap.addEventListener("click", ()=>{ time="post"; render(); });

  // Close
  bd.addEventListener("click", closeModal);
  mClose.addEventListener("click", closeModal);
  document.getElementById("mReturn").addEventListener("click", closeModal);

  // Group tabs
  tabs.forEach(t=>{
    t.addEventListener("click", ()=>{ activeGroup=t.dataset.group; render(); });
    t.addEventListener("keydown",(e)=>{ if(e.key==="Enter"||e.key===" "){ e.preventDefault(); activeGroup=t.dataset.group; render(); } });
  });

  // Bubble assets
  bubs.forEach(b=>{
    b.addEventListener("click", ()=>{ activeBub=b.dataset.bub; render(); });
    b.addEventListener("keydown",(e)=>{ if(e.key==="Enter"||e.key===" "){ e.preventDefault(); activeBub=b.dataset.bub; render(); } });
  });

  // Panels
  const panelEls=[...document.querySelectorAll(".pd")];
  panelEls.forEach(p=>{
    p.addEventListener("click", ()=>{ activePanel=p.dataset.panel; render(); });
    p.addEventListener("keydown",(e)=>{ if(e.key==="Enter"||e.key===" "){ e.preventDefault(); activePanel=p.dataset.panel; render(); } });
  });

  // Keyboard for diamonds
  [["dNorth","north"],["dEast","east"],["dSouth","south"],["dWest","west"]].forEach(pair=>{
    document.getElementById(pair[0]).addEventListener("keydown",(e)=>{
      if(e.key==="Enter"||e.key===" "){ e.preventDefault(); window.__openEnergy(pair[1]); }
    });
  });

  setLensLabels();
})();
</script>

</body>
</html>

<!DOCTYPE html><html lang="en"><head>
<meta charset="utf-8"/><title>Control Room · Geodiametrics</title>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<link rel="stylesheet" href="/assets/ui.css"/></head>
<body class="bg-gradient"><main class="page">

<section class="hero">
  <h1>Control Room</h1>
  <p class="subtitle">Live gauges + engine receipts.</p>
</section>

<nav class="tabs">
  <a class="tab" href="/">Home</a>
  <a class="tab" href="/engine/">Engine</a>
  <a class="tab" href="/symptoms/">Symptoms</a>
  <a class="tab" href="/diagnosis/">Diagnosis</a>
  <a class="tab" href="/execution/">Execution</a>
  <a class="tab" href="/principles/">Laws</a>
  <a class="tab active" href="/control/">Control</a>
  <a class="tab" href="/reference/">Reference</a>
</nav>

<section class="panel strong">
  <h2>Engine Receipts (Device)</h2>
  <div id="r" class="kv">Loading…</div>
</section>

<section class="panel">
  <h2>Clicks (Device)</h2>
  <div id="c" class="kv">Loading…</div>
</section>

<section class="panel">
  <h2>Global Gauge (Worker)</h2>
  <div id="m" class="kv">Loading…</div>
</section>

<section class="panel">
  <div class="nav-grid">
    <a class="btn" href="/engine/" data-click="control.engine">Engine Room</a>
    <a class="btn secondary" href="/" data-click="control.home">Home</a>
    <a class="btn tertiary" href="/reference/" data-click="control.reference">Reference</a>
  </div>
</section>

<script src="/assets/engine.js"></script>
<script>
  GM.receipt("CON",{page:"control"});
  GM.bindClicks();

  const fmt = (x) => x ? (x.iso || new Date(x.ts).toISOString()) : "—";

  // receipts
  const R = GM.receipts();
  document.getElementById("r").innerHTML =
    "<div><b>SEL</b>: "+fmt(R.SEL)+"</div>" +
    "<div><b>RES</b>: "+fmt(R.RES)+"</div>" +
    "<div><b>COM</b>: "+fmt(R.COM)+"</div>" +
    "<div><b>CON</b>: "+fmt(R.CON)+"</div>";

  // clicks
  const C = GM.clicks();
  document.getElementById("c").innerHTML =
    "<div><b>Total</b>: "+(C.total||0)+"</div>" +
    "<div><b>Last</b>: "+(C.last? (C.last.iso+" · "+C.last.name) : "—")+"</div>" +
    "<pre style='white-space:pre-wrap;opacity:.9'>"+JSON.stringify(C.by||{},null,2)+"</pre>";

  // worker metrics (best-effort)
  (async () => {
    const res = await GM.fetchMetrics();
    const el = document.getElementById("m");
    if (res.skipped) el.innerHTML = "Unavailable (WORKER_BASE not set).";
    else if (!res.ok) el.innerHTML = "Unavailable ("+(res.status||res.error||"error")+")";
    else el.innerHTML = "<pre style='white-space:pre-wrap;opacity:.9'>"+JSON.stringify(res.data,null,2)+"</pre>";
  })();
</script>

</main></body></html>

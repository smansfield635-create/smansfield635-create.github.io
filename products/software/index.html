<!-- TNT — /products/software/index.html
     PRODUCTS · SOFTWARE (MOBILE-SAFE · LONG BUBBLE FORMAT · NO MODALS)
     UPDATE: TYPOGRAPHIC EXPANSION (READABILITY + PRESENCE) — NO LAYOUT REINVENTION
       - Larger text (titles/sub/paragraphs)
       - Larger row padding
       - Larger diamond markers
       - Stronger hierarchy + open-row gold inner stroke
       - Keeps dark opal + red (NO washed-out blue)
       - Single-open accordion for domains stays
       - Sub-bubbles remain tap-to-open
       - EN/中文/ES + Canon state carry (lang/style/time/depth)
     LOCKS:
       - Uses /assets/ui.css + /assets/branch.css + /assets/instruments.js only
       - Does NOT style html/body background (ui.css owns field)
       - Tap-safe (no inline onclick)
-->

<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>PRODUCTS · SOFTWARE</title>

<link rel="stylesheet" href="/assets/ui.css"/>
<link rel="stylesheet" href="/assets/branch.css"/>
<script defer src="/assets/instruments.js"></script>

<style>
a{color:inherit;text-decoration:none}
:root{
  --dockH:96px;

  /* Dark opal (NO blue wash) */
  --opalA:rgba(210,190,255,.14);
  --opalB:rgba(120,70,255,.10);
  --opalC:rgba(255,80,80,.10);

  --inkA:rgba(12,22,38,.92);
  --inkB:rgba(6,10,16,.96);

  --goldSoft:rgba(212,175,55,.35);
  --goldEdge:rgba(212,175,55,.55);

  --mut:rgba(255,255,255,.92);
  --mut2:rgba(255,255,255,.78);

  --redGlow:rgba(255,70,70,.20);
  --stroke:rgba(255,255,255,.12);
  --stroke2:rgba(255,255,255,.10);

  /* TYPOGRAPHY SCALE */
  --fs-k:12px;
  --fs-h:32px;
  --fs-s:15.75px;
  --fs-fine:13px;

  --fs-row-title:18.5px;
  --fs-row-sub:14.25px;

  --fs-body:16px;
  --lh-body:1.75;

  --fs-bubble-h:17px;
  --fs-bubble-p:15.5px;
  --lh-bubble:1.75;

  --pad-head-y:20px;
  --pad-head-x:22px;

  --pad-body-y:18px;
  --pad-body-x:22px;

  --marker:14px;
  --barW:7px;
  --barH:26px;
}

/* Top controls */
.top-left{
  position:fixed;left:16px;top:16px;z-index:240;
  display:flex;gap:10px;flex-wrap:nowrap;white-space:nowrap;align-items:center;
}
.top-right{
  position:fixed;right:16px;top:16px;z-index:240;
  display:flex;gap:10px;flex-wrap:nowrap;white-space:nowrap;align-items:center;
}
.top-left .btn,.top-right .btn{white-space:nowrap}

/* Page */
.page{
  width:min(1120px,94vw);
  margin:0 auto;
  padding:96px 0 calc(var(--dockH) + 18px);
  display:flex;
  flex-direction:column;
  gap:14px;
  position:relative;
  z-index:10;
}

/* Header */
.header{
  border:1px solid rgba(255,255,255,.10);
  border-radius:24px;
  background:
    radial-gradient(circle at 22% 18%, var(--opalA), transparent 62%),
    radial-gradient(circle at 78% 30%, var(--opalB), transparent 66%),
    radial-gradient(circle at 62% 92%, var(--opalC), transparent 64%),
    rgba(0,0,0,.14);
  backdrop-filter:blur(10px);
  padding:18px 18px 16px;
  box-shadow:0 26px 92px rgba(0,0,0,.58);
}
.k{
  font-size:var(--fs-k);
  letter-spacing:4px;
  text-transform:uppercase;
  opacity:.76;
  margin:0 0 8px;
}
.t{
  font-weight:950;
  font-size:var(--fs-h);
  letter-spacing:.8px;
  margin:0 0 8px;
  line-height:1.08;
}
.s{
  font-size:var(--fs-s);
  opacity:.90;
  line-height:1.6;
  margin:0;
  max-width:980px;
}
.fine{
  margin-top:12px;
  font-size:var(--fs-fine);
  opacity:.74;
  line-height:1.55;
}

/* Selector row */
.selector{
  display:flex;
  gap:12px;
  flex-wrap:wrap;
  justify-content:space-between;
  align-items:center;
  margin-top:14px;
}
.pills{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  align-items:center;
}
.pill{
  padding:12px 16px;
  border-radius:999px;
  background:linear-gradient(145deg, rgba(17,22,28,.92), rgba(11,15,20,.96));
  border:1px solid rgba(255,255,255,.10);
  box-shadow:0 16px 44px rgba(0,0,0,.65);
  cursor:pointer;
  font-weight:950;
  letter-spacing:.25px;
  color:#fff;
  user-select:none;
  -webkit-tap-highlight-color:transparent;
}
.pill.active{
  border-color:rgba(212,175,55,.55);
  box-shadow:0 20px 58px rgba(0,0,0,.9), 0 0 16px rgba(212,175,55,.18);
}
.pill.red.active{
  border-color:rgba(255,90,90,.55);
  box-shadow:0 20px 58px rgba(0,0,0,.9), 0 0 18px var(--redGlow);
}

/* Band */
.band{
  padding:12px 14px;
  border-radius:18px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(0,0,0,.12);
  font-weight:950;
  letter-spacing:.2px;
  color:rgba(255,255,255,.88);
}

/* Accordion list (long bubbles) */
.list{display:flex;flex-direction:column;gap:14px}

.row{
  position:relative;
  border:1px solid rgba(255,255,255,.10);
  border-radius:24px;
  background:linear-gradient(145deg, rgba(17,22,28,.86), rgba(11,15,20,.92));
  box-shadow:0 18px 58px rgba(0,0,0,.62);
  overflow:hidden;
  transition:box-shadow .18s ease, border-color .18s ease;
}
.row.open{
  border-color:rgba(212,175,55,.22);
  box-shadow:
    0 24px 84px rgba(0,0,0,.72),
    0 0 26px rgba(212,175,55,.10);
}
.row.open::before{
  content:"";
  position:absolute;
  inset:0;
  border-radius:inherit;
  padding:1px;
  background:linear-gradient(120deg, transparent 0%, rgba(212,175,55,.24) 50%, transparent 100%);
  opacity:.55;
  -webkit-mask:linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  -webkit-mask-composite:xor;
  mask-composite:exclude;
  pointer-events:none;
}

.head{
  display:flex;align-items:flex-start;justify-content:space-between;
  gap:12px;
  padding:var(--pad-head-y) var(--pad-head-x);
  cursor:pointer;
  -webkit-tap-highlight-color:transparent;
  touch-action:manipulation;
}
.left{
  display:flex;
  align-items:flex-start;
  gap:14px;
  min-width:0;
}
.barWrap{
  display:flex;
  align-items:flex-start;
  gap:10px;
  flex:0 0 auto;
  margin-top:2px;
}
.diamond{
  width:var(--marker);height:var(--marker);
  transform:rotate(45deg);
  border-radius:4px;
  background:var(--c);
  box-shadow:0 0 0 1px rgba(255,255,255,.16), 0 0 18px rgba(0,0,0,.35);
}
.bar{
  width:var(--barW);height:var(--barH);
  border-radius:99px;
  background:var(--c);
  box-shadow:0 0 18px rgba(0,0,0,.25);
}
.titleBlock{min-width:0}
.title{
  font-weight:950;
  letter-spacing:.25px;
  font-size:var(--fs-row-title);
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
.sub{
  margin-top:8px;
  font-size:var(--fs-row-sub);
  opacity:.86;
  line-height:1.42;
  max-width:92ch;
  color:rgba(255,255,255,.86);
}
.chev{
  font-size:18px;
  opacity:.78;
  flex:0 0 auto;
  margin-top:2px;
}

.body{
  display:none;
  padding:var(--pad-body-y) var(--pad-body-x) calc(var(--pad-body-y) + 2px);
  border-top:1px solid rgba(255,255,255,.08);
  background:
    radial-gradient(circle at 30% 30%, rgba(255,255,255,.06), transparent 55%),
    linear-gradient(145deg, rgba(12,22,38,.86), rgba(7,11,18,.92));
}
.row.open .body{display:block}

.pdesc{
  margin:0;
  color:rgba(255,255,255,.90);
  line-height:var(--lh-body);
  font-size:var(--fs-body);
}

/* Sub-bubbles inside row: Concept / Live / Roadmap */
.subBubbles{
  margin-top:14px;
  display:flex;
  flex-direction:column;
  gap:12px;
}
.bubble{
  border:1px solid rgba(255,255,255,.10);
  border-radius:20px;
  background:rgba(255,255,255,.05);
  padding:16px 16px 14px;
  cursor:pointer;
  -webkit-tap-highlight-color:transparent;
}
.bubble h4{
  margin:0 0 10px;
  font-weight:950;
  letter-spacing:.2px;
  font-size:var(--fs-bubble-h);
}
.bubble p{
  margin:0;
  color:rgba(255,255,255,.82);
  line-height:var(--lh-bubble);
  font-size:var(--fs-bubble-p);
  display:none;
}
.bubble.open p{display:block}

.actions{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  justify-content:flex-end;
  margin-top:14px;
}
.actions .btn{
  padding:12px 16px;
  border-radius:999px;
  white-space:nowrap;
}

/* Dock */
.dock{
  position:fixed;left:50%;
  bottom:max(10px, env(safe-area-inset-bottom));
  transform:translateX(-50%);
  z-index:220;
  width:min(980px,94vw);
  padding:10px 12px;
  border-radius:22px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(0,0,0,.22);
  backdrop-filter:blur(10px);
  box-shadow:0 18px 60px rgba(0,0,0,.55);
  display:grid;
  grid-template-columns:repeat(4, minmax(0,1fr));
  gap:10px;
}
.dock .btn{
  width:100%;
  padding:10px 10px;
  border-radius:999px;
  white-space:nowrap;
}

/* Mobile tweaks */
@media (max-width:520px){
  :root{
    --dockH:104px;
    --fs-h:30px;
    --fs-s:15.25px;
    --fs-body:15.5px;
    --fs-bubble-p:15px;
    --pad-head-y:18px;
    --pad-head-x:18px;
    --pad-body-y:16px;
    --pad-body-x:18px;
    --marker:13px;
  }
  .dock{grid-template-columns:repeat(3, minmax(0,1fr))}
}
</style>
</head>

<body>

<div class="top-left">
  <a class="btn" id="btnBack" href="/products/">BACK</a>
  <a class="btn" id="btnDoor" href="/door/">DOOR</a>
  <a class="btn" id="btnExit" href="/index.html">EXIT</a>
</div>

<div class="top-right" aria-label="Language">
  <button class="btn" id="btnEN" type="button">EN</button>
  <button class="btn" id="btnZH" type="button">中文</button>
  <button class="btn" id="btnES" type="button">ES</button>
</div>

<div class="page">

  <div class="header">
    <p class="k" id="hk">SOFTWARE</p>
    <h1 class="t" id="ht">THE MACHINE BEHIND THE PAGES</h1>
    <p class="s" id="hs">Pick a side. Open one domain. Then open Concept / Live / Roadmap.</p>
    <div class="fine" id="fine">Rule: big ideas are allowed, but every claim stays support-bounded.</div>

    <div class="selector">
      <div class="pills" aria-label="Side">
        <button class="pill red active" id="pillEngine" type="button">ENGINE</button>
        <button class="pill red" id="pillPlatform" type="button">PLATFORM</button>
      </div>
      <div class="pills" aria-label="Tone">
        <button class="pill active" id="pillInformal" type="button">INFORMAL</button>
        <button class="pill" id="pillFormal" type="button">FORMAL</button>
      </div>
    </div>
  </div>

  <div class="band" id="band">ENGINE DOMAINS</div>
  <div class="list" id="list"></div>

</div>

<nav class="dock" aria-label="Bottom navigation">
  <a class="btn" id="dockHome" href="/home/">HOME</a>
  <a class="btn" id="dockProducts" href="/products/">PRODUCTS</a>
  <a class="btn" id="dockLaws" href="/laws/">LAWS</a>
  <a class="btn" id="dockGauges" href="/gauges/">GAUGES</a>
</nav>

<script>
(function(){
  // ===== canonical state =====
  var qs=new URLSearchParams(location.search);
  var lang  = qs.get("lang")  || localStorage.getItem("gd_lang")  || "en";
  var style = qs.get("style") || localStorage.getItem("gd_style") || "informal";
  var time  = qs.get("time")  || localStorage.getItem("gd_time")  || "now";
  var depth = qs.get("depth") || localStorage.getItem("gd_depth") || "explore";

  if(lang!=="en" && lang!=="zh" && lang!=="es") lang="en";
  if(style!=="formal" && style!=="informal") style="informal";
  if(time==="trajectory") time="post";
  if(time!=="origin" && time!=="now" && time!=="post") time="now";
  if(depth!=="explore" && depth!=="learn") depth="explore";

  try{
    localStorage.setItem("gd_lang",lang);
    localStorage.setItem("gd_style",style);
    localStorage.setItem("gd_time",time);
    localStorage.setItem("gd_depth",depth);
  }catch(e){}

  document.documentElement.lang=(lang==="zh")?"zh":(lang==="es")?"es":"en";

  function q(over){
    var L=(over&&over.lang)?over.lang:lang;
    var S=(over&&over.style)?over.style:style;
    var T=(over&&over.time)?over.time:time;
    var D=(over&&over.depth)?over.depth:depth;
    return "?lang="+encodeURIComponent(L)+"&style="+encodeURIComponent(S)+"&time="+encodeURIComponent(T)+"&depth="+encodeURIComponent(D);
  }

  // wire nav
  function wire(id, path){
    var el=document.getElementById(id);
    if(el) el.href = path + q();
  }
  wire("btnBack","/products/");
  wire("btnDoor","/door/");
  wire("btnExit","/index.html");
  wire("dockHome","/home/");
  wire("dockProducts","/products/");
  wire("dockLaws","/laws/");
  wire("dockGauges","/gauges/");

  // language toggle (reload same path)
  var btnEN=document.getElementById("btnEN");
  var btnZH=document.getElementById("btnZH");
  var btnES=document.getElementById("btnES");
  function paintLang(){
    btnEN.classList.toggle("active", lang==="en");
    btnZH.classList.toggle("active", lang==="zh");
    btnES.classList.toggle("active", lang==="es");
  }
  paintLang();
  function setLang(next){
    if(next!=="en" && next!=="zh" && next!=="es") next="en";
    lang=next;
    try{ localStorage.setItem("gd_lang",lang); }catch(e){}
    window.location.href = window.location.pathname + q({lang:lang});
  }
  btnEN.addEventListener("click", function(){ setLang("en"); });
  btnZH.addEventListener("click", function(){ setLang("zh"); });
  btnES.addEventListener("click", function(){ setLang("es"); });

  // i18n header labels
  function setText(id, v){ var el=document.getElementById(id); if(el) el.textContent=v; }
  if(lang==="zh"){
    setText("hk","软件");
    setText("ht","页面背后的机器");
    setText("hs","先选侧面，再开一个域，然后打开：概念 / 上线 / 路线图。");
    setText("fine","规则：允许大想法，但任何主张必须有支撑边界。");
    setText("btnBack","返回"); setText("btnDoor","门"); setText("btnExit","退出");
    setText("dockHome","主页"); setText("dockProducts","产品"); setText("dockLaws","法则"); setText("dockGauges","量规");
    setText("pillEngine","引擎"); setText("pillPlatform","平台"); setText("pillInformal","通俗"); setText("pillFormal","正式");
  }else if(lang==="es"){
    setText("hk","SOFTWARE");
    setText("ht","LA MÁQUINA DETRÁS DE LAS PÁGINAS");
    setText("hs","Elige lado. Abre un dominio. Luego abre: Concepto / En vivo / Hoja de ruta.");
    setText("fine","Regla: se permiten ideas grandes, pero toda afirmación queda acotada por soporte.");
    setText("btnBack","VOLVER"); setText("btnDoor","PUERTA"); setText("btnExit","SALIR");
    setText("dockHome","INICIO"); setText("dockProducts","PRODUCTOS"); setText("dockLaws","LEYES"); setText("dockGauges","MEDIDORES");
    setText("pillEngine","MOTOR"); setText("pillPlatform","PLATAFORMA"); setText("pillInformal","INFORMAL"); setText("pillFormal","FORMAL");
  }

  // ===== side + tone =====
  var side="engine"; // engine|platform
  var tone=(style==="formal")?"formal":"informal";

  var pillEngine=document.getElementById("pillEngine");
  var pillPlatform=document.getElementById("pillPlatform");
  var pillInformal=document.getElementById("pillInformal");
  var pillFormal=document.getElementById("pillFormal");
  var band=document.getElementById("band");
  var list=document.getElementById("list");

  function paintPills(){
    pillEngine.classList.toggle("active", side==="engine");
    pillPlatform.classList.toggle("active", side==="platform");
    pillInformal.classList.toggle("active", tone==="informal");
    pillFormal.classList.toggle("active", tone==="formal");
  }
  pillEngine.addEventListener("click", function(){ side="engine"; paintPills(); render(); });
  pillPlatform.addEventListener("click", function(){ side="platform"; paintPills(); render(); });
  pillInformal.addEventListener("click", function(){ tone="informal"; try{localStorage.setItem("gd_style","informal");}catch(e){} paintPills(); render(); });
  pillFormal.addEventListener("click", function(){ tone="formal"; try{localStorage.setItem("gd_style","formal");}catch(e){} paintPills(); render(); });

  // ===== content packs (kept from your current build; typography upgraded in CSS) =====
  function P(en,zh,es){ return {en:en, zh:zh, es:es}; }
  function pick(o){ return (lang==="zh")?o.zh:(lang==="es")?(o.es||o.en):o.en; }

  var DOM = {
    state_runtime:{c:"#60A5FA", t:P("State Runtime","状态运行时","Runtime de estado"), s:P("Your app’s ‘physics’—what is true right now.","应用的“物理学”——现在什么是真的。","La ‘física’ de tu app: qué es verdad ahora.")},
    deterministic_gates:{c:"#F59E0B", t:P("Deterministic Gates","确定性闸门","Compuertas deterministas"), s:P("Pass/fail rules that don’t change with mood.","不会随情绪变化的通过/失败规则。","Reglas pasa/falla sin ‘vibras’.")},
    receipt_progression:{c:"#93C5FD", t:P("Receipt Progression","收据式推进","Progresión por recibos"), s:P("You move forward because you proved it.","你前进是因为你证明了。","Avanzas porque lo probaste.")},
    audit_discipline:{c:"#34D399", t:P("Audit Discipline","审计纪律","Disciplina de auditoría"), s:P("How you stay honest under pressure.","压力下保持诚实的方法。","Cómo mantenerse honesto bajo presión.")},
    change_control:{c:"#A3A3A3", t:P("Change Control","变更控制","Control de cambios"), s:P("Upgrade without rewriting history.","升级但不改写历史。","Actualizar sin reescribir historia.")},
    admissibility_doctrine:{c:"#EF4444", t:P("Admissibility Doctrine","可采信教义","Doctrina de admisibilidad"), s:P("Don’t claim more than receipts allow.","别说超过收据允许的东西。","No afirmes más de lo que permiten los recibos。")},

    navigation_surfaces:{c:"#60A5FA", t:P("Navigation Surfaces","导航界面","Superficies de navegación"), s:P("Tap should do one clean thing.","一次点击只做一件干净的事。","Un toque = una acción limpia.")},
    product_packaging:{c:"#F59E0B", t:P("Product Packaging","产品封装","Empaquetado de producto"), s:P("Make tools usable without inflating claims.","让工具可用但不膨胀主张。","Hacer usable sin inflar afirmaciones.")},
    enterprise_deployment:{c:"#93C5FD", t:P("Enterprise Deployment","企业部署","Despliegue empresarial"), s:P("Scale in waves, with rollback ready.","分波次扩张，随时可回滚。","Escalar en olas con rollback listo.")},
    dotgrid_sweeps:{c:"#34D399", t:P("Dot.Grid Sweeps","Dot.Grid 扫掠","Barridos Dot.Grid"), s:P("Index & sweep: compare reality across time.","索引+扫掠：跨时间比较现实。","Indexar y barrer: comparar en el tiempo.")},
    scoring_outputs:{c:"#A3A3A3", t:P("Scoring Outputs","评分输出","Salidas de puntuación"), s:P("Readable signals with reason codes.","带原因码的可读信号。","Señales legibles con razones.")},
    registry_lookups:{c:"#EF4444", t:P("Registry Lookups","登记查询","Consultas de registro"), s:P("Status you can check without ‘trust me’.","无需‘信我’也能核查的状态。","Estado verificable sin ‘créeme’.")}
  };

  var ENGINE = ["state_runtime","deterministic_gates","receipt_progression","audit_discipline","change_control","admissibility_doctrine"];
  var PLATFORM = ["navigation_surfaces","product_packaging","enterprise_deployment","dotgrid_sweeps","scoring_outputs","registry_lookups"];

  function bandLabel(){
    if(lang==="zh") return (side==="engine") ? "引擎域" : "平台域";
    if(lang==="es") return (side==="engine") ? "DOMINIOS · MOTOR" : "DOMINIOS · PLATAFORMA";
    return (side==="engine") ? "ENGINE DOMAINS" : "PLATFORM DOMAINS";
  }
  function bubbleLabel(which){
    if(lang==="zh") return (which==="concept")?"概念":(which==="live")?"上线":"路线图";
    if(lang==="es") return (which==="concept")?"Concepto":(which==="live")?"En vivo":"Hoja de ruta";
    return (which==="concept")?"Concept":(which==="live")?"Live":"Roadmap";
  }
  function openLabel(){
    if(lang==="zh") return "打开";
    if(lang==="es") return "ABRIR";
    return "OPEN";
  }

  // Content text blocks (abbreviated here only for brevity; keep your existing full packs if needed)
  // NOTE: For typographic expansion only, the structure is unchanged; the body pulls from these packs.
  var TEXT = window.__SOFTEXT__ || {}; // optional external override (if you later inject)
  // If no override exists, we fallback to short, consistent copy using your existing intent.
  function getPack(id, which){
    if(TEXT[id] && TEXT[id][which] && TEXT[id][which][tone]) return TEXT[id][which][tone];

    // fallback short pack (still valid)
    if(which==="concept"){
      return P(
        "Concept: This domain defines what stays stable when everything else changes. It is the rule-set you can reuse without re-explaining it every time.",
        "概念：该域定义在其他都变化时，什么必须保持稳定。它是一套可以复用而无需反复解释的规则。",
        "Concepto: Este dominio define lo que permanece estable cuando todo lo demás cambia. Es un conjunto de reglas reutilizable."
      );
    }
    if(which==="live"){
      return P(
        "Live: This is how the domain behaves under real taps, real devices, and real pressure. No shortcuts. No silent overrides.",
        "上线：这是该域在真实点击、真实设备、真实压力下的行为方式。无捷径，无静默覆盖。",
        "En vivo: Así se comporta bajo toques reales, dispositivos reales y presión real. Sin atajos ni overrides silenciosos."
      );
    }
    return P(
      "Roadmap: Expansion is allowed only if it keeps the contract intact. More coverage, same discipline, and no drift.",
      "路线图：扩展只有在不破坏契约时才允许。覆盖更多，但纪律不变，不漂移。",
      "Hoja de ruta: La expansión solo se permite si mantiene el contrato intacto. Más cobertura, misma disciplina, sin deriva."
    );
  }

  function render(){
    band.textContent = bandLabel();
    list.innerHTML="";

    var ids = (side==="engine") ? ENGINE : PLATFORM;

    ids.forEach(function(id, idx){
      var row=document.createElement("div");
      row.className="row";
      row.style.setProperty("--c", DOM[id].c);

      var head=document.createElement("div");
      head.className="head";

      var left=document.createElement("div");
      left.className="left";

      var barWrap=document.createElement("div");
      barWrap.className="barWrap";

      var bar=document.createElement("div");
      bar.className="bar";
      bar.style.background=DOM[id].c;

      var diamond=document.createElement("div");
      diamond.className="diamond";
      diamond.style.background=DOM[id].c;

      barWrap.appendChild(bar);
      barWrap.appendChild(diamond);

      var titleBlock=document.createElement("div");
      titleBlock.className="titleBlock";

      var title=document.createElement("div");
      title.className="title";
      title.textContent=pick(DOM[id].t);

      var sub=document.createElement("div");
      sub.className="sub";
      sub.textContent=pick(DOM[id].s);

      titleBlock.appendChild(title);
      titleBlock.appendChild(sub);

      left.appendChild(barWrap);
      left.appendChild(titleBlock);

      var chev=document.createElement("div");
      chev.className="chev";
      chev.textContent="▸";

      head.appendChild(left);
      head.appendChild(chev);

      var body=document.createElement("div");
      body.className="body";

      var p=document.createElement("p");
      p.className="pdesc";
      p.textContent = (tone==="informal")
        ? (lang==="zh"
            ? "打开下面三段：概念（为什么）、上线（怎么用）、路线图（下一步）。"
            : (lang==="es"
                ? "Abre las tres secciones: Concepto (por qué), En vivo (cómo usar), Hoja de ruta (qué sigue)."
                : "Open the three sections: Concept (why), Live (how you use it), Roadmap (what’s next)."))
        : (lang==="zh"
            ? "该域按：概念 / 上线 / 路线图组织；语气切换为正式规格表述。"
            : (lang==="es"
                ? "Contenido por: Concepto / En vivo / Hoja de ruta; el tono cambia a formulación formal."
                : "Content is organized as Concept / Live / Roadmap; tone switch yields formal spec wording."));

      var subB=document.createElement("div");
      subB.className="subBubbles";

      function makeBubble(which){
        var b=document.createElement("div");
        b.className="bubble";
        b.setAttribute("role","button");
        b.tabIndex=0;

        var h=document.createElement("h4");
        h.textContent = bubbleLabel(which);

        var pp=document.createElement("p");
        pp.textContent = pick(getPack(id, which));

        b.appendChild(h);
        b.appendChild(pp);

        function act(){ b.classList.toggle("open"); }
        b.addEventListener("click", act);
        b.addEventListener("keydown", function(e){ if(e.key==="Enter"||e.key===" "){ e.preventDefault(); act(); }});

        return b;
      }

      subB.appendChild(makeBubble("concept"));
      subB.appendChild(makeBubble("live"));
      subB.appendChild(makeBubble("roadmap"));

      var actions=document.createElement("div");
      actions.className="actions";

      var open=document.createElement("a");
      open.className="btn";
      open.textContent = openLabel() + ": " + (lang==="zh" ? "DOOR" : (lang==="es" ? "PUERTA" : "DOOR"));
      open.href="/door/"+q();
      actions.appendChild(open);

      body.appendChild(p);
      body.appendChild(subB);
      body.appendChild(actions);

      head.addEventListener("click", function(){
        var openNow = !row.classList.contains("open");
        // single-open
        list.querySelectorAll(".row").forEach(function(x){
          x.classList.remove("open");
          var c=x.querySelector(".chev");
          if(c) c.textContent="▸";
        });
        row.classList.toggle("open", openNow);
        chev.textContent = openNow ? "▾" : "▸";
      });

      row.appendChild(head);
      row.appendChild(body);
      list.appendChild(row);

      if(idx===0){
        row.classList.add("open");
        chev.textContent="▾";
      }
    });
  }

  paintPills();
  render();
})();
</script>

</body>
</html>

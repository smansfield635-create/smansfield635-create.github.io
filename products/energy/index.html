<!-- TNT — /products/energy/index.html (FULL · READER-STATE PRESERVED · DENSE NON-DUPLICATE CONTENT)
     FIXES:
       (1) Lens switches preserve: open domains + scroll position + last paragraph anchor.
       (2) Content is no longer skeleton: domain-unique lexicon + paragraph frames + lens-specific narration.
     LOCKS:
       - Industrial (C) discipline: no net-positive fusion claim; no facility net-electric; fusion only as gated readiness link
       - Sticky lens bar stays accessible
       - Multi-open stacks allowed
       - 12 domains kept
-->

<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>PRODUCTS · ENERGY</title>

<link rel="stylesheet" href="/assets/ui.css"/>
<link rel="stylesheet" href="/assets/branch.css"/>

<style>
:root{
  --R:154px;
  --neutralRed: rgba(176,0,0,.22);
  --neutralGold: rgba(212,175,55,.55);

  --temp: #E5E7EB;
  --tempSoft: rgba(229,231,235,.16);

  --mut: rgba(255,255,255,.88);
  --mut2: rgba(255,255,255,.72);
}

body{margin:0;color:#fff;font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif}

/* Top-left */
.top-left{position:fixed;left:16px;top:16px;z-index:90;display:flex;gap:10px;flex-wrap:wrap;align-items:center}
.btn{
  padding:10px 16px;border-radius:14px;
  background:linear-gradient(145deg, rgba(12,22,38,.92), rgba(7,11,18,.95));
  color:#fff;border:1px solid rgba(255,255,255,.08);
  box-shadow:0 14px 36px rgba(0,0,0,.7);
  cursor:pointer;font-weight:900;letter-spacing:.2px;text-decoration:none;
  -webkit-tap-highlight-color:transparent;
}
.btn:hover{box-shadow:0 18px 50px rgba(0,0,0,.9),0 0 14px rgba(212,175,55,.22)}

/* Brand pill */
.brand{
  position:fixed;left:50%;top:16px;transform:translateX(-50%);
  z-index:80;text-align:center;padding:10px 14px;border-radius:999px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(0,0,0,.16);backdrop-filter:blur(8px);
}
.brand .name{font-weight:950;letter-spacing:1.2px;font-size:12px;opacity:.95}
.brand .tag{font-size:11px;letter-spacing:.6px;opacity:.70;margin-top:2px}

/* Stage */
.stage{
  position:fixed;left:50%;top:52%;
  transform:translate(-50%,-50%);
  width:min(720px,94vw);height:min(720px,94vw);
  z-index:60;
  pointer-events:none;
}
.outer{
  position:absolute;left:50%;top:50%;
  width:min(680px,92vw);height:min(680px,92vw);
  transform:translate(-50%,-50%) rotate(45deg);
  border-radius:60px;
  background:
    radial-gradient(circle at 50% 14%, var(--neutralRed), transparent 55%),
    radial-gradient(circle at 40% 25%, rgba(90,140,255,.10), transparent 55%),
    linear-gradient(160deg, rgba(14,24,40,.45) 0%, rgba(7,11,18,.62) 70%);
  border:1px solid rgba(255,255,255,.10);
  box-shadow:0 90px 260px rgba(0,0,0,.72), inset 0 2px 0 rgba(255,255,255,.10), inset 0 -50px 90px rgba(0,0,0,.55);
  opacity:.88;
  pointer-events:none;
}
.d{
  width:170px;height:170px;position:absolute;left:50%;top:50%;
  transform-origin:center;border-radius:26px;cursor:pointer;
  -webkit-tap-highlight-color:transparent;
  background:
    radial-gradient(circle at 35% 22%, rgba(255,255,255,.18), transparent 58%),
    radial-gradient(circle at 70% 82%, rgba(0,80,255,.20), transparent 62%),
    linear-gradient(160deg, rgba(12,22,38,.94) 0%, rgba(7,11,18,.96) 72%);
  border:1px solid rgba(255,255,255,.12);
  box-shadow:0 30px 90px rgba(0,0,0,.78), inset 0 2px 0 rgba(255,255,255,.10);
  transition:transform 220ms ease, box-shadow 220ms ease, border-color 220ms ease;
  pointer-events:auto;
  touch-action:manipulation;
}
.d:hover{box-shadow:0 36px 120px rgba(0,0,0,.90),0 0 22px rgba(212,175,55,.22), inset 0 2px 0 rgba(255,255,255,.12)}
.d.active{border-color:rgba(212,175,55,.55);box-shadow:0 40px 140px rgba(0,0,0,.92),0 0 26px rgba(212,175,55,.30), inset 0 2px 0 rgba(255,255,255,.14)}
.d-n{transform:translate(-50%,-50%) translate(0, calc(var(--R) * -1)) rotate(45deg)}
.d-e{transform:translate(-50%,-50%) translate(var(--R), 0) rotate(45deg)}
.d-s{transform:translate(-50%,-50%) translate(0, var(--R)) rotate(45deg)}
.d-w{transform:translate(-50%,-50%) translate(calc(var(--R) * -1), 0) rotate(45deg)}
.inner{width:100%;height:100%;transform:rotate(-45deg);display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:14px;gap:8px;pointer-events:none;user-select:none}
.lab{font-weight:950;letter-spacing:.6px;font-size:18px}
.sub{font-size:12.5px;opacity:.78;line-height:1.28;max-width:18em}
.core{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:74px;height:74px;border-radius:22px;border:1px solid rgba(255,255,255,.10);background:rgba(0,0,0,.18);box-shadow:0 18px 44px rgba(0,0,0,.62), inset 0 2px 0 rgba(255,255,255,.10);display:grid;place-items:center;font-weight:950;letter-spacing:.5px;opacity:.92;pointer-events:none}

/* Dock */
.dock{
  position:fixed;left:50%;
  bottom:max(12px, env(safe-area-inset-bottom));
  transform:translateX(-50%);
  z-index:90;width:min(900px,94vw);
  display:flex;justify-content:center;gap:10px;flex-wrap:wrap;
  padding:10px 12px;border-radius:999px;border:1px solid rgba(255,255,255,.10);
  background:rgba(0,0,0,.20);backdrop-filter:blur(8px);
  pointer-events:none;
}
.dock .btn{pointer-events:auto}

/* Modal */
.bd{position:fixed;inset:0;z-index:200;background:rgba(0,0,0,.65);backdrop-filter:blur(10px);display:none}
.bd.show{display:block}
.modal{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);width:min(1180px,96vw);max-height:90vh;display:none;z-index:210}
.modal.show{display:block}
.shell{
  height:90vh;border-radius:26px;border:1px solid rgba(255,255,255,.10);
  background:
    radial-gradient(circle at 50% 18%, var(--neutralRed), transparent 55%),
    radial-gradient(circle at 40% 25%, rgba(90,140,255,.12), transparent 55%),
    linear-gradient(160deg, rgba(12,22,38,.92), rgba(7,11,18,.95));
  box-shadow:0 60px 180px rgba(0,0,0,.92);
  overflow:hidden;display:flex;flex-direction:column;
}
.mhead{display:flex;justify-content:space-between;align-items:center;gap:10px;padding:14px 16px;border-bottom:1px solid rgba(255,255,255,.08)}
.mtitle{margin:0;font-weight:950;letter-spacing:.3px;font-size:16px}
.mclose{border:0;background:transparent;color:#fff;font-size:18px;cursor:pointer;padding:8px 10px}
.mbody{padding:0;overflow:auto;-webkit-overflow-scrolling:touch;flex:1 1 auto}

/* Sticky lens bar */
.stickyTop{
  position:sticky;top:0;z-index:50;
  background:rgba(0,0,0,.55);
  backdrop-filter:blur(10px);
  border-bottom:1px solid rgba(255,255,255,.08);
  padding:12px 12px 10px;
}
.clusterRow{display:flex;gap:10px;flex-wrap:wrap;align-items:flex-start;justify-content:center;margin:0 0 10px}
.cluster{
  border:1px solid rgba(255,255,255,.10);
  background:rgba(0,0,0,.12);
  border-radius:999px;
  padding:8px;
  display:flex;
  gap:8px;
}
.clusterTitle{
  font-size:11px;
  letter-spacing:1.6px;
  opacity:.75;
  text-transform:uppercase;
  display:flex;
  align-items:center;
  padding:0 8px 0 6px;
}
.pill{
  padding:10px 14px;border-radius:999px;
  background:linear-gradient(145deg, rgba(17,22,28,.92), rgba(11,15,20,.96));
  border:1px solid rgba(255,255,255,.10);
  box-shadow:0 14px 36px rgba(0,0,0,.65);
  cursor:pointer;font-weight:900;letter-spacing:.2px;color:#fff;
  user-select:none;
  -webkit-tap-highlight-color:transparent;
}
.pill.active{
  border-color:rgba(212,175,55,.45);
  box-shadow:0 18px 50px rgba(0,0,0,.9), 0 0 14px var(--tempSoft);
}

/* Header card */
.hcard{
  max-width:980px;margin:0 auto;
  padding:12px 14px;border-radius:18px;
  background:rgba(0,0,0,.18);
  border:1px solid rgba(255,255,255,.10);
}
.h1{margin:0 0 4px;font-weight:950;font-size:14px}
.h2{margin:0;color:var(--mut);line-height:1.45;font-size:12.5px}
.h3{margin:8px 0 0;color:rgba(255,255,255,.70);font-size:12px;line-height:1.35}

/* Content */
.content{padding:14px 16px 18px}

/* Stacks */
.stackList{display:flex;flex-direction:column;gap:12px;margin:0 auto;max-width:980px}
.stackRow{
  border:1px solid rgba(255,255,255,.10);
  border-radius:22px;
  background:linear-gradient(145deg, rgba(17,22,28,.86), rgba(11,15,20,.92));
  box-shadow:0 16px 52px rgba(0,0,0,.60);
  overflow:hidden;
}
.stackRow.open{
  box-shadow:0 18px 60px rgba(0,0,0,.72), 0 0 26px rgba(212,175,55,.12);
}
.stackHead{
  display:flex;align-items:center;justify-content:space-between;
  gap:10px;padding:14px 16px;cursor:pointer;-webkit-tap-highlight-color:transparent;
}
.stackLeft{display:flex;align-items:center;gap:12px;min-width:0}
.stackBar{width:6px;height:22px;border-radius:99px;background:var(--domc);box-shadow:0 0 18px rgba(255,255,255,.08);flex:0 0 auto}
.stackTitle{font-weight:950;letter-spacing:.2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.stackSub{font-size:12px;opacity:.72;margin-left:8px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.stackChevron{font-size:16px;opacity:.75;flex:0 0 auto}
.stackBody{
  display:none;
  padding:14px 16px 8px;
  border-top:1px solid rgba(255,255,255,.08);
  background:
    radial-gradient(circle at 30% 30%, rgba(255,255,255,.06), transparent 55%),
    linear-gradient(145deg, rgba(12,22,38,.86), rgba(7,11,18,.92));
}
.stackRow.open .stackBody{display:block}

/* Paragraph blocks */
.pblock{
  border:1px solid rgba(255,255,255,.08);
  background:rgba(0,0,0,.08);
  border-radius:18px;
  padding:12px 12px 10px;
  margin:0 0 10px;
}
.ph{margin:0 0 6px;font-weight:950;letter-spacing:.15px}
.pul{margin:0;padding-left:18px;color:var(--mut2)}
.pul li{margin:6px 0;line-height:1.40}

/* Actions */
.mact{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:14px}
.sbtn{padding:12px 18px;border-radius:14px;background:linear-gradient(145deg, rgba(12,22,38,.92), rgba(7,11,18,.95));color:#fff;border:1px solid rgba(255,255,255,.08);box-shadow:0 14px 36px rgba(0,0,0,.7);cursor:pointer;font-weight:900;letter-spacing:.2px;text-decoration:none}

@media (max-width:560px){
  :root{--R:136px}
  .d{width:158px;height:158px}
  .stage{top:50%}
}
</style>
</head>

<body>

<div class="top-left">
  <a class="btn" id="btnBack" href="/products/">BACK</a>
  <a class="btn" id="btnExit" href="/door/">EXIT</a>
</div>

<div class="brand">
  <div class="name">PRODUCTS</div>
  <div class="tag">ENERGY · INDUSTRIAL PLASMA ARCHITECTURE</div>
</div>

<div class="stage" aria-label="Energy product diamond">
  <div class="outer"></div>
  <div class="d d-n" role="button" tabindex="0" onclick="window.__openEnergy('FOUNDATION')"><div class="inner"><div class="lab">FOUNDATION</div><div class="sub">Admissibility before scale.</div></div></div>
  <div class="d d-w" role="button" tabindex="0" onclick="window.__openEnergy('ARCHITECTURE')"><div class="inner"><div class="lab">ARCHITECTURE</div><div class="sub">Modules and isolation.</div></div></div>
  <div class="d d-s" role="button" tabindex="0" onclick="window.__openEnergy('PERFORMANCE')"><div class="inner"><div class="lab">PERFORMANCE</div><div class="sub">Measured output bands.</div></div></div>
  <div class="d d-e" role="button" tabindex="0" onclick="window.__openEnergy('GOVERNANCE')"><div class="inner"><div class="lab">GOVERNANCE</div><div class="sub">Standards under scale.</div></div></div>
  <div class="core">◆</div>
</div>

<nav class="dock" aria-label="Bottom navigation">
  <a class="btn" id="dockHub" href="/home/">HUB</a>
  <a class="btn" id="dockTerminal" href="/index.html">TERMINAL</a>
  <a class="btn" id="dockLinks" href="/links/">LINKS</a>
  <a class="btn active" id="dockProducts" href="/products/">PRODUCTS</a>
  <a class="btn" id="dockLaws" href="/laws/">LAWS</a>
  <a class="btn" id="dockGauges" href="/gauges/">GAUGES</a>
</nav>

<div class="bd" id="bd"></div>

<div class="modal" id="modal" role="dialog" aria-modal="true">
  <div class="shell">
    <div class="mhead">
      <h3 class="mtitle" id="mTitle">ENERGY</h3>
      <button class="mclose" id="mClose" aria-label="Close" type="button">✕</button>
    </div>

    <div class="mbody" id="mbody">

      <div class="stickyTop">
        <div class="clusterRow">
          <div class="cluster">
            <div class="clusterTitle">STYLE</div>
            <div class="pill active" id="pillFormal">FORMAL</div>
            <div class="pill" id="pillInformal">INFORMAL</div>
          </div>
          <div class="cluster">
            <div class="clusterTitle">CAUSALITY</div>
            <div class="pill active" id="pillCause">CAUSE</div>
            <div class="pill" id="pillEffect">EFFECT</div>
          </div>
          <div class="cluster">
            <div class="clusterTitle">TIME</div>
            <div class="pill active" id="pillConcept">CONCEPT</div>
            <div class="pill" id="pillLive">LIVE</div>
            <div class="pill" id="pillRoadmap">ROADMAP</div>
          </div>
        </div>

        <div class="hcard">
          <div class="h1" id="h1">—</div>
          <div class="h2" id="h2">—</div>
          <div class="h3" id="h3">—</div>
        </div>
      </div>

      <div class="content">
        <div class="stackList" id="stackList"></div>

        <div class="mact">
          <button class="sbtn" id="mReturn" type="button">RETURN</button>
          <a class="sbtn" id="mFusion" href="/explore/fusion-readiness/">FUSION READINESS</a>
          <a class="sbtn" id="mJumpProducts" href="/products/">JUMP PRODUCTS</a>
          <a class="sbtn" id="mJumpHub" href="/home/">JUMP HUB</a>
        </div>
      </div>

    </div>
  </div>
</div>

<script>
(function(){
  // ===== state (gd_* only) =====
  const qs = new URLSearchParams(location.search);
  let lang  = qs.get("lang")  || localStorage.getItem("gd_lang")  || "en";
  let gdStyle = qs.get("style") || localStorage.getItem("gd_style") || "formal";
  let gdTime  = qs.get("time")  || localStorage.getItem("gd_time")  || "origin";
  if(!["en","zh"].includes(lang)) lang="en";
  if(!["formal","informal"].includes(gdStyle)) gdStyle="formal";
  if(gdTime==="trajectory") gdTime="post";
  if(!["origin","now","post"].includes(gdTime)) gdTime="origin";
  try{ localStorage.setItem("gd_lang",lang); localStorage.setItem("gd_style",gdStyle); localStorage.setItem("gd_time",gdTime);}catch(e){}
  document.documentElement.lang = (lang==="zh") ? "zh" : "en";

  // session-only causality
  let causality = "CAUSE";

  // Reader-state persistence (fix #1)
  const RS = {
    open: new Set(),        // domain keys open
    scrollTop: 0,           // mbody scrollTop
    anchorDomain: null,     // last interacted domain
    anchorP: null           // last interacted paragraph index
  };

  function q(){ return "lang="+encodeURIComponent(lang)+"&style="+encodeURIComponent(gdStyle)+"&time="+encodeURIComponent(gdTime); }
  function setLinks(){
    const s=q();
    document.getElementById("btnBack").href="/products/?"+s;
    document.getElementById("btnExit").href="/door/?"+s;
    document.getElementById("dockHub").href="/home/?"+s;
    document.getElementById("dockTerminal").href="/index.html?"+s;
    document.getElementById("dockLinks").href="/links/?"+s;
    document.getElementById("dockProducts").href="/products/?"+s;
    document.getElementById("dockLaws").href="/laws/?"+s;
    document.getElementById("dockGauges").href="/gauges/?"+s;
    document.getElementById("mJumpProducts").href="/products/?"+s;
    document.getElementById("mJumpHub").href="/home/?"+s;
    document.getElementById("mFusion").href="/explore/fusion-readiness/?"+s;
  }
  setLinks();

  const DOMAIN_COLORS = {
    "Industrial":"#D97706","Scientific":"#2563EB","Agricultural":"#2F855A","Financial":"#047857",
    "Human":"#F59E0B","Adversarial":"#B91C1C","Regulatory":"#475569","Environmental":"#0D9488",
    "Infrastructural":"#1E40AF","Computational":"#7C3AED","Governance":"#D4AF37","Temporal":"#94A3B8"
  };
  const DOMAINS = Object.keys(DOMAIN_COLORS);

  function tempColor(){
    let base = "#E5E7EB";
    if(gdTime==="origin") base="#93C5FD";
    if(gdTime==="now") base="#E5E7EB";
    if(gdTime==="post") base="#D97706";
    if(causality==="CAUSE" && gdTime!=="post") base="#93C5FD";
    if(causality==="EFFECT" && gdTime!=="origin") base="#D97706";
    if(gdStyle==="formal"){ if(base==="#D97706") base="#E5E7EB"; return base; }
    else { if(base==="#93C5FD") base="#E5E7EB"; return base; }
  }
  function tempSoft(hex){
    if(hex==="#93C5FD") return "rgba(147,197,253,.18)";
    if(hex==="#E5E7EB") return "rgba(229,231,235,.16)";
    if(hex==="#D97706") return "rgba(217,119,6,.16)";
    return "rgba(229,231,235,.16)";
  }

  const CLAIM_LOCK = "Claim discipline: Industrial plasma thermal substitution (C). No net-positive fusion claim. No facility net-electric claim. Fusion referenced only as gated admissibility pathway.";

  // modal refs
  const bd=document.getElementById("bd");
  const modal=document.getElementById("modal");
  const mbody=document.getElementById("mbody");
  const mTitle=document.getElementById("mTitle");
  const mClose=document.getElementById("mClose");
  const mReturn=document.getElementById("mReturn");

  const pillFormal=document.getElementById("pillFormal");
  const pillInformal=document.getElementById("pillInformal");
  const pillCause=document.getElementById("pillCause");
  const pillEffect=document.getElementById("pillEffect");
  const pillConcept=document.getElementById("pillConcept");
  const pillLive=document.getElementById("pillLive");
  const pillRoadmap=document.getElementById("pillRoadmap");

  const h1=document.getElementById("h1");
  const h2=document.getElementById("h2");
  const h3=document.getElementById("h3");
  const stackList=document.getElementById("stackList");

  let section="FOUNDATION";

  const PHEAD = ["P1 — Context","P2 — Constraint","P3 — Tension","P4 — Intervention","P5 — Mechanism","P6 — Result","P7 — Boundary"];

  // ===== DENSE CONTENT ENGINE (Fix #2) =====
  // Domain lexicon: unique nouns/verbs so domains can’t collapse into copies.
  const LEX = {
    Industrial:{actor:"industrial operators",asset:"thermal process lines",risk:"downtime cost",interface:"heat exchanger boundary",metric:"delivered-heat variance"},
    Scientific:{actor:"instrumentation",asset:"measurement stack",risk:"artifact inflation",interface:"calibration chain",metric:"background-subtracted signal"},
    Agricultural:{actor:"grow systems",asset:"crop microclimates",risk:"biological stress",interface:"exchanger-only heating",metric:"yield stability"},
    Financial:{actor:"capital allocators",asset:"cashflow sleeves",risk:"variance shock",interface:"insurance underwriting",metric:"cost-per-verified-output"},
    Human:{actor:"operators and communities",asset:"trust and comprehension",risk:"misuse from confusion",interface:"UI + training",metric:"error-rate reduction"},
    Adversarial:{actor:"attackers",asset:"critical nodes",risk:"spoofed telemetry",interface:"tamper detection",metric:"containment time"},
    Regulatory:{actor:"authorities",asset:"permits and filings",risk:"scope drift",interface:"certification tiers",metric:"compliance incident rate"},
    Environmental:{actor:"ecosystems",asset:"air/water/land",risk:"thermal discharge",interface:"impact boundary",metric:"measured discharge bands"},
    Infrastructural:{actor:"grid operators",asset:"dispatch capacity",risk:"cascades",interface:"buffered interconnect",metric:"ramp compliance"},
    Computational:{actor:"control loops",asset:"telemetry and logs",risk:"drift and latency",interface:"guards + receipts",metric:"oscillation events"},
    Governance:{actor:"stewards",asset:"policy + ledger",risk:"power drift",interface:"non-retroactive audit",metric:"exception rate"},
    Temporal:{actor:"maintenance cycles",asset:"lifecycle stages",risk:"aging drift",interface:"refresh protocol",metric:"failure-rate trend"}
  };

  // Lens-specific narration frames: DIFFERENT across style/cause/effect/time
  function frame(domain, pIndex){
    const t = (gdTime==="origin")?"concept":(gdTime==="now")?"live":"roadmap";
    const s = gdStyle; // formal/informal
    const c = causality; // CAUSE/EFFECT
    const X = LEX[domain];

    // For each paragraph index, generate 7 dense sentences in chronological arc.
    // Each sentence is multi-clause and domain-specific.
    const make = (a,b,c,d,e,f,g)=>[a,b,c,d,e,f,g];

    if(pIndex===0){ // Context
      if(s==="formal"){
        if(t==="concept") return make(
          `The ${X.asset} governs the baseline problem-space, because the energy demand is defined by operational constraints rather than slogans.`,
          `The primary ${c==="CAUSE"?"driver":"consequence"} is ${c==="CAUSE"?X.risk:`instability in ${X.metric}`}, which determines whether the system is financeable, insurable, and repeatable.`,
          `The relevant actor is ${X.actor}, and the system must remain legible to them under pressure without requiring narrative agreement.`,
          `The interface is ${X.interface}, which separates hazardous regimes from endpoints and prevents risk migration into human proximity.`,
          `The measurable axis is ${X.metric}, which must be defined before any “improvement” language is admissible.`,
          `The deployment posture remains Industrial Plasma Thermal Substitution (C), because that is the only claim class currently compatible with bounded receipts.`,
          `Fusion is referenced only as a gated admissibility pathway, because no net-positive evidence is asserted in this project layer.`
        );
        if(t==="live") return make(
          `The current posture is execution-safe: the ${X.asset} is described only at the level of boundaries, receipts, and measurable outputs.`,
          `The observed ${c==="CAUSE"?"driver":"effect"} is ${c==="CAUSE"?`variation in ${X.metric}`:`reduced narrative ambiguity when ${X.interface} is explicit`}, not speculative gain.`,
          `The operator-facing reality is that ${X.actor} needs stable rules more than inspirational language, so the page stays contract-first.`,
          `The system is being treated as upstream-only high-energy with downstream passive endpoints, so failure modes remain inert at the consumer layer.`,
          `The measurable reports are framed as what can be logged and audited today, so the page avoids unmeasured parameter disclosure.`,
          `The public claim is still Industrial (C), and every sentence that could be misread as fusion gain is structurally excluded.`,
          `Any upgrade requires receipts, and receipts require independent measurement discipline, not rhetorical intensity.`
        );
        return make(
          `Roadmap posture is gated: scaling is permitted only by tightening constraints and improving ${X.metric} under audit.`,
          `The planned ${c==="CAUSE"?"driver":"effect"} is ${c==="CAUSE"?`receipt completeness in ${X.interface}`:`lower ${X.risk} as incident rates stabilize`}, not claim expansion.`,
          `The long-run objective is an underwriting-grade story where ${X.actor} can sign, operate, and audit without interpretive disputes.`,
          `The program is designed to be replication-first, because replication is the only scalable antidote to drift.`,
          `The interface remains hardened and upstream, because moving high-energy regimes downstream is categorically inadmissible.`,
          `The claim discipline remains Industrial (C) until an independent fusion proof chain exists, which is explicitly separate.`,
          `The roadmap is therefore a governance path, not a physics leap.`
        );
      } else { // informal
        if(t==="concept") return make(
          `This starts with the real world: the ${X.asset} has to run every day, and ${X.risk} is what breaks people and budgets.`,
          `If we can’t keep ${X.metric} inside a tight band, nothing else matters—no hype, no vision, no clever talk.`,
          `The people who touch this are ${X.actor}, so the rules have to be simple enough to follow when things go sideways.`,
          `The safety line is ${X.interface}; that’s the wall that stops risk from leaking toward humans.`,
          `We measure ${X.metric} first, because anything unmeasured becomes a story that can’t be trusted.`,
          `We stay Industrial (C): plasma for industrial heat substitution, buffered and contained.`,
          `Fusion talk stays in the “requirements-only” lane, because we are not claiming net gain here.`
        );
        if(t==="live") return make(
          `Right now the page only says what we can actually enforce: boundaries, safety, and what gets logged.`,
          `The ${c==="CAUSE"?"driver":"effect"} we care about is ${c==="CAUSE"?`what pushes ${X.metric} out of range`:`what happens when ${X.metric} stays stable`}, not fantasy upgrades.`,
          `We’re keeping the system upstream and contained, because downstream risk is a deal-breaker.`,
          `Everything that matters to ${X.actor} is framed as a rule they can follow, not a claim they must believe.`,
          `The interface stays simple: ${X.interface}, then buffer, then delivery; nothing else gets to pretend it’s “safe.”`,
          `Industrial (C) stays locked, and that keeps language honest.`,
          `If we want to upgrade later, we earn it with receipts, not confidence.`
        );
        return make(
          `Next is scale, but scale doesn’t mean “bigger claims”—it means tighter rules and better receipts.`,
          `The plan is to reduce ${X.risk} by making ${X.metric} boring and repeatable, not dramatic.`,
          `We want ${X.actor} to operate this without needing a hero—just a clear playbook.`,
          `The safety wall (${X.interface}) stays permanent, because moving it would be irresponsible.`,
          `Everything new gets tested under stress first, because real systems fail under stress, not in slides.`,
          `Industrial (C) stays the public posture until the fusion proof chain exists independently.`,
          `So the roadmap is a disciplined build-out, not a miracle jump.`
        );
      }
    }

    // For pIndex 1..6, keep dense and unique but shorter to fit limits here.
    // (Still 7 sentences; still domain-specific; still chronological.)
    const P = (label, s1,s2,s3,s4,s5,s6,s7)=>make(s1,s2,s3,s4,s5,s6,s7);

    if(pIndex===1){ // Constraint
      if(s==="formal") return P("Constraint",
        `Constraints are declared before effort, because undeclared constraints produce hidden failure modes.`,
        `The primary constraint boundary is ${X.interface}, which cannot be relaxed by preference or urgency.`,
        `Safety constraints remain upstream-only for high-energy regimes, so endpoints remain passive and inert.`,
        `Measurement constraints require that ${X.metric} be computed from defined logs, not narrative judgments.`,
        `Operational constraints require that ${X.actor} can execute procedures under stress without ambiguity.`,
        `Financial and regulatory constraints require auditable traces, because audit is the gate to scaling.`,
        `Claim constraints lock posture to Industrial (C), and any fusion implication is structurally disallowed.`
      );
      return P("Constraint",
        `Rules come first, because rules are what keep people safe when the day goes bad.`,
        `${X.interface} is the hard wall; if you cross it, you’re doing a different project.`,
        `No high-energy at endpoints—ever—so the public layer stays passive.`,
        `We measure ${X.metric} from logs, not from “it feels better.”`,
        `${X.actor} has to be able to follow the playbook without arguing about words.`,
        `Audits matter because audits are what let you scale without lying.`,
        `Industrial (C) stays locked; fusion stays gated-only.`
      );
    }

    if(pIndex===2){ // Tension
      if(s==="formal") return P("Tension",
        `Tension emerges when ${X.risk} competes with the need for stable delivery.`,
        `Market and schedule pressure push teams toward ambiguous language and unmeasured claims.`,
        `Operational reality produces edge cases where ${X.metric} can drift even if average output looks fine.`,
        `Safety tension arises when convenience tries to erode ${X.interface}.`,
        `Data tension arises when noise and artifacts masquerade as improvement.`,
        `Governance tension arises when incentives reward optimism over accuracy.`,
        `The design response is to treat failures as data and tighten gates, not to reinterpret outcomes.`
      );
      return P("Tension",
        `${X.risk} is the enemy, and pressure makes people pretend it isn’t.`,
        `Deadlines make teams talk big instead of measuring ${X.metric}.`,
        `The system can look “fine” while it quietly drifts, and drift is how disasters start.`,
        `Convenience always tries to push through ${X.interface}, and that’s how risk leaks.`,
        `Noise can look like progress if you’re not strict.`,
        `Bad incentives make people hide ugly numbers.`,
        `So we treat failures as useful and tighten the rules.`
      );
    }

    if(pIndex===3){ // Intervention
      if(s==="formal") return P("Intervention",
        `The intervention is to move uncertainty upstream and convert it into measured envelopes.`,
        `We enforce ${X.interface} as a permanent separation requirement.`,
        `We buffer outputs so ${X.metric} becomes stable rather than reactive.`,
        `We require receipts for any posture shift, including deployment phase escalation.`,
        `We isolate variables so root causes are identifiable rather than argued.`,
        `We log deviations and treat them as triggers for constraint tightening.`,
        `We maintain Industrial (C) posture while running gated readiness pathways separately.`
      );
      return P("Intervention",
        `We push the danger upstream and keep the public layer boring.`,
        `${X.interface} stays locked as the separation wall.`,
        `We buffer the output so ${X.metric} stays steady.`,
        `Nothing levels up without receipts.`,
        `We change one thing at a time so we can actually learn.`,
        `We log deviations so we can tighten rules instead of blaming people.`,
        `Industrial (C) stays public; fusion stays gated-only.`
      );
    }

    if(pIndex===4){ // Mechanism
      if(s==="formal") return P("Mechanism",
        `Mechanism is a staged chain: controlled regime → isolation → buffer → delivery.`,
        `Control logic monitors envelope adherence and trips on mismatch rather than averaging errors away.`,
        `Telemetry must be redundant where ${X.risk} can be masked by artifacts.`,
        `CARES-style response preserves safety by prioritizing containment over continuity.`,
        `SVF-style validation prevents single-signal optimism from escalating claims.`,
        `Audit artifacts are produced as part of operation, not appended after incidents.`,
        `The system remains coherent because every stage has explicit stop conditions.`
      );
      return P("Mechanism",
        `It’s a chain: regime, isolation, buffer, delivery—no shortcuts.`,
        `The controls trip on mismatch instead of “hoping it smooths out.”`,
        `We use redundancy where noise can fool people.`,
        `Response puts containment first, not pride.`,
        `Validation stops single-signal hype.`,
        `Audits are built in, not added later.`,
        `Stop conditions keep the whole thing coherent.`
      );
    }

    if(pIndex===5){ // Result
      if(s==="formal") return P("Result",
        `The intended result is reduced variance in ${X.metric} under declared operating conditions.`,
        `The economic result is lower sensitivity to volatility via buffering and phase discipline.`,
        `The safety result is reduced endpoint exposure by enforcing ${X.interface}.`,
        `The governance result is reduced dispute surface because receipts replace interpretation.`,
        `The adoption result is higher trust because claims remain bounded and falsifiable.`,
        `The scaling result is replication readiness because rules are portable and auditable.`,
        `The scientific result is honest staging: what is measured vs what remains gated.`
      );
      return P("Result",
        `The goal is simple: make ${X.metric} stable in the real world.`,
        `Buffers make volatility less scary.`,
        `${X.interface} keeps people safe by design.`,
        `Receipts replace arguments.`,
        `Bounded claims build trust faster than big claims.`,
        `Portable rules make replication possible.`,
        `We keep science honest: measured stays measured; gated stays gated.`
      );
    }

    // pIndex===6 Boundary
    if(s==="formal") return P("Boundary",
      `This layer does not assert net-positive fusion.`,
      `This layer does not assert facility-level net electric output.`,
      `This layer does not publish hazardous operational recipes.`,
      `This layer does not permit endpoint high-energy exposure.`,
      `This layer does not upgrade claims via narrative interpretation.`,
      `This layer treats failure as admissible data, not as embarrassment.`,
      `This layer stays Industrial (C) unless independent receipts justify change.`
    );
    return P("Boundary",
      `We are not claiming net fusion.`,
      `We are not claiming net electric output.`,
      `We are not publishing dangerous recipes.`,
      `We are not allowing high-energy at endpoints.`,
      `We are not upgrading claims because it “sounds right.”`,
      `Failures count as useful data.`,
      `Industrial (C) stays locked unless receipts force an upgrade.`
    );
  }

  function renderTemp(){
    const t=tempColor();
    document.documentElement.style.setProperty("--temp", t);
    document.documentElement.style.setProperty("--tempSoft", tempSoft(t));
  }

  function headerLines(){
    const t = (gdTime==="origin")?"CONCEPT":(gdTime==="now")?"LIVE":"ROADMAP";
    h1.textContent = `ENERGY · ${section} · ${causality} · ${t} · ${gdStyle.toUpperCase()}`;
    h2.textContent = (section==="FOUNDATION")
      ? "Foundation defines what is admissible before anything else can scale."
      : (section==="ARCHITECTURE")
      ? "Architecture defines how the system is built, isolated, and interfaced."
      : (section==="PERFORMANCE")
      ? "Performance defines what is measured, stable, and auditable."
      : "Governance defines what may propagate under scale without corruption.";
    h3.textContent = CLAIM_LOCK;
  }

  // modal refs
  const h1=document.getElementById("h1");
  const h2=document.getElementById("h2");
  const h3=document.getElementById("h3");
  const stackList=document.getElementById("stackList");

  function renderPills(){
    pillFormal.classList.toggle("active", gdStyle==="formal");
    pillInformal.classList.toggle("active", gdStyle==="informal");
    pillCause.classList.toggle("active", causality==="CAUSE");
    pillEffect.classList.toggle("active", causality==="EFFECT");
    pillConcept.classList.toggle("active", gdTime==="origin");
    pillLive.classList.toggle("active", gdTime==="now");
    pillRoadmap.classList.toggle("active", gdTime==="post");
  }

  // Build stack rows (multi-open + anchored)
  function buildStackRow(domainKey){
    const row=document.createElement("div");
    row.className="stackRow";
    row.style.setProperty("--domc", DOMAIN_COLORS[domainKey]);

    const head=document.createElement("div");
    head.className="stackHead";

    const left=document.createElement("div");
    left.className="stackLeft";

    const bar=document.createElement("div");
    bar.className="stackBar";
    bar.style.background = DOMAIN_COLORS[domainKey];

    const title=document.createElement("div");
    title.className="stackTitle";
    title.textContent = domainKey;

    const sub=document.createElement("div");
    sub.className="stackSub";
    sub.textContent = `${section} · ${causality} · ${(gdTime==="origin")?"CONCEPT":(gdTime==="now")?"LIVE":"ROADMAP"} · ${gdStyle.toUpperCase()}`;

    left.appendChild(bar);
    left.appendChild(title);
    left.appendChild(sub);

    const chev=document.createElement("div");
    chev.className="stackChevron";
    chev.textContent = "▸";

    head.appendChild(left);
    head.appendChild(chev);

    const body=document.createElement("div");
    body.className="stackBody";

    for(let i=0;i<7;i++){
      const box=document.createElement("div");
      box.className="pblock";
      box.id = `p_${domainKey}_${i}`;

      const ph=document.createElement("div");
      ph.className="ph";
      ph.textContent = PHEAD[i];

      const ul=document.createElement("ul");
      ul.className="pul";

      const sents = frame(domainKey, i);
      sents.forEach(txt=>{
        const li=document.createElement("li");
        li.textContent = txt;
        ul.appendChild(li);
      });

      // Anchor capture on click inside a paragraph block
      box.addEventListener("click", ()=>{
        RS.anchorDomain = domainKey;
        RS.anchorP = i;
      });

      box.appendChild(ph);
      box.appendChild(ul);
      body.appendChild(box);
    }

    head.addEventListener("click", ()=>{
      RS.anchorDomain = domainKey;
      RS.anchorP = 0;
      const open = row.classList.toggle("open");
      if(open){ RS.open.add(domainKey); chev.textContent="▾"; }
      else { RS.open.delete(domainKey); chev.textContent="▸"; }
    });

    row.appendChild(head);
    row.appendChild(body);
    return row;
  }

  function renderStacks(){
    stackList.innerHTML="";
    DOMAINS.forEach(d=>{
      const el = buildStackRow(d);
      if(RS.open.has(d)){
        el.classList.add("open");
        el.querySelector(".stackChevron").textContent="▾";
      }
      stackList.appendChild(el);
    });
  }

  function restoreReadingPosition(){
    // restore scroll position first
    mbody.scrollTop = RS.scrollTop || 0;

    // then, if we have an anchor, gently bring it into view
    if(RS.anchorDomain && RS.anchorP!=null){
      const id = `p_${RS.anchorDomain}_${RS.anchorP}`;
      const node = document.getElementById(id);
      if(node){
        const rect = node.getBoundingClientRect();
        const top = rect.top;
        // if far away, scroll so it sits under the sticky lens bar
        if(top < 120 || top > window.innerHeight - 180){
          node.scrollIntoView({block:"start", behavior:"auto"});
          // offset for sticky top
          mbody.scrollTop = Math.max(0, mbody.scrollTop - 160);
        }
      }
    }
  }

  function renderAllPreserve(){
    // capture current scroll before rebuild
    RS.scrollTop = mbody.scrollTop;

    renderTemp();
    renderPills();
    headerLines();
    renderStacks();

    // restore after DOM paint
    requestAnimationFrame(restoreReadingPosition);
  }

  function openModal(sec){
    section=sec;
    mTitle.textContent = `ENERGY · ${section}`;
    bd.classList.add("show");
    modal.classList.add("show");
    // default: open none unless user has opened already
    renderAllPreserve();
  }
  function closeModal(){
    bd.classList.remove("show");
    modal.classList.remove("show");
  }

  // expose
  window.__openEnergy=openModal;

  // close
  bd.addEventListener("click", closeModal);
  mClose.addEventListener("click", closeModal);
  mReturn.addEventListener("click", closeModal);

  // STYLE
  pillFormal.addEventListener("click", ()=>{
    gdStyle="formal"; try{localStorage.setItem("gd_style",gdStyle);}catch(e){}
    renderAllPreserve();
  });
  pillInformal.addEventListener("click", ()=>{
    gdStyle="informal"; try{localStorage.setItem("gd_style",gdStyle);}catch(e){}
    renderAllPreserve();
  });

  // CAUSALITY
  pillCause.addEventListener("click", ()=>{ causality="CAUSE"; renderAllPreserve(); });
  pillEffect.addEventListener("click", ()=>{ causality="EFFECT"; renderAllPreserve(); });

  // TIME
  pillConcept.addEventListener("click", ()=>{ gdTime="origin"; try{localStorage.setItem("gd_time",gdTime);}catch(e){} renderAllPreserve(); });
  pillLive.addEventListener("click", ()=>{ gdTime="now"; try{localStorage.setItem("gd_time",gdTime);}catch(e){} renderAllPreserve(); });
  pillRoadmap.addEventListener("click", ()=>{ gdTime="post"; try{localStorage.setItem("gd_time",gdTime);}catch(e){} renderAllPreserve(); });

  // keyboard open
  [["dFoundation","FOUNDATION"],["dGovernance","GOVERNANCE"],["dPerformance","PERFORMANCE"],["dArchitecture","ARCHITECTURE"]].forEach(([id,sec])=>{
    const el=document.getElementById(id);
    if(!el) return;
    el.addEventListener("keydown",(e)=>{ if(e.key==="Enter"||e.key===" "){ e.preventDefault(); openModal(sec);} });
  });

})();
</script>

</body>
</html>

<!-- TNT — /products/energy/index.html  (FULL · NON-SKELETON · MAX DENSITY)
     CONFIRMED FINAL MODEL:
       - Face diamonds: NO NORTH/SOUTH/EAST/WEST text. Big labels are substance:
         FOUNDATION / GOVERNANCE / PERFORMANCE / ARCHITECTURE
       - Modal:
         1) STYLE lens: FORMAL / INFORMAL
         2) 3×2 GRID: CAUSE/EFFECT × CONCEPT/LIVE/ROADMAP (6 cells visible)
         3) ONE active cell renders MAX DENSITY:
            - Headline
            - 2 dense paragraphs
            - 7 domain strips (Industrial/Scientific/Agricultural/Financial/Human/Adversarial/Regulatory)
            - Each strip contains: 1 dense paragraph + 7 micro-bullets
       - Industrial (C) locked: no net-positive fusion, no facility net-electric, no grid-fusion implication.
       - Fusion referenced only as gated admissibility pathway (link only).
       - Uses /assets/ui.css + /assets/branch.css only. Does NOT style html/body background.
       - No new gd_* keys. (Bubble selection is session-only; style/time already gd_style/gd_time.)
-->

<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>PRODUCTS · ENERGY</title>

<link rel="stylesheet" href="/assets/ui.css"/>
<link rel="stylesheet" href="/assets/branch.css"/>

<style>
:root{
  --R:154px;
  --goldSoft:rgba(212,175,55,.35);
  --goldHard:rgba(212,175,55,.60);
  --obs1:#070b12;
  --obs2:#0c1626;
  --mut:rgba(255,255,255,.88);
  --mut2:rgba(255,255,255,.72);
}

body{margin:0;color:#fff;font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif}

/* Top-left */
.top-left{position:fixed;left:16px;top:16px;z-index:90;display:flex;gap:10px;flex-wrap:wrap;align-items:center}
.btn{
  padding:10px 16px;border-radius:14px;
  background:linear-gradient(145deg,var(--obs2),var(--obs1));
  color:#fff;border:1px solid rgba(255,255,255,.08);
  box-shadow:0 14px 36px rgba(0,0,0,.7);
  cursor:pointer;font-weight:900;letter-spacing:.2px;text-decoration:none;
  -webkit-tap-highlight-color:transparent;
}
.btn:hover{box-shadow:0 18px 50px rgba(0,0,0,.9),0 0 14px var(--goldSoft)}

/* Brand pill */
.brand{
  position:fixed;left:50%;top:16px;transform:translateX(-50%);
  z-index:80;text-align:center;padding:10px 14px;border-radius:999px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(0,0,0,.16);backdrop-filter:blur(8px);
}
.brand .name{font-weight:950;letter-spacing:1.2px;font-size:12px;opacity:.95}
.brand .tag{font-size:11px;letter-spacing:.6px;opacity:.70;margin-top:2px}

/* Stage */
.stage{
  position:fixed;left:50%;top:52%;
  transform:translate(-50%,-50%);
  width:min(720px,94vw);height:min(720px,94vw);
  z-index:60;
  pointer-events:none;
}
.outer{
  position:absolute;left:50%;top:50%;
  width:min(680px,92vw);height:min(680px,92vw);
  transform:translate(-50%,-50%) rotate(45deg);
  border-radius:60px;
  background:
    radial-gradient(circle at 30% 25%, rgba(255,255,255,.08), transparent 55%),
    radial-gradient(circle at 70% 80%, rgba(0,80,255,.14), transparent 60%),
    linear-gradient(160deg, rgba(14,24,40,.45) 0%, rgba(7,11,18,.62) 70%);
  border:1px solid rgba(255,255,255,.10);
  box-shadow:0 90px 260px rgba(0,0,0,.72), inset 0 2px 0 rgba(255,255,255,.10), inset 0 -50px 90px rgba(0,0,0,.55);
  opacity:.85;
  pointer-events:none;
}
.outer::after{
  content:"";position:absolute;inset:0;border-radius:60px;
  background:repeating-conic-gradient(from 0deg, rgba(255,255,255,.04) 0deg 6deg, transparent 6deg 18deg);
  opacity:.16; pointer-events:none;
}
.d{
  width:170px;height:170px;position:absolute;left:50%;top:50%;
  transform-origin:center;border-radius:26px;cursor:pointer;
  -webkit-tap-highlight-color:transparent;
  background:
    radial-gradient(circle at 35% 22%, rgba(255,255,255,.18), transparent 58%),
    radial-gradient(circle at 70% 82%, rgba(0,80,255,.22), transparent 62%),
    linear-gradient(160deg, rgba(12,22,38,.94) 0%, rgba(7,11,18,.96) 72%);
  border:1px solid rgba(255,255,255,.12);
  box-shadow:0 30px 90px rgba(0,0,0,.78), inset 0 2px 0 rgba(255,255,255,.10);
  transition:transform 220ms ease, box-shadow 220ms ease, border-color 220ms ease;
  pointer-events:auto;
  touch-action:manipulation;
  overflow:hidden;
}
.d::before{
  content:"";position:absolute;inset:0;border-radius:26px;padding:1px;
  background:linear-gradient(120deg, transparent 0%, var(--goldHard) 50%, transparent 100%);
  opacity:.50;
  -webkit-mask:linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  -webkit-mask-composite:xor;mask-composite:exclude;
  pointer-events:none;
}
.d::after{
  content:"";position:absolute;left:-40%;top:-60%;
  width:180%;height:160%;
  background:linear-gradient(120deg, rgba(255,255,255,.00) 0%, rgba(255,255,255,.16) 45%, rgba(255,255,255,.00) 60%);
  transform:rotate(18deg);
  opacity:.60;pointer-events:none;
  animation:shimmer 6.8s linear infinite;
}
@keyframes shimmer{
  0%{transform:translateX(-18%) rotate(18deg);opacity:.35}
  45%{opacity:.85}
  100%{transform:translateX(18%) rotate(18deg);opacity:.35}
}
.d:hover{box-shadow:0 36px 120px rgba(0,0,0,.90),0 0 22px var(--goldSoft), inset 0 2px 0 rgba(255,255,255,.12)}
.d.active{border-color:rgba(212,175,55,.55);box-shadow:0 40px 140px rgba(0,0,0,.92),0 0 26px rgba(212,175,55,.35), inset 0 2px 0 rgba(255,255,255,.14)}
.d-n{transform:translate(-50%,-50%) translate(0, calc(var(--R) * -1)) rotate(45deg)}
.d-e{transform:translate(-50%,-50%) translate(var(--R), 0) rotate(45deg)}
.d-s{transform:translate(-50%,-50%) translate(0, var(--R)) rotate(45deg)}
.d-w{transform:translate(-50%,-50%) translate(calc(var(--R) * -1), 0) rotate(45deg)}
.inner{width:100%;height:100%;transform:rotate(-45deg);display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:14px;gap:8px;pointer-events:none;user-select:none}
.lab{font-weight:950;letter-spacing:.6px;font-size:18px}
.sub{font-size:12.5px;opacity:.78;line-height:1.28;max-width:18em}
.core{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:74px;height:74px;border-radius:22px;border:1px solid rgba(255,255,255,.10);background:rgba(0,0,0,.18);box-shadow:0 18px 44px rgba(0,0,0,.62), inset 0 2px 0 rgba(255,255,255,.10);display:grid;place-items:center;font-weight:950;letter-spacing:.5px;opacity:.92;pointer-events:none}

/* Dock */
.dock{
  position:fixed;left:50%;
  bottom:max(12px, env(safe-area-inset-bottom));
  transform:translateX(-50%);
  z-index:90;width:min(900px,94vw);
  display:flex;justify-content:center;gap:10px;flex-wrap:wrap;
  padding:10px 12px;border-radius:999px;border:1px solid rgba(255,255,255,.10);
  background:rgba(0,0,0,.20);backdrop-filter:blur(8px);
  pointer-events:none;
}
.dock .btn{pointer-events:auto}

/* Modal */
.bd{position:fixed;inset:0;z-index:200;background:rgba(0,0,0,.65);backdrop-filter:blur(10px);display:none}
.bd.show{display:block}
.modal{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);width:min(1180px,96vw);max-height:90vh;display:none;z-index:210}
.modal.show{display:block}
.shell{
  height:90vh;border-radius:26px;border:1px solid rgba(255,255,255,.10);
  background:
    radial-gradient(circle at 50% 18%, rgba(176,0,0,.20), transparent 55%),
    radial-gradient(circle at 40% 25%, rgba(90,140,255,.12), transparent 55%),
    linear-gradient(160deg,var(--obs2) 0%, var(--obs1) 65%);
  box-shadow:0 60px 180px rgba(0,0,0,.92);
  overflow:hidden;display:flex;flex-direction:column;
}
.mhead{display:flex;justify-content:space-between;align-items:center;gap:10px;padding:14px 16px;border-bottom:1px solid rgba(255,255,255,.08)}
.mtitle{margin:0;font-weight:950;letter-spacing:.3px;font-size:16px}
.mclose{border:0;background:transparent;color:#fff;font-size:18px;cursor:pointer;padding:8px 10px}
.mbody{padding:14px 16px 18px;overflow:auto;-webkit-overflow-scrolling:touch;flex:1 1 auto}

/* Lenses */
.lensbar{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:center;padding:10px 10px 14px;border-bottom:1px solid rgba(255,255,255,.08);margin:-6px -6px 14px}
.chip{padding:10px 16px;border-radius:999px;background:linear-gradient(145deg,var(--obs2),var(--obs1));border:1px solid rgba(255,255,255,.08);box-shadow:0 14px 36px rgba(0,0,0,.65);cursor:pointer;font-weight:900;letter-spacing:.2px;color:#fff}
.chip.active{border-color:rgba(212,175,55,.35);box-shadow:0 18px 50px rgba(0,0,0,.9),0 0 16px rgba(212,175,55,.30)}

/* 3×2 grid (Cause/Effect × Concept/Live/Roadmap) */
.grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
  margin:0 0 14px;
}
.cell{
  padding:12px 14px;
  border-radius:18px;
  background:linear-gradient(145deg, rgba(17,22,28,.82), rgba(11,15,20,.88));
  border:1px solid rgba(255,255,255,.10);
  box-shadow:0 12px 30px rgba(0,0,0,.50);
  cursor:pointer;
  font-weight:950;
  letter-spacing:.2px;
  text-align:center;
  user-select:none;
  -webkit-tap-highlight-color:transparent;
}
.cell.active{
  border-color:rgba(212,175,55,.40);
  box-shadow:0 18px 48px rgba(0,0,0,.72), 0 0 18px rgba(212,175,55,.18);
}

/* Dense body */
.dense{
  padding:16px 18px;border-radius:22px;
  background:
    radial-gradient(circle at 30% 30%, rgba(120,160,255,.08), transparent 55%),
    linear-gradient(145deg, rgba(12,22,38,.92), rgba(7,11,18,.95));
  border:1px solid rgba(255,255,255,.10);
  box-shadow:0 18px 60px rgba(0,0,0,.70), inset 0 2px 0 rgba(255,255,255,.06);
  position:relative;
}
.dense::before{
  content:"";position:absolute;inset:0;border-radius:22px;padding:1px;
  background:linear-gradient(120deg, transparent 0%, var(--goldSoft) 50%, transparent 100%);
  opacity:.55;
  -webkit-mask:linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  -webkit-mask-composite:xor;mask-composite:exclude;
  pointer-events:none;
}
.hd{margin:0 0 10px;font-weight:950;letter-spacing:.2px;font-size:18px}
.p1,.p2{margin:0 0 10px;color:var(--mut);line-height:1.58}
.note{margin:0 0 14px;color:rgba(255,255,255,.70);font-size:12px;line-height:1.45}

/* Domain strips */
.strip{
  border:1px solid rgba(255,255,255,.08);
  background:rgba(0,0,0,.10);
  border-radius:18px;
  padding:12px 12px 10px;
  margin:0 0 10px;
}
.sh{margin:0 0 6px;font-weight:950;letter-spacing:.2px}
.sp{margin:0 0 8px;color:var(--mut);line-height:1.55}
.sul{margin:0;padding-left:18px;color:var(--mut2)}
.sul li{margin:4px 0}

/* Modal actions */
.mact{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:14px}
.sbtn{padding:12px 18px;border-radius:14px;background:linear-gradient(145deg,var(--obs2),var(--obs1));color:#fff;border:1px solid rgba(255,255,255,.08);box-shadow:0 14px 36px rgba(0,0,0,.7);cursor:pointer;font-weight:900;letter-spacing:.2px;text-decoration:none}

@media (max-width:560px){
  :root{--R:136px}
  .d{width:158px;height:158px}
  .stage{top:50%}
}
</style>
</head>

<body>

<div class="top-left">
  <a class="btn" id="btnBack" href="/products/">BACK</a>
  <a class="btn" id="btnExit" href="/door/">EXIT</a>
</div>

<div class="brand">
  <div class="name" id="brandName">PRODUCTS</div>
  <div class="tag" id="brandTag">ENERGY · INDUSTRIAL PLASMA ARCHITECTURE</div>
</div>

<div class="stage" aria-label="Energy product diamond">
  <div class="outer"></div>

  <div class="d d-n" id="dFoundation" role="button" tabindex="0" onclick="window.__openEnergy('FOUNDATION')">
    <div class="inner">
      <div class="lab">FOUNDATION</div>
      <div class="sub">Constraint base · Industrial (C) locked</div>
    </div>
  </div>

  <div class="d d-e" id="dGovernance" role="button" tabindex="0" onclick="window.__openEnergy('GOVERNANCE')">
    <div class="inner">
      <div class="lab">GOVERNANCE</div>
      <div class="sub">Standards · Licensing-before-scale</div>
    </div>
  </div>

  <div class="d d-s" id="dPerformance" role="button" tabindex="0" onclick="window.__openEnergy('PERFORMANCE')">
    <div class="inner">
      <div class="lab">PERFORMANCE</div>
      <div class="sub">Measured output · Bounded variance</div>
    </div>
  </div>

  <div class="d d-w" id="dArchitecture" role="button" tabindex="0" onclick="window.__openEnergy('ARCHITECTURE')">
    <div class="inner">
      <div class="lab">ARCHITECTURE</div>
      <div class="sub">System form · Containment classes</div>
    </div>
  </div>

  <div class="core">◆</div>
</div>

<nav class="dock" aria-label="Bottom navigation">
  <a class="btn" id="dockHub" href="/home/">HUB</a>
  <a class="btn" id="dockTerminal" href="/index.html">TERMINAL</a>
  <a class="btn" id="dockLinks" href="/links/">LINKS</a>
  <a class="btn active" id="dockProducts" href="/products/">PRODUCTS</a>
  <a class="btn" id="dockLaws" href="/laws/">LAWS</a>
  <a class="btn" id="dockGauges" href="/gauges/">GAUGES</a>
</nav>

<div class="bd" id="bd"></div>

<div class="modal" id="modal" role="dialog" aria-modal="true">
  <div class="shell">
    <div class="mhead">
      <h3 class="mtitle" id="mTitle">DETAIL</h3>
      <button class="mclose" id="mClose" aria-label="Close" type="button">✕</button>
    </div>

    <div class="mbody">
      <!-- Lenses -->
      <div class="lensbar">
        <button class="chip active" id="styleFormal" type="button">FORMAL</button>
        <button class="chip" id="styleInformal" type="button">INFORMAL</button>
        <button class="chip active" data-time="origin" id="chipConcept" type="button">CONCEPT</button>
        <button class="chip" data-time="now" id="chipLive" type="button">LIVE</button>
        <button class="chip" data-time="post" id="chipRoadmap" type="button">ROADMAP</button>
      </div>

      <!-- Grid -->
      <div class="grid" id="grid">
        <div class="cell active" data-c="CAUSE" data-t="CONCEPT">CAUSE · CONCEPT</div>
        <div class="cell" data-c="EFFECT" data-t="CONCEPT">EFFECT · CONCEPT</div>
        <div class="cell" data-c="CAUSE" data-t="LIVE">CAUSE · LIVE</div>
        <div class="cell" data-c="EFFECT" data-t="LIVE">EFFECT · LIVE</div>
        <div class="cell" data-c="CAUSE" data-t="ROADMAP">CAUSE · ROADMAP</div>
        <div class="cell" data-c="EFFECT" data-t="ROADMAP">EFFECT · ROADMAP</div>
      </div>

      <!-- Dense Body -->
      <div class="dense" id="dense">
        <h4 class="hd" id="hd">—</h4>
        <p class="p1" id="p1">—</p>
        <p class="p2" id="p2">—</p>
        <p class="note" id="note">—</p>

        <div id="strips"></div>
      </div>

      <div class="mact">
        <button class="sbtn" id="mReturn" type="button">RETURN</button>
        <a class="sbtn" id="mFusion" href="/explore/fusion-readiness/">FUSION READINESS</a>
        <a class="sbtn" id="mJumpProducts" href="/products/">JUMP PRODUCTS</a>
        <a class="sbtn" id="mJumpHub" href="/home/">JUMP HUB</a>
      </div>
    </div>
  </div>
</div>

<script>
(function(){
  // ===== state (gd_* only) =====
  const qs = new URLSearchParams(location.search);
  let lang  = qs.get("lang")  || localStorage.getItem("gd_lang")  || "en";
  let style = qs.get("style") || localStorage.getItem("gd_style") || "formal";
  let time  = qs.get("time")  || localStorage.getItem("gd_time")  || "origin";
  if(!["en","zh"].includes(lang)) lang="en";
  if(!["formal","informal"].includes(style)) style="formal";
  if(!["origin","now","post"].includes(time)) time="origin";
  try{ localStorage.setItem("gd_lang",lang); localStorage.setItem("gd_style",style); localStorage.setItem("gd_time",time);}catch(e){}
  document.documentElement.lang = (lang==="zh") ? "zh" : "en";
  const q = () => `lang=${encodeURIComponent(lang)}&style=${encodeURIComponent(style)}&time=${encodeURIComponent(time)}`;

  function setLinks(){
    const s=q();
    document.getElementById("btnBack").href="/products/?"+s;
    document.getElementById("btnExit").href="/door/?"+s;
    document.getElementById("dockHub").href="/home/?"+s;
    document.getElementById("dockTerminal").href="/index.html?"+s;
    document.getElementById("dockLinks").href="/links/?"+s;
    document.getElementById("dockProducts").href="/products/?"+s;
    document.getElementById("dockLaws").href="/laws/?"+s;
    document.getElementById("dockGauges").href="/gauges/?"+s;
    document.getElementById("mJumpProducts").href="/products/?"+s;
    document.getElementById("mJumpHub").href="/home/?"+s;
    document.getElementById("mFusion").href="/explore/fusion-readiness/?"+s;
  }
  setLinks();

  // ===== modal refs =====
  const bd=document.getElementById("bd");
  const modal=document.getElementById("modal");
  const mTitle=document.getElementById("mTitle");
  const mClose=document.getElementById("mClose");
  const mReturn=document.getElementById("mReturn");

  const styleFormal=document.getElementById("styleFormal");
  const styleInformal=document.getElementById("styleInformal");
  const chipConcept=document.getElementById("chipConcept");
  const chipLive=document.getElementById("chipLive");
  const chipRoadmap=document.getElementById("chipRoadmap");

  const hd=document.getElementById("hd");
  const p1=document.getElementById("p1");
  const p2=document.getElementById("p2");
  const note=document.getElementById("note");
  const strips=document.getElementById("strips");

  // ===== active selectors =====
  let activeSection = "FOUNDATION";     // FOUNDATION | ARCHITECTURE | PERFORMANCE | GOVERNANCE
  let activeC = "CAUSE";               // CAUSE | EFFECT
  let activeT = "CONCEPT";             // CONCEPT | LIVE | ROADMAP

  // ===== constants =====
  const DOMAINS = ["Industrial","Scientific","Agricultural","Financial","Human","Adversarial","Regulatory"];

  // CLAIM DISCIPLINE (global invariant)
  const CLAIM_LOCK = "Public positioning: Industrial plasma thermal substitution (C). No net-positive fusion claim. No facility net-electric claim. Fusion referenced only as gated admissibility pathway.";

  // Helper: compact bullet phrases (≤14 words)
  function bulletsFor(domain, section, c, t){
    // Always 7 bullets per domain. Dense, bounded, no fusion overclaim.
    const base = {
      Industrial:[
        "PFM modules substitute fossil heat.",
        "SLA buffers dispatch variability.",
        "IDP gates deployment scale.",
        "CC tiers constrain containment.",
        "CARES governs escalation response.",
        "SVF rejects artifact-only signals.",
        "Fusion remains gated pathway."
      ],
      Scientific:[
        "Definitions and falsifiers remain explicit.",
        "Measured vs unmeasured stays declared.",
        "Noise floor constraints remain binding.",
        "No post-hoc threshold edits.",
        "Disproof triggers remain published.",
        "Replication precedes elevation.",
        "No Q>1 implied."
      ],
      Agricultural:[
        "Thermal reuse via exchangers only.",
        "Soil boundary remains isolated.",
        "Livestock exposure remains zero.",
        "Setback geometry remains enforced.",
        "Seasonality mitigated by buffering.",
        "Revenue stacking remains bounded.",
        "No high-energy regime on fields."
      ],
      Financial:[
        "Phase-gated capex discipline.",
        "Insurance compatibility tied to CC tier.",
        "Incident rate tied to underwriting.",
        "Opex bounded by maintenance intervals.",
        "No speculative claim escalation.",
        "Audit trail increases bankability.",
        "Scale follows receipts."
      ],
      Human:[
        "Claims remain clear and bounded.",
        "No consumer high-energy exposure.",
        "Interfaces remain simple and safe.",
        "Training reduces misuse risk.",
        "Exit remains cost-free.",
        "Adoption through incumbents.",
        "No coercive messaging."
      ],
      Adversarial:[
        "Artifact suppression enforced by SVF.",
        "Disagreement kills runs.",
        "Rollback triggers remain active.",
        "Hostile audit posture maintained.",
        "No smoothing or bin merging.",
        "Stop rules precede rupture.",
        "External falsification invited."
      ],
      Regulatory:[
        "Standards precede deployment scale.",
        "Licensing precedes distribution.",
        "Tiered permissions by CC class.",
        "Documentation precedes claims.",
        "Compliance artifacts persist.",
        "Independent audits encouraged.",
        "No mixed claim language."
      ]
    };
    // Add subtle section/cause/time bias in paragraph only; bullets remain stable for readability.
    return base[domain];
  }

  function faceLine(section){
    if(section==="FOUNDATION") return "Foundation defines admissible boundaries and claim discipline before execution.";
    if(section==="ARCHITECTURE") return "Architecture defines modules, placement, buffering, and containment under declared constraints.";
    if(section==="PERFORMANCE") return "Performance defines measurable inputs/outputs, stability bands, and bounded variance under load.";
    return "Governance defines standards, licensing, auditability, and non-retroactive enforcement under scale.";
  }

  function lensLine(c,t){
    const tt = (t==="CONCEPT")?"CONCEPT":(t==="LIVE")?"LIVE":"ROADMAP";
    const cc = (c==="CAUSE")?"CAUSE":"EFFECT";
    return `${cc} · ${tt}`;
  }

  function paragraph1(section,c,t){
    // Dense paragraph 1 (definition + constraints)
    const tt = (t==="CONCEPT")?"concept framing":(t==="LIVE")?"current measurable posture":"bounded roadmap posture";
    const cc = (c==="CAUSE")?"drivers and constraints":"outputs and consequences";
    return `${section} under ${lensLine(c,t)} describes ${cc} using ${tt}. Industrial (C) positioning is locked. High-energy regimes remain upstream under containment classes, with buffered delivery via SLA and phase-gated deployment via IDP.`;
  }

  function paragraph2(section,c,t){
    // Dense paragraph 2 (mechanism + limits)
    const cc = (c==="CAUSE")?"Causality view emphasizes what must be true before action proceeds":"Effect view emphasizes what can be measured and recorded without reinterpretation";
    const tt = (t==="CONCEPT")?"Definitions and falsifiers are primary":"Receipts and windows are primary";
    const tr = (t==="ROADMAP")?"Any future posture remains gated by receipts; failure reverts to Industrial (C)":"No upgrade is implied";
    return `${cc}. ${tt}. Signal validation is multi-channel (SVF). Escalation response is governed (CARES) and bounded by containment class (CC). ${tr}.`;
  }

  function domainParagraph(domain, section, c, t){
    // One dense paragraph per domain per active cell
    const cc = (c==="CAUSE")?"cause-side requirements":"effect-side evidence";
    const tt = (t==="CONCEPT")?"definition-level":(t==="LIVE")?"current-state": "roadmap-level";
    return `${domain} layer expresses ${section} as ${cc} under ${tt} framing. Claim discipline remains binding; no net-positive fusion is asserted.`;
  }

  function render(){
    // Headline
    hd.textContent = `${activeSection} · ${lensLine(activeC,activeT)} · ${style.toUpperCase()}`;
    // Paragraphs (formal vs informal)
    if(style==="informal"){
      p1.textContent = `${activeSection}: ${lensLine(activeC,activeT)}. Industrial (C) locked. Upstream-only high energy. Buffered delivery.`;
      p2.textContent = `Cause/Effector view changes what you read, not what we claim. SVF/CARES/CC/IDP remain binding. Roadmap is gated.`;
    }else{
      p1.textContent = paragraph1(activeSection,activeC,activeT);
      p2.textContent = paragraph2(activeSection,activeC,activeT);
    }
    note.textContent = CLAIM_LOCK;

    // Domain strips
    strips.innerHTML = "";
    DOMAINS.forEach((d)=>{
      const wrap=document.createElement("div");
      wrap.className="strip";
      const h=document.createElement("h4");
      h.className="sh";
      h.textContent=d;
      const p=document.createElement("p");
      p.className="sp";
      p.textContent = (style==="informal")
        ? `${d}: ${activeSection} · ${lensLine(activeC,activeT)}. Bounded. No fusion gain claim.`
        : domainParagraph(d,activeSection,activeC,activeT);

      const ul=document.createElement("ul");
      ul.className="sul";
      bulletsFor(d,activeSection,activeC,activeT).forEach(b=>{
        const li=document.createElement("li");
        li.textContent=b;
        ul.appendChild(li);
      });

      wrap.appendChild(h);
      wrap.appendChild(p);
      wrap.appendChild(ul);
      strips.appendChild(wrap);
    });
  }

  function openModal(section){
    activeSection = section;
    mTitle.textContent = `ENERGY · ${section}`;
    bd.classList.add("show");
    modal.classList.add("show");

    // defaults for clarity
    activeC = "CAUSE";
    activeT = "CONCEPT";
    time = "origin";
    style = (style==="informal") ? "informal" : "formal";

    // reset chips + grid
    document.querySelectorAll(".cell").forEach(c=>c.classList.remove("active"));
    document.querySelector('.cell[data-c="CAUSE"][data-t="CONCEPT"]').classList.add("active");
    chipConcept.classList.add("active"); chipLive.classList.remove("active"); chipRoadmap.classList.remove("active");
    styleFormal.classList.toggle("active", style==="formal");
    styleInformal.classList.toggle("active", style==="informal");

    try{ localStorage.setItem("gd_style",style); localStorage.setItem("gd_time",time);}catch(e){}
    render();
  }

  function closeModal(){
    bd.classList.remove("show");
    modal.classList.remove("show");
  }

  // expose
  window.__openEnergy = openModal;

  // close binds
  bd.addEventListener("click", closeModal);
  mClose.addEventListener("click", closeModal);
  mReturn.addEventListener("click", closeModal);

  // style lens
  styleFormal.addEventListener("click", ()=>{
    style="formal"; try{localStorage.setItem("gd_style",style);}catch(e){}
    styleFormal.classList.add("active"); styleInformal.classList.remove("active"); render();
  });
  styleInformal.addEventListener("click", ()=>{
    style="informal"; try{localStorage.setItem("gd_style",style);}catch(e){}
    styleInformal.classList.add("active"); styleFormal.classList.remove("active"); render();
  });

  // time lens
  function setTime(tk){
    activeT = tk;
    time = (tk==="CONCEPT")?"origin":(tk==="LIVE")?"now":"post";
    try{localStorage.setItem("gd_time",time);}catch(e){}
    chipConcept.classList.toggle("active", tk==="CONCEPT");
    chipLive.classList.toggle("active", tk==="LIVE");
    chipRoadmap.classList.toggle("active", tk==="ROADMAP");
    // also update active grid cell time if it differs
    document.querySelectorAll(".cell").forEach(c=>{
      if(c.classList.contains("active")){
        activeC = c.dataset.c;
        // force the active cell's time to match tk by activating matching cell
        c.classList.remove("active");
      }
    });
    document.querySelector(`.cell[data-c="${activeC}"][data-t="${tk}"]`).classList.add("active");
    render();
  }
  chipConcept.addEventListener("click", ()=>setTime("CONCEPT"));
  chipLive.addEventListener("click", ()=>setTime("LIVE"));
  chipRoadmap.addEventListener("click", ()=>setTime("ROADMAP"));

  // grid selection
  document.querySelectorAll(".cell").forEach(cell=>{
    cell.addEventListener("click", ()=>{
      document.querySelectorAll(".cell").forEach(c=>c.classList.remove("active"));
      cell.classList.add("active");
      activeC = cell.dataset.c;
      activeT = cell.dataset.t;
      // sync time lens chips
      if(activeT==="CONCEPT"){ time="origin"; chipConcept.classList.add("active"); chipLive.classList.remove("active"); chipRoadmap.classList.remove("active"); }
      if(activeT==="LIVE"){ time="now"; chipLive.classList.add("active"); chipConcept.classList.remove("active"); chipRoadmap.classList.remove("active"); }
      if(activeT==="ROADMAP"){ time="post"; chipRoadmap.classList.add("active"); chipConcept.classList.remove("active"); chipLive.classList.remove("active"); }
      try{localStorage.setItem("gd_time",time);}catch(e){}
      render();
    });
  });

  // keyboard open (accessibility)
  [["dFoundation","FOUNDATION"],["dGovernance","GOVERNANCE"],["dPerformance","PERFORMANCE"],["dArchitecture","ARCHITECTURE"]].forEach(([id,sec])=>{
    const el=document.getElementById(id);
    el.addEventListener("keydown",(e)=>{ if(e.key==="Enter"||e.key===" "){ e.preventDefault(); openModal(sec);} });
  });

})();
</script>

</body>
</html>

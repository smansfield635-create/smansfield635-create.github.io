<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Control · Geodiametrics</title>

<style>
:root{
  --bg:#07131c;
  --panel:#0f2433;
  --panel2:#132c3f;
  --text:#eaf2f8;
  --muted:#9fb4c6;
  --ok:#35d0a1;
  --warn:#ffb020;
  --err:#ff5d5d;
  --accent:#39b6ff;
  --radius:22px;
  --stroke:rgba(255,255,255,.08);
  --shadow:0 18px 48px rgba(0,0,0,.45);
}

*{box-sizing:border-box}
html,body{margin:0;height:100%}

body{
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
  color:var(--text);
  background:
    radial-gradient(1200px 900px at 70% -20%,rgba(57,182,255,.12),transparent 60%),
    radial-gradient(900px 700px at 10% 10%,rgba(53,208,161,.08),transparent 55%),
    linear-gradient(180deg,#061018,#07131c);
}

.page{
  max-width:900px;
  margin:0 auto;
  padding:28px 18px 60px;
}

.card{
  background:linear-gradient(180deg,var(--panel),var(--panel2));
  border:1px solid var(--stroke);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  padding:22px;
  margin-bottom:18px;
}

h1{margin:0;font-size:36px}
.sub{color:var(--muted);margin-top:6px}

.kv{
  display:grid;
  grid-template-columns:auto 1fr;
  gap:8px 14px;
  margin-top:10px;
}
.kv div{color:var(--muted)}
.kv strong{color:var(--text);font-weight:600}

.status{
  display:inline-flex;
  align-items:center;
  gap:10px;
  margin-top:10px;
  font-weight:600;
}
.dot{
  width:10px;height:10px;border-radius:50%;
}
.ok{background:var(--ok)}
.warn{background:var(--warn)}
.err{background:var(--err)}

.grid{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:14px;
}
@media(max-width:700px){.grid{grid-template-columns:1fr}}

.metric{
  background:rgba(255,255,255,.03);
  border:1px solid var(--stroke);
  border-radius:18px;
  padding:18px;
}
.metric h3{margin:0;font-size:14px;color:var(--muted)}
.metric .val{font-size:34px;font-weight:700;margin-top:6px}

.note{
  color:var(--muted);
  font-size:14px;
  line-height:1.45;
  margin-top:12px;
}

.nav{
  display:flex;
  justify-content:center;
  gap:18px;
  margin-top:18px;
}
.nav a{
  color:var(--accent);
  text-decoration:none;
  font-weight:600;
}
.nav a:hover{text-decoration:underline}

.footer{
  margin-top:26px;
  text-align:center;
  color:#7f95a8;
  font-size:13px;
}
</style>
</head>

<body>
<div class="page">

  <!-- Header -->
  <div class="card">
    <h1>Control</h1>
    <div class="sub">Live metrics. Read-only by design.</div>
  </div>

  <!-- Source -->
  <div class="card">
    <div class="kv">
      <div>Truth source</div>
      <strong>
        <a href="https://geodiametrics-aggregator.smansfield635.workers.dev/metrics"
           target="_blank" rel="noopener"
           style="color:var(--accent)">
          /metrics
        </a>
      </strong>

      <div>Polling</div><strong>10s</strong>
      <div>Last updated</div><strong id="lastUpdated">—</strong>
    </div>

    <div class="status" id="statusLine">
      <span class="dot warn"></span>
      <span>Idle (no events observed)</span>
    </div>

    <div class="note">
      Zero values indicate an intact but idle system. Divergence indicates missing
      or blocked event emission — not UI failure.
    </div>
  </div>

  <!-- Metrics -->
  <div class="grid">
    <div class="metric">
      <h3>Pageviews</h3>
      <div class="val" id="pageviews">0</div>
    </div>
    <div class="metric">
      <h3>Sessions</h3>
      <div class="val" id="sessions">0</div>
    </div>
    <div class="metric">
      <h3>Clicks</h3>
      <div class="val" id="clicks">0</div>
    </div>
    <div class="metric">
      <h3>Writes</h3>
      <div class="val" id="writes">0</div>
    </div>
  </div>

  <!-- Nav -->
  <div class="nav">
    <a href="/">Landing</a>
    <a href="/home/">Home</a>
    <a href="/reference/">Reference</a>
  </div>

  <div class="footer">© Geodiametrics</div>
</div>

<script>
const ENDPOINT = "https://geodiametrics-aggregator.smansfield635.workers.dev/metrics";

async function refresh(){
  try{
    const r = await fetch(ENDPOINT,{cache:"no-store"});
    const j = await r.json();

    const m = j.metrics || {};
    document.getElementById("pageviews").textContent = m.pageviews ?? 0;
    document.getElementById("sessions").textContent = m.sessions ?? 0;
    document.getElementById("clicks").textContent = m.clicks ?? 0;
    document.getElementById("writes").textContent = m.writes ?? 0;

    const last = m.lastUpdated
      ? new Date(m.lastUpdated).toLocaleTimeString()
      : "—";
    document.getElementById("lastUpdated").textContent = last;

    const status = document.getElementById("statusLine");
    status.innerHTML = "";

    if(m.pageviews || m.sessions || m.clicks || m.writes){
      status.innerHTML = `<span class="dot ok"></span><span>Active</span>`;
    }else{
      status.innerHTML = `<span class="dot warn"></span><span>Idle (no events observed)</span>`;
    }
  }catch(e){
    const status = document.getElementById("statusLine");
    status.innerHTML = `<span class="dot err"></span><span>Unavailable (fetch failed)</span>`;
  }
}

refresh();
setInterval(refresh,10000);
</script>
</body>
</html>

<!-- TNT — /products/energy/index.html  (FULL · MAX DENSITY · FIXED COLOR/TEMP · NO DRIFT)
     LOCKS (CONFIRMED):
       - Face diamonds show NO North/South/East/West text.
       - Face diamonds show substance labels: FOUNDATION / GOVERNANCE / PERFORMANCE / ARCHITECTURE.
       - Modal lenses are presented as 3 selector clusters (NOT grid):
           1) STYLE: FORMAL / INFORMAL  (gd_style)
           2) CAUSALITY: CAUSE / EFFECT  (session-only; no new gd_* keys)
           3) TIME: CONCEPT / LIVE / ROADMAP  (gd_time = origin/now/post)
       - Fixed temperature + fixed colors:
           * Black/Red/Gold/Opal = neutral baseline (field + accents)
           * Temperature = blackbody-aligned glow (blue/white hotter than red), glow-only
           * Domain identity color = accent-only (left bar + badge), never tints the field
       - Content: 12 DOMAIN STACKS (accordion):
           * 12 domain bubbles
           * One open at a time (dense but readable)
           * Each domain contains 7 paragraph blocks
           * Each paragraph block contains 7 bullets
       - Industrial (C) positioning discipline:
           * No net-positive fusion claim
           * No facility net-electric claim
           * No grid-fusion implication
           * Fusion referenced only as gated admissibility pathway (link)
       - No debug pills
       - Uses /assets/ui.css + /assets/branch.css only
       - Does NOT style html/body background (ui.css owns field)
       - No new state keys beyond gd_lang/gd_style/gd_time
-->

<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>PRODUCTS · ENERGY</title>

<link rel="stylesheet" href="/assets/ui.css"/>
<link rel="stylesheet" href="/assets/branch.css"/>

<style>
:root{
  --R:154px;

  /* Neutral baseline (Chinese theme) */
  --neutralBlack: rgba(0,0,0,.18);
  --neutralRed: rgba(176,0,0,.22);
  --neutralGold: rgba(212,175,55,.55);
  --neutralOpal: rgba(255,255,255,.10);

  /* Temperature glow (set by JS; blackbody aligned) */
  --temp: #E5E7EB;         /* white */
  --tempSoft: rgba(229,231,235,.18);

  /* Typography */
  --mut: rgba(255,255,255,.88);
  --mut2: rgba(255,255,255,.70);
}

/* DO NOT TOUCH FIELD — ui.css owns html/body background */
body{margin:0;color:#fff;font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif}

/* Top-left */
.top-left{position:fixed;left:16px;top:16px;z-index:90;display:flex;gap:10px;flex-wrap:wrap;align-items:center}
.btn{
  padding:10px 16px;border-radius:14px;
  background:linear-gradient(145deg, rgba(12,22,38,.92), rgba(7,11,18,.95));
  color:#fff;border:1px solid rgba(255,255,255,.08);
  box-shadow:0 14px 36px rgba(0,0,0,.7);
  cursor:pointer;font-weight:900;letter-spacing:.2px;text-decoration:none;
  -webkit-tap-highlight-color:transparent;
}
.btn:hover{box-shadow:0 18px 50px rgba(0,0,0,.9),0 0 14px rgba(212,175,55,.22)}

/* Brand pill */
.brand{
  position:fixed;left:50%;top:16px;transform:translateX(-50%);
  z-index:80;text-align:center;padding:10px 14px;border-radius:999px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(0,0,0,.16);backdrop-filter:blur(8px);
}
.brand .name{font-weight:950;letter-spacing:1.2px;font-size:12px;opacity:.95}
.brand .tag{font-size:11px;letter-spacing:.6px;opacity:.70;margin-top:2px}

/* Stage */
.stage{
  position:fixed;left:50%;top:52%;
  transform:translate(-50%,-50%);
  width:min(720px,94vw);height:min(720px,94vw);
  z-index:60;
  pointer-events:none;
}
.outer{
  position:absolute;left:50%;top:50%;
  width:min(680px,92vw);height:min(680px,92vw);
  transform:translate(-50%,-50%) rotate(45deg);
  border-radius:60px;
  background:
    radial-gradient(circle at 50% 14%, var(--neutralRed), transparent 55%),
    radial-gradient(circle at 40% 25%, rgba(90,140,255,.10), transparent 55%),
    linear-gradient(160deg, rgba(14,24,40,.45) 0%, rgba(7,11,18,.62) 70%);
  border:1px solid rgba(255,255,255,.10);
  box-shadow:0 90px 260px rgba(0,0,0,.72), inset 0 2px 0 rgba(255,255,255,.10), inset 0 -50px 90px rgba(0,0,0,.55);
  opacity:.88;
  pointer-events:none;
}
.d{
  width:170px;height:170px;position:absolute;left:50%;top:50%;
  transform-origin:center;border-radius:26px;cursor:pointer;
  -webkit-tap-highlight-color:transparent;
  background:
    radial-gradient(circle at 35% 22%, rgba(255,255,255,.18), transparent 58%),
    radial-gradient(circle at 70% 82%, rgba(0,80,255,.20), transparent 62%),
    linear-gradient(160deg, rgba(12,22,38,.94) 0%, rgba(7,11,18,.96) 72%);
  border:1px solid rgba(255,255,255,.12);
  box-shadow:0 30px 90px rgba(0,0,0,.78), inset 0 2px 0 rgba(255,255,255,.10);
  transition:transform 220ms ease, box-shadow 220ms ease, border-color 220ms ease;
  pointer-events:auto;
  touch-action:manipulation;
  overflow:hidden;
}
.d:hover{box-shadow:0 36px 120px rgba(0,0,0,.90),0 0 22px rgba(212,175,55,.22), inset 0 2px 0 rgba(255,255,255,.12)}
.d.active{
  border-color:rgba(212,175,55,.55);
  box-shadow:0 40px 140px rgba(0,0,0,.92),0 0 26px rgba(212,175,55,.30), inset 0 2px 0 rgba(255,255,255,.14);
}
.d-n{transform:translate(-50%,-50%) translate(0, calc(var(--R) * -1)) rotate(45deg)}
.d-e{transform:translate(-50%,-50%) translate(var(--R), 0) rotate(45deg)}
.d-s{transform:translate(-50%,-50%) translate(0, var(--R)) rotate(45deg)}
.d-w{transform:translate(-50%,-50%) translate(calc(var(--R) * -1), 0) rotate(45deg)}
.inner{width:100%;height:100%;transform:rotate(-45deg);display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:14px;gap:8px;pointer-events:none;user-select:none}
.lab{font-weight:950;letter-spacing:.6px;font-size:18px}
.sub{font-size:12.5px;opacity:.78;line-height:1.28;max-width:18em}
.core{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:74px;height:74px;border-radius:22px;border:1px solid rgba(255,255,255,.10);background:rgba(0,0,0,.18);box-shadow:0 18px 44px rgba(0,0,0,.62), inset 0 2px 0 rgba(255,255,255,.10);display:grid;place-items:center;font-weight:950;letter-spacing:.5px;opacity:.92;pointer-events:none}

/* Dock */
.dock{
  position:fixed;left:50%;
  bottom:max(12px, env(safe-area-inset-bottom));
  transform:translateX(-50%);
  z-index:90;width:min(900px,94vw);
  display:flex;justify-content:center;gap:10px;flex-wrap:wrap;
  padding:10px 12px;border-radius:999px;border:1px solid rgba(255,255,255,.10);
  background:rgba(0,0,0,.20);backdrop-filter:blur(8px);
  pointer-events:none;
}
.dock .btn{pointer-events:auto}

/* Modal */
.bd{position:fixed;inset:0;z-index:200;background:rgba(0,0,0,.65);backdrop-filter:blur(10px);display:none}
.bd.show{display:block}
.modal{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);width:min(1180px,96vw);max-height:90vh;display:none;z-index:210}
.modal.show{display:block}
.shell{
  height:90vh;border-radius:26px;border:1px solid rgba(255,255,255,.10);
  background:
    radial-gradient(circle at 50% 18%, var(--neutralRed), transparent 55%),
    radial-gradient(circle at 40% 25%, rgba(90,140,255,.12), transparent 55%),
    linear-gradient(160deg, rgba(12,22,38,.92), rgba(7,11,18,.95));
  box-shadow:0 60px 180px rgba(0,0,0,.92);
  overflow:hidden;display:flex;flex-direction:column;
}
.mhead{display:flex;justify-content:space-between;align-items:center;gap:10px;padding:14px 16px;border-bottom:1px solid rgba(255,255,255,.08)}
.mtitle{margin:0;font-weight:950;letter-spacing:.3px;font-size:16px}
.mclose{border:0;background:transparent;color:#fff;font-size:18px;cursor:pointer;padding:8px 10px}
.mbody{padding:14px 16px 18px;overflow:auto;-webkit-overflow-scrolling:touch;flex:1 1 auto}

/* Lens clusters */
.clusterRow{display:flex;gap:10px;flex-wrap:wrap;align-items:flex-start;justify-content:center;margin:0 0 12px}
.cluster{
  border:1px solid rgba(255,255,255,.10);
  background:rgba(0,0,0,.12);
  border-radius:999px;
  padding:8px;
  display:flex;
  gap:8px;
}
.clusterTitle{
  font-size:11px;
  letter-spacing:1.6px;
  opacity:.75;
  text-transform:uppercase;
  display:flex;
  align-items:center;
  padding:0 8px 0 6px;
}
.pill{
  padding:10px 14px;border-radius:999px;
  background:linear-gradient(145deg, rgba(17,22,28,.92), rgba(11,15,20,.96));
  border:1px solid rgba(255,255,255,.10);
  box-shadow:0 14px 36px rgba(0,0,0,.65);
  cursor:pointer;font-weight:900;letter-spacing:.2px;color:#fff;
  user-select:none;
  -webkit-tap-highlight-color:transparent;
}
.pill.active{
  border-color:rgba(212,175,55,.45);
  box-shadow:0 18px 50px rgba(0,0,0,.9), 0 0 14px var(--tempSoft);
}
.pill.hot{
  box-shadow:0 18px 50px rgba(0,0,0,.9), 0 0 18px var(--tempSoft);
  border-color:rgba(255,255,255,.14);
}

/* Domain bubble rail */
.domains{
  display:flex;gap:10px;flex-wrap:wrap;justify-content:center;
  padding:10px 10px 12px;margin:0 0 14px;
  border:1px solid rgba(255,255,255,.08);
  border-radius:22px;background:rgba(0,0,0,.10);
}
.db{
  padding:10px 14px;border-radius:999px;
  background:linear-gradient(145deg, rgba(17,22,28,.84), rgba(11,15,20,.90));
  border:1px solid rgba(255,255,255,.10);
  box-shadow:0 12px 30px rgba(0,0,0,.50);
  cursor:pointer;font-weight:900;letter-spacing:.15px;
  user-select:none;
  -webkit-tap-highlight-color:transparent;
  position:relative;
}
.db::before{
  content:"";position:absolute;left:10px;top:8px;bottom:8px;width:4px;border-radius:99px;
  background:var(--domc, rgba(255,255,255,.20));
  opacity:.9;
}
.db span{padding-left:10px;display:inline-block}
.db.active{
  border-color:rgba(212,175,55,.34);
  box-shadow:0 16px 44px rgba(0,0,0,.70), 0 0 18px rgba(212,175,55,.18);
}

/* Dense article body */
.article{
  padding:16px 18px;border-radius:22px;
  background:
    radial-gradient(circle at 30% 30%, rgba(255,255,255,.06), transparent 55%),
    linear-gradient(145deg, rgba(12,22,38,.92), rgba(7,11,18,.95));
  border:1px solid rgba(255,255,255,.10);
  box-shadow:0 18px 60px rgba(0,0,0,.70), inset 0 2px 0 rgba(255,255,255,.06);
  position:relative;
}
.article::before{
  content:"";position:absolute;inset:0;border-radius:22px;padding:1px;
  background:linear-gradient(120deg, transparent 0%, var(--neutralGold) 50%, transparent 100%);
  opacity:.35;
  -webkit-mask:linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  -webkit-mask-composite:xor;mask-composite:exclude;
  pointer-events:none;
}
.ah{margin:0 0 10px;font-weight:950;letter-spacing:.2px;font-size:18px}
.ap{margin:0 0 10px;color:var(--mut);line-height:1.6}
.anote{margin:0 0 14px;color:rgba(255,255,255,.70);font-size:12px;line-height:1.45}

/* Paragraph blocks (7) */
.pblock{
  border:1px solid rgba(255,255,255,.08);
  background:rgba(0,0,0,.08);
  border-radius:18px;
  padding:12px 12px 10px;
  margin:0 0 10px;
}
.ph{margin:0 0 6px;font-weight:950;letter-spacing:.15px}
.pdesc{margin:0 0 8px;color:var(--mut);line-height:1.55}
.pul{margin:0;padding-left:18px;color:var(--mut2)}
.pul li{margin:4px 0}

/* Actions */
.mact{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:14px}
.sbtn{padding:12px 18px;border-radius:14px;background:linear-gradient(145deg, rgba(12,22,38,.92), rgba(7,11,18,.95));color:#fff;border:1px solid rgba(255,255,255,.08);box-shadow:0 14px 36px rgba(0,0,0,.7);cursor:pointer;font-weight:900;letter-spacing:.2px;text-decoration:none}

@media (max-width:560px){
  :root{--R:136px}
  .d{width:158px;height:158px}
  .stage{top:50%}
}
</style>
</head>

<body>

<div class="top-left">
  <a class="btn" id="btnBack" href="/products/">BACK</a>
  <a class="btn" id="btnExit" href="/door/">EXIT</a>
</div>

<div class="brand">
  <div class="name" id="brandName">PRODUCTS</div>
  <div class="tag" id="brandTag">ENERGY · INDUSTRIAL PLASMA ARCHITECTURE</div>
</div>

<div class="stage" aria-label="Energy product diamond">
  <div class="outer"></div>

  <div class="d d-n" id="dFoundation" role="button" tabindex="0" onclick="window.__openEnergy('FOUNDATION')">
    <div class="inner">
      <div class="lab">FOUNDATION</div>
      <div class="sub">Constraint base · Industrial (C) locked</div>
    </div>
  </div>

  <div class="d d-e" id="dGovernance" role="button" tabindex="0" onclick="window.__openEnergy('GOVERNANCE')">
    <div class="inner">
      <div class="lab">GOVERNANCE</div>
      <div class="sub">Standards · Licensing-before-scale</div>
    </div>
  </div>

  <div class="d d-s" id="dPerformance" role="button" tabindex="0" onclick="window.__openEnergy('PERFORMANCE')">
    <div class="inner">
      <div class="lab">PERFORMANCE</div>
      <div class="sub">Measured output · Bounded variance</div>
    </div>
  </div>

  <div class="d d-w" id="dArchitecture" role="button" tabindex="0" onclick="window.__openEnergy('ARCHITECTURE')">
    <div class="inner">
      <div class="lab">ARCHITECTURE</div>
      <div class="sub">System form · Containment classes</div>
    </div>
  </div>

  <div class="core">◆</div>
</div>

<nav class="dock" aria-label="Bottom navigation">
  <a class="btn" id="dockHub" href="/home/">HUB</a>
  <a class="btn" id="dockTerminal" href="/index.html">TERMINAL</a>
  <a class="btn" id="dockLinks" href="/links/">LINKS</a>
  <a class="btn active" id="dockProducts" href="/products/">PRODUCTS</a>
  <a class="btn" id="dockLaws" href="/laws/">LAWS</a>
  <a class="btn" id="dockGauges" href="/gauges/">GAUGES</a>
</nav>

<div class="bd" id="bd"></div>

<div class="modal" id="modal" role="dialog" aria-modal="true">
  <div class="shell">
    <div class="mhead">
      <h3 class="mtitle" id="mTitle">DETAIL</h3>
      <button class="mclose" id="mClose" aria-label="Close" type="button">✕</button>
    </div>

    <div class="mbody">

      <!-- Selector clusters -->
      <div class="clusterRow" id="clusters">
        <div class="cluster">
          <div class="clusterTitle">STYLE</div>
          <div class="pill active" id="pillFormal">FORMAL</div>
          <div class="pill" id="pillInformal">INFORMAL</div>
        </div>

        <div class="cluster">
          <div class="clusterTitle">CAUSALITY</div>
          <div class="pill active" id="pillCause">CAUSE</div>
          <div class="pill" id="pillEffect">EFFECT</div>
        </div>

        <div class="cluster">
          <div class="clusterTitle">TIME</div>
          <div class="pill active" id="pillConcept">CONCEPT</div>
          <div class="pill" id="pillLive">LIVE</div>
          <div class="pill" id="pillRoadmap">ROADMAP</div>
        </div>
      </div>

      <!-- Domain stacks -->
      <div class="domains" id="domainRail"></div>

      <!-- Article body -->
      <div class="article">
        <h4 class="ah" id="ah">—</h4>
        <p class="ap" id="ap1">—</p>
        <p class="ap" id="ap2">—</p>
        <p class="anote" id="anote">—</p>

        <div id="pblocks"></div>
      </div>

      <div class="mact">
        <button class="sbtn" id="mReturn" type="button">RETURN</button>
        <a class="sbtn" id="mFusion" href="/explore/fusion-readiness/">FUSION READINESS</a>
        <a class="sbtn" id="mJumpProducts" href="/products/">JUMP PRODUCTS</a>
        <a class="sbtn" id="mJumpHub" href="/home/">JUMP HUB</a>
      </div>

    </div>
  </div>
</div>

<script>
(function(){
  // ===== state (gd_* only) =====
  const qs = new URLSearchParams(location.search);
  let lang  = qs.get("lang")  || localStorage.getItem("gd_lang")  || "en";
  let gdStyle = qs.get("style") || localStorage.getItem("gd_style") || "formal";  // formal/informal
  let gdTime  = qs.get("time")  || localStorage.getItem("gd_time")  || "origin"; // origin/now/post
  if(!["en","zh"].includes(lang)) lang="en";
  if(!["formal","informal"].includes(gdStyle)) gdStyle="formal";
  if(gdTime==="trajectory") gdTime="post";
  if(!["origin","now","post"].includes(gdTime)) gdTime="origin";
  try{ localStorage.setItem("gd_lang",lang); localStorage.setItem("gd_style",gdStyle); localStorage.setItem("gd_time",gdTime);}catch(e){}
  document.documentElement.lang = (lang==="zh") ? "zh" : "en";

  // session-only causality (no new gd_* keys)
  let causality = "CAUSE"; // CAUSE/EFFECT

  // derived time label
  function timeLabel(){ return (gdTime==="origin") ? "CONCEPT" : (gdTime==="now") ? "LIVE" : "ROADMAP"; }

  // fixed domain identity colors (accent only)
  const DOMAIN_COLORS = {
    "Industrial":"#D97706",
    "Scientific":"#2563EB",
    "Agricultural":"#2F855A",
    "Financial":"#047857",
    "Human":"#F59E0B",
    "Adversarial":"#B91C1C",
    "Regulatory":"#475569",
    "Environmental":"#0D9488",
    "Infrastructural":"#1E40AF",
    "Computational":"#7C3AED",
    "Governance":"#D4AF37",
    "Temporal":"#94A3B8"
  };

  const DOMAINS = Object.keys(DOMAIN_COLORS); // 12

  // blackbody-aligned fixed temperature palette for lens state (glow only)
  // (blue/white hotter than red)
  function tempColor(){
    // base by time
    let base = "#E5E7EB"; // white (hot)
    if(gdTime==="origin") base = "#93C5FD";   // blue-white (hot intellect)
    if(gdTime==="now")    base = "#E5E7EB";   // white (present)
    if(gdTime==="post")   base = "#D97706";   // warm amber (roadmap warmth)

    // causality nudges
    if(causality==="CAUSE" && gdTime!=="post") base = "#93C5FD"; // cooler bias
    if(causality==="EFFECT" && gdTime!=="origin") base = "#D97706"; // warmer bias

    // style brightness (formal tighter/cooler; informal warmer)
    if(gdStyle==="formal"){
      if(base==="#D97706") base = "#E5E7EB"; // formal roadmap feels white-hot constraint
      return base;
    }else{
      if(base==="#93C5FD") base = "#E5E7EB"; // informal concept feels approachable white
      return base;
    }
  }

  function tempSoft(hex){
    // crude alpha soft: fixed to avoid parsing complexity
    if(hex==="#2563EB") return "rgba(37,99,235,.18)";
    if(hex==="#93C5FD") return "rgba(147,197,253,.18)";
    if(hex==="#E5E7EB") return "rgba(229,231,235,.16)";
    if(hex==="#D97706") return "rgba(217,119,6,.16)";
    if(hex==="#7F1D1D") return "rgba(127,29,29,.16)";
    return "rgba(229,231,235,.16)";
  }

  const CLAIM_LOCK = "Claim discipline: Industrial plasma thermal substitution (C). No net-positive fusion claim. No facility net-electric claim. Fusion referenced only as gated admissibility pathway.";

  // ===== modal refs =====
  const bd=document.getElementById("bd");
  const modal=document.getElementById("modal");
  const mTitle=document.getElementById("mTitle");
  const mClose=document.getElementById("mClose");
  const mReturn=document.getElementById("mReturn");

  const pillFormal=document.getElementById("pillFormal");
  const pillInformal=document.getElementById("pillInformal");
  const pillCause=document.getElementById("pillCause");
  const pillEffect=document.getElementById("pillEffect");
  const pillConcept=document.getElementById("pillConcept");
  const pillLive=document.getElementById("pillLive");
  const pillRoadmap=document.getElementById("pillRoadmap");

  const ah=document.getElementById("ah");
  const ap1=document.getElementById("ap1");
  const ap2=document.getElementById("ap2");
  const anote=document.getElementById("anote");
  const domainRail=document.getElementById("domainRail");
  const pblocks=document.getElementById("pblocks");

  let section = "FOUNDATION";
  let activeDomain = "Industrial";

  function q(){ return "lang="+encodeURIComponent(lang)+"&style="+encodeURIComponent(gdStyle)+"&time="+encodeURIComponent(gdTime); }

  function setLinks(){
    const s=q();
    document.getElementById("btnBack").href="/products/?"+s;
    document.getElementById("btnExit").href="/door/?"+s;
    document.getElementById("dockHub").href="/home/?"+s;
    document.getElementById("dockTerminal").href="/index.html?"+s;
    document.getElementById("dockLinks").href="/links/?"+s;
    document.getElementById("dockProducts").href="/products/?"+s;
    document.getElementById("dockLaws").href="/laws/?"+s;
    document.getElementById("dockGauges").href="/gauges/?"+s;
    document.getElementById("mJumpProducts").href="/products/?"+s;
    document.getElementById("mJumpHub").href="/home/?"+s;
    document.getElementById("mFusion").href="/explore/fusion-readiness/?"+s;
  }
  setLinks();

  // ===== content generator (non-skeleton: full 7×7 per domain, deterministic)
  const PHEAD = [
    "P1 — Definition",
    "P2 — Boundary",
    "P3 — Mechanism",
    "P4 — Constraints",
    "P5 — Deployment",
    "P6 — Risk",
    "P7 — Verification"
  ];

  function paraIntro(domain, idx){
    const t = timeLabel();
    const c = causality;
    const s = gdStyle.toUpperCase();
    // One dense thesis sentence per paragraph block
    if(gdStyle==="informal"){
      return `${domain} · ${section} · ${c} · ${t} · ${s}. This block stays bounded and claim-safe.`;
    }
    return `${domain} expresses ${section} under ${c}·${t}·${s} framing. Statements remain bounded, receipt-aware, and non-escalatory under Industrial (C) discipline.`;
  }

  function bullets(domain, idx){
    // 7 bullets per paragraph block (49 per domain)
    // Compact, declarative, no fusion overclaim.
    const t = timeLabel();
    const c = causality;
    // bullets vary slightly with c/t for journey effect, but remain fixed logic.
    const b = [];
    b.push(`${c}: primary driver declared before change.`);
    b.push(`${t}: posture scoped without claim inflation.`);
    b.push(`Bounds: no net-positive fusion implied anywhere.`);
    b.push(`Controls: SVF/CARES/CC/IDP remain binding.`);
    b.push(`Evidence: receipts required before elevation.`);
    b.push(`Failure: rollback/stop rules remain valid data.`);
    b.push(`Continuity: deployment stays industrial-first.`);
    // Domain nuance (swap one bullet)
    b[0] = `${c}: ${domain} driver/impact declared explicitly.`;
    return b;
  }

  function sectionLine(){
    if(section==="FOUNDATION") return "Foundation defines admissible boundaries and claim discipline before execution.";
    if(section==="ARCHITECTURE") return "Architecture defines modules, placement, buffering, and containment under declared constraints.";
    if(section==="PERFORMANCE") return "Performance defines measurable inputs/outputs, stability bands, and bounded variance under load.";
    return "Governance defines standards, licensing, auditability, and non-retroactive enforcement under scale.";
  }

  function causeEffectLine(){
    if(causality==="CAUSE") return "CAUSE view emphasizes prerequisites, drivers, constraints, and gate conditions.";
    return "EFFECT view emphasizes observable consequences, recorded outcomes, and bounded interpretation.";
  }

  function timeLine(){
    if(gdTime==="origin") return "CONCEPT view is definition-first: what must be true for admissibility.";
    if(gdTime==="now") return "LIVE view is measurement-first: what is currently observed and recorded.";
    return "ROADMAP view is gating-first: what would be required before expansion is admissible.";
  }

  function renderTemp(){
    const t = tempColor();
    document.documentElement.style.setProperty("--temp", t);
    document.documentElement.style.setProperty("--tempSoft", tempSoft(t));
    // apply hot class to active pills for laser feel
    document.querySelectorAll(".pill").forEach(p=>p.classList.remove("hot"));
    const active = document.querySelectorAll(".pill.active");
    active.forEach(p=>p.classList.add("hot"));
  }

  function renderDomains(){
    domainRail.innerHTML="";
    DOMAINS.forEach((d)=>{
      const el=document.createElement("div");
      el.className="db"+(d===activeDomain?" active":"");
      el.style.setProperty("--domc", DOMAIN_COLORS[d]);
      const sp=document.createElement("span");
      sp.textContent=d;
      el.appendChild(sp);
      el.addEventListener("click", ()=>{
        activeDomain=d;
        render();
      });
      domainRail.appendChild(el);
    });
  }

  function renderArticle(){
    const t = timeLabel();
    ah.textContent = `${section} · ${causality} · ${t} · ${gdStyle.toUpperCase()} · ${activeDomain}`;
    if(gdStyle==="informal"){
      ap1.textContent = `${sectionLine()} ${causeEffectLine()} ${timeLine()}`;
      ap2.textContent = `Industrial (C) is locked. Fusion is gated doctrine only. Domain color stays fixed; temperature glow stays fixed per lens.`;
    }else{
      ap1.textContent = `${sectionLine()} ${causeEffectLine()} ${timeLine()}`;
      ap2.textContent = `This product remains positioned as Industrial plasma thermal substitution (C). Any fusion discussion is framed strictly as a gated admissibility pathway requiring independent measurement receipts and explicit disproof conditions.`;
    }
    anote.textContent = CLAIM_LOCK;

    pblocks.innerHTML="";
    for(let i=0;i<7;i++){
      const box=document.createElement("div");
      box.className="pblock";

      const h=document.createElement("div");
      h.className="ph";
      h.textContent = `${PHEAD[i]}`;

      const p=document.createElement("div");
      p.className="pdesc";
      p.textContent = paraIntro(activeDomain, i);

      const ul=document.createElement("ul");
      ul.className="pul";
      bullets(activeDomain, i).forEach(x=>{
        const li=document.createElement("li");
        li.textContent = x;
        ul.appendChild(li);
      });

      box.appendChild(h);
      box.appendChild(p);
      box.appendChild(ul);
      pblocks.appendChild(box);
    }
  }

  function renderPills(){
    pillFormal.classList.toggle("active", gdStyle==="formal");
    pillInformal.classList.toggle("active", gdStyle==="informal");

    pillCause.classList.toggle("active", causality==="CAUSE");
    pillEffect.classList.toggle("active", causality==="EFFECT");

    pillConcept.classList.toggle("active", gdTime==="origin");
    pillLive.classList.toggle("active", gdTime==="now");
    pillRoadmap.classList.toggle("active", gdTime==="post");
  }

  function render(){
    renderPills();
    renderTemp();
    renderDomains();
    renderArticle();
  }

  function openModal(sec){
    section = sec;
    activeDomain = "Industrial";
    causality = "CAUSE";
    // keep existing gdStyle/gdTime; default time to concept if missing
    if(!gdTime) gdTime="origin";
    mTitle.textContent = `ENERGY · ${section}`;
    bd.classList.add("show");
    modal.classList.add("show");
    render();
  }

  function closeModal(){
    bd.classList.remove("show");
    modal.classList.remove("show");
  }

  // expose
  window.__openEnergy=openModal;

  // close
  bd.addEventListener("click", closeModal);
  mClose.addEventListener("click", closeModal);
  mReturn.addEventListener("click", closeModal);

  // STYLE
  pillFormal.addEventListener("click", ()=>{
    gdStyle="formal"; try{localStorage.setItem("gd_style",gdStyle);}catch(e){}
    render();
  });
  pillInformal.addEventListener("click", ()=>{
    gdStyle="informal"; try{localStorage.setItem("gd_style",gdStyle);}catch(e){}
    render();
  });

  // CAUSALITY (session-only)
  pillCause.addEventListener("click", ()=>{ causality="CAUSE"; render(); });
  pillEffect.addEventListener("click", ()=>{ causality="EFFECT"; render(); });

  // TIME (gd_time)
  pillConcept.addEventListener("click", ()=>{
    gdTime="origin"; try{localStorage.setItem("gd_time",gdTime);}catch(e){}
    render();
  });
  pillLive.addEventListener("click", ()=>{
    gdTime="now"; try{localStorage.setItem("gd_time",gdTime);}catch(e){}
    render();
  });
  pillRoadmap.addEventListener("click", ()=>{
    gdTime="post"; try{localStorage.setItem("gd_time",gdTime);}catch(e){}
    render();
  });

  // keyboard opens
  [["dFoundation","FOUNDATION"],["dGovernance","GOVERNANCE"],["dPerformance","PERFORMANCE"],["dArchitecture","ARCHITECTURE"]].forEach(([id,sec])=>{
    const el=document.getElementById(id);
    el.addEventListener("keydown",(e)=>{ if(e.key==="Enter"||e.key===" "){ e.preventDefault(); openModal(sec);} });
  });

})();
</script>

</body>
</html>

<!-- TNT — /products/energy/index.html  (PRODUCTS · ENERGY · INDUSTRIAL PLASMA ARCHITECTURE)
     FIXES:
       - Restores working diamond taps (proven hit-test + inline onclick)
       - Removes debug “ENERGY LIVE …” pill entirely
       - Adds “category bubbles” inside the modal:
           Scientific / Industrial / Agricultural / Adversarial
         → tap a bubble to expand; others stay collapsed (no overwhelm)
     RULES:
       - NO new state keys (gd_lang/gd_style/gd_time only)
       - Lenses stay inside modal only (STYLE + Concept/Live/Roadmap)
       - 4 bubbles exist always; each bubble has 4 bullets when expanded
       - Single-language render (en only if lang=en; zh only if lang=zh; zh mirrors EN for now)
       - Uses /assets/ui.css + /assets/branch.css only
       - Does NOT style html/body background (ui.css owns field)
-->

<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>PRODUCTS · ENERGY</title>

<link rel="stylesheet" href="/assets/ui.css"/>
<link rel="stylesheet" href="/assets/branch.css"/>

<style>
:root{
  --R:154px;
  --goldSoft:rgba(212,175,55,.35);
  --obs1:#070b12;
  --obs2:#0c1626;
  --mut:rgba(255,255,255,.84);
  --mut2:rgba(255,255,255,.68);
}
body{margin:0;min-height:100vh;overflow-x:hidden;font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;color:#fff}

/* Top-left */
.top-left{position:fixed;left:16px;top:16px;z-index:90;display:flex;gap:10px;flex-wrap:wrap;align-items:center}
.btn{
  padding:10px 16px;border-radius:14px;
  background:linear-gradient(145deg,var(--obs2),var(--obs1));
  color:#fff;border:1px solid rgba(255,255,255,.08);
  box-shadow:0 14px 36px rgba(0,0,0,.7);
  cursor:pointer;font-weight:900;letter-spacing:.2px;text-decoration:none;
  -webkit-tap-highlight-color:transparent;
}
.btn:hover{box-shadow:0 18px 50px rgba(0,0,0,.9),0 0 14px var(--goldSoft)}

/* Brand pill */
.brand{
  position:fixed;left:50%;top:16px;transform:translateX(-50%);
  z-index:80;text-align:center;padding:10px 14px;border-radius:999px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(0,0,0,.16);backdrop-filter:blur(8px);
}
.brand .name{font-weight:950;letter-spacing:1.2px;font-size:12px;opacity:.95}
.brand .tag{font-size:11px;letter-spacing:.6px;opacity:.70;margin-top:2px}

/* Stage (hit-test lock) */
.stage{
  position:fixed;left:50%;top:52%;
  transform:translate(-50%,-50%);
  width:min(720px,94vw);height:min(720px,94vw);
  z-index:60;
  pointer-events:none; /* stage ignores taps */
}
.outer{
  position:absolute;left:50%;top:50%;
  width:min(680px,92vw);height:min(680px,92vw);
  transform:translate(-50%,-50%) rotate(45deg);
  border-radius:60px;
  background:
    radial-gradient(circle at 30% 25%, rgba(255,255,255,.08), transparent 55%),
    radial-gradient(circle at 70% 80%, rgba(0,80,255,.14), transparent 60%),
    linear-gradient(160deg, rgba(14,24,40,.45) 0%, rgba(7,11,18,.62) 70%);
  border:1px solid rgba(255,255,255,.10);
  box-shadow:0 90px 260px rgba(0,0,0,.72), inset 0 2px 0 rgba(255,255,255,.10), inset 0 -50px 90px rgba(0,0,0,.55);
  opacity:.85;
  pointer-events:none;
}
.outer::after{
  content:"";position:absolute;inset:0;border-radius:60px;
  background:repeating-conic-gradient(from 0deg, rgba(255,255,255,.04) 0deg 6deg, transparent 6deg 18deg);
  opacity:.16; pointer-events:none;
}
.d{
  width:170px;height:170px;position:absolute;left:50%;top:50%;
  transform-origin:center;border-radius:26px;cursor:pointer;
  -webkit-tap-highlight-color:transparent;
  background:
    radial-gradient(circle at 35% 25%, rgba(255,255,255,.14), transparent 55%),
    radial-gradient(circle at 70% 80%, rgba(0,80,255,.18), transparent 60%),
    linear-gradient(160deg, rgba(12,22,38,.92) 0%, rgba(7,11,18,.95) 70%);
  border:1px solid rgba(255,255,255,.10);
  box-shadow:0 28px 84px rgba(0,0,0,.78), inset 0 2px 0 rgba(255,255,255,.14), inset 0 -28px 44px rgba(0,0,0,.62);
  transition:transform 220ms ease, box-shadow 220ms ease, border-color 220ms ease;
  pointer-events:auto; /* diamonds receive taps */
  touch-action:manipulation;
}
.d::before{
  content:"";position:absolute;inset:0;border-radius:26px;padding:1px;
  background:linear-gradient(120deg, transparent 0%, var(--goldSoft) 50%, transparent 100%);
  opacity:.45;
  -webkit-mask:linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  -webkit-mask-composite:xor;mask-composite:exclude;
  pointer-events:none;
}
.d::after{
  content:"";position:absolute;left:12%;right:12%;top:10%;height:28%;
  border-radius:999px;background:linear-gradient(to bottom, rgba(255,255,255,.16), rgba(255,255,255,0));
  opacity:.85;transform:rotate(-10deg);pointer-events:none;
}
.d:hover{transform:translate(-50%,-50%) rotate(45deg) scale(1.02)}
.d.active{
  border-color:rgba(212,175,55,.55);
  box-shadow:0 34px 110px rgba(0,0,0,.88),0 0 30px rgba(212,175,55,.40),
    inset 0 2px 0 rgba(255,255,255,.18),inset 0 -32px 52px rgba(0,0,0,.68);
}
.d-n{transform:translate(-50%,-50%) translate(0, calc(var(--R) * -1)) rotate(45deg)}
.d-e{transform:translate(-50%,-50%) translate(var(--R), 0) rotate(45deg)}
.d-s{transform:translate(-50%,-50%) translate(0, var(--R)) rotate(45deg)}
.d-w{transform:translate(-50%,-50%) translate(calc(var(--R) * -1), 0) rotate(45deg)}
.inner{width:100%;height:100%;transform:rotate(-45deg);display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:16px;gap:10px;pointer-events:none;user-select:none}
.lab{font-weight:950;letter-spacing:.8px;font-size:16px}
.sub{font-size:12.5px;opacity:.80;line-height:1.35;max-width:18em}
.core{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:74px;height:74px;border-radius:22px;border:1px solid rgba(255,255,255,.10);background:rgba(0,0,0,.18);box-shadow:0 18px 44px rgba(0,0,0,.62), inset 0 2px 0 rgba(255,255,255,.10);display:grid;place-items:center;font-weight:950;letter-spacing:.5px;opacity:.92;pointer-events:none}

/* Dock (tap-safe) */
.dock{
  position:fixed;left:50%;
  bottom:max(12px, env(safe-area-inset-bottom));
  transform:translateX(-50%);
  z-index:90;width:min(900px,94vw);
  display:flex;justify-content:center;gap:10px;flex-wrap:wrap;
  padding:10px 12px;border-radius:999px;border:1px solid rgba(255,255,255,.10);
  background:rgba(0,0,0,.20);backdrop-filter:blur(8px);
  pointer-events:none;
}
.dock .btn{pointer-events:auto}

/* Modal */
.bd{position:fixed;inset:0;z-index:200;background:rgba(0,0,0,.65);backdrop-filter:blur(10px);display:none}
.bd.show{display:block}
.modal{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);width:min(1020px,94vw);max-height:88vh;display:none;z-index:210}
.modal.show{display:block}
.shell{
  height:88vh;border-radius:26px;border:1px solid rgba(255,255,255,.10);
  background:
    radial-gradient(circle at 50% 18%, rgba(176,0,0,.20), transparent 55%),
    radial-gradient(circle at 40% 25%, rgba(90,140,255,.12), transparent 55%),
    linear-gradient(160deg,var(--obs2) 0%, var(--obs1) 65%);
  box-shadow:0 60px 180px rgba(0,0,0,.92);
  overflow:hidden;display:flex;flex-direction:column;
}
.mhead{display:flex;justify-content:space-between;align-items:center;gap:10px;padding:14px 16px;border-bottom:1px solid rgba(255,255,255,.08)}
.mtitle{margin:0;font-weight:950;letter-spacing:.3px;font-size:16px}
.mclose{border:0;background:transparent;color:#fff;font-size:18px;cursor:pointer;padding:8px 10px}
.mbody{padding:14px 16px 18px;overflow:auto;-webkit-overflow-scrolling:touch;flex:1 1 auto}
.lensbar{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:center;padding:10px 10px 14px;border-bottom:1px solid rgba(255,255,255,.08);margin:-6px -6px 14px}
.chip{padding:10px 16px;border-radius:999px;background:linear-gradient(145deg,var(--obs2),var(--obs1));border:1px solid rgba(255,255,255,.08);box-shadow:0 14px 36px rgba(0,0,0,.65);cursor:pointer;font-weight:900;letter-spacing:.2px;color:#fff}
.chip.active{border-color:rgba(212,175,55,.35);box-shadow:0 18px 50px rgba(0,0,0,.9),0 0 16px rgba(212,175,55,.30)}

.mgrid{display:grid;gap:14px}

/* Category bubbles (collapsible) */
.cbox{
  padding:16px 18px;border-radius:22px;
  background:
    radial-gradient(circle at 30% 30%, rgba(120,160,255,.08), transparent 55%),
    linear-gradient(145deg, rgba(12,22,38,.92), rgba(7,11,18,.95));
  border:1px solid rgba(255,255,255,.10);
  box-shadow:0 18px 60px rgba(0,0,0,.70), inset 0 2px 0 rgba(255,255,255,.06);
  position:relative;
  cursor:pointer;
  -webkit-tap-highlight-color:transparent;
}
.cbox::before{
  content:"";position:absolute;inset:0;border-radius:22px;padding:1px;
  background:linear-gradient(120deg, transparent 0%, var(--goldSoft) 50%, transparent 100%);
  opacity:.55;
  -webkit-mask:linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  -webkit-mask-composite:xor;mask-composite:exclude;
  pointer-events:none;
}
.cbox.open{border-color:rgba(212,175,55,.28); box-shadow:0 22px 80px rgba(0,0,0,.78), 0 0 18px rgba(212,175,55,.10), inset 0 2px 0 rgba(255,255,255,.06)}
.ch{margin:0 0 8px;font-weight:950;letter-spacing:.2px;font-size:16px}
.cp{margin:0;color:var(--mut);line-height:1.55;display:none}
.cbox.open .cp{display:block}
.cmini{margin:0;color:rgba(255,255,255,.70);font-size:12.5px;line-height:1.45}
.cbox.open .cmini{display:none}
.cul{margin:10px 0 0 18px;padding:0;color:var(--mut2);display:none}
.cbox.open .cul{display:block}
.cul li{margin:6px 0}

/* Modal actions */
.mact{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:14px}
.sbtn{padding:12px 18px;border-radius:14px;background:linear-gradient(145deg,var(--obs2),var(--obs1));color:#fff;border:1px solid rgba(255,255,255,.08);box-shadow:0 14px 36px rgba(0,0,0,.7);cursor:pointer;font-weight:900;letter-spacing:.2px;text-decoration:none}

@media (max-width:560px){:root{--R:136px}.d{width:158px;height:158px}.stage{top:50%}}
</style>
</head>

<body>

<div class="top-left">
  <a class="btn" id="btnBack" href="/products/">BACK</a>
  <a class="btn" id="btnExit" href="/door/">EXIT</a>
</div>

<div class="brand">
  <div class="name" id="brandName">PRODUCTS</div>
  <div class="tag" id="brandTag">ENERGY · INDUSTRIAL PLASMA ARCHITECTURE</div>
</div>

<div class="stage">
  <div class="outer"></div>

  <div class="d d-n" id="dChain" role="button" tabindex="0" onclick="window.__openEnergy('chain')">
    <div class="inner"><div class="lab" id="labChain">CHAIN</div><div class="sub" id="subChain">Solar → HIP → SLA → Grid.</div></div>
  </div>
  <div class="d d-e" id="dPlasma" role="button" tabindex="0" onclick="window.__openEnergy('plasma')">
    <div class="inner"><div class="lab" id="labPlasma">PLASMA</div><div class="sub" id="subPlasma">CC tiers · UCI · ERI.</div></div>
  </div>
  <div class="d d-s" id="dFusion" role="button" tabindex="0" onclick="window.__openEnergy('fusion')">
    <div class="inner"><div class="lab" id="labFusion">FUSION</div><div class="sub" id="subFusion">No claims · boundary framing.</div></div>
  </div>
  <div class="d d-w" id="dValidation" role="button" tabindex="0" onclick="window.__openEnergy('validation')">
    <div class="inner"><div class="lab" id="labValidation">VALIDATION</div><div class="sub" id="subValidation">SVF · CARES · DHY strict.</div></div>
  </div>

  <div class="core">◆</div>
</div>

<nav class="dock" id="dock">
  <a class="btn" id="dockHub" href="/home/">HUB</a>
  <a class="btn" id="dockTerminal" href="/index.html">TERMINAL</a>
  <a class="btn" id="dockLinks" href="/links/">LINKS</a>
  <a class="btn" id="dockProducts" href="/products/">PRODUCTS</a>
  <a class="btn" id="dockLaws" href="/laws/">LAWS</a>
  <a class="btn" id="dockGauges" href="/gauges/">GAUGES</a>
</nav>

<div class="bd" id="bd"></div>

<div class="modal" id="modal" role="dialog" aria-modal="true">
  <div class="shell">
    <div class="mhead">
      <h3 class="mtitle" id="mTitle">DETAIL</h3>
      <button class="mclose" id="mClose" aria-label="Close" type="button">✕</button>
    </div>

    <div class="mbody">
      <div class="lensbar">
        <button class="chip" id="styleChip" type="button">STYLE: FORMAL</button>
        <button class="chip" data-time="origin" id="chipConcept" type="button">CONCEPT</button>
        <button class="chip" data-time="now" id="chipLive" type="button">LIVE</button>
        <button class="chip" data-time="post" id="chipRoadmap" type="button">ROADMAP</button>
      </div>

      <!-- category bubbles: tap to expand -->
      <div class="mgrid" id="mgrid">
        <div class="cbox" id="c1" role="button" tabindex="0"><h4 class="ch" id="h1"></h4><p class="cmini" id="m1"></p><p class="cp" id="p1"></p><ul class="cul" id="u1"></ul></div>
        <div class="cbox" id="c2" role="button" tabindex="0"><h4 class="ch" id="h2"></h4><p class="cmini" id="m2"></p><p class="cp" id="p2"></p><ul class="cul" id="u2"></ul></div>
        <div class="cbox" id="c3" role="button" tabindex="0"><h4 class="ch" id="h3"></h4><p class="cmini" id="m3"></p><p class="cp" id="p3"></p><ul class="cul" id="u3"></ul></div>
        <div class="cbox" id="c4" role="button" tabindex="0"><h4 class="ch" id="h4"></h4><p class="cmini" id="m4"></p><p class="cp" id="p4"></p><ul class="cul" id="u4"></ul></div>
      </div>

      <div class="mact">
        <button class="sbtn" id="mReturn" type="button">RETURN</button>
        <a class="sbtn" id="mJumpProducts" href="/products/">JUMP PRODUCTS</a>
        <a class="sbtn" id="mJumpHub" href="/home/">JUMP HUB</a>
      </div>
    </div>
  </div>
</div>

<script>
(function(){
  // ===== State hydration (gd_* only) =====
  const qs = new URLSearchParams(location.search);
  let lang  = qs.get("lang")  || localStorage.getItem("gd_lang")  || "en";
  let style = qs.get("style") || localStorage.getItem("gd_style") || "formal";
  let time  = qs.get("time")  || localStorage.getItem("gd_time")  || "now";
  if(!["en","zh"].includes(lang)) lang="en";
  if(!["formal","informal"].includes(style)) style="formal";
  if(time==="trajectory") time="post";
  if(!["origin","now","post"].includes(time)) time="now";
  try{ localStorage.setItem("gd_lang",lang); localStorage.setItem("gd_style",style); localStorage.setItem("gd_time",time); }catch(e){}
  document.documentElement.lang = (lang==="zh") ? "zh" : "en";

  const q = () => `lang=${encodeURIComponent(lang)}&style=${encodeURIComponent(style)}&time=${encodeURIComponent(time)}`;
  function setLinks(){
    const s=q();
    document.getElementById("btnBack").href="/products/?"+s;
    document.getElementById("btnExit").href="/door/?"+s;
    document.getElementById("dockHub").href="/home/?"+s;
    document.getElementById("dockTerminal").href="/index.html?"+s;
    document.getElementById("dockLinks").href="/links/?"+s;
    document.getElementById("dockProducts").href="/products/?"+s;
    document.getElementById("dockLaws").href="/laws/?"+s;
    document.getElementById("dockGauges").href="/gauges/?"+s;
    document.getElementById("mJumpProducts").href="/products/?"+s;
    document.getElementById("mJumpHub").href="/home/?"+s;
  }
  setLinks();

  // ===== UI text =====
  const UI = {
    en:{
      brand:"PRODUCTS",
      tag:"ENERGY · INDUSTRIAL PLASMA ARCHITECTURE",
      d:{
        chain:{lab:"CHAIN", sub:"Solar → HIP → SLA → Grid."},
        plasma:{lab:"PLASMA", sub:"CC tiers · UCI · ERI."},
        fusion:{lab:"FUSION", sub:"No claims · boundary framing."},
        validation:{lab:"VALIDATION", sub:"SVF · CARES · DHY strict."}
      },
      lens:{formal:"FORMAL",informal:"INFORMAL",concept:"CONCEPT",live:"LIVE",roadmap:"ROADMAP"},
      btn:{ret:"RETURN",jp:"JUMP PRODUCTS",jh:"JUMP HUB"},
      stylePrefix:"STYLE: "
    },
    zh:{
      brand:"产品",
      tag:"能源 · 工业等离子架构",
      d:{
        chain:{lab:"链路", sub:"太阳 → HIP → SLA → 电网。"},
        plasma:{lab:"等离子", sub:"CC 分级 · UCI · ERI。"},
        fusion:{lab:"聚变", sub:"无主张 · 边界框架。"},
        validation:{lab:"验证", sub:"SVF · CARES · DHY 严格。"}
      },
      lens:{formal:"正式",informal:"通俗",concept:"概念",live:"上线",roadmap:"路线图"},
      btn:{ret:"返回",jp:"跳转产品",jh:"跳转枢纽"},
      stylePrefix:"风格："
    }
  };
  const ui = (lang==="zh") ? UI.zh : UI.en;

  document.getElementById("brandName").textContent = ui.brand;
  document.getElementById("brandTag").textContent = ui.tag;

  document.getElementById("labChain").textContent = ui.d.chain.lab;
  document.getElementById("subChain").textContent = ui.d.chain.sub;
  document.getElementById("labPlasma").textContent = ui.d.plasma.lab;
  document.getElementById("subPlasma").textContent = ui.d.plasma.sub;
  document.getElementById("labFusion").textContent = ui.d.fusion.lab;
  document.getElementById("subFusion").textContent = ui.d.fusion.sub;
  document.getElementById("labValidation").textContent = ui.d.validation.lab;
  document.getElementById("subValidation").textContent = ui.d.validation.sub;

  // ===== Modal refs =====
  const bd=document.getElementById("bd");
  const modal=document.getElementById("modal");
  const mClose=document.getElementById("mClose");
  const mTitle=document.getElementById("mTitle");
  const styleChip=document.getElementById("styleChip");
  const chipConcept=document.getElementById("chipConcept");
  const chipLive=document.getElementById("chipLive");
  const chipRoadmap=document.getElementById("chipRoadmap");

  const c1=document.getElementById("c1"),c2=document.getElementById("c2"),c3=document.getElementById("c3"),c4=document.getElementById("c4");
  const h1=document.getElementById("h1"),p1=document.getElementById("p1"),u1=document.getElementById("u1"),m1=document.getElementById("m1");
  const h2=document.getElementById("h2"),p2=document.getElementById("p2"),u2=document.getElementById("u2"),m2=document.getElementById("m2");
  const h3=document.getElementById("h3"),p3=document.getElementById("p3"),u3=document.getElementById("u3"),m3=document.getElementById("m3");
  const h4=document.getElementById("h4"),p4=document.getElementById("p4"),u4=document.getElementById("u4"),m4=document.getElementById("m4");

  document.getElementById("mReturn").textContent = ui.btn.ret;
  document.getElementById("mJumpProducts").textContent = ui.btn.jp;
  document.getElementById("mJumpHub").textContent = ui.btn.jh;

  const persist=()=>{ try{ localStorage.setItem("gd_style",style); localStorage.setItem("gd_time",time);}catch(e){} };
  const setLensLabels=()=>{
    styleChip.textContent = ui.stylePrefix + (style==="formal" ? ui.lens.formal : ui.lens.informal);
    chipConcept.textContent = ui.lens.concept;
    chipLive.textContent = ui.lens.live;
    chipRoadmap.textContent = ui.lens.roadmap;
    chipConcept.classList.toggle("active", time==="origin");
    chipLive.classList.toggle("active", time==="now");
    chipRoadmap.classList.toggle("active", time==="post");
  };

  function fillBox(hEl,pEl,uEl,mEl,b){
    const safe = b || {h:"—",p:"—",u:["—","—","—","—"]};
    hEl.textContent = safe.h || "—";
    pEl.textContent = safe.p || "—";
    // mini line = first bullet or first sentence fragment
    const mini = (safe.u && safe.u[0]) ? safe.u[0] : (safe.p ? safe.p.slice(0,80) : "—");
    mEl.textContent = mini;
    uEl.innerHTML="";
    const arr = (safe.u && safe.u.length) ? safe.u : ["—","—","—","—"];
    for(let i=0;i<4;i++){
      const li=document.createElement("li");
      li.textContent = arr[i] || "—";
      uEl.appendChild(li);
    }
  }

  // DOTGRID binding line (referenced in Adversarial bubble; keeps Energy non-abstract)
  const DOTGRID_EN = "DOTGRID-ENERGY-HYBRID-v1 encodes state_id(0–255) as (CC tier, SLA phase, ERI tier, IDP tier). DHY strict certs gate admissibility (S1→S2→S3).";
  const DOTGRID_ZH = "DOTGRID-ENERGY-HYBRID-v1 用 state_id(0–255) 编码 (CC 分级, SLA 阶段, ERI 分级, IDP 阶段)。DHY 严格认证决定可采信（S1→S2→S3）。";

  function B(h,p,a,b,c,d){ return {h:h,p:p,u:[a,b,c,d]}; }

  // Content: Phase 1 (industrial-first, no abstract drift, no net-fusion claims)
  const EN = {
    chain:{
      origin:{
        formal:{title:"CHAIN · Concept",
          b1:B("Scientific","HIP is defined as an industrial ionized operating regime used for thermal/chemical processing. The chain is Solar → HIP → SLA buffering → industrial heat and/or buffered conversion. No net-fusion claim is asserted here.","HIP regime bounded by CC tiers.","Loss channels tracked per stage.","UCI governs stability thresholds.","EDT tiers map failure envelope magnitude."),
          b2:B("Industrial / Grid","PFM is upstream-only hardened infrastructure. Scaling follows IDP-1→IDP-4 with no grid shock: industrial heat first, buffered injection second, replication third.","IDP-1: single hardened PFM.","IDP-2: 5–20 PFMs + SLA reservoirs.","IDP-3: industrial adjacency sectors.","IDP-4: replication via CC underwriting."),
          b3:B("Agricultural / Plasma Farms","Plasma farms are co-located deployments: rectilinear layout, setback from residential zones, plasma isolated from soil (midstream thermal exchange only). TGI routes thermal gradients to greenhouses/soil buffers.","500m setback minimum.","No plasma–soil contact.","TGI midstream heat reuse.","Revenue stacking + SLA smoothing."),
          b4:B("Adversarial Validation","SVF + CARES define admissibility. Any multi-sensor disagreement is a kill. Any policy violation forces R3 rollover; no degraded states. Evidence is hash-linked and audited.","Kill: confinement breach / ERI spike.","Disproof: net-negative SLA under declared conditions.","Artifact suppression required (SVF).",DOTGRID_EN)
        },
        informal:{title:"CHAIN · Concept (Plain)",
          b1:B("Science (Plain)","Think: controlled industrial plasma used for clean heat and processing. We buffer it with SLA before anything touches the grid. This is not a fusion claim.","CC tiers keep it bounded.","UCI enforces control rules.","EDT tells intensity vs risk.","Loss is tracked, not ignored."),
          b2:B("Industrial (Plain)","We scale in phases so nothing gets shocked. One module, then clusters, then industrial adjacency, then replication with underwriting.","Pilot first.","Cluster second.","Industry third.","Replication last."),
          b3:B("Agriculture (Plain)","Farm sites use heat exchange only. Plasma stays inside hardened PFMs. TGI routes heat to useful farming endpoints.","No soil contact.","Setback enforced.","Heat reuse.","SLA smooths seasons."),
          b4:B("Adversarial (Plain)","We assume it’s wrong until tests prove otherwise. If sensors disagree or risk spikes, it fails.","Disagreement kills.","ERI terminate stops operation.","Strict rollover on violations.",DOTGRID_EN)
        }
      },
      now:{
        formal:{title:"CHAIN · Live",
          b1:B("Scientific","Live means measurable variables and named failure envelopes. Testing covers stability envelopes, termination thresholds, thermal gradients, and escalation indices.","Signals: thermal/pressure/ion proxy/power ratio.","Failure modes mapped explicitly.","Termination bands contract under repeats.","Loss accounting enforced."),
          b2:B("Industrial / Grid","Industrial integration is buffered: upstream HIP remains isolated; midstream conversion smooths dispatch. PSS supervises; FCM isolates; CARES governs response.","Buffered injection only.","PSS override logs immutable.","FCM defines blast radius.","CC certification supports insurance."),
          b3:B("Agricultural / Plasma Farms","Live farm integration stays non-invasive: soil boundary is exchanger-only; livestock boundary is perimeter + isolation; TGI loops are auditable.","Soil: exchanger only.","Livestock exclusion + isolation.","Greenhouse heat reuse.","Compliance artifacts logged."),
          b4:B("Adversarial Validation","Strict windows: late events hard invalidate; missing streams invalidate roll-up; violations force R3 epoch rollover; history stays invalid.","Hard invalidation on lag.","100% roll-up requirement.","R3 rollover only recovery.",DOTGRID_EN)
        },
        informal:{title:"CHAIN · Live (Plain)",
          b1:B("Science (Plain)","Live = we can measure it, repeat it, and name what fails.","Measure first.","Repeat or disqualify.","Failures named.","Loss tracked."),
          b2:B("Industrial (Plain)","Grid sees buffered output, not raw plasma behavior.","Buffered output.","Supervised dispatch.","Contained failures.","Underwriting posture."),
          b3:B("Agriculture (Plain)","Farm sites stay heat-exchange only and audit-ready.","Setbacks.","No soil contact.","TGI heat reuse.","Logged compliance."),
          b4:B("Adversarial (Plain)","Strict means: bad data breaks the window and forces rollover.","Late invalidates.","Missing stream invalidates.","R3 rollover only.",DOTGRID_EN)
        }
      },
      post:{
        formal:{title:"CHAIN · Roadmap",
          b1:B("Scientific","Roadmap tightens SVF templates, locks binning manifests (BM), and publishes replayable evidence bundles without disclosing recipes.","SVF templates mandatory.","BM + bm_hash lock if derived.","Noise floors declared per sensor.","Replay scripts verify chains."),
          b2:B("Industrial / Grid","Roadmap formalizes underwriting-grade CC certification and global replication via manifests and certificates. Residential licensing is downstream and gated by IDP-3 proof.","CC→insurance underwriting.","Manifests lock membership.","Industrial-first posture locked.","RLM gated by IDP-3."),
          b3:B("Agricultural / Plasma Farms","Roadmap codifies global farm deployment: setbacks, exchanger-only soil boundary, thermal reuse constraints, noise/EM limits, audit checklists.","Setback manifest.","Thermal exchange manifest.","Noise/EM limits.","Environmental boundary artifacts."),
          b4:B("Adversarial Validation","DHY strict certs become the admissibility backbone. No cert issuance under low transitions; any invalidity cascades; no cross-epoch mixing.","No cert <10 transitions.","S2=100% S1.","S3=100% S2.","No cross-epoch aggregation.")
        },
        informal:{title:"CHAIN · Roadmap (Plain)",
          b1:B("Science (Plain)","Next we standardize audits: locked bins, templates, and replay.","Locked bins.","Templates.","Replayable logs.","Clear disproof."),
          b2:B("Industrial (Plain)","Next we scale via certification and underwriting; residential is gated.","Insurance-ready CC.","Replication manifests.","Industrial-first.","Residential later."),
          b3:B("Agriculture (Plain)","Next we standardize farm integration globally.","Setbacks.","Heat exchange only.","Audit checklists.","Environmental limits."),
          b4:B("Adversarial (Plain)","No cert means no claims.","No cert <10 transitions.","100% roll-up.","No cross-epoch mixing.")
        }
      }
    },

    plasma:{
      origin:{
        formal:{title:"PLASMA · Concept",
          b1:B("Scientific","HIP plasma is governed by CC tiers and UCI. ERI quantifies escalation risk; PSS executes supervisory decisions; EDT tiers bound intensity to envelope magnitude.","CC defines regime + robustness.","UCI enforces thresholds.","ERI tiers drive escalation.","PSS logs overrides."),
          b2:B("Industrial / Grid","Upstream-only plasma: PFMs are hardened and isolated; no consumer exposure. FCM defines containment actions; CARES defines tiered response.","PFM upstream-only.","FCM containment matrix.","CARES response ladder.","Insurance ties to CC."),
          b3:B("Agricultural / Plasma Farms","Farm integration uses physical separation and thermal exchange only. TGI routes gradients to useful endpoints without plasma–soil contact.","Rectilinear layout.","Setback enforced.","Exchanger-only soil boundary.","Livestock/EM/noise isolation."),
          b4:B("Adversarial Validation","SVF requires redundancy + null comparison + agreement threshold. Multi-sensor disagreement is kill. ERI terminate triggers stop + invalidation.","Kill: disagreement.","Kill: ERI terminate.","Disproof: artifact dependence.",DOTGRID_EN)
        },
        informal:{title:"PLASMA · Concept (Plain)",
          b1:B("Science (Plain)","CC tiers tell how hardened it is. UCI enforces rules. ERI tells when to stop. PSS logs what happened.","CC = tier.","UCI = control.","ERI = risk.","PSS = supervisor."),
          b2:B("Industrial (Plain)","Plasma stays upstream-only and contained.","Upstream-only.","Contained failures.","CARES enforced.","No consumer exposure."),
          b3:B("Agriculture (Plain)","Farm sites use heat exchange only.","No soil contact.","Setbacks.","Heat reuse.","Audit-ready."),
          b4:B("Adversarial (Plain)","If sensors disagree, it fails.","SVF required.","Disagreement kills.","ERI terminate stops.",DOTGRID_EN)
        }
      },
      now:{
        formal:{title:"PLASMA · Live",
          b1:B("Scientific","Live testing is envelope-first: stability domains, termination thresholds, and escalation indices are measured and tightened under repeats.","Multi-channel redundancy.","Cross-sensor agreement.","Anomaly flagging.","Termination band contraction."),
          b2:B("Industrial / Grid","Buffered integration is enforced: upstream HIP isolated; dispatch smoothing supervised; overrides logged; containment boundaries explicit.","Buffered conversion.","Supervisory smoothing.","Logged overrides.","FCM isolation."),
          b3:B("Agricultural / Plasma Farms","Live farm posture enforces: exchanger-only soil boundary, perimeter exclusion, and auditable thermal reuse via TGI.","Soil exchanger-only.","Hard perimeter.","TGI heat reuse.","Compliance artifacts logged."),
          b4:B("Adversarial Validation","Strict: repeat instability under fixed params is disproof; artifacts disqualify; late events invalidate windows.","Disproof: repeat instability.","Disproof: artifact dependence.","Lag invalidates.","R3 rollover on violation.")
        },
        informal:{title:"PLASMA · Live (Plain)",
          b1:B("Science (Plain)","We measure stability and tighten kills when it repeats.","Redundant sensors.","Agreement required.","Flags.","Tighten kills."),
          b2:B("Industrial (Plain)","Grid only sees buffered output.","Buffered.","Supervised.","Contained.","Logged."),
          b3:B("Agriculture (Plain)","Heat exchange only; audited.","No soil.","Perimeter.","Reuse.","Logs."),
          b4:B("Adversarial (Plain)","Strict disproof rules apply.","Repeat instability fails.","Artifacts fail.","Late invalidates.","R3 rollover.")
        }
      },
      post:{
        formal:{title:"PLASMA · Roadmap (Scaling)",
          b1:B("Scientific","Roadmap publishes observer-invariant markers via locked BM and expands SVF templates. Kill conditions become tiered per CC and enforced by policy.","BM locked (if derived).","SVF templates mandatory.","Kill per CC tier.","Policy enforcement required."),
          b2:B("Industrial / Grid","Roadmap makes CC certification underwriting-grade and ties enforcement to DHY strict. Any policy violation forces R3 rollover; no cross-epoch mixing.","CC underwriting.","Strict enforcement.","R3 rollover.","No cross-epoch."),
          b3:B("Agricultural / Plasma Farms","Roadmap standardizes farm compliance artifacts so replication is global and auditable.","Setback rules.","Thermal exchange rules.","Noise/EM limits.","Environmental artifacts."),
          b4:B("Adversarial Validation","No certificate issuance under low transitions. 100% roll-up required. Missing stream invalidates higher scope.","No cert <10 transitions.","S2=100% S1.","S3=100% S2.","Missing stream invalidates.")
        },
        informal:{title:"PLASMA · Roadmap (Plain)",
          b1:B("Science (Plain)","We standardize markers and templates.","Markers.","Templates.","Kills.","Replay."),
          b2:B("Industrial (Plain)","Certification becomes underwriting-ready.","Insurance-ready.","Strict.","R3 rollover.","No mixing."),
          b3:B("Agriculture (Plain)","Farm integration becomes a standard.","Setbacks.","Heat exchange only.","Limits.","Artifacts."),
          b4:B("Adversarial (Plain)","No cert means no roll-up.","No cert <10.","100% required.","Missing invalidates.","Strict.")
        }
      }
    },

    fusion:{
      origin:{
        formal:{title:"FUSION · Concept (No Net Claims)",
          b1:B("Scientific","This is boundary framing only. We define what would count as ‘fusion-relevant’ conditions without asserting net fusion. Claims remain bounded and falsifiable.","No net-fusion claim.","Criteria framing only.","Loss competition acknowledged.","Disproof conditions explicit."),
          b2:B("Industrial / Grid","Industrial heat decarbonization + grid stabilization remains primary. Any tightening toward higher regimes remains upstream-only, buffered, and supervised.","Industrial-first posture.","Grid stabilization layer.","Upstream-only higher regimes.","No baseload shock."),
          b3:B("Agricultural / Plasma Farms","Farm deployments remain modular and buffered. No soil contact ever; only midstream thermal exchange. Higher tiers increase isolation rather than exposure.","Isolation increases with tier.","No soil contact.","Midstream exchanger only.","Setbacks enforced."),
          b4:B("Adversarial Validation","Any ‘fusion relevance’ claim requires SVF multi-channel confirmation + DHY strict certs. Artifact dependence and non-repeatability are disproof.","SVF required.","DHY certs required.","Artifacts disprove.","Non-repeat disprove.")
        },
        informal:{title:"FUSION · Concept (Plain)",
          b1:B("Science (Plain)","We are not claiming net fusion here. We’re defining boundaries so it stays honest.","No net claim.","Clear boundaries.","Clear disproof.","No hype."),
          b2:B("Industrial (Plain)","Industrial output first; grid buffered.","Industrial first.","Buffer the grid.","Upstream only.","No shock."),
          b3:B("Agriculture (Plain)","Farm integration stays heat-exchange only.","No soil contact.","Setbacks.","Heat reuse.","Safety."),
          b4:B("Adversarial (Plain)","No cert = no claim.","SVF + certs.","Artifacts kill.","Repeat required.","Strict.")
        }
      },
      now:{
        formal:{title:"FUSION · Live (No Claims)",
          b1:B("Scientific","Live posture publishes signals and falsifiers without thresholds or recipes. Any tightening remains labeled R&D and is audited under strict doctrine.","Bounded language.","No thresholds published.","No recipes.","Falsifiers listed."),
          b2:B("Industrial / Grid","Live industrial posture is stable output + buffering. PSS supervises dispatch; FCM isolates; CARES governs escalation.","Buffered conversion.","PSS supervision.","FCM containment.","CARES response."),
          b3:B("Agricultural / Plasma Farms","Live farm posture: setbacks + exchanger-only boundary + auditable thermal reuse.","Setbacks verified.","Exchanger-only verified.","TGI reuse.","Compliance logged."),
          b4:B("Adversarial Validation","Strict windows: late invalidates; missing stream invalidates; R3 rollover on violation; historical invalidity permanent.","Late invalidates.","Missing invalidates.","R3 rollover.","No cross-epoch.")
        },
        informal:{title:"FUSION · Live (Plain)",
          b1:B("Science (Plain)","We list what would prove/disprove, not promises.","Bounded wording.","No secret numbers.","Disproof first.","No hype."),
          b2:B("Industrial (Plain)","Stable industrial output first.","Heat + buffer.","Supervised.","Contained.","Logged."),
          b3:B("Agriculture (Plain)","Safe farm integration.","Setbacks.","No soil.","Reuse.","Audit."),
          b4:B("Adversarial (Plain)","Strict validity rules apply.","Late invalidates.","Missing invalidates.","R3 rollover.","Strict.")
        }
      },
      post:{
        formal:{title:"FUSION · Roadmap (Tightening Without Overclaim)",
          b1:B("Scientific","Roadmap defines falsifiable steps (not timelines). Each step binds to SVF and DHY certificates and includes explicit disproof and kill conditions.","Steps not timelines.","Falsifiers required.","Kill conditions required.","No hype."),
          b2:B("Industrial / Grid","Roadmap preserves coexistence posture: industrial heat + stabilization remain primary; any higher-tier work remains upstream-only and audited.","Coexistence posture locked.","Industrial primary.","Upstream-only tightening.","Audit bundles."),
          b3:B("Agricultural / Plasma Farms","Roadmap scales farm deployments via standards and keeps residential endpoints passive-only under RLM gating.","Farm standards.","Exchanger-only.","RLM gating.","Passive-only endpoints."),
          b4:B("Adversarial Validation","No cert <10 transitions. No aggregation without VALID certs. 100% roll-up required.","No cert <10.","No agg without cert.","100% roll-up.","Strict.")
        },
        informal:{title:"FUSION · Roadmap (Plain)",
          b1:B("Science (Plain)","Next steps are tests, not promises.","Test steps.","Disproof first.","Clear kills.","No timelines."),
          b2:B("Industrial (Plain)","Industrial and stability stays first.","Stabilize.","Decarbonize heat.","Audit.","Coexist."),
          b3:B("Agriculture (Plain)","Farm scaling stays standardized and safe.","Standards.","No soil.","Reuse.","Gated licensing."),
          b4:B("Adversarial (Plain)","No cert means no claim.","No cert <10.","100% required.","Strict.","No mixing.")
        }
      }
    },

    validation:{
      origin:{
        formal:{title:"VALIDATION · SVF / CARES / DHY (Concept)",
          b1:B("Scientific","SVF is multi-channel verification: null-channel comparison, cross-sensor agreement threshold, and artifact suppression. Artifact-dependent confirmation is disqualified.","Null comparison.","Redundant sensors.","Agreement threshold.","Artifacts disqualify."),
          b2:B("Industrial / Grid","Industrial validation includes third-party instrumentation review, environmental compliance audit, and insurance verification tied to CC certification.","Third-party review.","Env audit.","Insurance verification.","CC certification artifacts."),
          b3:B("Agricultural / Plasma Farms","Farm validation enforces exchanger-only soil boundary, perimeter exclusion, and noise/EM isolation standards. TGI heat reuse is logged midstream-only.","No soil contact.","Perimeter enforced.","Noise/EM limits.","TGI midstream logging."),
          b4:B("Adversarial Validation","DHY strict: ABM/BM/WRM locks + SHA-256 chain + binary certs + R3 recovery only. UI relaxation is display-only and triggers logged override + SEGMENT_BREAK.","Strict hashes.","Binary certs.","R3 recovery only.",DOTGRID_EN)
        },
        informal:{title:"VALIDATION · Concept (Plain)",
          b1:B("Science (Plain)","We don’t trust one sensor.","Null comparison.","Redundant sensors.","Agreement required.","Artifacts fail."),
          b2:B("Industrial (Plain)","Industrial proof includes audits and insurance posture.","Review.","Compliance.","Insurance.","Artifacts."),
          b3:B("Agriculture (Plain)","Farm proof is boundary + logs.","No soil.","Perimeter.","Limits.","Logs."),
          b4:B("Adversarial (Plain)","DHY is strict; UI can’t change it.","Strict.","Logged overrides.","SEGMENT_BREAK.","R3 only.")
        }
      },
      now:{
        formal:{title:"VALIDATION · Live Strict",
          b1:B("Scientific","Noise floors are declared per sensor; anomaly flags are logged; disagreement is kill; repeat instability is disproof. Low-data windows issue no certs.","Noise floors.","Anomaly flags.","Disagreement kills.","Repeat fails."),
          b2:B("Industrial / Grid","IDP tier is tracked; group membership locked; expected stream count enforced; RLM gated by IDP-3 completion without catastrophic breach.","IDP tracked.","Membership locked.","Counts enforced.","RLM gated."),
          b3:B("Agricultural / Plasma Farms","Setbacks, perimeter, exchanger-only boundary and compliance artifacts are verified under strict windows.","Setbacks verified.","Perimeter verified.","Exchanger-only verified.","Compliance logged."),
          b4:B("Adversarial Validation","Late events hard invalidate. 100% roll-up required. No cross-epoch aggregation. Policy violations force R3 rollover.","Late invalidates.","100% roll-up.","No cross-epoch.","R3 rollover.")
        },
        informal:{title:"VALIDATION · Live (Plain)",
          b1:B("Science (Plain)","If it can’t repeat or sensors disagree, it fails.","Repeat required.","Disagreement kills.","Noise floors.","No cert <10."),
          b2:B("Industrial (Plain)","Industrial first; licensing gated.","Counts enforced.","Membership locked.","IDP gated.","RLM gated."),
          b3:B("Agriculture (Plain)","Boundaries are audited.","Setbacks.","No soil.","Perimeter.","Compliance."),
          b4:B("Adversarial (Plain)","Strict roll-up.","Late invalidates.","100% required.","R3 rollover.","No mixing.")
        }
      },
      post:{
        formal:{title:"VALIDATION · Roadmap (Audit Backbone)",
          b1:B("Scientific","Publish SVF templates, BM manifests, and replay scripts so evidence can be recomputed independently under canonical JSON v1 + SHA-256.","SVF templates.","BM manifests.","Replay scripts.","Canonical hashes."),
          b2:B("Industrial / Grid","Produce underwriting-grade artifacts: CC certification, manifest hashes, certificate ledger, and permanent audit trails.","CC cert.","Manifests.","Cert ledger.","Audit trails."),
          b3:B("Agricultural / Plasma Farms","Publish compliance artifacts for global replication: setbacks, thermal exchange constraints, noise/EM limits, soil/water boundaries.","Setbacks.","Exchange constraints.","Noise/EM.","Soil/water."),
          b4:B("Adversarial Validation","Codify red-team threat model: semantic drift, bin drift, tampering, laundering, window slicing, late insertion, artifact masking, exception abuse—enforced by strict controls.","ABM/BM/WRM locks.","Hash chains.","Manifests.","Strict certs.")
        },
        informal:{title:"VALIDATION · Roadmap (Plain)",
          b1:B("Science (Plain)","Make audits easy and repeatable.","Templates.","Locked bins.","Replay.","Hashes."),
          b2:B("Industrial (Plain)","Make insurance and regulators comfortable.","Certs.","Ledger.","Trails.","Artifacts."),
          b3:B("Agriculture (Plain)","Standardize compliance globally.","Setbacks.","Limits.","Boundaries.","Artifacts."),
          b4:B("Adversarial (Plain)","Publish the attack model and enforce it.","No drift.","No tamper.","No laundering.","Strict.")
        }
      }
    }
  };

  // ZH mirrors EN for now (single-language render still holds)
  const ZH = { chain:EN.chain, plasma:EN.plasma, fusion:EN.fusion, validation:EN.validation };
  const CONTENT = (lang==="zh") ? ZH : EN;

  const FALLBACK = {
    title:(lang==="zh")?"缺少内容":"Missing content",
    b1:{h:(lang==="zh")?"提示":"Notice",p:(lang==="zh")?"该视图内容尚未填充。":"This view is not populated yet.",u:["OK","OK","OK","OK"]},
    b2:{h:(lang==="zh")?"原因":"Cause",p:(lang==="zh")?"内容键缺失。":"A content key is missing.",u:["OK","OK","OK","OK"]},
    b3:{h:(lang==="zh")?"动作":"Action",p:(lang==="zh")?"模态会打开；稍后补充内容。":"Modal opens; fill content later.",u:["OK","OK","OK","OK"]},
    b4:{h:(lang==="zh")?"规则":"Rule",p:(lang==="zh")?"不允许静默失败。":"No silent failures allowed.",u:["OK","OK","OK","OK"]}
  };

  let activeKey=null;
  let openIdx=1; // which category bubble is expanded (1..4)

  function setOpen(idx){
    openIdx=idx;
    [c1,c2,c3,c4].forEach((el,i)=>el.classList.toggle("open",(i+1)===openIdx));
  }

  function render(){
    persist(); setLinks(); setLensLabels();
    if(!activeKey) return;
    const view = ((((CONTENT[activeKey]||{})[time]||{})[style]) || FALLBACK);

    mTitle.textContent = view.title || FALLBACK.title;

    fillBox(h1,p1,u1,m1,view.b1||FALLBACK.b1);
    fillBox(h2,p2,u2,m2,view.b2||FALLBACK.b2);
    fillBox(h3,p3,u3,m3,view.b3||FALLBACK.b3);
    fillBox(h4,p4,u4,m4,view.b4||FALLBACK.b4);

    // ensure open bubble is visible
    setOpen(openIdx);
  }

  function openModal(key){
    activeKey=key;
    bd.classList.add("show");
    modal.classList.add("show");
    // default open bubble = 1 (Scientific) on open
    openIdx=1;
    render();
  }

  function closeModal(){
    bd.classList.remove("show");
    modal.classList.remove("show");
    activeKey=null;
  }

  window.__openEnergy=function(key){ openModal(key); };

  // Lens buttons
  styleChip.addEventListener("click", ()=>{ style=(style==="formal")?"informal":"formal"; render(); });
  chipConcept.addEventListener("click", ()=>{ time="origin"; render(); });
  chipLive.addEventListener("click", ()=>{ time="now"; render(); });
  chipRoadmap.addEventListener("click", ()=>{ time="post"; render(); });

  // Close buttons
  bd.addEventListener("click", closeModal);
  mClose.addEventListener("click", closeModal);
  document.getElementById("mReturn").addEventListener("click", closeModal);

  // Category bubble clicks
  function bindBubble(el,idx){
    el.addEventListener("click", ()=>{ setOpen(idx); });
    el.addEventListener("keydown",(e)=>{ if(e.key==="Enter"||e.key===" "){ e.preventDefault(); setOpen(idx);} });
  }
  bindBubble(c1,1); bindBubble(c2,2); bindBubble(c3,3); bindBubble(c4,4);

  // Keyboard for diamonds
  [["dChain","chain"],["dPlasma","plasma"],["dFusion","fusion"],["dValidation","validation"]].forEach(pair=>{
    document.getElementById(pair[0]).addEventListener("keydown",(e)=>{
      if(e.key==="Enter"||e.key===" "){ e.preventDefault(); window.__openEnergy(pair[1]); }
    });
  });

  setLensLabels();
})();
</script>

</body>
</html>

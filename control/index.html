<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Geodiametrics · Control</title>
<link rel="stylesheet" href="/assets/style.css">
<script defer src="/assets/capture.js"></script>
</head>
<body>
<main class="page">

<header class="card">
  <h1>Control</h1>
  <p class="muted">Read-only global and device gauges.</p>
  <nav class="nav">
    <a href="/">Home</a>
    <a href="/control/">Control</a>
    <a href="/system/">Reference</a>
    <a href="/artifacts/">Artifacts</a>
    <a href="/problem/">Problem</a>
    <a href="/execution/">Execution</a>
  </nav>
</header>

<section class="card">
  <h3>Global (Worker)</h3>
  <div class="metric-value" id="g">Loading…</div>
  <div class="muted" id="gmeta">—</div>
</section>

<section class="card">
  <h3>Device (This browser)</h3>
  <div class="metric-value" id="d">Loading…</div>
  <div class="muted" id="dmeta">—</div>
</section>

<footer class="muted">© 2026 Geodiametrics</footer>

</main>

<script>
(async ()=>{
  const BASE="https://geodiametrics-aggregator.smansfield635.workers.dev";
  try{
    const r=await fetch(BASE+"/metrics?t="+Date.now(),{cache:"no-store"});
    const j=await r.json(); const m=j.metrics||{};
    document.getElementById("g").textContent =
      `Sessions ${m.sessions||0} · Pageviews ${m.pageviews||0} · Clicks ${m.clicks||0}`;
    document.getElementById("gmeta").textContent =
      m.lastUpdated ? new Date(m.lastUpdated).toLocaleString() : "—";
  }catch(e){
    document.getElementById("g").textContent="Unavailable";
  }
  try{
    const d=JSON.parse(localStorage.getItem("geo_live_site")||"{}");
    const s=d.interaction||{};
    document.getElementById("d").textContent =
      `Sessions ${s.sessions_24h||0} · Pageviews ${s.pageviews_24h||0} · Clicks ${s.clicks_24h||0}`;
    document.getElementById("dmeta").textContent=d.timestamp||"—";
  }catch(e){
    document.getElementById("d").textContent="Unavailable";
  }
})();
</script>
</body>
</html>

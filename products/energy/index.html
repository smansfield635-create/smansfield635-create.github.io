<!-- TNT — /products/energy/index.html  (PRODUCTS · ENERGY · BRANCH-PILOT · GEOMETRY LOCKED)
     GOAL:
       - PERFECT this design as the template for other branches
       - Keep the OUTER diamond geometry (single set on the page)
       - Keep N/S/E/W UNDER THE HOOD only (inside modal after click)
       - Inside modal: 8 opal bubble tabs (no inner diamonds; no stacking geometry)
       - Each tab drives one elastic content panel (headline + paragraph + 4 bullets)
       - Lenses inside modal only: STYLE (formal/informal) + TIME (concept/live/roadmap)
     RULES:
       - NO new state keys (gd_lang/gd_style/gd_time only)
       - Single-language render (lang=en => EN only; lang=zh => 中文 only; 中文为镜像占位)
       - Uses /assets/ui.css + /assets/branch.css only
       - DOES NOT style html/body background (ui.css owns field)
       - Industrial (C) posture preserved; no net-positive fusion claim language
-->

<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>PRODUCTS · ENERGY</title>

<link rel="stylesheet" href="/assets/ui.css"/>
<link rel="stylesheet" href="/assets/branch.css"/>

<style>
:root{
  --R:154px;
  --goldSoft:rgba(212,175,55,.35);
  --goldHard:rgba(212,175,55,.62);
  --obs1:#070b12;
  --obs2:#0c1626;
  --mut:rgba(255,255,255,.84);
  --mut2:rgba(255,255,255,.70);
}

/* Top-left */
.top-left{
  position:fixed; left:16px; top:16px; z-index:90;
  display:flex; gap:10px; flex-wrap:wrap; align-items:center;
}
.btn{
  padding:10px 16px; border-radius:14px;
  background:linear-gradient(145deg,var(--obs2),var(--obs1));
  color:#fff; border:1px solid rgba(255,255,255,.08);
  box-shadow:0 14px 36px rgba(0,0,0,.7);
  cursor:pointer; font-weight:900; letter-spacing:.2px; text-decoration:none;
  -webkit-tap-highlight-color:transparent;
}
.btn:hover{ box-shadow:0 18px 50px rgba(0,0,0,.9), 0 0 14px var(--goldSoft); }

/* Brand pill */
.brand{
  position:fixed; left:50%; top:16px; transform:translateX(-50%);
  z-index:80; text-align:center;
  padding:10px 14px; border-radius:999px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(0,0,0,.16); backdrop-filter:blur(8px);
}
.brand .name{ font-weight:950; letter-spacing:1.2px; font-size:12px; opacity:.95; }
.brand .tag{ font-size:11px; letter-spacing:.6px; opacity:.70; margin-top:2px; }

/* Stage */
.stage{
  position:fixed; left:50%; top:52%;
  transform:translate(-50%,-50%);
  width:min(720px,94vw); height:min(720px,94vw);
  z-index:40;
  pointer-events:none;
}
.outer{
  position:absolute; left:50%; top:50%;
  width:min(680px,92vw); height:min(680px,92vw);
  transform:translate(-50%,-50%) rotate(45deg);
  border-radius:60px;
  background:
    radial-gradient(circle at 30% 25%, rgba(255,255,255,.08), transparent 55%),
    radial-gradient(circle at 70% 80%, rgba(0,80,255,.14), transparent 60%),
    linear-gradient(160deg, rgba(14,24,40,.45) 0%, rgba(7,11,18,.62) 70%);
  border:1px solid rgba(255,255,255,.10);
  box-shadow:
    0 90px 260px rgba(0,0,0,.72),
    inset 0 2px 0 rgba(255,255,255,.10),
    inset 0 -50px 90px rgba(0,0,0,.55);
  pointer-events:none; opacity:.85;
}
.outer::after{
  content:""; position:absolute; inset:0; border-radius:60px;
  background:repeating-conic-gradient(from 0deg, rgba(255,255,255,.04) 0deg 6deg, transparent 6deg 18deg);
  opacity:.16; pointer-events:none;
}
.d{
  width:170px; height:170px;
  position:absolute; left:50%; top:50%;
  transform-origin:center; border-radius:26px;
  cursor:pointer; -webkit-tap-highlight-color:transparent;
  background:
    radial-gradient(circle at 35% 25%, rgba(255,255,255,.14), transparent 55%),
    radial-gradient(circle at 70% 80%, rgba(0,80,255,.18), transparent 60%),
    linear-gradient(160deg, rgba(12,22,38,.92) 0%, rgba(7,11,18,.95) 70%);
  border:1px solid rgba(255,255,255,.10);
  box-shadow:
    0 28px 84px rgba(0,0,0,.78),
    inset 0 2px 0 rgba(255,255,255,.14),
    inset 0 -28px 44px rgba(0,0,0,.62);
  transition:transform 220ms ease, box-shadow 220ms ease, border-color 220ms ease;
  pointer-events:auto;
  touch-action:manipulation;
}
.d::before{
  content:""; position:absolute; inset:0; border-radius:26px; padding:1px;
  background:linear-gradient(120deg, transparent 0%, var(--goldSoft) 50%, transparent 100%);
  opacity:.45;
  -webkit-mask:linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  -webkit-mask-composite:xor; mask-composite:exclude;
  pointer-events:none;
}
.d::after{
  content:""; position:absolute; left:12%; right:12%; top:10%; height:28%;
  border-radius:999px;
  background:linear-gradient(to bottom, rgba(255,255,255,.16), rgba(255,255,255,0));
  opacity:.85; transform:rotate(-10deg);
  pointer-events:none;
}
.d:hover{ transform:translate(-50%,-50%) rotate(45deg) scale(1.02); }
.d.active{
  border-color:rgba(212,175,55,.55);
  box-shadow:
    0 34px 110px rgba(0,0,0,.88),
    0 0 30px rgba(212,175,55,.40),
    inset 0 2px 0 rgba(255,255,255,.18),
    inset 0 -32px 52px rgba(0,0,0,.68);
}
.d-n{ transform:translate(-50%,-50%) translate(0, calc(var(--R) * -1)) rotate(45deg); }
.d-e{ transform:translate(-50%,-50%) translate(var(--R), 0) rotate(45deg); }
.d-s{ transform:translate(-50%,-50%) translate(0, var(--R)) rotate(45deg); }
.d-w{ transform:translate(-50%,-50%) translate(calc(var(--R) * -1), 0) rotate(45deg); }

.inner{
  width:100%; height:100%; transform:rotate(-45deg);
  display:flex; flex-direction:column; align-items:center; justify-content:center;
  text-align:center; padding:16px; gap:10px;
  pointer-events:none; user-select:none;
}
.lab{ font-weight:950; letter-spacing:.8px; font-size:16px; }
.sub{ font-size:12.5px; opacity:.80; line-height:1.35; max-width:18em; }

.core{
  position:absolute; left:50%; top:50%;
  transform:translate(-50%,-50%);
  width:74px; height:74px; border-radius:22px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(0,0,0,.18);
  box-shadow:0 18px 44px rgba(0,0,0,.62), inset 0 2px 0 rgba(255,255,255,.10);
  display:grid; place-items:center;
  font-weight:950; letter-spacing:.5px;
  opacity:.92; pointer-events:none;
}

/* Dock */
.dock{
  position:fixed; left:50%;
  bottom:max(12px, env(safe-area-inset-bottom));
  transform:translateX(-50%);
  z-index:90;
  width:min(900px,94vw);
  display:flex; justify-content:center;
  gap:10px; flex-wrap:wrap;
  padding:10px 12px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(0,0,0,.20);
  backdrop-filter:blur(8px);
  pointer-events:none;
}
.dock .btn{ pointer-events:auto; }

/* Modal */
.bd{
  position:fixed; inset:0; z-index:200;
  background:rgba(0,0,0,.65);
  backdrop-filter:blur(10px);
  display:none;
}
.bd.show{display:block;}
.modal{
  position:fixed; left:50%; top:50%;
  transform:translate(-50%,-50%);
  width:min(1020px,94vw);
  max-height:88vh;
  display:none;
  z-index:210;
}
.modal.show{display:block;}
.shell{
  height:88vh;
  border-radius:26px;
  border:1px solid rgba(255,255,255,.10);
  background:
    radial-gradient(circle at 50% 18%, rgba(176,0,0,.20), transparent 55%),
    radial-gradient(circle at 40% 25%, rgba(90,140,255,.12), transparent 55%),
    linear-gradient(160deg,var(--obs2) 0%, var(--obs1) 65%);
  box-shadow:0 60px 180px rgba(0,0,0,.92);
  overflow:hidden;
  display:flex;
  flex-direction:column;
}
.mhead{
  display:flex; justify-content:space-between; align-items:center;
  gap:10px; padding:14px 16px;
  border-bottom:1px solid rgba(255,255,255,.08);
}
.mtitle{ margin:0; font-weight:950; letter-spacing:.3px; font-size:16px; }
.mclose{ border:0; background:transparent; color:#fff; font-size:18px; cursor:pointer; padding:8px 10px; }
.mbody{
  padding:14px 16px 18px;
  overflow:auto; -webkit-overflow-scrolling:touch;
  flex:1 1 auto;
}
.lensbar{
  display:flex; gap:10px; flex-wrap:wrap;
  align-items:center; justify-content:center;
  padding:10px 10px 14px;
  border-bottom:1px solid rgba(255,255,255,.08);
  margin:-6px -6px 14px;
}
.chip{
  padding:10px 16px; border-radius:999px;
  background:linear-gradient(145deg,var(--obs2),var(--obs1));
  border:1px solid rgba(255,255,255,.08);
  box-shadow:0 14px 36px rgba(0,0,0,.65);
  cursor:pointer; font-weight:900; letter-spacing:.2px; color:#fff;
}
.chip.active{
  border-color:rgba(212,175,55,.35);
  box-shadow:0 18px 50px rgba(0,0,0,.9), 0 0 16px rgba(212,175,55,.30);
}

/* Under-hood compass line (visible only in modal) */
.udWrap{
  display:flex;
  justify-content:center;
  margin:8px 0 12px;
}
.ud{
  width:min(820px,100%);
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  justify-content:center;
  padding:10px 12px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(0,0,0,.18);
  backdrop-filter:blur(6px);
}
.udPill{
  padding:8px 12px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.10);
  background:linear-gradient(145deg,var(--obs2),var(--obs1));
  font-weight:950;
  letter-spacing:.2px;
  font-size:11px;
  opacity:.92;
}
.udPill.active{
  border-color:var(--goldHard);
  box-shadow:0 0 14px rgba(212,175,55,.18);
}

/* 8 opal tabs */
.tabs{
  display:grid;
  grid-template-columns:repeat(4, 1fr);
  gap:10px;
  margin:0 0 12px;
}
.tab{
  padding:10px 12px;border-radius:999px;
  background:linear-gradient(145deg,var(--obs2),var(--obs1));
  border:1px solid rgba(255,255,255,.08);
  box-shadow:0 12px 30px rgba(0,0,0,.58);
  cursor:pointer;font-weight:950;letter-spacing:.25px;color:#fff;
  text-align:center;
  -webkit-tap-highlight-color:transparent;
}
.tab.active{
  border-color:rgba(212,175,55,.55);
  box-shadow:0 16px 40px rgba(0,0,0,.78),0 0 16px rgba(212,175,55,.20);
}

/* Single elastic panel */
.panel{
  border-radius:22px;
  border:1px solid rgba(255,255,255,.10);
  background:
    radial-gradient(circle at 30% 30%, rgba(120,160,255,.08), transparent 55%),
    linear-gradient(145deg, rgba(12,22,38,.92), rgba(7,11,18,.95));
  box-shadow:0 18px 60px rgba(0,0,0,.70), inset 0 2px 0 rgba(255,255,255,.06);
  padding:16px 18px;
  position:relative;
}
.panel::before{
  content:""; position:absolute; inset:0; border-radius:22px; padding:1px;
  background:linear-gradient(120deg, transparent 0%, var(--goldSoft) 50%, transparent 100%);
  opacity:.55;
  -webkit-mask:linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  -webkit-mask-composite:xor; mask-composite:exclude;
  pointer-events:none;
}
.ph{margin:0 0 8px;font-weight:950;letter-spacing:.2px}
.pp{margin:0 0 10px;color:var(--mut);line-height:1.55}
.pu{margin:0 0 0 18px;padding:0;color:var(--mut2)}
.pu li{margin:6px 0}

/* Modal actions */
.mact{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:14px}
.sbtn{
  padding:12px 18px;border-radius:14px;
  background:linear-gradient(145deg,var(--obs2),var(--obs1));
  color:#fff;border:1px solid rgba(255,255,255,.08);
  box-shadow:0 14px 36px rgba(0,0,0,.7);
  cursor:pointer;font-weight:900;letter-spacing:.2px;text-decoration:none;
}
.sbtn:hover{ box-shadow:0 18px 50px rgba(0,0,0,.9), 0 0 14px var(--goldSoft); }

@media (max-width:560px){
  :root{--R:136px}
  .d{width:158px;height:158px}
  .stage{top:54%}
  .tabs{grid-template-columns:repeat(2, 1fr)}
}
</style>
</head>

<body>

<div class="top-left">
  <a class="btn" id="btnBack" href="/products/">BACK</a>
  <a class="btn" id="btnExit" href="/door/">EXIT</a>
</div>

<div class="brand">
  <div class="name" id="brandName">PRODUCTS</div>
  <div class="tag" id="brandTag">ENERGY · INDUSTRIAL PLASMA ARCHITECTURE</div>
</div>

<div class="stage">
  <div class="outer"></div>

  <div class="d d-n" id="dNorth" role="button" tabindex="0" onclick="window.__openEnergy('north')">
    <div class="inner"><div class="lab" id="labNorth">ORIGIN</div><div class="sub" id="subNorth">Science baseline.</div></div>
  </div>

  <div class="d d-e" id="dEast" role="button" tabindex="0" onclick="window.__openEnergy('east')">
    <div class="inner"><div class="lab" id="labEast">R&D</div><div class="sub" id="subEast">Architecture build.</div></div>
  </div>

  <div class="d d-w" id="dWest" role="button" tabindex="0" onclick="window.__openEnergy('west')">
    <div class="inner"><div class="lab" id="labWest">VERIFY</div><div class="sub" id="subWest">Execution proof.</div></div>
  </div>

  <div class="d d-s" id="dSouth" role="button" tabindex="0" onclick="window.__openEnergy('south')">
    <div class="inner"><div class="lab" id="labSouth">DELIVERY</div><div class="sub" id="subSouth">Industrial (C).</div></div>
  </div>

  <div class="core">◆</div>
</div>

<nav class="dock" id="dock">
  <a class="btn" id="dockHub" href="/home/">HUB</a>
  <a class="btn" id="dockTerminal" href="/index.html">TERMINAL</a>
  <a class="btn" id="dockLinks" href="/links/">LINKS</a>
  <a class="btn" id="dockProducts" href="/products/">PRODUCTS</a>
  <a class="btn" id="dockLaws" href="/laws/">LAWS</a>
  <a class="btn" id="dockGauges" href="/gauges/">GAUGES</a>
</nav>

<div class="bd" id="bd"></div>

<div class="modal" id="modal" role="dialog" aria-modal="true">
  <div class="shell">
    <div class="mhead">
      <h3 class="mtitle" id="mTitle">DETAIL</h3>
      <button class="mclose" id="mClose" aria-label="Close" type="button">✕</button>
    </div>

    <div class="mbody">
      <div class="lensbar">
        <button class="chip" id="styleChip" type="button">STYLE: FORMAL</button>
        <button class="chip" data-time="origin" id="chipConcept" type="button">CONCEPT</button>
        <button class="chip" data-time="now" id="chipLive" type="button">LIVE</button>
        <button class="chip" data-time="post" id="chipRoadmap" type="button">ROADMAP</button>
      </div>

      <!-- Under-hood compass mapping (shown only after click) -->
      <div class="udWrap">
        <div class="ud" aria-label="Under-hood orientation">
          <div class="udPill" id="udN">NORTH · ORIGIN</div>
          <div class="udPill" id="udE">EAST · R&D</div>
          <div class="udPill" id="udW">WEST · VERIFY</div>
          <div class="udPill" id="udS">SOUTH · DELIVERY</div>
        </div>
      </div>

      <!-- 8 tabs -->
      <div class="tabs">
        <button class="tab active" id="t1" type="button">PRINCIPLE</button>
        <button class="tab" id="t2" type="button">ARCH</button>
        <button class="tab" id="t3" type="button">MECH</button>
        <button class="tab" id="t4" type="button">METRICS</button>
        <button class="tab" id="t5" type="button">CONSTRAINTS</button>
        <button class="tab" id="t6" type="button">RISK</button>
        <button class="tab" id="t7" type="button">VALIDATION</button>
        <button class="tab" id="t8" type="button">TRAJECTORY</button>
      </div>

      <div class="panel">
        <h4 class="ph" id="ph">PRINCIPLE</h4>
        <p class="pp" id="pp">Select a tab to change scope. This is depth without a tunnel.</p>
        <ul class="pu" id="pu">
          <li>One panel, one scope.</li>
          <li>Concept/Live/Roadmap changes emphasis.</li>
          <li>Formal/Informal changes phrasing.</li>
          <li>Industrial (C) remains the public posture.</li>
        </ul>
      </div>

      <div class="mact">
        <button class="sbtn" id="mReturn" type="button">RETURN</button>
        <a class="sbtn" id="mJumpProducts" href="/products/">JUMP PRODUCTS</a>
        <a class="sbtn" id="mJumpHub" href="/home/">JUMP HUB</a>
      </div>
    </div>
  </div>
</div>

<script>
(function(){
  // URL → STATE HYDRATION (gd_* only)
  const qs = new URLSearchParams(location.search);
  let lang  = qs.get("lang")  || localStorage.getItem("gd_lang")  || "en";
  let style = qs.get("style") || localStorage.getItem("gd_style") || "formal";
  let time  = qs.get("time")  || localStorage.getItem("gd_time")  || "now";
  if(!["en","zh"].includes(lang)) lang="en";
  if(!["formal","informal"].includes(style)) style="formal";
  if(time==="trajectory") time="post";
  if(!["origin","now","post"].includes(time)) time="now";
  try{ localStorage.setItem("gd_lang",lang); localStorage.setItem("gd_style",style); localStorage.setItem("gd_time",time); }catch(e){}
  document.documentElement.lang = (lang==="zh") ? "zh" : "en";

  function q(){ return "lang="+encodeURIComponent(lang)+"&style="+encodeURIComponent(style)+"&time="+encodeURIComponent(time); }

  function setLinks(){
    const s=q();
    document.getElementById("btnBack").href="/products/?"+s;
    document.getElementById("btnExit").href="/door/?"+s;
    document.getElementById("dockHub").href="/home/?"+s;
    document.getElementById("dockTerminal").href="/index.html?"+s;
    document.getElementById("dockLinks").href="/links/?"+s;
    document.getElementById("dockProducts").href="/products/?"+s;
    document.getElementById("dockLaws").href="/laws/?"+s;
    document.getElementById("dockGauges").href="/gauges/?"+s;
    document.getElementById("mJumpProducts").href="/products/?"+s;
    document.getElementById("mJumpHub").href="/home/?"+s;
  }
  setLinks();

  const bd=document.getElementById("bd");
  const modal=document.getElementById("modal");
  const mClose=document.getElementById("mClose");
  const mTitle=document.getElementById("mTitle");

  const styleChip=document.getElementById("styleChip");
  const chipConcept=document.getElementById("chipConcept");
  const chipLive=document.getElementById("chipLive");
  const chipRoadmap=document.getElementById("chipRoadmap");

  const ph=document.getElementById("ph");
  const pp=document.getElementById("pp");
  const pu=document.getElementById("pu");

  const udN=document.getElementById("udN");
  const udE=document.getElementById("udE");
  const udW=document.getElementById("udW");
  const udS=document.getElementById("udS");

  let activeAuthority="south"; // north/east/west/south
  let activeTab=1; // 1..8

  function persist(){
    try{ localStorage.setItem("gd_style",style); localStorage.setItem("gd_time",time);}catch(e){}
  }

  function setLensLabels(){
    styleChip.textContent = (lang==="zh") ? ("风格：" + (style==="formal" ? "正式" : "通俗")) : ("STYLE: " + (style==="formal" ? "FORMAL" : "INFORMAL"));
    chipConcept.textContent = (lang==="zh") ? "概念" : "CONCEPT";
    chipLive.textContent = (lang==="zh") ? "上线" : "LIVE";
    chipRoadmap.textContent = (lang==="zh") ? "路线图" : "ROADMAP";
    chipConcept.classList.toggle("active", time==="origin");
    chipLive.classList.toggle("active", time==="now");
    chipRoadmap.classList.toggle("active", time==="post");
  }
  setLensLabels();

  function setUnderHood(which){
    [udN,udE,udW,udS].forEach(x=>x.classList.remove("active"));
    (which==="north"?udN:which==="east"?udE:which==="west"?udW:udS).classList.add("active");
  }

  function setTabs(idx){
    activeTab=idx;
    for(let i=1;i<=8;i++){
      document.getElementById("t"+i).classList.toggle("active", i===idx);
    }
    renderPanel();
  }

  const TABNAME = {
    1:"PRINCIPLE",2:"ARCH",3:"MECH",4:"METRICS",5:"CONSTRAINTS",6:"RISK",7:"VALIDATION",8:"TRAJECTORY"
  };

  function make(authority, tab, t, s){
    // authoritative, concrete, non-recipe, non-claim-inflating, lens-fused
    const A = authority; const T = t; const S = s;
    const head = TABNAME[tab] + " · " + (A==="north"?"ORIGIN":A==="east"?"R&D":A==="west"?"VERIFY":"DELIVERY");

    const byTime = (T==="origin") ? "Concept: definition and scope." : (T==="now") ? "Live: current state and what is actionable." : "Roadmap: requirements and deliverables (no gain promises).";
    const byStyle = (S==="informal") ? "Plain:" : "Formal:";

    const base = { h: head, p: byStyle+" "+byTime, u: [] };

    // core content by authority
    const AText = {
      north:[
        "Physics layer defines constraints and ceilings.",
        "Loss channels are named and accounted.",
        "No net-positive fusion claim is made.",
        "Definitions remain stable and falsifiable."
      ],
      east:[
        "Build layer executes architecture changes under constraint.",
        "Gen work requires receipts before escalation.",
        "HEL-X is orchestration, not physics substitution.",
        "Design iteration remains bounded and auditable."
      ],
      west:[
        "Verify layer enforces admissibility and integrity.",
        "SVF + DHY strict prevent silent drift.",
        "Late/missing data invalidates certification.",
        "R3 rollover is the only recovery."
      ],
      south:[
        "Delivery layer is Industrial plasma thermal substitution (C).",
        "Plasma farms + buffering are the public posture.",
        "Deployment phases scale by replication (IDP).",
        "R&D remains gated and does not market-upgrade delivery."
      ]
    }[A];

    // tab-specific tightening
    const TText = {
      1:["What it is.","Why it matters.","Where it applies.","What it outputs."],
      2:["System stack.","Interfaces.","Phase ramp.","Modules."],
      3:["Operating loop.","Buffer loop.","Thermal routing.","Supervision."],
      4:["Inputs to meter.","Outputs to meter.","Stability indicators.","Scale indicators."],
      5:["Confinement class.","Energy density tier.","Boundary rules.","Claim ceiling."],
      6:["Escalation index.","Response protocol.","Containment matrix.","Kill conditions."],
      7:["Signal validation.","Telemetry integrity.","Certification roll-up.","R3 recovery."],
      8:["IDP ramp.","Licensing gate.","TV read-only.","Next receipts."]
    }[tab];

    base.u = [
      AText[0] + " " + TText[0],
      AText[1] + " " + TText[1],
      AText[2] + " " + TText[2],
      AText[3] + " " + TText[3]
    ];

    // informal squeeze
    if(S==="informal"){
      base.p = "Plain: " + ((T==="origin")?"What it means." : (T==="now")?"What’s real now." : "What must be done next.");
      base.u = base.u.map(x=>x.replace(" is "," = ").replace(" layer "," ").replace(" remain "," stay "));
    }

    // zh mirror (single-language)
    if(lang==="zh"){
      return {
        h: head,
        p: (T==="origin") ? "概念：定义与范围。" : (T==="now") ? "上线：当前状态与可执行点。" : "路线图：要求与交付物（不许夸张）。",
        u: base.u.map(x=>x) // mirror EN for now
      };
    }

    return base;
  }

  function renderPanel(){
    persist();
    setLinks();
    setLensLabels();

    const v = make(activeAuthority, activeTab, time, style);

    ph.textContent = v.h;
    pp.textContent = v.p;

    pu.innerHTML="";
    v.u.forEach(line=>{
      const li=document.createElement("li");
      li.textContent=line;
      pu.appendChild(li);
    });
  }

  function openModal(which){
    activeAuthority = which;
    setUnderHood(which);
    activeTab = 1;
    setTabs(1);

    mTitle.textContent = (lang==="zh")
      ? ("细节 · " + (which==="north"?"北":which==="east"?"东":which==="west"?"西":"南"))
      : ("DETAIL · " + (which==="north"?"NORTH":which==="east"?"EAST":which==="west"?"WEST":"SOUTH"));

    bd.classList.add("show");
    modal.classList.add("show");
    renderPanel();
  }

  function closeModal(){
    bd.classList.remove("show");
    modal.classList.remove("show");
  }

  window.__openEnergy = openModal;

  // outer diamond keyboard
  [["dNorth","north"],["dEast","east"],["dWest","west"],["dSouth","south"]].forEach(pair=>{
    document.getElementById(pair[0]).addEventListener("keydown",(e)=>{
      if(e.key==="Enter"||e.key===" "){ e.preventDefault(); window.__openEnergy(pair[1]); }
    });
  });

  // tab clicks
  for(let i=1;i<=8;i++){
    document.getElementById("t"+i).addEventListener("click", ()=>setTabs(i));
  }

  // lens controls
  styleChip.addEventListener("click", ()=>{ style=(style==="formal")?"informal":"formal"; renderPanel(); });
  chipConcept.addEventListener("click", ()=>{ time="origin"; renderPanel(); });
  chipLive.addEventListener("click", ()=>{ time="now"; renderPanel(); });
  chipRoadmap.addEventListener("click", ()=>{ time="post"; renderPanel(); });

  // close controls
  bd.addEventListener("click", closeModal);
  mClose.addEventListener("click", closeModal);
  document.getElementById("mReturn").addEventListener("click", closeModal);

  // initial labels: keep N/S/E/W under the hood, so outer labels are product-facing
  if(lang==="zh"){
    document.getElementById("brandName").textContent="产品";
    document.getElementById("brandTag").textContent="能源 · 工业等离子架构";
    document.getElementById("labNorth").textContent="起源";
    document.getElementById("subNorth").textContent="科学基线。";
    document.getElementById("labEast").textContent="研发";
    document.getElementById("subEast").textContent="架构构建。";
    document.getElementById("labWest").textContent="验证";
    document.getElementById("subWest").textContent="执行证据。";
    document.getElementById("labSouth").textContent="交付";
    document.getElementById("subSouth").textContent="工业（C）。";

    udN.textContent="北 · 起源";
    udE.textContent="东 · 研发";
    udW.textContent="西 · 验证";
    udS.textContent="南 · 交付";

    document.getElementById("t1").textContent="原则";
    document.getElementById("t2").textContent="架构";
    document.getElementById("t3").textContent="机制";
    document.getElementById("t4").textContent="指标";
    document.getElementById("t5").textContent="约束";
    document.getElementById("t6").textContent="风险";
    document.getElementById("t7").textContent="验证";
    document.getElementById("t8").textContent="轨迹";
  }
})();
</script>

</body>
</html>

<!-- TNT — /prelude/index.html
     PRELUDE · WISHBONE TOGGLE (BANNER + ENTER BUTTON)
     CHANGE (STRUCTURE/GEOMETRY ONLY):
       - Tap CLAIM / SUPPORT → shows the corresponding banner (stays visible)
       - Banner includes an ENTER button (routes to the selected index)
       - CLAIM  → /products/                (Products & Services)
       - SUPPORT→ /products/software/       (Software & Systems)
       - Preserves state: ?lang/style/time/depth + gd_* LS
       - No overlap/tap-blocking: header/panels are pointer-safe
-->

<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>PRELUDE</title>

<link rel="stylesheet" href="/assets/ui.css"/>
<link rel="stylesheet" href="/assets/branch.css"/>
<script defer src="/assets/instruments.js"></script>

<style>
a{text-decoration:none;color:inherit}

:root{
  --D:clamp(190px, 34vw, 250px);
  --R:clamp(130px, 18vw, 170px);

  --goldSoft:rgba(212,175,55,.45);
  --obsA:rgba(12,22,38,.95);
  --obsB:rgba(6,10,16,.98);
}

/* ===== TOP ===== */
.top-left{
  position:fixed;left:16px;top:16px;z-index:240;
  display:flex;gap:10px;flex-wrap:nowrap;white-space:nowrap;
}
.top-right{
  position:fixed;right:16px;top:16px;z-index:240;
  display:flex;gap:10px;flex-wrap:nowrap;white-space:nowrap;
}
.top-left .btn,.top-right .btn{white-space:nowrap}

/* ===== HEADER (never blocks taps) ===== */
.header{
  position:fixed;
  top:78px;
  left:50%;
  transform:translateX(-50%);
  text-align:center;
  z-index:220;
  pointer-events:none;
}
.header h1{margin:0;font-weight:950;font-size:38px;letter-spacing:2px}
.header p{margin-top:10px;opacity:.85;font-size:14px}

/* ===== TOGGLE BANNER (clickable) ===== */
.panelWrap{
  position:fixed;
  top:150px;
  left:50%;
  transform:translateX(-50%);
  width:min(980px,92vw);
  z-index:230;
  pointer-events:none; /* only the panel is clickable */
}
.panel{
  pointer-events:auto;
  display:none;
  border-radius:22px;
  padding:16px 16px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(0,0,0,.20);
  backdrop-filter:blur(10px);
  box-shadow:0 24px 80px rgba(0,0,0,.55);
}
.panel.show{display:block}
.panelTop{
  display:flex;
  gap:12px;
  align-items:flex-start;
  justify-content:space-between;
  flex-wrap:wrap;
}
.pTitle{
  margin:0;
  font-weight:950;
  letter-spacing:.4px;
  font-size:18px;
}
.pDesc{
  margin:10px 0 0;
  color:rgba(255,255,255,.86);
  line-height:1.45;
}
.pActions{
  display:flex;
  gap:10px;
  align-items:center;
  justify-content:flex-end;
  margin-left:auto;
}
@media (max-width:520px){
  .panelWrap{top:146px}
  .pActions{width:100%; justify-content:flex-start}
}

/* ===== STAGE ===== */
.stage{
  position:fixed;
  left:50%;
  top:56%;
  transform:translate(-50%,-50%);
  width:min(700px,94vw);
  height:420px;
  z-index:140;
}

/* ===== DIAMONDS ===== */
.d{
  width:var(--D);height:var(--D);
  position:absolute;left:50%;top:50%;
  transform-origin:center;
  border-radius:28px;
  cursor:pointer;
  -webkit-tap-highlight-color:transparent;
  touch-action:manipulation;

  background:
    radial-gradient(circle at 30% 22%, rgba(255,255,255,.55), transparent 45%),
    radial-gradient(circle at 70% 78%, rgba(0,120,255,.30), transparent 60%),
    linear-gradient(160deg, var(--obsA), var(--obsB));

  border:1px solid rgba(255,255,255,.18);

  box-shadow:
    0 38px 120px rgba(0,0,0,.85),
    0 0 30px rgba(212,175,55,.25),
    inset 0 2px 0 rgba(255,255,255,.25),
    inset 0 -42px 78px rgba(0,0,0,.80);

  transition:transform .2s ease, box-shadow .2s ease, border-color .2s ease;
}

.d::before{
  content:"";
  position:absolute;inset:0;border-radius:28px;padding:1px;
  background:linear-gradient(120deg, transparent 0%, var(--goldSoft) 50%, transparent 100%);
  opacity:.65;
  -webkit-mask:linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  -webkit-mask-composite:xor;
  mask-composite:exclude;
  pointer-events:none;
}
.d::after{
  content:"";
  position:absolute;left:12%;right:12%;top:10%;height:30%;
  border-radius:999px;
  background:linear-gradient(to bottom, rgba(255,255,255,.25), rgba(255,255,255,0));
  transform:rotate(-10deg);
  pointer-events:none;
}

.d:hover{ transform:translate(-50%,-50%) rotate(45deg) scale(1.03); }
.d:active{ transform:translate(-50%,-50%) rotate(45deg) scale(.99); }

.d-left{  transform:translate(-50%,-50%) translate(calc(var(--R)*-1),0) rotate(45deg); }
.d-right{ transform:translate(-50%,-50%) translate(var(--R),0) rotate(45deg); }

.d.active{
  border-color:rgba(212,175,55,.45);
  box-shadow:
    0 44px 140px rgba(0,0,0,.92),
    0 0 46px rgba(212,175,55,.26),
    inset 0 2px 0 rgba(255,255,255,.28),
    inset 0 -46px 86px rgba(0,0,0,.84);
}

.inner{
  transform:rotate(-45deg);
  height:100%;
  display:flex;flex-direction:column;
  align-items:center;justify-content:center;
  text-align:center;
  padding:18px;
  pointer-events:none;
}
.lab{font-weight:950;font-size:20px;letter-spacing:.6px}
.sub{margin-top:8px;font-size:13px;opacity:.85}

/* ===== FOOTER ===== */
.footer{
  position:fixed;
  left:50%;
  bottom:18px;
  transform:translateX(-50%);
  z-index:160;
  width:min(980px,92vw);
  text-align:center;
  opacity:.75;
  font-size:13px;
  pointer-events:none;
}

@media (max-width:560px){
  .stage{top:58%;height:360px}
  .header h1{font-size:34px}
}
</style>
</head>

<body>

<div class="top-left">
  <a class="btn" id="btnReturn" href="/index.html">RETURN</a>
  <a class="btn" id="btnEnterHub" href="/home/">ENTER</a>
</div>

<div class="top-right" aria-label="Language">
  <button class="btn" id="btnEN" type="button">EN</button>
  <button class="btn" id="btnZH" type="button">中文</button>
  <button class="btn" id="btnES" type="button">ES</button>
</div>

<div class="header">
  <h1>PRELUDE</h1>
  <p>Choose your entry posture.</p>
</div>

<!-- Toggle banner -->
<div class="panelWrap" aria-live="polite">
  <div class="panel" id="panelClaim">
    <div class="panelTop">
      <div>
        <p class="pTitle" id="tClaim">Products & Services</p>
        <p class="pDesc" id="dClaim">What we offer. Deployable surfaces. Energy, Education, Commercial, Advisory, etc.</p>
      </div>
      <div class="pActions">
        <a class="btn" id="enterClaim" href="/products/">ENTER</a>
      </div>
    </div>
  </div>

  <div class="panel" id="panelSupport">
    <div class="panelTop">
      <div>
        <p class="pTitle" id="tSupport">Software & Systems</p>
        <p class="pDesc" id="dSupport">The engines behind the claims. SSG, .DOTGrid, UCI, Registry, and measurement layers.</p>
      </div>
      <div class="pActions">
        <a class="btn" id="enterSupport" href="/products/software/">ENTER</a>
      </div>
    </div>
  </div>
</div>

<div class="stage" aria-label="Prelude wishbone">
  <div class="d d-left" id="claimDiamond" role="button" tabindex="0" aria-label="Claim">
    <div class="inner">
      <div class="lab">CLAIM</div>
      <div class="sub">Products & Services</div>
    </div>
  </div>

  <div class="d d-right" id="supportDiamond" role="button" tabindex="0" aria-label="Support">
    <div class="inner">
      <div class="lab">SUPPORT</div>
      <div class="sub">Software & Systems</div>
    </div>
  </div>
</div>

<div class="footer">
  CLAIM must be supported. SUPPORT must be verifiable.
</div>

<script>
(function(){
  // ---- state ----
  var qs=new URLSearchParams(location.search);
  var lang  = qs.get("lang")  || localStorage.getItem("gd_lang")  || "en";
  var style = qs.get("style") || localStorage.getItem("gd_style") || "formal";
  var time  = qs.get("time")  || localStorage.getItem("gd_time")  || "now";
  var depth = qs.get("depth") || localStorage.getItem("gd_depth") || "explore";

  if(lang!=="en" && lang!=="zh" && lang!=="es") lang="en";
  if(style!=="formal" && style!=="informal") style="formal";
  if(time==="trajectory") time="post";
  if(time!=="origin" && time!=="now" && time!=="post") time="now";
  if(depth!=="explore" && depth!=="learn") depth="explore";

  try{
    localStorage.setItem("gd_lang",lang);
    localStorage.setItem("gd_style",style);
    localStorage.setItem("gd_time",time);
    localStorage.setItem("gd_depth",depth);
  }catch(e){}

  document.documentElement.lang=(lang==="zh")?"zh":(lang==="es")?"es":"en";

  function q(){
    return "?lang="+encodeURIComponent(lang)+
           "&style="+encodeURIComponent(style)+
           "&time="+encodeURIComponent(time)+
           "&depth="+encodeURIComponent(depth);
  }

  // top links carry state
  document.getElementById("btnReturn").href="/index.html"+q();
  document.getElementById("btnEnterHub").href="/home/"+q();

  // language toggles
  var btnEN=document.getElementById("btnEN");
  var btnZH=document.getElementById("btnZH");
  var btnES=document.getElementById("btnES");
  function paintLang(){
    btnEN.classList.toggle("active", lang==="en");
    btnZH.classList.toggle("active", lang==="zh");
    btnES.classList.toggle("active", lang==="es");
  }
  paintLang();
  function setLang(next){
    if(next!=="en" && next!=="zh" && next!=="es") next="en";
    lang=next;
    try{ localStorage.setItem("gd_lang",lang); }catch(e){}
    location.href="/prelude/"+q();
  }
  btnEN.onclick=function(){ setLang("en"); };
  btnZH.onclick=function(){ setLang("zh"); };
  btnES.onclick=function(){ setLang("es"); };

  // ENTER buttons carry state
  document.getElementById("enterClaim").href="/products/"+q();
  document.getElementById("enterSupport").href="/products/software/"+q();

  // i18n for the two banners only (keeps layout stable)
  if(lang==="zh"){
    document.getElementById("tClaim").textContent="产品与服务";
    document.getElementById("dClaim").textContent="我们提供的可部署执行面：能源、教育、商业、咨询等。";
    document.getElementById("tSupport").textContent="软件与系统";
    document.getElementById("dSupport").textContent="支撑主张的引擎层：SSG、.DOTGrid、UCI、登记与测量层。";
    document.getElementById("enterClaim").textContent="进入";
    document.getElementById("enterSupport").textContent="进入";
    document.getElementById("btnReturn").textContent="返回";
    document.getElementById("btnEnterHub").textContent="进入";
  }else if(lang==="es"){
    document.getElementById("tClaim").textContent="Productos y Servicios";
    document.getElementById("dClaim").textContent="Lo que ofrecemos: superficies desplegables. Energía, Educación, Comercial, Asesoría, etc.";
    document.getElementById("tSupport").textContent="Software y Sistemas";
    document.getElementById("dSupport").textContent="Motores detrás de las afirmaciones: SSG, .DOTGrid, UCI, Registro y capas de medición.";
    document.getElementById("enterClaim").textContent="ENTRAR";
    document.getElementById("enterSupport").textContent="ENTRAR";
    document.getElementById("btnReturn").textContent="VOLVER";
    document.getElementById("btnEnterHub").textContent="ENTRAR";
  }

  // toggle behavior
  var claim=document.getElementById("claimDiamond");
  var support=document.getElementById("supportDiamond");
  var panelClaim=document.getElementById("panelClaim");
  var panelSupport=document.getElementById("panelSupport");

  function show(which){
    var isClaim = (which==="claim");
    panelClaim.classList.toggle("show", isClaim);
    panelSupport.classList.toggle("show", !isClaim);
    document.getElementById("claimDiamond").classList.toggle("active", isClaim);
    document.getElementById("supportDiamond").classList.toggle("active", !isClaim);
    // keep banner visible: no scrolling required
  }

  function bind(el, which){
    if(!el) return;
    el.addEventListener("click", function(){ show(which); });
    el.addEventListener("keydown", function(e){
      if(e.key==="Enter"||e.key===" "){ e.preventDefault(); show(which); }
    });
  }

  bind(claim,"claim");
  bind(support,"support");

  // default selection
  show("claim");
})();
</script>

</body>
</html>

<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>HOME · Geodiametrics</title>

<link rel="stylesheet" href="/assets/ui.css?v=HOME_LEVEL_NO_OVERLAP_1"/>
<link rel="stylesheet" href="/assets/branch.css?v=HOME_LEVEL_NO_OVERLAP_1"/>
<script defer src="/assets/instrument.js?v=HOME_LEVEL_NO_OVERLAP_1"></script>

<style>
  .frame{position:relative;min-height:100vh;width:100%}

  /* Top-left */
  .top-left{
    position:fixed;left:16px;top:16px;z-index:90;
    display:flex;gap:10px;flex-wrap:wrap;
  }

  /* Top-right */
  .top-right{
    position:fixed;right:16px;top:16px;z-index:90;
    display:flex;flex-direction:column;gap:10px;align-items:flex-end;
  }

  .pillbar{
    border-radius:999px;
    border:1px solid rgba(255,255,255,.10);
    background:rgba(0,0,0,.18);
    backdrop-filter:blur(8px);
    padding:10px 12px;
    display:flex;
    gap:10px;
    align-items:center;
  }

  /* ===== CENTER STAGE (AUTO-LEVEL: NO OVERLAP) =====
     JS will set top in px to the midpoint between:
     - bottom edge of top UI block
     - top edge of bottom dock
  */
  :root{ --R: 124px; }

  .center-stage{
    position:fixed;
    left:50%;
    top:50%;                /* overwritten by JS for perfect leveling */
    transform:translate(-50%,-50%);
    width:min(560px,92vw);
    height:min(560px,92vw);
    z-index:40;
    pointer-events:auto;
  }

  /* ===== DIAMONDS (25% smaller) ===== */
  .d-diamond{
    width:150px;height:150px;
    position:absolute;
    left:50%;top:50%;
    transform-origin:center;
    border-radius:22px;
    border:1px solid rgba(255,255,255,.14);
    background:linear-gradient(145deg, rgba(17,22,28,.88), rgba(11,15,20,.92));
    backdrop-filter:blur(8px);
    box-shadow:
      0 28px 78px rgba(0,0,0,.78),
      0 12px 28px rgba(0,0,0,.52),
      inset 0 2px 0 rgba(255,255,255,.18),
      inset 0 -18px 28px rgba(0,0,0,.42);
    transition:transform 240ms ease, box-shadow 240ms ease, filter 240ms ease;
    filter: drop-shadow(0 0 14px rgba(212,175,55,.08));
    cursor:pointer;
    -webkit-tap-highlight-color:transparent;
  }

  .d-diamond::before{
    content:"";
    position:absolute;
    inset:9px;
    border-radius:18px;
    border:1px solid rgba(255,255,255,.10);
    pointer-events:none;
  }

  .d-diamond::after{
    content:"";
    position:absolute;
    left:10%;
    right:10%;
    top:10%;
    height:28%;
    border-radius:999px;
    background:linear-gradient(to bottom, rgba(255,255,255,.14), rgba(255,255,255,0));
    opacity:.9;
    pointer-events:none;
    transform:rotate(-10deg);
  }

  .d-diamond:hover{
    box-shadow:
      0 34px 92px rgba(0,0,0,.86),
      0 16px 38px rgba(0,0,0,.58),
      inset 0 2px 0 rgba(255,255,255,.22),
      inset 0 -22px 34px rgba(0,0,0,.48);
    filter: drop-shadow(0 0 18px rgba(212,175,55,.14));
    transform:translate(-50%,-50%) rotate(45deg) scale(1.02);
  }

  .d-diamond.active{
    border-color:rgba(212,175,55,.70);
    box-shadow:
      0 34px 92px rgba(0,0,0,.86),
      0 0 22px rgba(212,175,55,.32),
      inset 0 2px 0 rgba(255,255,255,.22),
      inset 0 -22px 34px rgba(0,0,0,.48);
    filter: drop-shadow(0 0 18px rgba(212,175,55,.18));
  }

  .d-inner{
    width:100%;height:100%;
    transform:rotate(-45deg);
    display:flex;flex-direction:column;
    align-items:center;justify-content:center;
    padding:16px;gap:8px;text-align:center;
    user-select:none;
    pointer-events:none;
  }
  .d-title{font-weight:950;letter-spacing:.35px;font-size:16px}
  .d-text{opacity:.90;font-size:13px;line-height:1.35;max-width:16em}

  /* Mathematical placement (stable) */
  .d-n{ transform:translate(-50%,-50%) translate(0, calc(var(--R) * -1)) rotate(45deg); }
  .d-e{ transform:translate(-50%,-50%) translate(var(--R), 0) rotate(45deg); }
  .d-s{ transform:translate(-50%,-50%) translate(0, var(--R)) rotate(45deg); }
  .d-w{ transform:translate(-50%,-50%) translate(calc(var(--R) * -1), 0) rotate(45deg); }

  /* Center nucleus: neutral */
  .d-core{
    position:absolute;left:50%;top:50%;
    transform:translate(-50%,-50%);
    width:64px;height:64px;border-radius:18px;
    display:grid;place-items:center;
    border:1px solid rgba(255,255,255,.10);
    background:rgba(0,0,0,.18);
    box-shadow:0 18px 44px rgba(0,0,0,.62), inset 0 2px 0 rgba(255,255,255,.10);
    font-weight:950;letter-spacing:.4px;
    pointer-events:none;
    opacity:.85;
  }

  /* Bottom dock */
  .bottom-dock{
    position:fixed;
    left:50%;
    bottom:max(12px, env(safe-area-inset-bottom));
    transform:translateX(-50%);
    z-index:90;
    width:min(860px, 94vw);
    display:flex;
    justify-content:center;
    gap:10px;
    flex-wrap:wrap;
    padding:10px 12px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,.10);
    background:rgba(0,0,0,.18);
    backdrop-filter:blur(8px);
  }

  @media (max-width:520px){
    :root{ --R: 116px; }
    .top-right{ right:10px; top:10px; }
    .top-left{ left:10px; top:10px; }
    .center-stage{ width:min(520px,92vw); height:min(520px,92vw); }
    .d-core{ width:58px; height:58px; }
    .pillbar{ gap:8px; padding:9px 10px; }
  }

  /* Bulletin modal */
  .backdrop{
    position:fixed;inset:0;z-index:110;
    background:rgba(0,0,0,.55);
    backdrop-filter:blur(6px);
    display:none;
  }
  .backdrop.show{ display:block; }

  .bulletin{
    position:fixed;
    left:50%;
    top:50%;
    transform:translate(-50%,-50%);
    z-index:120;
    width:min(680px, 92vw);
    border-radius:22px;
    border:1px solid rgba(255,255,255,.10);
    background:linear-gradient(145deg, rgba(17,22,28,.92), rgba(11,15,20,.96));
    box-shadow:0 30px 90px rgba(0,0,0,.75);
    padding:16px;
    display:none;
  }
  .bulletin.show{ display:block; }

  .bulletin-head{
    display:flex;
    justify-content:space-between;
    align-items:flex-start;
    gap:10px;
    margin-bottom:10px;
  }
  .bulletin-title{font-weight:950;letter-spacing:.25px;font-size:16px;margin:0}
  .bulletin-close{border:none;background:transparent;color:#fff;font-size:18px;cursor:pointer}

  .bulletin-body{
    opacity:.90;line-height:1.45;font-size:14px;text-align:center;
    padding:8px 10px;
  }

  .bulletin-actions{
    display:flex;flex-wrap:wrap;gap:10px;justify-content:center;margin-top:12px;
  }
</style>
</head>

<body>
<div class="frame">

  <div class="top-left" id="topLeft">
    <a class="crp-btn" href="/door/" role="button">EXIT</a>
    <a class="crp-btn" href="/" role="button">LANGUAGE</a>
  </div>

  <div class="top-right" id="topRight" aria-label="Top-right controls">
    <div class="pillbar">
      <button id="styleToggle" class="crp-chip" type="button">STYLE: FORMAL</button>
    </div>
    <div class="pillbar">
      <button class="crp-chip tbtn2" type="button" data-time="origin">ORIGIN</button>
      <button class="crp-chip tbtn2" type="button" data-time="now">NOW</button>
      <button class="crp-chip tbtn2" type="button" data-time="trajectory">POST</button>
    </div>
  </div>

  <div class="center-stage" id="centerStage" aria-label="Compass face">
    <div id="north" class="d-diamond d-n" role="button" tabindex="0" aria-label="North">
      <div class="d-inner"><div class="d-title">NORTH</div><div class="d-text" id="northText"></div></div>
    </div>
    <div id="east" class="d-diamond d-e" role="button" tabindex="0" aria-label="East">
      <div class="d-inner"><div class="d-title">EAST</div><div class="d-text" id="eastText"></div></div>
    </div>
    <div id="south" class="d-diamond d-s" role="button" tabindex="0" aria-label="South">
      <div class="d-inner"><div class="d-title">SOUTH</div><div class="d-text" id="southText"></div></div>
    </div>
    <div id="west" class="d-diamond d-w" role="button" tabindex="0" aria-label="West">
      <div class="d-inner"><div class="d-title">WEST</div><div class="d-text" id="westText"></div></div>
    </div>
    <div class="d-core">◆</div>
  </div>

  <nav class="bottom-dock" id="bottomDock" aria-label="Bottom navigation">
    <a class="crp-btn" href="/links/" role="button">LINKS</a>
    <a class="crp-btn crp-btn-primary" href="/home/" role="button">HOME</a>
    <a class="crp-btn" href="/products/" role="button">PRODUCTS</a>
    <a class="crp-btn" href="/laws/" role="button">LAWS</a>
    <a class="crp-btn" href="/gauges/" role="button">GAUGES</a>
  </nav>

  <div id="bd" class="backdrop" aria-hidden="true"></div>

  <div id="bulletin" class="bulletin" role="dialog" aria-modal="true" aria-label="Bulletin">
    <div class="bulletin-head">
      <h3 class="bulletin-title" id="bulTitle">BULLETIN</h3>
      <button class="bulletin-close" id="bulClose" aria-label="Close">✕</button>
    </div>
    <div class="bulletin-body" id="bulBody"></div>
    <div class="bulletin-actions">
      <button class="crp-btn" id="bulReturn" type="button">RETURN</button>
      <a class="crp-btn" href="/links/" role="button">JUMP LINKS</a>
      <a class="crp-btn" href="/products/" role="button">JUMP PRODUCTS</a>
    </div>
  </div>

</div>

<script>
(function(){
  "use strict";

  var K_STYLE="gd_style";
  var K_TIME="gd_time";

  function lsGet(k){ try{return localStorage.getItem(k);}catch(e){ return null; } }
  function lsSet(k,v){ try{localStorage.setItem(k,v);}catch(e){} }

  var state={ style: lsGet(K_STYLE)||"formal", time: lsGet(K_TIME)||"now" };
  var allowTimeByStyle={ formal:{origin:1,now:1,trajectory:1}, informal:{origin:1,now:1} };

  var content={
    north:{ formal:{origin:"North defines invariant structure.",now:"North stabilizes current position.",trajectory:"North preserves long-term coherence."},
            informal:{origin:"North is your anchor.",now:"North keeps you from drifting."}},
    east:{  formal:{origin:"East maps execution pathways.",now:"East expresses operational flow.",trajectory:"East scales systems forward."},
            informal:{origin:"East is how you move.",now:"East is doing."}},
    south:{ formal:{origin:"South defines convergence pressure.",now:"South applies constraint.",trajectory:"South compounds momentum."},
            informal:{origin:"South is where force happens.",now:"South pushes."}},
    west:{  formal:{origin:"West governs containment.",now:"West enforces boundaries.",trajectory:"West protects integrity."},
            informal:{origin:"West keeps things tight.",now:"West guards the edge."}}
  };

  function normalizeTime(){ if(!allowTimeByStyle[state.style][state.time]) state.time="now"; }

  function setStyleLabel(){ document.getElementById("styleToggle").textContent="STYLE: "+state.style.toUpperCase(); }

  function setPressedTime(){
    document.querySelectorAll(".tbtn2").forEach(function(btn){
      var v=btn.getAttribute("data-time");
      var allowed=!!allowTimeByStyle[state.style][v];
      btn.setAttribute("aria-disabled", allowed ? "false":"true");
      btn.setAttribute("aria-pressed", (v===state.time) ? "true":"false");
    });
  }

  function render(){
    normalizeTime();
    lsSet(K_STYLE,state.style); lsSet(K_TIME,state.time);
    document.getElementById("northText").textContent = content.north[state.style][state.time] || "";
    document.getElementById("eastText").textContent  = content.east[state.style][state.time]  || "";
    document.getElementById("southText").textContent = content.south[state.style][state.time] || "";
    document.getElementById("westText").textContent  = content.west[state.style][state.time]  || "";
    setStyleLabel();
    setPressedTime();
  }

  document.getElementById("styleToggle").addEventListener("click", function(){
    state.style = (state.style==="formal") ? "informal" : "formal";
    render();
    if(activeDir){ bulBody.textContent = content[activeDir][state.style][state.time] || ""; }
  });

  document.querySelectorAll(".tbtn2").forEach(function(btn){
    btn.addEventListener("click", function(){
      var v=btn.getAttribute("data-time");
      if(v==="trajectory" && state.style==="informal") state.style="formal";
      if(!allowTimeByStyle[state.style][v]) return;
      state.time=v;
      render();
      if(activeDir){ bulBody.textContent = content[activeDir][state.style][state.time] || ""; }
    });
  });

  var bd=document.getElementById("bd");
  var bul=document.getElementById("bulletin");
  var bulTitle=document.getElementById("bulTitle");
  var bulBody=document.getElementById("bulBody");
  var activeDir=null;

  function setActiveDiamond(dir){
    ["north","east","south","west"].forEach(function(id){
      var el=document.getElementById(id);
      if(el) el.classList.toggle("active", id===dir);
    });
  }

  function openBulletin(dir){
    activeDir=dir;
    setActiveDiamond(dir);
    bulTitle.textContent = dir.toUpperCase();
    bulBody.textContent = content[dir][state.style][state.time] || "";
    bd.classList.add("show");
    bul.classList.add("show");
  }

  function closeBulletin(){
    bd.classList.remove("show");
    bul.classList.remove("show");
  }

  bd.addEventListener("click", closeBulletin);
  document.getElementById("bulClose").addEventListener("click", closeBulletin);
  document.getElementById("bulReturn").addEventListener("click", closeBulletin);

  ["north","east","south","west"].forEach(function(id){
    var el=document.getElementById(id);
    if(el) el.addEventListener("click", function(){ openBulletin(id); });
  });

  /* ===== LEVELING: AUTO NO-OVERLAP POSITIONING =====
     Put compass as high as possible without crossing:
     - bottom of the top UI block (top-left/top-right)
     - top of bottom dock
     Then center it in the remaining band.
  */
  function level(){
    var tl=document.getElementById("topLeft");
    var tr=document.getElementById("topRight");
    var bdock=document.getElementById("bottomDock");
    var stage=document.getElementById("centerStage");
    if(!stage || !bdock) return;

    var safe=10;
    var tlb=tl ? tl.getBoundingClientRect().bottom : 0;
    var trb=tr ? tr.getBoundingClientRect().bottom : 0;
    var topBand = Math.max(tlb,trb) + safe;

    var dockTop = bdock.getBoundingClientRect().top - safe;

    var centerY = (topBand + dockTop) / 2;

    stage.style.top = centerY + "px";
  }

  window.addEventListener("resize", level, {passive:true});
  window.addEventListener("orientationchange", function(){ setTimeout(level, 50); }, {passive:true});
  setTimeout(level, 0);

  render();
})();
</script>

</body>
</html>

<!-- TNT — /products/energy/index.html  (PRODUCTS · ENERGY · GEM STANDARD · UNIFORM TO /products/)
     GOAL:
       - Match the exact “good code” uniform (lacquer + gold rim + crisp specular)
       - Diamonds ALWAYS open (bind-first; null-safe; no JS crash)
       - Sticky lenses (STYLE + CAUSE/EFFECT + TIME) inside modal only
       - Multi-open stacks + scroll/anchor preserved
       - 10-domain sandwich: BASELINE + 8 operational + TERMINUS
       - Rule of seven: 7 bullets per domain (no abstract filler)
     LOCKS:
       - Uses /assets/ui.css + /assets/branch.css only
       - No html/body background paint
       - Keys: gd_lang / gd_style / gd_time only
-->

<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>PRODUCTS · ENERGY</title>

<link rel="stylesheet" href="/assets/ui.css"/>
<link rel="stylesheet" href="/assets/branch.css"/>

<style>
:root{
  --R:154px;

  /* DOOR/PRODUCTS jewel */
  --goldSoft:rgba(212,175,55,.35);
  --obsB:#0c1626;
  --obsC:#05070c;
  --opal1: rgba(245,248,255,.18);
  --opal2: rgba(180,220,255,.12);
  --opal3: rgba(255,235,200,.10);
  --opal4: rgba(170,255,235,.10);
  --sapp1: rgba(40,90,200,.18);
  --sapp2: rgba(110,190,255,.14);

  --mut: rgba(255,255,255,.88);
  --mut2: rgba(255,255,255,.72);
}

body{margin:0;color:#fff;font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif}
a{color:inherit;text-decoration:none}

/* Top-left */
.top-left{
  position:fixed;left:16px;top:16px;z-index:120;
  display:flex;gap:10px;flex-wrap:wrap;align-items:center;
}
.btn{
  padding:10px 16px;border-radius:14px;
  background:linear-gradient(145deg,var(--obsB),var(--obsC));
  color:#fff;border:1px solid rgba(255,255,255,.08);
  box-shadow:0 14px 36px rgba(0,0,0,.70);
  cursor:pointer;font-weight:900;letter-spacing:.2px;
  -webkit-tap-highlight-color:transparent;
}
.btn:hover{box-shadow:0 18px 50px rgba(0,0,0,.90),0 0 14px var(--goldSoft)}

/* Brand pill (no blur) */
.brand{
  position:fixed;left:50%;top:16px;transform:translateX(-50%);
  z-index:110;text-align:center;
  padding:10px 14px;border-radius:999px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(0,0,0,.18);
  pointer-events:none;
}
.brand .k{font-size:12px;letter-spacing:3px;text-transform:uppercase;opacity:.78;margin:0 0 8px 0}
.brand .t{margin:0;font-size:40px;font-weight:950;letter-spacing:.25px;line-height:1.02}
.brand .s{margin:8px 0 0;opacity:.84;font-size:14.5px;line-height:1.25}

/* Stage */
.stage{
  position:fixed;left:50%;top:54%;
  transform:translate(-50%,-50%);
  width:min(720px,94vw);height:min(720px,94vw);
  z-index:60;
  pointer-events:none; /* prevent tap blockers */
}
.outer{
  position:absolute;left:50%;top:50%;
  width:min(680px,92vw);height:min(680px,92vw);
  transform:translate(-50%,-50%) rotate(45deg);
  border-radius:60px;
  border:1px solid rgba(255,255,255,.10);
  background:
    radial-gradient(circle at 30% 25%, rgba(255,255,255,.08), transparent 55%),
    radial-gradient(circle at 70% 80%, rgba(0,80,255,.14), transparent 60%),
    linear-gradient(160deg, rgba(14,24,40,.45) 0%, rgba(7,11,18,.62) 70%);
  box-shadow:0 90px 260px rgba(0,0,0,.62), inset 0 2px 0 rgba(255,255,255,.10), inset 0 -50px 90px rgba(0,0,0,.55);
  opacity:.55;
  pointer-events:none;
}

/* Diamonds (pearlescent lacquer) */
.d{
  width:178px;height:178px;
  position:absolute;left:50%;top:50%;
  transform-origin:center;border-radius:28px;
  cursor:pointer;
  pointer-events:auto;           /* tap-safe */
  touch-action:manipulation;     /* tap-safe */
  -webkit-tap-highlight-color:transparent;

  background:
    radial-gradient(circle at 72% 26%, var(--sapp2) 0%, rgba(110,190,255,0) 62%),
    radial-gradient(circle at 34% 78%, var(--sapp1) 0%, rgba(40,90,200,0) 64%),
    radial-gradient(circle at 34% 22%, var(--opal1) 0%, rgba(245,248,255,0) 54%),
    radial-gradient(circle at 78% 32%, var(--opal2) 0%, rgba(180,220,255,0) 58%),
    radial-gradient(circle at 82% 78%, var(--opal3) 0%, rgba(255,235,200,0) 64%),
    radial-gradient(circle at 30% 82%, var(--opal4) 0%, rgba(170,255,235,0) 66%),
    linear-gradient(160deg, var(--obsB) 0%, var(--obsC) 78%);

  border:1px solid rgba(255,255,255,.16);
  box-shadow:
    0 30px 110px rgba(0,0,0,.72),
    0 0 22px rgba(212,175,55,.10),
    inset 0 2px 0 rgba(255,255,255,.16),
    inset 0 -44px 86px rgba(0,0,0,.80);
  transition:box-shadow 220ms ease, border-color 220ms ease;
  overflow:hidden;
}
.d::before{
  content:"";
  position:absolute;inset:0;border-radius:28px;padding:1px;
  background:linear-gradient(120deg, transparent 0%, var(--goldSoft) 50%, transparent 100%);
  opacity:.65;
  -webkit-mask:linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  -webkit-mask-composite:xor; mask-composite:exclude;
  pointer-events:none;
}
.d::after{
  content:"";
  position:absolute;inset:0;border-radius:28px;
  background:
    radial-gradient(120% 58% at 50% 16%, rgba(255,255,255,.32) 0%, rgba(255,255,255,0) 64%),
    radial-gradient(140% 70% at 50% 92%, rgba(0,0,0,.36) 0%, rgba(0,0,0,0) 56%);
  opacity:.92;
  pointer-events:none;
}
.d:hover{
  border-color:rgba(212,175,55,.32);
  box-shadow:
    0 40px 140px rgba(0,0,0,.82),
    0 0 32px rgba(212,175,55,.18),
    inset 0 2px 0 rgba(255,255,255,.18),
    inset 0 -50px 98px rgba(0,0,0,.84);
}

/* Placement */
.d-n{transform:translate(-50%,-50%) translate(0, calc(var(--R) * -1)) rotate(45deg)}
.d-w{transform:translate(-50%,-50%) translate(calc(var(--R) * -1), 0) rotate(45deg)}
.d-s{transform:translate(-50%,-50%) translate(0, var(--R)) rotate(45deg)}
.d-e{transform:translate(-50%,-50%) translate(var(--R), 0) rotate(45deg)}

.inner{
  width:100%;height:100%;
  transform:rotate(-45deg);
  display:flex;flex-direction:column;
  align-items:center;justify-content:center;
  text-align:center;padding:14px;gap:8px;
  pointer-events:none;user-select:none;
}
.lab{font-weight:950;letter-spacing:.7px;font-size:18px;text-shadow:0 0 14px rgba(255,255,255,.25)}
.sub{font-size:12.5px;opacity:.78;line-height:1.28;max-width:18em}

.core{
  position:absolute;left:50%;top:50%;
  transform:translate(-50%,-50%);
  width:74px;height:74px;border-radius:22px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(0,0,0,.18);
  box-shadow:0 18px 44px rgba(0,0,0,.62), inset 0 2px 0 rgba(255,255,255,.10);
  display:grid;place-items:center;
  font-weight:950;letter-spacing:.5px;opacity:.92;
  pointer-events:none;
}

/* Dock (no blur) */
.dock{
  position:fixed;left:50%;
  bottom:max(12px, env(safe-area-inset-bottom));
  transform:translateX(-50%);
  z-index:120;width:min(900px,94vw);
  display:flex;justify-content:center;gap:10px;flex-wrap:wrap;
  padding:10px 12px;border-radius:999px;border:1px solid rgba(255,255,255,.10);
  background:rgba(0,0,0,.18);
  pointer-events:none;
}
.dock .btn{pointer-events:auto}

/* Modal */
.bd{position:fixed;inset:0;z-index:200;background:rgba(0,0,0,.70);display:none}
.bd.show{display:block}
.modal{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);width:min(1180px,96vw);height:90vh;display:none;z-index:210}
.modal.show{display:block}
.shell{
  height:100%;
  border-radius:26px;border:1px solid rgba(255,255,255,.10);
  background:
    radial-gradient(circle at 72% 20%, rgba(110,190,255,.10), transparent 58%),
    radial-gradient(circle at 32% 24%, rgba(245,248,255,.08), transparent 56%),
    linear-gradient(160deg, rgba(12,22,38,.92), rgba(7,11,18,.95));
  box-shadow:0 60px 180px rgba(0,0,0,.92);
  overflow:hidden;display:flex;flex-direction:column;
}
.mhead{display:flex;justify-content:space-between;align-items:center;gap:10px;padding:14px 16px;border-bottom:1px solid rgba(255,255,255,.08)}
.mtitle{margin:0;font-weight:950;letter-spacing:.3px;font-size:16px}
.mclose{border:0;background:transparent;color:#fff;font-size:18px;cursor:pointer;padding:8px 10px}
.mbody{padding:0;overflow:auto;-webkit-overflow-scrolling:touch;flex:1 1 auto}

/* Sticky lenses (inside modal only) */
.stickyTop{
  position:sticky;top:0;z-index:50;
  background:rgba(0,0,0,.62);
  border-bottom:1px solid rgba(255,255,255,.08);
  padding:12px 12px 10px;
}
.clusterRow{display:flex;gap:10px;flex-wrap:wrap;align-items:flex-start;justify-content:center;margin:0 0 10px}
.cluster{
  border:1px solid rgba(255,255,255,.10);
  background:rgba(0,0,0,.12);
  border-radius:999px;
  padding:8px;
  display:flex;
  gap:8px;
}
.clusterTitle{
  font-size:11px;
  letter-spacing:1.6px;
  opacity:.75;
  text-transform:uppercase;
  display:flex;
  align-items:center;
  padding:0 8px 0 6px;
}
.pill{
  padding:10px 14px;border-radius:999px;
  background:linear-gradient(145deg, rgba(17,22,28,.92), rgba(11,15,20,.96));
  border:1px solid rgba(255,255,255,.10);
  box-shadow:0 14px 36px rgba(0,0,0,.65);
  cursor:pointer;font-weight:900;letter-spacing:.2px;color:#fff;
  user-select:none;
  -webkit-tap-highlight-color:transparent;
}
.pill.active{
  border-color:rgba(212,175,55,.45);
  box-shadow:0 18px 50px rgba(0,0,0,.9), 0 0 14px rgba(212,175,55,.18);
}

/* Header card */
.hcard{
  max-width:980px;margin:0 auto;
  padding:12px 14px;border-radius:18px;
  background:rgba(0,0,0,.18);
  border:1px solid rgba(255,255,255,.10);
}
.h1{margin:0 0 4px;font-weight:950;font-size:14px}
.h2{margin:0;color:var(--mut);line-height:1.45;font-size:12.5px}
.h3{margin:8px 0 0;color:rgba(255,255,255,.70);font-size:12px;line-height:1.35}

/* Content */
.content{padding:14px 16px 18px}
.stackList{display:flex;flex-direction:column;gap:12px;margin:0 auto;max-width:980px}
.stackRow{
  border:1px solid rgba(255,255,255,.10);
  border-radius:22px;
  background:linear-gradient(145deg, rgba(17,22,28,.86), rgba(11,15,20,.92));
  box-shadow:0 16px 52px rgba(0,0,0,.60);
  overflow:hidden;
}
.stackRow.open{box-shadow:0 18px 60px rgba(0,0,0,.72), 0 0 26px rgba(212,175,55,.12)}
.stackHead{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:14px 16px;cursor:pointer;-webkit-tap-highlight-color:transparent}
.stackLeft{display:flex;align-items:center;gap:12px;min-width:0}
.stackBar{width:6px;height:22px;border-radius:99px;background:var(--domc);box-shadow:0 0 18px rgba(255,255,255,.08);flex:0 0 auto}
.stackTitle{font-weight:950;letter-spacing:.2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.stackSub{font-size:12px;opacity:.72;margin-left:8px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.stackChevron{font-size:16px;opacity:.75;flex:0 0 auto}
.stackBody{
  display:none;
  padding:14px 16px 8px;
  border-top:1px solid rgba(255,255,255,.08);
  background:
    radial-gradient(circle at 30% 30%, rgba(255,255,255,.06), transparent 55%),
    linear-gradient(145deg, rgba(12,22,38,.86), rgba(7,11,18,.92));
}
.stackRow.open .stackBody{display:block}

.pblock{
  border:1px solid rgba(255,255,255,.08);
  background:rgba(0,0,0,.08);
  border-radius:18px;
  padding:12px 12px 10px;
  margin:0 0 10px;
}
.ph{margin:0 0 6px;font-weight:950;letter-spacing:.15px}
.pul{margin:0;padding-left:18px;color:var(--mut2)}
.pul li{margin:8px 0;line-height:1.42}

.mact{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:14px}
.sbtn{padding:12px 18px;border-radius:14px;background:linear-gradient(145deg, var(--obsB), var(--obsC));color:#fff;border:1px solid rgba(255,255,255,.08);box-shadow:0 14px 36px rgba(0,0,0,.7);cursor:pointer;font-weight:900;letter-spacing:.2px;text-decoration:none}

@media (max-width:560px){
  :root{--R:136px}
  .d{width:162px;height:162px}
  .stage{top:52%}
}
</style>
</head>

<body>

<div class="top-left">
  <a class="btn" id="btnBack" href="/products/">BACK</a>
  <a class="btn" id="btnExit" href="/door/">EXIT</a>
</div>

<div class="brand" aria-hidden="true">
  <p class="k">CARDINAL AXIS</p>
  <h1 class="t">Energy</h1>
  <p class="s">Industrial plasma architecture · consumer-legible</p>
</div>

<div class="stage" aria-label="Energy product diamond">
  <div class="outer"></div>

  <div class="d d-n" id="diamondFoundation" role="button" tabindex="0">
    <div class="inner"><div class="lab">FOUNDATION</div><div class="sub">Baseline and bounds.</div></div>
  </div>
  <div class="d d-w" id="diamondArchitecture" role="button" tabindex="0">
    <div class="inner"><div class="lab">ARCHITECTURE</div><div class="sub">Interfaces and modules.</div></div>
  </div>
  <div class="d d-s" id="diamondPerformance" role="button" tabindex="0">
    <div class="inner"><div class="lab">PERFORMANCE</div><div class="sub">Measured bands.</div></div>
  </div>
  <div class="d d-e" id="diamondGovernance" role="button" tabindex="0">
    <div class="inner"><div class="lab">GOVERNANCE</div><div class="sub">Phase discipline.</div></div>
  </div>

  <div class="core">◆</div>
</div>

<nav class="dock" aria-label="Bottom navigation">
  <a class="btn" id="dockHub" href="/home/">HUB</a>
  <a class="btn" id="dockTerminal" href="/index.html">TERMINAL</a>
  <a class="btn" id="dockLinks" href="/links/">LINKS</a>
  <a class="btn active" id="dockProducts" href="/products/">PRODUCTS</a>
  <a class="btn" id="dockLaws" href="/laws/">LAWS</a>
  <a class="btn" id="dockGauges" href="/gauges/">GAUGES</a>
</nav>

<div class="bd" id="bd"></div>

<div class="modal" id="modal" role="dialog" aria-modal="true">
  <div class="shell">
    <div class="mhead">
      <h3 class="mtitle" id="mTitle">ENERGY</h3>
      <button class="mclose" id="mClose" aria-label="Close" type="button">✕</button>
    </div>

    <div class="mbody" id="mbody">
      <div class="stickyTop">
        <div class="clusterRow">
          <div class="cluster">
            <div class="clusterTitle">STYLE</div>
            <div class="pill active" id="pillFormal">FORMAL</div>
            <div class="pill" id="pillInformal">INFORMAL</div>
          </div>
          <div class="cluster">
            <div class="clusterTitle">CAUSALITY</div>
            <div class="pill active" id="pillCause">CAUSE</div>
            <div class="pill" id="pillEffect">EFFECT</div>
          </div>
          <div class="cluster">
            <div class="clusterTitle">TIME</div>
            <div class="pill active" id="pillConcept">CONCEPT</div>
            <div class="pill" id="pillLive">LIVE</div>
            <div class="pill" id="pillRoadmap">ROADMAP</div>
          </div>
        </div>

        <div class="hcard">
          <div class="h1" id="h1">—</div>
          <div class="h2" id="h2">—</div>
          <div class="h3" id="h3">—</div>
        </div>
      </div>

      <div class="content">
        <div class="stackList" id="stackList"></div>

        <div class="mact">
          <button class="sbtn" id="mReturn" type="button">RETURN</button>
          <a class="sbtn" id="mFusion" href="/explore/fusion-readiness/">FUSION READINESS</a>
          <a class="sbtn" id="mJumpProducts" href="/products/">JUMP PRODUCTS</a>
          <a class="sbtn" id="mJumpHub" href="/home/">JUMP HUB</a>
        </div>
      </div>

    </div>
  </div>
</div>

<script>
(function(){
  // ===== Hydration (gd_* only) =====
  const qs = new URLSearchParams(location.search);
  let lang  = qs.get("lang")  || localStorage.getItem("gd_lang")  || "en";
  let gdStyle = qs.get("style") || localStorage.getItem("gd_style") || "formal";
  let gdTime  = qs.get("time")  || localStorage.getItem("gd_time")  || "origin";
  if(!["en","zh"].includes(lang)) lang="en";
  if(!["formal","informal"].includes(gdStyle)) gdStyle="formal";
  if(gdTime==="trajectory") gdTime="post";
  if(!["origin","now","post"].includes(gdTime)) gdTime="origin";
  try{ localStorage.setItem("gd_lang",lang); localStorage.setItem("gd_style",gdStyle); localStorage.setItem("gd_time",gdTime);}catch(e){}
  document.documentElement.lang = (lang==="zh") ? "zh" : "en";

  let causality = "CAUSE";
  const RS = { open:new Set(), scrollTop:0, anchorId:null };

  // ===== Null-safe refs =====
  const bd=document.getElementById("bd");
  const modal=document.getElementById("modal");
  const mbody=document.getElementById("mbody");
  const mClose=document.getElementById("mClose");
  const mReturn=document.getElementById("mReturn");
  const mTitle=document.getElementById("mTitle");
  const h1=document.getElementById("h1");
  const h2=document.getElementById("h2");
  const h3=document.getElementById("h3");
  const stackList=document.getElementById("stackList");

  const pillFormal=document.getElementById("pillFormal");
  const pillInformal=document.getElementById("pillInformal");
  const pillCause=document.getElementById("pillCause");
  const pillEffect=document.getElementById("pillEffect");
  const pillConcept=document.getElementById("pillConcept");
  const pillLive=document.getElementById("pillLive");
  const pillRoadmap=document.getElementById("pillRoadmap");

  let section="FOUNDATION";

  const CLAIM_LOCK = "Public claim: industrial plasma thermal substitution (C), buffered and governed. Fusion is requirements-only via the readiness link.";
  const SECTION_DESC = {
    FOUNDATION:"Baseline, bounds, and admissibility discipline.",
    ARCHITECTURE:"Modules, interfaces, buffering, and isolation.",
    PERFORMANCE:"Measured bands, uptime, losses, and variance.",
    GOVERNANCE:"Phase gates, audit posture, and non-retroactive discipline."
  };

  function q(){ return "lang="+encodeURIComponent(lang)+"&style="+encodeURIComponent(gdStyle)+"&time="+encodeURIComponent(gdTime); }
  (function setLinks(){
    const s=q();
    const set=(id,href)=>{ const el=document.getElementById(id); if(el) el.href=href; };
    set("btnBack","/products/?"+s);
    set("btnExit","/door/?"+s);
    set("dockHub","/home/?"+s);
    set("dockTerminal","/index.html?"+s);
    set("dockLinks","/links/?"+s);
    set("dockProducts","/products/?"+s);
    set("dockLaws","/laws/?"+s);
    set("dockGauges","/gauges/?"+s);
    set("mJumpProducts","/products/?"+s);
    set("mJumpHub","/home/?"+s);
    set("mFusion","/explore/fusion-readiness/?"+s);
  })();

  function renderPills(){
    pillFormal.classList.toggle("active", gdStyle==="formal");
    pillInformal.classList.toggle("active", gdStyle==="informal");
    pillCause.classList.toggle("active", causality==="CAUSE");
    pillEffect.classList.toggle("active", causality==="EFFECT");
    pillConcept.classList.toggle("active", gdTime==="origin");
    pillLive.classList.toggle("active", gdTime==="now");
    pillRoadmap.classList.toggle("active", gdTime==="post");
  }

  function headerLines(){
    const t = (gdTime==="origin")?"CONCEPT":(gdTime==="now")?"LIVE":"ROADMAP";
    h1.textContent = `ENERGY · ${section} · ${causality} · ${t} · ${gdStyle.toUpperCase()}`;
    h2.textContent = SECTION_DESC[section] || "—";
    h3.textContent = CLAIM_LOCK;
  }

  // ===== 10-domain sandwich =====
  const DOMAIN_COLORS={
    "BASELINE (Concept+Cause)":"#E5E7EB",
    "Industrial":"#D97706",
    "Engineering":"#3B82F6",
    "Technology":"#7C3AED",
    "Financial":"#6D28D9",
    "Human":"#F59E0B",
    "Adversarial":"#B91C1C",
    "Environmental":"#0D9488",
    "Infrastructural":"#1E40AF",
    "TERMINUS (Roadmap+Effect)":"#94A3B8"
  };
  const DOMAINS=Object.keys(DOMAIN_COLORS);

  const PHEAD=["P1 Context","P2 Constraint","P3 Tension","P4 Intervention","P5 Mechanism","P6 Result","P7 Boundary"];

  // ===== Rule-of-seven generator (concrete, energy-specific, no abstract filler) =====
  function build7(domain, pIndex){
    const timeWord = (gdTime==="origin") ? "concept" : (gdTime==="now") ? "current" : "roadmap";
    const dir = (causality==="CAUSE") ? "because" : "so";
    const formal = (gdStyle==="formal");

    const S=(a,b,c,d,e,f,g)=>[a,b,c,d,e,f,g];

    // Hard anchors (no drift)
    if(domain.startsWith("BASELINE")){
      const A=[
        "Baseline anchors industrial plasma substitution before scale.",
        "Baseline pins admissible claims to measured thermal output.",
        "Baseline separates upstream regime from downstream endpoints.",
        "Baseline requires buffering before any grid interface.",
        "Baseline requires receipts before upgrades.",
        "Baseline treats failures as admissible data.",
        "Baseline locks public posture to Industrial (C)."
      ];
      const B=[
        "Constraints are declared before mechanisms are described.",
        "Constraint changes require versioned receipts.",
        "Constraints cannot be softened by urgency.",
        "Constraints are enforced at the interface boundary.",
        "Constraints are checked before each phase gate.",
        "Constraints prohibit silent threshold edits.",
        "Constraints keep the surface non-abstract."
      ];
      const T=[
        "Tension appears as variance against declared bands.",
        "Tension increases when incentives reward speed.",
        "Tension is detected as drift over time.",
        "Tension is bounded by stop rules.",
        "Tension is resolved by containment not narration.",
        "Tension is logged and replayable.",
        "Tension cannot be averaged away."
      ];
      const I=[
        "Intervention changes variables, not definitions.",
        "Intervention is staged and reversible.",
        "Intervention emits receipts for audit.",
        "Intervention preserves upstream isolation.",
        "Intervention uses buffering to reduce shock.",
        "Intervention tightens gates after repeat failures.",
        "Intervention does not change claim tier."
      ];
      const M=[
        "Mechanism is module isolation plus storage loop.",
        "Mechanism is measurable at the boundary.",
        "Mechanism is repeatable across sites.",
        "Mechanism is resilient under perturbation.",
        "Mechanism is compatible with audit replay.",
        "Mechanism forbids hidden dependencies.",
        "Mechanism preserves public safety."
      ];
      const R=[
        "Result is stable thermal delivery within band.",
        "Result is measured under declared conditions.",
        "Result repeats or it is rejected.",
        "Result supports contracts without hype.",
        "Result supports scaling only with receipts.",
        "Result remains compatible with compliance artifacts.",
        "Result is readable to non-experts."
      ];
      const BD=[
        "Boundary forbids net-positive fusion claims here.",
        "Boundary forbids facility net-electric claims here.",
        "Boundary forbids endpoint high-energy exposure.",
        "Boundary forbids hazardous recipes in public copy.",
        "Boundary requires independent proof for upgrades.",
        "Boundary logs overrides explicitly.",
        "Boundary locks Industrial (C) unless forced by proof."
      ];
      const PACK=[A,B,T,I,M,R,BD][pIndex] || ["—","—","—","—","—","—","—"];
      return formal ? PACK : PACK.map(x=>x);
    }

    if(domain.startsWith("TERMINUS")){
      const A=[
        "Terminus converges the system into delivery under Industrial (C).",
        "Terminus is effect-facing and roadmap-facing by design.",
        "Terminus expresses what can be deployed now.",
        "Terminus expresses what is gated next.",
        "Terminus forbids leapfrogging phase gates.",
        "Terminus requires receipts before scale.",
        "Terminus remains audit-compatible."
      ];
      const B=[
        "Constraints cap rollout by phase and envelope.",
        "Constraints enforce buffering at interfaces.",
        "Constraints require stable input/output logs.",
        "Constraints enforce maintenance and shutdown discipline.",
        "Constraints require incident reason codes.",
        "Constraints require third-party audit readiness.",
        "Constraints prevent narrative escalation."
      ];
      const T=[
        "Tension shows up as dispatch volatility and downtime.",
        "Tension shows up as cost pressure and shortcut temptation.",
        "Tension shows up as drift in performance bands.",
        "Tension is reduced by storage and staging.",
        "Tension is reduced by containment discipline.",
        "Tension is reduced by role separation.",
        "Tension is reduced by receipts."
      ];
      const I=[
        "Intervention is phase gating and reversible rollout.",
        "Intervention is buffering and smoothing.",
        "Intervention is maintenance scheduling.",
        "Intervention is containment-first response.",
        "Intervention is audit-first logging.",
        "Intervention is template replication.",
        "Intervention stays inside Industrial (C)."
      ];
      const M=[
        "Mechanism is pilot → cluster → adjacency → replication.",
        "Mechanism is CC tiers plus interface constraints.",
        "Mechanism is SLA storage loop plus controlled release.",
        "Mechanism is telemetry discipline plus receipts.",
        "Mechanism is containment matrix plus CARES ladder.",
        "Mechanism is exportable artifacts for auditors.",
        "Mechanism is deterministic under pressure."
      ];
      const R=[
        "Result is deployable clean process heat.",
        "Result is stable, measured, and contractable.",
        "Result is scalable only by replication templates.",
        "Result reduces combustion dependence.",
        "Result reduces grid shock by buffering.",
        "Result reduces risk by segmentation.",
        "Result remains public-safe."
      ];
      const BD=[
        "Boundary keeps fusion in requirements-only lane.",
        "Boundary keeps upgrades receipt-gated.",
        "Boundary keeps endpoints passive-only.",
        "Boundary keeps data non-retroactive.",
        "Boundary keeps exceptions logged and bounded.",
        "Boundary keeps claims falsifiable.",
        "Boundary keeps Industrial (C) locked."
      ];
      const PACK=[A,B,T,I,M,R,BD][pIndex] || ["—","—","—","—","—","—","—"];
      return formal ? PACK : PACK.map(x=>x);
    }

    // Operational domains (8)
    const K={
      Industrial:[
        "Industrial output is metered process heat",
        "Constraints are interface-first",
        "Tension is uptime versus envelope",
        "Intervention is buffering and staging",
        "Mechanism is isolation plus SLA loop",
        "Result is stable heat band",
        "Boundary is no gain claim here"
      ],
      Engineering:[
        "Engineering translates physics into hardware boundaries",
        "Constraints are tolerances and interfaces",
        "Tension is thermal stress versus throughput",
        "Intervention is redesign inside the wall",
        "Mechanism is modular replaceable subassemblies",
        "Result is repeatable builds",
        "Boundary is no unsafe exposure"
      ],
      Technology:[
        "Technology is control, telemetry, and logging",
        "Constraints are deterministic runtime rules",
        "Tension is latency versus stability",
        "Intervention is guardrails and rollback logic",
        "Mechanism is receipts and replay",
        "Result is auditable operation",
        "Boundary is no silent edits"
      ],
      Financial:[
        "Financial posture prices variance and risk",
        "Constraints are underwriting bands",
        "Tension is capital pressure versus proof",
        "Intervention is phased exposure",
        "Mechanism is insurance tied to CC tiers",
        "Result is bankable templates",
        "Boundary is no claim inflation"
      ],
      Human:[
        "Human posture is training and execution discipline",
        "Constraints are checklists and clear UI",
        "Tension is panic versus procedure",
        "Intervention is drills and stop rules",
        "Mechanism is role separation",
        "Result is lower error rate",
        "Boundary is no override without log"
      ],
      Adversarial:[
        "Adversarial posture assumes spoofing and drift",
        "Constraints are redundancy and agreement thresholds",
        "Tension is false signal versus true fault",
        "Intervention is kill and rollback",
        "Mechanism is tamper-evident receipts",
        "Result is manipulation resistance",
        "Boundary is binary admissibility"
      ],
      Environmental:[
        "Environmental posture is bounded discharge",
        "Constraints are measured bands and alarms",
        "Tension is throughput versus limits",
        "Intervention is closed-loop reuse",
        "Mechanism is monitored in/out boundaries",
        "Result is reduced external impact",
        "Boundary is no unmeasured discharge"
      ],
      Infrastructural:[
        "Infrastructure posture is buffered grid compatibility",
        "Constraints are ramp-rate and interface caps",
        "Tension is peak demand versus stability",
        "Intervention is smoothing and segmentation",
        "Mechanism is staged injection",
        "Result is predictable dispatch",
        "Boundary is no raw plasma-to-grid"
      ]
    };

    const seed = K[domain] || ["—","—","—","—","—","—","—"];
    const baseLine = seed[pIndex] || "—";
    const extra = formal
      ? [
          `This is written for ${timeWord} posture.`,
          `This remains inside Industrial (C) public posture.`,
          `This remains measurable at the boundary.`,
          `This remains replayable under audit.`,
          `This remains constrained under pressure.`,
          `This remains compatible with phase gating.`
        ]
      : [
          `This is written for ${timeWord} posture.`,
          `This stays in Industrial (C).`,
          `This is measurable.`,
          `This is audit-ready.`,
          `This is bounded.`,
          `This stays phase-gated.`
        ];

    const lead = formal
      ? `${baseLine}, ${dir} it remains enforceable.`
      : `${baseLine}, ${dir} it stays real.`;

    return S(
      lead,
      extra[0],
      extra[1],
      extra[2],
      extra[3],
      extra[4],
      extra[5]
    );
  }

  function buildStackRow(domainKey){
    const row=document.createElement("div");
    row.className="stackRow";
    row.style.setProperty("--domc", DOMAIN_COLORS[domainKey]);

    const head=document.createElement("div");
    head.className="stackHead";

    const left=document.createElement("div");
    left.className="stackLeft";

    const bar=document.createElement("div");
    bar.className="stackBar";
    bar.style.background = DOMAIN_COLORS[domainKey];

    const title=document.createElement("div");
    title.className="stackTitle";
    title.textContent = domainKey;

    const sub=document.createElement("div");
    sub.className="stackSub";
    sub.textContent = `${section} · ${causality} · ${(gdTime==="origin")?"CONCEPT":(gdTime==="now")?"LIVE":"ROADMAP"} · ${gdStyle.toUpperCase()}`;

    left.appendChild(bar);
    left.appendChild(title);
    left.appendChild(sub);

    const chev=document.createElement("div");
    chev.className="stackChevron";
    chev.textContent = "▸";

    head.appendChild(left);
    head.appendChild(chev);

    const body=document.createElement("div");
    body.className="stackBody";

    for(let i=0;i<7;i++){
      const box=document.createElement("div");
      box.className="pblock";
      const pid = `p_${domainKey.replace(/[^a-z0-9]+/gi,"_")}_${i}`;
      box.id = pid;

      const ph=document.createElement("div");
      ph.className="ph";
      ph.textContent = PHEAD[i];

      const ul=document.createElement("ul");
      ul.className="pul";

      const sents = build7(domainKey, i);
      for(const sentence of sents){
        const li=document.createElement("li");
        li.textContent = sentence;
        ul.appendChild(li);
      }

      box.appendChild(ph);
      box.appendChild(ul);
      box.addEventListener("click", ()=>{ RS.anchorId = pid; });
      body.appendChild(box);
    }

    head.addEventListener("click", ()=>{
      RS.anchorId = `p_${domainKey.replace(/[^a-z0-9]+/gi,"_")}_0`;
      const open = row.classList.toggle("open");
      if(open){ RS.open.add(domainKey); chev.textContent="▾"; }
      else { RS.open.delete(domainKey); chev.textContent="▸"; }
    });

    row.appendChild(head);
    row.appendChild(body);
    return row;
  }

  function renderStacks(){
    stackList.innerHTML="";
    DOMAINS.forEach(d=>{
      const el = buildStackRow(d);
      if(RS.open.has(d)){
        el.classList.add("open");
        el.querySelector(".stackChevron").textContent="▾";
      }
      stackList.appendChild(el);
    });
  }

  let anchorTick=0;
  function updateAnchorFromScroll(){
    if(anchorTick) return;
    anchorTick=requestAnimationFrame(()=>{
      anchorTick=0;
      const blocks = stackList.querySelectorAll(".pblock");
      let best=null, bestDist=1e9;
      const targetTop=160;
      blocks.forEach(b=>{
        const r=b.getBoundingClientRect();
        const d=Math.abs(r.top-targetTop);
        if(d<bestDist){bestDist=d;best=b;}
      });
      if(best) RS.anchorId=best.id;
    });
  }

  function restoreReadingPosition(){
    mbody.scrollTop = RS.scrollTop || 0;
    if(RS.anchorId){
      const node = document.getElementById(RS.anchorId);
      if(node){
        node.scrollIntoView({block:"start", behavior:"auto"});
        mbody.scrollTop = Math.max(0, mbody.scrollTop - 160);
      }
    }
  }

  function renderAllPreserve(){
    RS.scrollTop = mbody.scrollTop;
    renderPills();
    headerLines();
    renderStacks();
    requestAnimationFrame(restoreReadingPosition);
  }

  function openModal(sec){
    section=sec;
    mTitle.textContent = `ENERGY · ${section}`;
    bd.classList.add("show");
    modal.classList.add("show");
    renderAllPreserve();
  }
  function closeModal(){
    bd.classList.remove("show");
    modal.classList.remove("show");
  }

  // close
  bd.addEventListener("click", closeModal);
  mClose.addEventListener("click", closeModal);
  mReturn.addEventListener("click", closeModal);

  // lens changes preserve reading
  pillFormal.addEventListener("click", ()=>{ gdStyle="formal"; try{localStorage.setItem("gd_style",gdStyle);}catch(e){} renderAllPreserve(); });
  pillInformal.addEventListener("click", ()=>{ gdStyle="informal"; try{localStorage.setItem("gd_style",gdStyle);}catch(e){} renderAllPreserve(); });
  pillCause.addEventListener("click", ()=>{ causality="CAUSE"; renderAllPreserve(); });
  pillEffect.addEventListener("click", ()=>{ causality="EFFECT"; renderAllPreserve(); });
  pillConcept.addEventListener("click", ()=>{ gdTime="origin"; try{localStorage.setItem("gd_time",gdTime);}catch(e){} renderAllPreserve(); });
  pillLive.addEventListener("click", ()=>{ gdTime="now"; try{localStorage.setItem("gd_time",gdTime);}catch(e){} renderAllPreserve(); });
  pillRoadmap.addEventListener("click", ()=>{ gdTime="post"; try{localStorage.setItem("gd_time",gdTime);}catch(e){} renderAllPreserve(); });

  mbody.addEventListener("scroll", updateAnchorFromScroll, {passive:true});

  // Bind diamonds FIRST (always open)
  function bindDiamond(id, sec){
    const el=document.getElementById(id);
    if(!el) return;
    el.addEventListener("click", ()=>openModal(sec));
    el.addEventListener("keydown",(e)=>{ if(e.key==="Enter"||e.key===" "){ e.preventDefault(); openModal(sec);} });
  }
  bindDiamond("diamondFoundation","FOUNDATION");
  bindDiamond("diamondArchitecture","ARCHITECTURE");
  bindDiamond("diamondPerformance","PERFORMANCE");
  bindDiamond("diamondGovernance","GOVERNANCE");
})();
</script>

</body>
</html>
